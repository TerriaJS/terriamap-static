"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
((self || window)["webpackChunkterriajs_map"] = (self || window)["webpackChunkterriajs_map"] || []).push([["packages_terriajs_lib_Models_Leaflet_ts"],{

/***/ "./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletGridLayer.ts":
/*!******************************************************************************!*\
  !*** ./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletGridLayer.ts ***!
  \******************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ ImageryProviderLeafletGridLayer),\n/* harmony export */   isImageryProviderGridLayer: () => (/* binding */ isImageryProviderGridLayer)\n/* harmony export */ });\n/* harmony import */ var core_js_modules_es_array_reverse_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! core-js/modules/es.array.reverse.js */ \"./node_modules/core-js/modules/es.array.reverse.js\");\n/* harmony import */ var core_js_modules_es_array_reverse_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(core_js_modules_es_array_reverse_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var leaflet__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\");\n/* harmony import */ var leaflet__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(leaflet__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var mobx__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! mobx */ \"./node_modules/mobx/dist/mobx.esm.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_Cartographic__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Cartographic */ \"./node_modules/terriajs-cesium/Source/Core/Cartographic.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_Event__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Event */ \"./node_modules/terriajs-cesium/Source/Core/Event.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Math */ \"./node_modules/terriajs-cesium/Source/Core/Math.js\");\n/* harmony import */ var terriajs_cesium_Source_Scene_SplitDirection__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! terriajs-cesium/Source/Scene/SplitDirection */ \"./node_modules/terriajs-cesium/Source/Scene/SplitDirection.js\");\n\nvar _class, _descriptor, _descriptor2;\nfunction _initializerDefineProperty(e, i, r, l) { r && Object.defineProperty(e, i, { enumerable: r.enumerable, configurable: r.configurable, writable: r.writable, value: r.initializer ? r.initializer.call(l) : void 0 }); }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction _applyDecoratedDescriptor(i, e, r, n, l) { var a = {}; return Object.keys(n).forEach(function (i) { a[i] = n[i]; }), a.enumerable = !!a.enumerable, a.configurable = !!a.configurable, (\"value\" in a || a.initializer) && (a.writable = !0), a = r.slice().reverse().reduce(function (r, n) { return n(i, e, r) || r; }, a), l && void 0 !== a.initializer && (a.value = a.initializer ? a.initializer.call(l) : void 0, a.initializer = void 0), void 0 === a.initializer ? (Object.defineProperty(i, e, a), null) : a; }\nfunction _initializerWarningHelper(r, e) { throw Error(\"Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.\"); }\n\n\n\n\n\n\nconst isImageryProviderGridLayer = obj => {\n  return typeof obj.requestImageForCanvas === \"function\";\n};\nlet ImageryProviderLeafletGridLayer = (_class = class ImageryProviderLeafletGridLayer extends (leaflet__WEBPACK_IMPORTED_MODULE_1___default().GridLayer) {\n  constructor(leaflet, imageryProvider, options) {\n    super(Object.assign(options, {\n      async: true,\n      tileSize: 256\n    }));\n    this.leaflet = leaflet;\n    this.imageryProvider = imageryProvider;\n    _defineProperty(this, \"errorEvent\", new terriajs_cesium_Source_Core_Event__WEBPACK_IMPORTED_MODULE_4__[\"default\"]());\n    _defineProperty(this, \"initialized\", false);\n    _defineProperty(this, \"_usable\", false);\n    _defineProperty(this, \"_delayedUpdate\", undefined);\n    _defineProperty(this, \"_zSubtract\", 0);\n    _defineProperty(this, \"_previousCredits\", []);\n    _initializerDefineProperty(this, \"splitDirection\", _descriptor, this);\n    _initializerDefineProperty(this, \"splitPosition\", _descriptor2, this);\n    (0,mobx__WEBPACK_IMPORTED_MODULE_2__.makeObservable)(this);\n\n    // Handle splitter rection (and disposing reaction)\n    let disposeSplitterReaction;\n    this.on(\"add\", () => {\n      if (!disposeSplitterReaction) {\n        disposeSplitterReaction = this._reactToSplitterChange();\n      }\n    });\n    this.on(\"remove\", () => {\n      if (disposeSplitterReaction) {\n        disposeSplitterReaction();\n        disposeSplitterReaction = undefined;\n      }\n    });\n  }\n  _reactToSplitterChange() {\n    return (0,mobx__WEBPACK_IMPORTED_MODULE_2__.autorun)(() => {\n      const container = this.getContainer();\n      if (container === null) {\n        return;\n      }\n      if (this.splitDirection === terriajs_cesium_Source_Scene_SplitDirection__WEBPACK_IMPORTED_MODULE_6__[\"default\"].LEFT) {\n        const {\n          left: clipLeft\n        } = this._clipsForSplitter;\n        container.style.clip = clipLeft;\n      } else if (this.splitDirection === terriajs_cesium_Source_Scene_SplitDirection__WEBPACK_IMPORTED_MODULE_6__[\"default\"].RIGHT) {\n        const {\n          right: clipRight\n        } = this._clipsForSplitter;\n        container.style.clip = clipRight;\n      } else {\n        container.style.clip = \"auto\";\n      }\n    });\n  }\n  get _clipsForSplitter() {\n    let clipLeft = \"\";\n    let clipRight = \"\";\n    let clipPositionWithinMap;\n    let clipX;\n    if (this.leaflet.size && this.leaflet.nw && this.leaflet.se) {\n      clipPositionWithinMap = this.leaflet.size.x * this.splitPosition;\n      clipX = Math.round(this.leaflet.nw.x + clipPositionWithinMap);\n      clipLeft = \"rect(\" + [this.leaflet.nw.y, clipX, this.leaflet.se.y, this.leaflet.nw.x].join(\"px,\") + \"px)\";\n      clipRight = \"rect(\" + [this.leaflet.nw.y, this.leaflet.se.x, this.leaflet.se.y, clipX].join(\"px,\") + \"px)\";\n    }\n    return {\n      left: clipLeft,\n      right: clipRight,\n      clipPositionWithinMap: clipPositionWithinMap,\n      clipX: clipX\n    };\n  }\n  createTile(tilePoint, done) {\n    const canvas = leaflet__WEBPACK_IMPORTED_MODULE_1___default().DomUtil.create(\"canvas\", \"leaflet-tile\");\n    const size = this.getTileSize();\n    canvas.width = size.x;\n    canvas.height = size.y;\n    const n = this.imageryProvider.tilingScheme.getNumberOfXTilesAtLevel(tilePoint.z);\n    this.imageryProvider.requestImageForCanvas(terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_5__[\"default\"].mod(tilePoint.x, n), tilePoint.y, tilePoint.z, canvas).then(function (canvas) {\n      done(undefined, canvas);\n    });\n    return canvas; // Not yet drawn on, but Leaflet requires the tile\n  }\n  getFeaturePickingCoords(map, longitudeRadians, latitudeRadians) {\n    const ll = new terriajs_cesium_Source_Core_Cartographic__WEBPACK_IMPORTED_MODULE_3__[\"default\"](terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_5__[\"default\"].negativePiToPi(longitudeRadians), latitudeRadians, 0.0);\n    const level = Math.round(map.getZoom());\n    const tilingScheme = this.imageryProvider.tilingScheme;\n    const coords = tilingScheme.positionToTileXY(ll, level);\n    return {\n      x: coords.x,\n      y: coords.y,\n      level: level\n    };\n  }\n  pickFeatures(x, y, level, longitudeRadians, latitudeRadians) {\n    return this.imageryProvider.pickFeatures(x, y, level, longitudeRadians, latitudeRadians);\n  }\n}, _descriptor = _applyDecoratedDescriptor(_class.prototype, \"splitDirection\", [mobx__WEBPACK_IMPORTED_MODULE_2__.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return terriajs_cesium_Source_Scene_SplitDirection__WEBPACK_IMPORTED_MODULE_6__[\"default\"].NONE;\n  }\n}), _descriptor2 = _applyDecoratedDescriptor(_class.prototype, \"splitPosition\", [mobx__WEBPACK_IMPORTED_MODULE_2__.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return 0.5;\n  }\n}), _applyDecoratedDescriptor(_class.prototype, \"_clipsForSplitter\", [mobx__WEBPACK_IMPORTED_MODULE_2__.computed], Object.getOwnPropertyDescriptor(_class.prototype, \"_clipsForSplitter\"), _class.prototype), _class);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXQvSW1hZ2VyeVByb3ZpZGVyTGVhZmxldEdyaWRMYXllci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBYUE7QUFHQTtBQUNBO0FBQUE7QUFhQTtBQUtBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFKQTtBQUNBO0FBWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFZQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBTUE7QUFNQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUVBO0FBR0E7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBS0E7QUFLQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQU9BO0FBT0E7QUFDQTtBQTNJQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdGVycmlhanMtbWFwLy4vcGFja2FnZXMvdGVycmlhanMvbGliL01hcC9MZWFmbGV0L0ltYWdlcnlQcm92aWRlckxlYWZsZXRHcmlkTGF5ZXIudHM/MmMzZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTCBmcm9tIFwibGVhZmxldFwiO1xuaW1wb3J0IHtcbiAgYXV0b3J1bixcbiAgY29tcHV0ZWQsXG4gIElSZWFjdGlvbkRpc3Bvc2VyLFxuICBvYnNlcnZhYmxlLFxuICBtYWtlT2JzZXJ2YWJsZVxufSBmcm9tIFwibW9ieFwiO1xuaW1wb3J0IENhcnRvZ3JhcGhpYyBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0NhcnRvZ3JhcGhpY1wiO1xuaW1wb3J0IENlc2l1bUV2ZW50IGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvRXZlbnRcIjtcbmltcG9ydCBDZXNpdW1NYXRoIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvTWF0aFwiO1xuaW1wb3J0IFNwbGl0RGlyZWN0aW9uIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL1NjZW5lL1NwbGl0RGlyZWN0aW9uXCI7XG5pbXBvcnQgTGVhZmxldCBmcm9tIFwiLi4vLi4vTW9kZWxzL0xlYWZsZXRcIjtcbmltcG9ydCBJbWFnZXJ5UHJvdmlkZXIgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvU2NlbmUvSW1hZ2VyeVByb3ZpZGVyXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSW1hZ2VyeVByb3ZpZGVyV2l0aEdyaWRMYXllclN1cHBvcnQgZXh0ZW5kcyBJbWFnZXJ5UHJvdmlkZXIge1xuICByZXF1ZXN0SW1hZ2VGb3JDYW52YXM6IChcbiAgICB4OiBudW1iZXIsXG4gICAgeTogbnVtYmVyLFxuICAgIGxldmVsOiBudW1iZXIsXG4gICAgY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudFxuICApID0+IFByb21pc2U8SFRNTENhbnZhc0VsZW1lbnQ+O1xufVxuXG5leHBvcnQgY29uc3QgaXNJbWFnZXJ5UHJvdmlkZXJHcmlkTGF5ZXIgPSAoXG4gIG9iajogYW55XG4pOiBvYmogaXMgSW1hZ2VyeVByb3ZpZGVyV2l0aEdyaWRMYXllclN1cHBvcnQgPT4ge1xuICByZXR1cm4gdHlwZW9mIG9iai5yZXF1ZXN0SW1hZ2VGb3JDYW52YXMgPT09IFwiZnVuY3Rpb25cIjtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEltYWdlcnlQcm92aWRlckxlYWZsZXRHcmlkTGF5ZXIgZXh0ZW5kcyBMLkdyaWRMYXllciB7XG4gIHJlYWRvbmx5IGVycm9yRXZlbnQ6IENlc2l1bUV2ZW50ID0gbmV3IENlc2l1bUV2ZW50KCk7XG4gIHJlYWRvbmx5IGluaXRpYWxpemVkOiBib29sZWFuID0gZmFsc2U7XG4gIHJlYWRvbmx5IF91c2FibGU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcmVhZG9ubHkgX2RlbGF5ZWRVcGRhdGU6IHVua25vd24gPSB1bmRlZmluZWQ7XG4gIHJlYWRvbmx5IF96U3VidHJhY3Q6IG51bWJlciA9IDA7XG4gIHJlYWRvbmx5IF9wcmV2aW91c0NyZWRpdHM6IHVua25vd25bXSA9IFtdO1xuXG4gIEBvYnNlcnZhYmxlIHNwbGl0RGlyZWN0aW9uID0gU3BsaXREaXJlY3Rpb24uTk9ORTtcbiAgQG9ic2VydmFibGUgc3BsaXRQb3NpdGlvbjogbnVtYmVyID0gMC41O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgbGVhZmxldDogTGVhZmxldCxcbiAgICByZWFkb25seSBpbWFnZXJ5UHJvdmlkZXI6IEltYWdlcnlQcm92aWRlcldpdGhHcmlkTGF5ZXJTdXBwb3J0LFxuICAgIG9wdGlvbnM6IEwuR3JpZExheWVyT3B0aW9uc1xuICApIHtcbiAgICBzdXBlcihPYmplY3QuYXNzaWduKG9wdGlvbnMsIHsgYXN5bmM6IHRydWUsIHRpbGVTaXplOiAyNTYgfSkpO1xuXG4gICAgbWFrZU9ic2VydmFibGUodGhpcyk7XG5cbiAgICAvLyBIYW5kbGUgc3BsaXR0ZXIgcmVjdGlvbiAoYW5kIGRpc3Bvc2luZyByZWFjdGlvbilcbiAgICBsZXQgZGlzcG9zZVNwbGl0dGVyUmVhY3Rpb246IElSZWFjdGlvbkRpc3Bvc2VyIHwgdW5kZWZpbmVkO1xuICAgIHRoaXMub24oXCJhZGRcIiwgKCkgPT4ge1xuICAgICAgaWYgKCFkaXNwb3NlU3BsaXR0ZXJSZWFjdGlvbikge1xuICAgICAgICBkaXNwb3NlU3BsaXR0ZXJSZWFjdGlvbiA9IHRoaXMuX3JlYWN0VG9TcGxpdHRlckNoYW5nZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMub24oXCJyZW1vdmVcIiwgKCkgPT4ge1xuICAgICAgaWYgKGRpc3Bvc2VTcGxpdHRlclJlYWN0aW9uKSB7XG4gICAgICAgIGRpc3Bvc2VTcGxpdHRlclJlYWN0aW9uKCk7XG4gICAgICAgIGRpc3Bvc2VTcGxpdHRlclJlYWN0aW9uID0gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgX3JlYWN0VG9TcGxpdHRlckNoYW5nZSgpIHtcbiAgICByZXR1cm4gYXV0b3J1bigoKSA9PiB7XG4gICAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLmdldENvbnRhaW5lcigpO1xuICAgICAgaWYgKGNvbnRhaW5lciA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLnNwbGl0RGlyZWN0aW9uID09PSBTcGxpdERpcmVjdGlvbi5MRUZUKSB7XG4gICAgICAgIGNvbnN0IHsgbGVmdDogY2xpcExlZnQgfSA9IHRoaXMuX2NsaXBzRm9yU3BsaXR0ZXI7XG4gICAgICAgIGNvbnRhaW5lci5zdHlsZS5jbGlwID0gY2xpcExlZnQ7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuc3BsaXREaXJlY3Rpb24gPT09IFNwbGl0RGlyZWN0aW9uLlJJR0hUKSB7XG4gICAgICAgIGNvbnN0IHsgcmlnaHQ6IGNsaXBSaWdodCB9ID0gdGhpcy5fY2xpcHNGb3JTcGxpdHRlcjtcbiAgICAgICAgY29udGFpbmVyLnN0eWxlLmNsaXAgPSBjbGlwUmlnaHQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb250YWluZXIuc3R5bGUuY2xpcCA9IFwiYXV0b1wiO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgQGNvbXB1dGVkXG4gIGdldCBfY2xpcHNGb3JTcGxpdHRlcigpIHtcbiAgICBsZXQgY2xpcExlZnQgPSBcIlwiO1xuICAgIGxldCBjbGlwUmlnaHQgPSBcIlwiO1xuICAgIGxldCBjbGlwUG9zaXRpb25XaXRoaW5NYXA7XG4gICAgbGV0IGNsaXBYO1xuXG4gICAgaWYgKHRoaXMubGVhZmxldC5zaXplICYmIHRoaXMubGVhZmxldC5udyAmJiB0aGlzLmxlYWZsZXQuc2UpIHtcbiAgICAgIGNsaXBQb3NpdGlvbldpdGhpbk1hcCA9IHRoaXMubGVhZmxldC5zaXplLnggKiB0aGlzLnNwbGl0UG9zaXRpb247XG4gICAgICBjbGlwWCA9IE1hdGgucm91bmQodGhpcy5sZWFmbGV0Lm53LnggKyBjbGlwUG9zaXRpb25XaXRoaW5NYXApO1xuICAgICAgY2xpcExlZnQgPVxuICAgICAgICBcInJlY3QoXCIgK1xuICAgICAgICBbdGhpcy5sZWFmbGV0Lm53LnksIGNsaXBYLCB0aGlzLmxlYWZsZXQuc2UueSwgdGhpcy5sZWFmbGV0Lm53LnhdLmpvaW4oXG4gICAgICAgICAgXCJweCxcIlxuICAgICAgICApICtcbiAgICAgICAgXCJweClcIjtcbiAgICAgIGNsaXBSaWdodCA9XG4gICAgICAgIFwicmVjdChcIiArXG4gICAgICAgIFt0aGlzLmxlYWZsZXQubncueSwgdGhpcy5sZWFmbGV0LnNlLngsIHRoaXMubGVhZmxldC5zZS55LCBjbGlwWF0uam9pbihcbiAgICAgICAgICBcInB4LFwiXG4gICAgICAgICkgK1xuICAgICAgICBcInB4KVwiO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBsZWZ0OiBjbGlwTGVmdCxcbiAgICAgIHJpZ2h0OiBjbGlwUmlnaHQsXG4gICAgICBjbGlwUG9zaXRpb25XaXRoaW5NYXA6IGNsaXBQb3NpdGlvbldpdGhpbk1hcCxcbiAgICAgIGNsaXBYOiBjbGlwWFxuICAgIH07XG4gIH1cblxuICBjcmVhdGVUaWxlKHRpbGVQb2ludDogTC5Db29yZHMsIGRvbmU6IEwuRG9uZUNhbGxiYWNrKSB7XG4gICAgY29uc3QgY2FudmFzID0gTC5Eb21VdGlsLmNyZWF0ZShcbiAgICAgIFwiY2FudmFzXCIsXG4gICAgICBcImxlYWZsZXQtdGlsZVwiXG4gICAgKSBhcyBIVE1MQ2FudmFzRWxlbWVudDtcbiAgICBjb25zdCBzaXplID0gdGhpcy5nZXRUaWxlU2l6ZSgpO1xuICAgIGNhbnZhcy53aWR0aCA9IHNpemUueDtcbiAgICBjYW52YXMuaGVpZ2h0ID0gc2l6ZS55O1xuXG4gICAgY29uc3QgbiA9IHRoaXMuaW1hZ2VyeVByb3ZpZGVyLnRpbGluZ1NjaGVtZS5nZXROdW1iZXJPZlhUaWxlc0F0TGV2ZWwoXG4gICAgICB0aWxlUG9pbnQuelxuICAgICk7XG4gICAgdGhpcy5pbWFnZXJ5UHJvdmlkZXJcbiAgICAgIC5yZXF1ZXN0SW1hZ2VGb3JDYW52YXMoXG4gICAgICAgIENlc2l1bU1hdGgubW9kKHRpbGVQb2ludC54LCBuKSxcbiAgICAgICAgdGlsZVBvaW50LnksXG4gICAgICAgIHRpbGVQb2ludC56LFxuICAgICAgICBjYW52YXNcbiAgICAgIClcbiAgICAgIC50aGVuKGZ1bmN0aW9uIChjYW52YXMpIHtcbiAgICAgICAgZG9uZSh1bmRlZmluZWQsIGNhbnZhcyk7XG4gICAgICB9KTtcbiAgICByZXR1cm4gY2FudmFzOyAvLyBOb3QgeWV0IGRyYXduIG9uLCBidXQgTGVhZmxldCByZXF1aXJlcyB0aGUgdGlsZVxuICB9XG5cbiAgZ2V0RmVhdHVyZVBpY2tpbmdDb29yZHMoXG4gICAgbWFwOiBMLk1hcCxcbiAgICBsb25naXR1ZGVSYWRpYW5zOiBudW1iZXIsXG4gICAgbGF0aXR1ZGVSYWRpYW5zOiBudW1iZXJcbiAgKSB7XG4gICAgY29uc3QgbGwgPSBuZXcgQ2FydG9ncmFwaGljKFxuICAgICAgQ2VzaXVtTWF0aC5uZWdhdGl2ZVBpVG9QaShsb25naXR1ZGVSYWRpYW5zKSxcbiAgICAgIGxhdGl0dWRlUmFkaWFucyxcbiAgICAgIDAuMFxuICAgICk7XG4gICAgY29uc3QgbGV2ZWwgPSBNYXRoLnJvdW5kKG1hcC5nZXRab29tKCkpO1xuXG4gICAgY29uc3QgdGlsaW5nU2NoZW1lID0gdGhpcy5pbWFnZXJ5UHJvdmlkZXIudGlsaW5nU2NoZW1lO1xuICAgIGNvbnN0IGNvb3JkcyA9IHRpbGluZ1NjaGVtZS5wb3NpdGlvblRvVGlsZVhZKGxsLCBsZXZlbCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHg6IGNvb3Jkcy54LFxuICAgICAgeTogY29vcmRzLnksXG4gICAgICBsZXZlbDogbGV2ZWxcbiAgICB9O1xuICB9XG5cbiAgcGlja0ZlYXR1cmVzKFxuICAgIHg6IG51bWJlcixcbiAgICB5OiBudW1iZXIsXG4gICAgbGV2ZWw6IG51bWJlcixcbiAgICBsb25naXR1ZGVSYWRpYW5zOiBudW1iZXIsXG4gICAgbGF0aXR1ZGVSYWRpYW5zOiBudW1iZXJcbiAgKSB7XG4gICAgcmV0dXJuIHRoaXMuaW1hZ2VyeVByb3ZpZGVyLnBpY2tGZWF0dXJlcyhcbiAgICAgIHgsXG4gICAgICB5LFxuICAgICAgbGV2ZWwsXG4gICAgICBsb25naXR1ZGVSYWRpYW5zLFxuICAgICAgbGF0aXR1ZGVSYWRpYW5zXG4gICAgKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletGridLayer.ts\n\n}");

/***/ }),

/***/ "./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletTileLayer.ts":
/*!******************************************************************************!*\
  !*** ./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletTileLayer.ts ***!
  \******************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ ImageryProviderLeafletTileLayer)\n/* harmony export */ });\n/* harmony import */ var core_js_modules_es_array_reverse_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! core-js/modules/es.array.reverse.js */ \"./node_modules/core-js/modules/es.array.reverse.js\");\n/* harmony import */ var core_js_modules_es_array_reverse_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(core_js_modules_es_array_reverse_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var core_js_modules_web_dom_collections_iterator_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"./node_modules/core-js/modules/web.dom-collections.iterator.js\");\n/* harmony import */ var core_js_modules_web_dom_collections_iterator_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(core_js_modules_web_dom_collections_iterator_js__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var i18next__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! i18next */ \"./node_modules/i18next/dist/esm/i18next.js\");\n/* harmony import */ var leaflet__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\");\n/* harmony import */ var leaflet__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(leaflet__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var mobx__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! mobx */ \"./node_modules/mobx/dist/mobx.esm.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_Cartesian2__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Cartesian2 */ \"./node_modules/terriajs-cesium/Source/Core/Cartesian2.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_Cartographic__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Cartographic */ \"./node_modules/terriajs-cesium/Source/Core/Cartographic.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_Credit__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Credit */ \"./node_modules/terriajs-cesium/Source/Core/Credit.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_defined__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! terriajs-cesium/Source/Core/defined */ \"./node_modules/terriajs-cesium/Source/Core/defined.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_Event__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Event */ \"./node_modules/terriajs-cesium/Source/Core/Event.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Math */ \"./node_modules/terriajs-cesium/Source/Core/Math.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_TileProviderError__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! terriajs-cesium/Source/Core/TileProviderError */ \"./node_modules/terriajs-cesium/Source/Core/TileProviderError.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_WebMercatorTilingScheme__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! terriajs-cesium/Source/Core/WebMercatorTilingScheme */ \"./node_modules/terriajs-cesium/Source/Core/WebMercatorTilingScheme.js\");\n/* harmony import */ var terriajs_cesium_Source_Scene_SplitDirection__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! terriajs-cesium/Source/Scene/SplitDirection */ \"./node_modules/terriajs-cesium/Source/Scene/SplitDirection.js\");\n/* harmony import */ var _Core_isDefined__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../Core/isDefined */ \"./packages/terriajs/lib/Core/isDefined.ts\");\n/* harmony import */ var _Core_TerriaError__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../Core/TerriaError */ \"./packages/terriajs/lib/Core/TerriaError.ts\");\n/* harmony import */ var _ImageryProvider_getUrlForImageryTile__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../ImageryProvider/getUrlForImageryTile */ \"./packages/terriajs/lib/Map/ImageryProvider/getUrlForImageryTile.ts\");\nvar _class, _descriptor, _descriptor2;\nfunction _initializerDefineProperty(e, i, r, l) { r && Object.defineProperty(e, i, { enumerable: r.enumerable, configurable: r.configurable, writable: r.writable, value: r.initializer ? r.initializer.call(l) : void 0 }); }\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _applyDecoratedDescriptor(i, e, r, n, l) { var a = {}; return Object.keys(n).forEach(function (i) { a[i] = n[i]; }), a.enumerable = !!a.enumerable, a.configurable = !!a.configurable, (\"value\" in a || a.initializer) && (a.writable = !0), a = r.slice().reverse().reduce(function (r, n) { return n(i, e, r) || r; }, a), l && void 0 !== a.initializer && (a.value = a.initializer ? a.initializer.call(l) : void 0, a.initializer = void 0), void 0 === a.initializer ? (Object.defineProperty(i, e, a), null) : a; }\nfunction _initializerWarningHelper(r, e) { throw Error(\"Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.\"); }\n\n\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst swScratch = new terriajs_cesium_Source_Core_Cartographic__WEBPACK_IMPORTED_MODULE_6__[\"default\"]();\nconst neScratch = new terriajs_cesium_Source_Core_Cartographic__WEBPACK_IMPORTED_MODULE_6__[\"default\"]();\nconst swTileCoordinatesScratch = new terriajs_cesium_Source_Core_Cartesian2__WEBPACK_IMPORTED_MODULE_5__[\"default\"]();\nconst neTileCoordinatesScratch = new terriajs_cesium_Source_Core_Cartesian2__WEBPACK_IMPORTED_MODULE_5__[\"default\"]();\nclass Credit extends terriajs_cesium_Source_Core_Credit__WEBPACK_IMPORTED_MODULE_7__[\"default\"] {\n  constructor() {\n    super(...arguments);\n    _defineProperty(this, \"_shownInLeaflet\", void 0);\n    _defineProperty(this, \"_shownInLeafletLastUpdate\", void 0);\n  }\n}\nlet ImageryProviderLeafletTileLayer = (_class = class ImageryProviderLeafletTileLayer extends (leaflet__WEBPACK_IMPORTED_MODULE_3___default().TileLayer) {\n  constructor(leaflet, imageryProvider) {\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    super(undefined, _objectSpread(_objectSpread({}, options), {}, {\n      updateInterval: (0,terriajs_cesium_Source_Core_defined__WEBPACK_IMPORTED_MODULE_8__[\"default\"])(imageryProvider._leafletUpdateInterval) ? imageryProvider._leafletUpdateInterval : 100\n    }));\n    this.leaflet = leaflet;\n    this.imageryProvider = imageryProvider;\n    _defineProperty(this, \"tileSize\", 256);\n    _defineProperty(this, \"errorEvent\", new terriajs_cesium_Source_Core_Event__WEBPACK_IMPORTED_MODULE_9__[\"default\"]());\n    _defineProperty(this, \"initialized\", false);\n    _defineProperty(this, \"_usable\", false);\n    _defineProperty(this, \"_delayedUpdate\", void 0);\n    _defineProperty(this, \"_zSubtract\", 0);\n    _defineProperty(this, \"_requestImageError\", void 0);\n    _defineProperty(this, \"_previousCredits\", []);\n    _defineProperty(this, \"_leafletUpdateInterval\", void 0);\n    _initializerDefineProperty(this, \"splitDirection\", _descriptor, this);\n    _initializerDefineProperty(this, \"splitPosition\", _descriptor2, this);\n    (0,mobx__WEBPACK_IMPORTED_MODULE_4__.makeObservable)(this);\n    this.imageryProvider = imageryProvider;\n\n    // Handle splitter rection (and disposing reaction)\n    let disposeSplitterReaction;\n    this.on(\"add\", () => {\n      if (!disposeSplitterReaction) {\n        disposeSplitterReaction = this._reactToSplitterChange();\n      }\n    });\n    this.on(\"remove\", () => {\n      if (disposeSplitterReaction) {\n        disposeSplitterReaction();\n        disposeSplitterReaction = undefined;\n      }\n    });\n    this._leafletUpdateInterval = (0,terriajs_cesium_Source_Core_defined__WEBPACK_IMPORTED_MODULE_8__[\"default\"])(imageryProvider._leafletUpdateInterval) ? imageryProvider._leafletUpdateInterval : 100;\n\n    // Hack to fix \"Space between tiles on fractional zoom levels in Webkit browsers\" (https://github.com/Leaflet/Leaflet/issues/3575#issuecomment-688644225)\n    this.on(\"tileloadstart\", event => {\n      event.tile.style.width = this.getTileSize().x + 0.5 + \"px\";\n      event.tile.style.height = this.getTileSize().y + 0.5 + \"px\";\n    });\n  }\n  _reactToSplitterChange() {\n    return (0,mobx__WEBPACK_IMPORTED_MODULE_4__.autorun)(() => {\n      const container = this.getContainer();\n      if (container === null) {\n        return;\n      }\n      if (this.splitDirection === terriajs_cesium_Source_Scene_SplitDirection__WEBPACK_IMPORTED_MODULE_13__[\"default\"].LEFT) {\n        const {\n          left: clipLeft\n        } = this._clipsForSplitter;\n        container.style.clip = clipLeft;\n      } else if (this.splitDirection === terriajs_cesium_Source_Scene_SplitDirection__WEBPACK_IMPORTED_MODULE_13__[\"default\"].RIGHT) {\n        const {\n          right: clipRight\n        } = this._clipsForSplitter;\n        container.style.clip = clipRight;\n      } else {\n        container.style.clip = \"auto\";\n      }\n    });\n  }\n  get _clipsForSplitter() {\n    let clipLeft = \"\";\n    let clipRight = \"\";\n    let clipPositionWithinMap;\n    let clipX;\n    if (this.leaflet.size && this.leaflet.nw && this.leaflet.se) {\n      clipPositionWithinMap = this.leaflet.size.x * this.splitPosition;\n      clipX = Math.round(this.leaflet.nw.x + clipPositionWithinMap);\n      clipLeft = \"rect(\" + [this.leaflet.nw.y, clipX, this.leaflet.se.y, this.leaflet.nw.x].join(\"px,\") + \"px)\";\n      clipRight = \"rect(\" + [this.leaflet.nw.y, this.leaflet.se.x, this.leaflet.se.y, clipX].join(\"px,\") + \"px)\";\n    }\n    return {\n      left: clipLeft,\n      right: clipRight,\n      clipPositionWithinMap: clipPositionWithinMap,\n      clipX: clipX\n    };\n  }\n  _tileOnError(_done, _tile, _e) {\n    // Do nothing, we'll handle tile errors separately.\n  }\n  createTile(coords, done) {\n    // Create a tile (Image) as normal.\n    const tile = super.createTile(coords, done);\n\n    // By default, Leaflet handles tile load errors by setting the Image to the error URL and raising\n    // an error event.  We want to first raise an error event that optionally returns a promise and\n    // retries after the promise resolves.\n\n    const _doRequest = waitPromise => {\n      if (waitPromise) {\n        waitPromise.then(function () {\n          _doRequest();\n        }).catch(e => {\n          // The tile has failed irrecoverably, so invoke Leaflet's standard\n          // tile error handler.\n          leaflet__WEBPACK_IMPORTED_MODULE_3___default().TileLayer.prototype._tileOnError.call(this, done, tile, e);\n        });\n        return;\n      }\n\n      // Setting src will trigger a new load or error event, even if the\n      // new src is the same as the old one.\n      const tileUrl = this.getTileUrl(coords);\n      if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_14__[\"default\"])(tileUrl)) {\n        tile.src = tileUrl;\n      }\n    };\n    leaflet__WEBPACK_IMPORTED_MODULE_3___default().DomEvent.on(tile, \"error\", e => {\n      const level = this._getLevelFromZ(coords);\n      const message = i18next__WEBPACK_IMPORTED_MODULE_2__[\"default\"].t(\"map.cesium.failedToObtain\", {\n        x: coords.x,\n        y: coords.y,\n        level: level\n      });\n      this._requestImageError = terriajs_cesium_Source_Core_TileProviderError__WEBPACK_IMPORTED_MODULE_11__[\"default\"].reportError(this._requestImageError,\n      // TODO: Cesium type definitions incorrectly forbid undefined\n      this.imageryProvider, this.imageryProvider.errorEvent, message, coords.x, coords.y, level, e\n      // TODO: bring terriajs-cesium retry logic to cesium\n      //doRequest\n      );\n    });\n    return tile;\n  }\n  getTileUrl(tilePoint) {\n    const level = this._getLevelFromZ(tilePoint);\n    const errorTileUrl = this.options.errorTileUrl || \"\";\n    if (level < 0) {\n      return errorTileUrl;\n    }\n    return (0,_ImageryProvider_getUrlForImageryTile__WEBPACK_IMPORTED_MODULE_16__[\"default\"])(this.imageryProvider, tilePoint.x, tilePoint.y, level) || errorTileUrl;\n  }\n  _getLevelFromZ(tilePoint) {\n    return tilePoint.z - this._zSubtract;\n  }\n  _update() {\n    if (!this.initialized) {\n      this.initialized = true;\n\n      // Cancel the existing delayed update, if any.\n      if (this._delayedUpdate) {\n        clearTimeout(this._delayedUpdate);\n        this._delayedUpdate = undefined;\n      }\n      this._delayedUpdate = setTimeout(() => {\n        this._delayedUpdate = undefined;\n\n        // If we're no longer attached to a map, do nothing.\n        if (!this._map) {\n          return;\n        }\n        const tilingScheme = this.imageryProvider.tilingScheme;\n        if (!(tilingScheme instanceof terriajs_cesium_Source_Core_WebMercatorTilingScheme__WEBPACK_IMPORTED_MODULE_12__[\"default\"])) {\n          this.errorEvent.raiseEvent(this, i18next__WEBPACK_IMPORTED_MODULE_2__[\"default\"].t(\"map.cesium.notWebMercatorTilingScheme\"));\n          return;\n        }\n        if (tilingScheme.getNumberOfXTilesAtLevel(0) === 2 && tilingScheme.getNumberOfYTilesAtLevel(0) === 2) {\n          this._zSubtract = 1;\n        } else if (tilingScheme.getNumberOfXTilesAtLevel(0) !== 1 || tilingScheme.getNumberOfYTilesAtLevel(0) !== 1) {\n          this.errorEvent.raiseEvent(this, i18next__WEBPACK_IMPORTED_MODULE_2__[\"default\"].t(\"map.cesium.unusalTilingScheme\"));\n          return;\n        }\n        if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_14__[\"default\"])(this.imageryProvider.maximumLevel)) {\n          this.options.maxNativeZoom = this.imageryProvider.maximumLevel;\n        }\n        if ((0,terriajs_cesium_Source_Core_defined__WEBPACK_IMPORTED_MODULE_8__[\"default\"])(this.imageryProvider.minimumLevel)) {\n          this.options.minNativeZoom = this.imageryProvider.minimumLevel;\n        }\n        if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_14__[\"default\"])(this.imageryProvider.credit)) {\n          this._map.attributionControl.addAttribution(getCreditHtml(this.imageryProvider.credit));\n        }\n        this._usable = true;\n        this._update();\n      }, this._leafletUpdateInterval);\n    }\n    if (this._usable) {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      leaflet__WEBPACK_IMPORTED_MODULE_3___default().TileLayer.prototype._update.apply(this, args);\n      this._updateAttribution();\n    }\n  }\n  _updateAttribution() {\n    if (!this._usable || !(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_14__[\"default\"])(this.imageryProvider.getTileCredits)) {\n      return;\n    }\n    for (let i = 0; i < this._previousCredits.length; ++i) {\n      this._previousCredits[i]._shownInLeafletLastUpdate = this._previousCredits[i]._shownInLeaflet;\n      this._previousCredits[i]._shownInLeaflet = false;\n    }\n    const bounds = this._map.getBounds();\n    const zoom = this._map.getZoom() - this._zSubtract;\n    const tilingScheme = this.imageryProvider.tilingScheme;\n    swScratch.longitude = Math.max(terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_10__[\"default\"].negativePiToPi(terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_10__[\"default\"].toRadians(bounds.getWest())), tilingScheme.rectangle.west);\n    swScratch.latitude = Math.max(terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_10__[\"default\"].toRadians(bounds.getSouth()), tilingScheme.rectangle.south);\n    let sw = tilingScheme.positionToTileXY(swScratch, zoom, swTileCoordinatesScratch);\n    if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_14__[\"default\"])(sw)) {\n      sw = swTileCoordinatesScratch;\n      sw.x = 0;\n      sw.y = tilingScheme.getNumberOfYTilesAtLevel(zoom) - 1;\n    }\n    neScratch.longitude = Math.min(terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_10__[\"default\"].negativePiToPi(terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_10__[\"default\"].toRadians(bounds.getEast())), tilingScheme.rectangle.east);\n    neScratch.latitude = Math.min(terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_10__[\"default\"].toRadians(bounds.getNorth()), tilingScheme.rectangle.north);\n    let ne = tilingScheme.positionToTileXY(neScratch, zoom, neTileCoordinatesScratch);\n    if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_14__[\"default\"])(ne)) {\n      ne = neTileCoordinatesScratch;\n      ne.x = tilingScheme.getNumberOfXTilesAtLevel(zoom) - 1;\n      ne.y = 0;\n    }\n    const nextCredits = [];\n    for (let j = ne.y; j < sw.y; ++j) {\n      for (let i = sw.x; i < ne.x; ++i) {\n        const credits = this.imageryProvider.getTileCredits(i, j, zoom);\n        if (!(0,terriajs_cesium_Source_Core_defined__WEBPACK_IMPORTED_MODULE_8__[\"default\"])(credits)) {\n          continue;\n        }\n        for (let k = 0; k < credits.length; ++k) {\n          const credit = credits[k];\n          if (credit._shownInLeaflet) {\n            continue;\n          }\n          credit._shownInLeaflet = true;\n          nextCredits.push(credit);\n          if (!credit._shownInLeafletLastUpdate) {\n            this._map.attributionControl.addAttribution(getCreditHtml(credit));\n          }\n        }\n      }\n    }\n\n    // Remove attributions that applied last update but not this one.\n    for (let i = 0; i < this._previousCredits.length; ++i) {\n      if (!this._previousCredits[i]._shownInLeaflet) {\n        this._map.attributionControl.removeAttribution(getCreditHtml(this._previousCredits[i]));\n        this._previousCredits[i]._shownInLeafletLastUpdate = false;\n      }\n    }\n    this._previousCredits = nextCredits;\n  }\n  async getFeaturePickingCoords(map, longitudeRadians, latitudeRadians) {\n    const ll = new terriajs_cesium_Source_Core_Cartographic__WEBPACK_IMPORTED_MODULE_6__[\"default\"](terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_10__[\"default\"].negativePiToPi(longitudeRadians), latitudeRadians, 0.0);\n    const level = Math.round(map.getZoom());\n    const tilingScheme = this.imageryProvider.tilingScheme;\n    const coords = tilingScheme.positionToTileXY(ll, level);\n    return {\n      x: coords.x,\n      y: coords.y,\n      level: level\n    };\n  }\n  async pickFeatures(x, y, level, longitudeRadians, latitudeRadians) {\n    try {\n      return await this.imageryProvider.pickFeatures(x, y, level, longitudeRadians, latitudeRadians);\n    } catch (e) {\n      _Core_TerriaError__WEBPACK_IMPORTED_MODULE_15__[\"default\"].from(e, \"An error ocurred while calling `ImageryProvider#.pickFeatures`. `ImageryProvider.url = \".concat(this.imageryProvider.url, \"`\")).log();\n    }\n  }\n  onRemove(map) {\n    if (this._delayedUpdate) {\n      clearTimeout(this._delayedUpdate);\n      this._delayedUpdate = undefined;\n    }\n    for (let i = 0; i < this._previousCredits.length; ++i) {\n      this._previousCredits[i]._shownInLeafletLastUpdate = false;\n      this._previousCredits[i]._shownInLeaflet = false;\n      map.attributionControl.removeAttribution(getCreditHtml(this._previousCredits[i]));\n    }\n    if (this._usable && (0,terriajs_cesium_Source_Core_defined__WEBPACK_IMPORTED_MODULE_8__[\"default\"])(this.imageryProvider.credit)) {\n      map.attributionControl.removeAttribution(getCreditHtml(this.imageryProvider.credit));\n    }\n    leaflet__WEBPACK_IMPORTED_MODULE_3___default().TileLayer.prototype.onRemove.apply(this, [map]);\n\n    // Check that this cancels tile requests when dragging the time slider and rapidly creating\n    // and destroying layers.  If the image requests for previous times/layers are allowed to hang\n    // around, they clog up the pipeline and it takes approximately forever for the browser\n    // to get around to downloading the tiles that are actually needed.\n    this._abortLoading();\n    return this;\n  }\n}, _descriptor = _applyDecoratedDescriptor(_class.prototype, \"splitDirection\", [mobx__WEBPACK_IMPORTED_MODULE_4__.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return terriajs_cesium_Source_Scene_SplitDirection__WEBPACK_IMPORTED_MODULE_13__[\"default\"].NONE;\n  }\n}), _descriptor2 = _applyDecoratedDescriptor(_class.prototype, \"splitPosition\", [mobx__WEBPACK_IMPORTED_MODULE_4__.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return 0.5;\n  }\n}), _applyDecoratedDescriptor(_class.prototype, \"_clipsForSplitter\", [mobx__WEBPACK_IMPORTED_MODULE_4__.computed], Object.getOwnPropertyDescriptor(_class.prototype, \"_clipsForSplitter\"), _class.prototype), _class);\n\nfunction getCreditHtml(credit) {\n  return credit.element.outerHTML;\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXQvSW1hZ2VyeVByb3ZpZGVyTGVhZmxldFRpbGVMYXllci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFFQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQWlCQTtBQUlBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFUQTtBQUNBO0FBaEJBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFFQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBaUJBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFNQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBUUE7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBRUE7QUFJQTtBQUNBO0FBSUE7QUFJQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUdBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBL0RBO0FBQUE7QUFnRUE7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBRUE7QUFJQTtBQUlBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBSUE7QUFJQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBS0E7QUFLQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQU9BO0FBQ0E7QUFPQTtBQUNBO0FBTUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBRUE7QUFDQTtBQUdBO0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXJhQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBOERBO0FBd1dBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL3RlcnJpYWpzLW1hcC8uL3BhY2thZ2VzL3RlcnJpYWpzL2xpYi9NYXAvTGVhZmxldC9JbWFnZXJ5UHJvdmlkZXJMZWFmbGV0VGlsZUxheWVyLnRzP2UwYTUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGkxOG5leHQgZnJvbSBcImkxOG5leHRcIjtcbmltcG9ydCBMLCB7IFRpbGVFdmVudCB9IGZyb20gXCJsZWFmbGV0XCI7XG5pbXBvcnQge1xuICBhdXRvcnVuLFxuICBjb21wdXRlZCxcbiAgSVJlYWN0aW9uRGlzcG9zZXIsXG4gIG9ic2VydmFibGUsXG4gIG1ha2VPYnNlcnZhYmxlXG59IGZyb20gXCJtb2J4XCI7XG5pbXBvcnQgQ2FydGVzaWFuMiBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0NhcnRlc2lhbjJcIjtcbmltcG9ydCBDYXJ0b2dyYXBoaWMgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9DYXJ0b2dyYXBoaWNcIjtcbmltcG9ydCBDZXNpdW1DcmVkaXQgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9DcmVkaXRcIjtcbmltcG9ydCBkZWZpbmVkIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvZGVmaW5lZFwiO1xuaW1wb3J0IENlc2l1bUV2ZW50IGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvRXZlbnRcIjtcbmltcG9ydCBDZXNpdW1NYXRoIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvTWF0aFwiO1xuaW1wb3J0IFRpbGVQcm92aWRlckVycm9yIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvVGlsZVByb3ZpZGVyRXJyb3JcIjtcbmltcG9ydCBXZWJNZXJjYXRvclRpbGluZ1NjaGVtZSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL1dlYk1lcmNhdG9yVGlsaW5nU2NoZW1lXCI7XG5pbXBvcnQgSW1hZ2VyeUxheWVyRmVhdHVyZUluZm8gZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvU2NlbmUvSW1hZ2VyeUxheWVyRmVhdHVyZUluZm9cIjtcbmltcG9ydCBJbWFnZXJ5UHJvdmlkZXIgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvU2NlbmUvSW1hZ2VyeVByb3ZpZGVyXCI7XG5pbXBvcnQgU3BsaXREaXJlY3Rpb24gZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvU2NlbmUvU3BsaXREaXJlY3Rpb25cIjtcbmltcG9ydCBpc0RlZmluZWQgZnJvbSBcIi4uLy4uL0NvcmUvaXNEZWZpbmVkXCI7XG5pbXBvcnQgVGVycmlhRXJyb3IgZnJvbSBcIi4uLy4uL0NvcmUvVGVycmlhRXJyb3JcIjtcbmltcG9ydCBMZWFmbGV0IGZyb20gXCIuLi8uLi9Nb2RlbHMvTGVhZmxldFwiO1xuaW1wb3J0IGdldFVybEZvckltYWdlcnlUaWxlIGZyb20gXCIuLi9JbWFnZXJ5UHJvdmlkZXIvZ2V0VXJsRm9ySW1hZ2VyeVRpbGVcIjtcbmltcG9ydCB7IFByb3ZpZGVyQ29vcmRzIH0gZnJvbSBcIi4uL1BpY2tlZEZlYXR1cmVzL1BpY2tlZEZlYXR1cmVzXCI7XG5cbmNvbnN0IHN3U2NyYXRjaCA9IG5ldyBDYXJ0b2dyYXBoaWMoKTtcbmNvbnN0IG5lU2NyYXRjaCA9IG5ldyBDYXJ0b2dyYXBoaWMoKTtcbmNvbnN0IHN3VGlsZUNvb3JkaW5hdGVzU2NyYXRjaCA9IG5ldyBDYXJ0ZXNpYW4yKCk7XG5jb25zdCBuZVRpbGVDb29yZGluYXRlc1NjcmF0Y2ggPSBuZXcgQ2FydGVzaWFuMigpO1xuXG5jbGFzcyBDcmVkaXQgZXh0ZW5kcyBDZXNpdW1DcmVkaXQge1xuICBfc2hvd25JbkxlYWZsZXQ/OiBib29sZWFuO1xuICBfc2hvd25JbkxlYWZsZXRMYXN0VXBkYXRlPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSW1hZ2VyeVByb3ZpZGVyTGVhZmxldFRpbGVMYXllciBleHRlbmRzIEwuVGlsZUxheWVyIHtcbiAgcmVhZG9ubHkgdGlsZVNpemUgPSAyNTY7XG4gIHJlYWRvbmx5IGVycm9yRXZlbnQgPSBuZXcgQ2VzaXVtRXZlbnQoKTtcblxuICBwcml2YXRlIGluaXRpYWxpemVkID0gZmFsc2U7XG4gIHByaXZhdGUgX3VzYWJsZSA9IGZhbHNlO1xuICBwcml2YXRlIF9kZWxheWVkVXBkYXRlPzogbnVtYmVyO1xuICBwcml2YXRlIF96U3VidHJhY3QgPSAwO1xuICBwcml2YXRlIF9yZXF1ZXN0SW1hZ2VFcnJvcjogVGlsZVByb3ZpZGVyRXJyb3IgfCB1bmRlZmluZWQ7XG4gIHByaXZhdGUgX3ByZXZpb3VzQ3JlZGl0czogQ3JlZGl0W10gPSBbXTtcbiAgcHJpdmF0ZSBfbGVhZmxldFVwZGF0ZUludGVydmFsOiBudW1iZXI7XG5cbiAgQG9ic2VydmFibGUgc3BsaXREaXJlY3Rpb24gPSBTcGxpdERpcmVjdGlvbi5OT05FO1xuICBAb2JzZXJ2YWJsZSBzcGxpdFBvc2l0aW9uOiBudW1iZXIgPSAwLjU7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBsZWFmbGV0OiBMZWFmbGV0LFxuICAgIHJlYWRvbmx5IGltYWdlcnlQcm92aWRlcjogSW1hZ2VyeVByb3ZpZGVyLFxuICAgIG9wdGlvbnM6IEwuVGlsZUxheWVyT3B0aW9ucyA9IHt9XG4gICkge1xuICAgIHN1cGVyKHVuZGVmaW5lZCBhcyBhbnksIHtcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgICB1cGRhdGVJbnRlcnZhbDogZGVmaW5lZCgoaW1hZ2VyeVByb3ZpZGVyIGFzIGFueSkuX2xlYWZsZXRVcGRhdGVJbnRlcnZhbClcbiAgICAgICAgPyAoaW1hZ2VyeVByb3ZpZGVyIGFzIGFueSkuX2xlYWZsZXRVcGRhdGVJbnRlcnZhbFxuICAgICAgICA6IDEwMFxuICAgIH0pO1xuICAgIG1ha2VPYnNlcnZhYmxlKHRoaXMpO1xuICAgIHRoaXMuaW1hZ2VyeVByb3ZpZGVyID0gaW1hZ2VyeVByb3ZpZGVyO1xuXG4gICAgLy8gSGFuZGxlIHNwbGl0dGVyIHJlY3Rpb24gKGFuZCBkaXNwb3NpbmcgcmVhY3Rpb24pXG4gICAgbGV0IGRpc3Bvc2VTcGxpdHRlclJlYWN0aW9uOiBJUmVhY3Rpb25EaXNwb3NlciB8IHVuZGVmaW5lZDtcbiAgICB0aGlzLm9uKFwiYWRkXCIsICgpID0+IHtcbiAgICAgIGlmICghZGlzcG9zZVNwbGl0dGVyUmVhY3Rpb24pIHtcbiAgICAgICAgZGlzcG9zZVNwbGl0dGVyUmVhY3Rpb24gPSB0aGlzLl9yZWFjdFRvU3BsaXR0ZXJDaGFuZ2UoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLm9uKFwicmVtb3ZlXCIsICgpID0+IHtcbiAgICAgIGlmIChkaXNwb3NlU3BsaXR0ZXJSZWFjdGlvbikge1xuICAgICAgICBkaXNwb3NlU3BsaXR0ZXJSZWFjdGlvbigpO1xuICAgICAgICBkaXNwb3NlU3BsaXR0ZXJSZWFjdGlvbiA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuX2xlYWZsZXRVcGRhdGVJbnRlcnZhbCA9IGRlZmluZWQoXG4gICAgICAoaW1hZ2VyeVByb3ZpZGVyIGFzIGFueSkuX2xlYWZsZXRVcGRhdGVJbnRlcnZhbFxuICAgIClcbiAgICAgID8gKGltYWdlcnlQcm92aWRlciBhcyBhbnkpLl9sZWFmbGV0VXBkYXRlSW50ZXJ2YWxcbiAgICAgIDogMTAwO1xuXG4gICAgLy8gSGFjayB0byBmaXggXCJTcGFjZSBiZXR3ZWVuIHRpbGVzIG9uIGZyYWN0aW9uYWwgem9vbSBsZXZlbHMgaW4gV2Via2l0IGJyb3dzZXJzXCIgKGh0dHBzOi8vZ2l0aHViLmNvbS9MZWFmbGV0L0xlYWZsZXQvaXNzdWVzLzM1NzUjaXNzdWVjb21tZW50LTY4ODY0NDIyNSlcbiAgICB0aGlzLm9uKFwidGlsZWxvYWRzdGFydFwiLCAoZXZlbnQ6IFRpbGVFdmVudCkgPT4ge1xuICAgICAgZXZlbnQudGlsZS5zdHlsZS53aWR0aCA9IHRoaXMuZ2V0VGlsZVNpemUoKS54ICsgMC41ICsgXCJweFwiO1xuICAgICAgZXZlbnQudGlsZS5zdHlsZS5oZWlnaHQgPSB0aGlzLmdldFRpbGVTaXplKCkueSArIDAuNSArIFwicHhcIjtcbiAgICB9KTtcbiAgfVxuXG4gIF9yZWFjdFRvU3BsaXR0ZXJDaGFuZ2UoKSB7XG4gICAgcmV0dXJuIGF1dG9ydW4oKCkgPT4ge1xuICAgICAgY29uc3QgY29udGFpbmVyID0gdGhpcy5nZXRDb250YWluZXIoKTtcbiAgICAgIGlmIChjb250YWluZXIgPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5zcGxpdERpcmVjdGlvbiA9PT0gU3BsaXREaXJlY3Rpb24uTEVGVCkge1xuICAgICAgICBjb25zdCB7IGxlZnQ6IGNsaXBMZWZ0IH0gPSB0aGlzLl9jbGlwc0ZvclNwbGl0dGVyO1xuICAgICAgICBjb250YWluZXIuc3R5bGUuY2xpcCA9IGNsaXBMZWZ0O1xuICAgICAgfSBlbHNlIGlmICh0aGlzLnNwbGl0RGlyZWN0aW9uID09PSBTcGxpdERpcmVjdGlvbi5SSUdIVCkge1xuICAgICAgICBjb25zdCB7IHJpZ2h0OiBjbGlwUmlnaHQgfSA9IHRoaXMuX2NsaXBzRm9yU3BsaXR0ZXI7XG4gICAgICAgIGNvbnRhaW5lci5zdHlsZS5jbGlwID0gY2xpcFJpZ2h0O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29udGFpbmVyLnN0eWxlLmNsaXAgPSBcImF1dG9cIjtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIEBjb21wdXRlZFxuICBnZXQgX2NsaXBzRm9yU3BsaXR0ZXIoKSB7XG4gICAgbGV0IGNsaXBMZWZ0ID0gXCJcIjtcbiAgICBsZXQgY2xpcFJpZ2h0ID0gXCJcIjtcbiAgICBsZXQgY2xpcFBvc2l0aW9uV2l0aGluTWFwO1xuICAgIGxldCBjbGlwWDtcblxuICAgIGlmICh0aGlzLmxlYWZsZXQuc2l6ZSAmJiB0aGlzLmxlYWZsZXQubncgJiYgdGhpcy5sZWFmbGV0LnNlKSB7XG4gICAgICBjbGlwUG9zaXRpb25XaXRoaW5NYXAgPSB0aGlzLmxlYWZsZXQuc2l6ZS54ICogdGhpcy5zcGxpdFBvc2l0aW9uO1xuICAgICAgY2xpcFggPSBNYXRoLnJvdW5kKHRoaXMubGVhZmxldC5udy54ICsgY2xpcFBvc2l0aW9uV2l0aGluTWFwKTtcbiAgICAgIGNsaXBMZWZ0ID1cbiAgICAgICAgXCJyZWN0KFwiICtcbiAgICAgICAgW3RoaXMubGVhZmxldC5udy55LCBjbGlwWCwgdGhpcy5sZWFmbGV0LnNlLnksIHRoaXMubGVhZmxldC5udy54XS5qb2luKFxuICAgICAgICAgIFwicHgsXCJcbiAgICAgICAgKSArXG4gICAgICAgIFwicHgpXCI7XG4gICAgICBjbGlwUmlnaHQgPVxuICAgICAgICBcInJlY3QoXCIgK1xuICAgICAgICBbdGhpcy5sZWFmbGV0Lm53LnksIHRoaXMubGVhZmxldC5zZS54LCB0aGlzLmxlYWZsZXQuc2UueSwgY2xpcFhdLmpvaW4oXG4gICAgICAgICAgXCJweCxcIlxuICAgICAgICApICtcbiAgICAgICAgXCJweClcIjtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIGxlZnQ6IGNsaXBMZWZ0LFxuICAgICAgcmlnaHQ6IGNsaXBSaWdodCxcbiAgICAgIGNsaXBQb3NpdGlvbldpdGhpbk1hcDogY2xpcFBvc2l0aW9uV2l0aGluTWFwLFxuICAgICAgY2xpcFg6IGNsaXBYXG4gICAgfTtcbiAgfVxuXG4gIF90aWxlT25FcnJvcihfZG9uZTogdW5rbm93biwgX3RpbGU6IHVua25vd24sIF9lOiB1bmtub3duKSB7XG4gICAgLy8gRG8gbm90aGluZywgd2UnbGwgaGFuZGxlIHRpbGUgZXJyb3JzIHNlcGFyYXRlbHkuXG4gIH1cblxuICBjcmVhdGVUaWxlKGNvb3JkczogTC5Db29yZHMsIGRvbmU6IEwuRG9uZUNhbGxiYWNrKSB7XG4gICAgLy8gQ3JlYXRlIGEgdGlsZSAoSW1hZ2UpIGFzIG5vcm1hbC5cbiAgICBjb25zdCB0aWxlID0gc3VwZXIuY3JlYXRlVGlsZShjb29yZHMsIGRvbmUpIGFzIEhUTUxJbWFnZUVsZW1lbnQ7XG5cbiAgICAvLyBCeSBkZWZhdWx0LCBMZWFmbGV0IGhhbmRsZXMgdGlsZSBsb2FkIGVycm9ycyBieSBzZXR0aW5nIHRoZSBJbWFnZSB0byB0aGUgZXJyb3IgVVJMIGFuZCByYWlzaW5nXG4gICAgLy8gYW4gZXJyb3IgZXZlbnQuICBXZSB3YW50IHRvIGZpcnN0IHJhaXNlIGFuIGVycm9yIGV2ZW50IHRoYXQgb3B0aW9uYWxseSByZXR1cm5zIGEgcHJvbWlzZSBhbmRcbiAgICAvLyByZXRyaWVzIGFmdGVyIHRoZSBwcm9taXNlIHJlc29sdmVzLlxuXG4gICAgY29uc3QgX2RvUmVxdWVzdCA9ICh3YWl0UHJvbWlzZT86IGFueSkgPT4ge1xuICAgICAgaWYgKHdhaXRQcm9taXNlKSB7XG4gICAgICAgIHdhaXRQcm9taXNlXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX2RvUmVxdWVzdCgpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmNhdGNoKChlOiB1bmtub3duKSA9PiB7XG4gICAgICAgICAgICAvLyBUaGUgdGlsZSBoYXMgZmFpbGVkIGlycmVjb3ZlcmFibHksIHNvIGludm9rZSBMZWFmbGV0J3Mgc3RhbmRhcmRcbiAgICAgICAgICAgIC8vIHRpbGUgZXJyb3IgaGFuZGxlci5cbiAgICAgICAgICAgIChMLlRpbGVMYXllciBhcyBhbnkpLnByb3RvdHlwZS5fdGlsZU9uRXJyb3IuY2FsbChcbiAgICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgICAgZG9uZSxcbiAgICAgICAgICAgICAgdGlsZSxcbiAgICAgICAgICAgICAgZVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBTZXR0aW5nIHNyYyB3aWxsIHRyaWdnZXIgYSBuZXcgbG9hZCBvciBlcnJvciBldmVudCwgZXZlbiBpZiB0aGVcbiAgICAgIC8vIG5ldyBzcmMgaXMgdGhlIHNhbWUgYXMgdGhlIG9sZCBvbmUuXG4gICAgICBjb25zdCB0aWxlVXJsID0gdGhpcy5nZXRUaWxlVXJsKGNvb3Jkcyk7XG4gICAgICBpZiAoaXNEZWZpbmVkKHRpbGVVcmwpKSB7XG4gICAgICAgIHRpbGUuc3JjID0gdGlsZVVybDtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgTC5Eb21FdmVudC5vbih0aWxlLCBcImVycm9yXCIsIChlKSA9PiB7XG4gICAgICBjb25zdCBsZXZlbCA9ICh0aGlzIGFzIGFueSkuX2dldExldmVsRnJvbVooY29vcmRzKTtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBpMThuZXh0LnQoXCJtYXAuY2VzaXVtLmZhaWxlZFRvT2J0YWluXCIsIHtcbiAgICAgICAgeDogY29vcmRzLngsXG4gICAgICAgIHk6IGNvb3Jkcy55LFxuICAgICAgICBsZXZlbDogbGV2ZWxcbiAgICAgIH0pO1xuICAgICAgdGhpcy5fcmVxdWVzdEltYWdlRXJyb3IgPSBUaWxlUHJvdmlkZXJFcnJvci5yZXBvcnRFcnJvcihcbiAgICAgICAgdGhpcy5fcmVxdWVzdEltYWdlRXJyb3IhLCAvLyBUT0RPOiBDZXNpdW0gdHlwZSBkZWZpbml0aW9ucyBpbmNvcnJlY3RseSBmb3JiaWQgdW5kZWZpbmVkXG4gICAgICAgIHRoaXMuaW1hZ2VyeVByb3ZpZGVyLFxuICAgICAgICB0aGlzLmltYWdlcnlQcm92aWRlci5lcnJvckV2ZW50LFxuICAgICAgICBtZXNzYWdlLFxuICAgICAgICBjb29yZHMueCxcbiAgICAgICAgY29vcmRzLnksXG4gICAgICAgIGxldmVsLFxuICAgICAgICBlIGFzIGFueVxuICAgICAgICAvLyBUT0RPOiBicmluZyB0ZXJyaWFqcy1jZXNpdW0gcmV0cnkgbG9naWMgdG8gY2VzaXVtXG4gICAgICAgIC8vZG9SZXF1ZXN0XG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRpbGU7XG4gIH1cblxuICBnZXRUaWxlVXJsKHRpbGVQb2ludDogTC5Db29yZHMpOiBzdHJpbmcge1xuICAgIGNvbnN0IGxldmVsID0gdGhpcy5fZ2V0TGV2ZWxGcm9tWih0aWxlUG9pbnQpO1xuICAgIGNvbnN0IGVycm9yVGlsZVVybCA9IHRoaXMub3B0aW9ucy5lcnJvclRpbGVVcmwgfHwgXCJcIjtcbiAgICBpZiAobGV2ZWwgPCAwKSB7XG4gICAgICByZXR1cm4gZXJyb3JUaWxlVXJsO1xuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICBnZXRVcmxGb3JJbWFnZXJ5VGlsZShcbiAgICAgICAgdGhpcy5pbWFnZXJ5UHJvdmlkZXIsXG4gICAgICAgIHRpbGVQb2ludC54LFxuICAgICAgICB0aWxlUG9pbnQueSxcbiAgICAgICAgbGV2ZWxcbiAgICAgICkgfHwgZXJyb3JUaWxlVXJsXG4gICAgKTtcbiAgfVxuXG4gIF9nZXRMZXZlbEZyb21aKHRpbGVQb2ludDogTC5Db29yZHMpIHtcbiAgICByZXR1cm4gdGlsZVBvaW50LnogLSB0aGlzLl96U3VidHJhY3Q7XG4gIH1cblxuICBfdXBkYXRlKC4uLmFyZ3M6IHVua25vd25bXSkge1xuICAgIGlmICghdGhpcy5pbml0aWFsaXplZCkge1xuICAgICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7XG5cbiAgICAgIC8vIENhbmNlbCB0aGUgZXhpc3RpbmcgZGVsYXllZCB1cGRhdGUsIGlmIGFueS5cbiAgICAgIGlmICh0aGlzLl9kZWxheWVkVXBkYXRlKSB7XG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9kZWxheWVkVXBkYXRlKTtcbiAgICAgICAgdGhpcy5fZGVsYXllZFVwZGF0ZSA9IHVuZGVmaW5lZDtcbiAgICAgIH1cblxuICAgICAgdGhpcy5fZGVsYXllZFVwZGF0ZSA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLl9kZWxheWVkVXBkYXRlID0gdW5kZWZpbmVkO1xuXG4gICAgICAgIC8vIElmIHdlJ3JlIG5vIGxvbmdlciBhdHRhY2hlZCB0byBhIG1hcCwgZG8gbm90aGluZy5cbiAgICAgICAgaWYgKCF0aGlzLl9tYXApIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB0aWxpbmdTY2hlbWUgPSB0aGlzLmltYWdlcnlQcm92aWRlci50aWxpbmdTY2hlbWU7XG4gICAgICAgIGlmICghKHRpbGluZ1NjaGVtZSBpbnN0YW5jZW9mIFdlYk1lcmNhdG9yVGlsaW5nU2NoZW1lKSkge1xuICAgICAgICAgIHRoaXMuZXJyb3JFdmVudC5yYWlzZUV2ZW50KFxuICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgIGkxOG5leHQudChcIm1hcC5jZXNpdW0ubm90V2ViTWVyY2F0b3JUaWxpbmdTY2hlbWVcIilcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChcbiAgICAgICAgICB0aWxpbmdTY2hlbWUuZ2V0TnVtYmVyT2ZYVGlsZXNBdExldmVsKDApID09PSAyICYmXG4gICAgICAgICAgdGlsaW5nU2NoZW1lLmdldE51bWJlck9mWVRpbGVzQXRMZXZlbCgwKSA9PT0gMlxuICAgICAgICApIHtcbiAgICAgICAgICB0aGlzLl96U3VidHJhY3QgPSAxO1xuICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgIHRpbGluZ1NjaGVtZS5nZXROdW1iZXJPZlhUaWxlc0F0TGV2ZWwoMCkgIT09IDEgfHxcbiAgICAgICAgICB0aWxpbmdTY2hlbWUuZ2V0TnVtYmVyT2ZZVGlsZXNBdExldmVsKDApICE9PSAxXG4gICAgICAgICkge1xuICAgICAgICAgIHRoaXMuZXJyb3JFdmVudC5yYWlzZUV2ZW50KFxuICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgIGkxOG5leHQudChcIm1hcC5jZXNpdW0udW51c2FsVGlsaW5nU2NoZW1lXCIpXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaXNEZWZpbmVkKHRoaXMuaW1hZ2VyeVByb3ZpZGVyLm1heGltdW1MZXZlbCkpIHtcbiAgICAgICAgICB0aGlzLm9wdGlvbnMubWF4TmF0aXZlWm9vbSA9IHRoaXMuaW1hZ2VyeVByb3ZpZGVyLm1heGltdW1MZXZlbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkZWZpbmVkKHRoaXMuaW1hZ2VyeVByb3ZpZGVyLm1pbmltdW1MZXZlbCkpIHtcbiAgICAgICAgICB0aGlzLm9wdGlvbnMubWluTmF0aXZlWm9vbSA9IHRoaXMuaW1hZ2VyeVByb3ZpZGVyLm1pbmltdW1MZXZlbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpc0RlZmluZWQodGhpcy5pbWFnZXJ5UHJvdmlkZXIuY3JlZGl0KSkge1xuICAgICAgICAgICh0aGlzLl9tYXAgYXMgYW55KS5hdHRyaWJ1dGlvbkNvbnRyb2wuYWRkQXR0cmlidXRpb24oXG4gICAgICAgICAgICBnZXRDcmVkaXRIdG1sKHRoaXMuaW1hZ2VyeVByb3ZpZGVyLmNyZWRpdClcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fdXNhYmxlID0gdHJ1ZTtcblxuICAgICAgICB0aGlzLl91cGRhdGUoKTtcbiAgICAgIH0sIHRoaXMuX2xlYWZsZXRVcGRhdGVJbnRlcnZhbCkgYXMgYW55O1xuICAgIH1cblxuICAgIGlmICh0aGlzLl91c2FibGUpIHtcbiAgICAgIChMLlRpbGVMYXllciBhcyBhbnkpLnByb3RvdHlwZS5fdXBkYXRlLmFwcGx5KHRoaXMsIGFyZ3MpO1xuXG4gICAgICB0aGlzLl91cGRhdGVBdHRyaWJ1dGlvbigpO1xuICAgIH1cbiAgfVxuXG4gIF91cGRhdGVBdHRyaWJ1dGlvbigpIHtcbiAgICBpZiAoIXRoaXMuX3VzYWJsZSB8fCAhaXNEZWZpbmVkKHRoaXMuaW1hZ2VyeVByb3ZpZGVyLmdldFRpbGVDcmVkaXRzKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5fcHJldmlvdXNDcmVkaXRzLmxlbmd0aDsgKytpKSB7XG4gICAgICB0aGlzLl9wcmV2aW91c0NyZWRpdHNbaV0uX3Nob3duSW5MZWFmbGV0TGFzdFVwZGF0ZSA9XG4gICAgICAgIHRoaXMuX3ByZXZpb3VzQ3JlZGl0c1tpXS5fc2hvd25JbkxlYWZsZXQ7XG4gICAgICB0aGlzLl9wcmV2aW91c0NyZWRpdHNbaV0uX3Nob3duSW5MZWFmbGV0ID0gZmFsc2U7XG4gICAgfVxuXG4gICAgY29uc3QgYm91bmRzID0gdGhpcy5fbWFwLmdldEJvdW5kcygpO1xuICAgIGNvbnN0IHpvb20gPSB0aGlzLl9tYXAuZ2V0Wm9vbSgpIC0gdGhpcy5felN1YnRyYWN0O1xuXG4gICAgY29uc3QgdGlsaW5nU2NoZW1lID0gdGhpcy5pbWFnZXJ5UHJvdmlkZXIudGlsaW5nU2NoZW1lO1xuXG4gICAgc3dTY3JhdGNoLmxvbmdpdHVkZSA9IE1hdGgubWF4KFxuICAgICAgQ2VzaXVtTWF0aC5uZWdhdGl2ZVBpVG9QaShDZXNpdW1NYXRoLnRvUmFkaWFucyhib3VuZHMuZ2V0V2VzdCgpKSksXG4gICAgICB0aWxpbmdTY2hlbWUucmVjdGFuZ2xlLndlc3RcbiAgICApO1xuICAgIHN3U2NyYXRjaC5sYXRpdHVkZSA9IE1hdGgubWF4KFxuICAgICAgQ2VzaXVtTWF0aC50b1JhZGlhbnMoYm91bmRzLmdldFNvdXRoKCkpLFxuICAgICAgdGlsaW5nU2NoZW1lLnJlY3RhbmdsZS5zb3V0aFxuICAgICk7XG4gICAgbGV0IHN3ID0gdGlsaW5nU2NoZW1lLnBvc2l0aW9uVG9UaWxlWFkoXG4gICAgICBzd1NjcmF0Y2gsXG4gICAgICB6b29tLFxuICAgICAgc3dUaWxlQ29vcmRpbmF0ZXNTY3JhdGNoXG4gICAgKTtcbiAgICBpZiAoIWlzRGVmaW5lZChzdykpIHtcbiAgICAgIHN3ID0gc3dUaWxlQ29vcmRpbmF0ZXNTY3JhdGNoO1xuICAgICAgc3cueCA9IDA7XG4gICAgICBzdy55ID0gdGlsaW5nU2NoZW1lLmdldE51bWJlck9mWVRpbGVzQXRMZXZlbCh6b29tKSAtIDE7XG4gICAgfVxuXG4gICAgbmVTY3JhdGNoLmxvbmdpdHVkZSA9IE1hdGgubWluKFxuICAgICAgQ2VzaXVtTWF0aC5uZWdhdGl2ZVBpVG9QaShDZXNpdW1NYXRoLnRvUmFkaWFucyhib3VuZHMuZ2V0RWFzdCgpKSksXG4gICAgICB0aWxpbmdTY2hlbWUucmVjdGFuZ2xlLmVhc3RcbiAgICApO1xuICAgIG5lU2NyYXRjaC5sYXRpdHVkZSA9IE1hdGgubWluKFxuICAgICAgQ2VzaXVtTWF0aC50b1JhZGlhbnMoYm91bmRzLmdldE5vcnRoKCkpLFxuICAgICAgdGlsaW5nU2NoZW1lLnJlY3RhbmdsZS5ub3J0aFxuICAgICk7XG4gICAgbGV0IG5lID0gdGlsaW5nU2NoZW1lLnBvc2l0aW9uVG9UaWxlWFkoXG4gICAgICBuZVNjcmF0Y2gsXG4gICAgICB6b29tLFxuICAgICAgbmVUaWxlQ29vcmRpbmF0ZXNTY3JhdGNoXG4gICAgKTtcbiAgICBpZiAoIWlzRGVmaW5lZChuZSkpIHtcbiAgICAgIG5lID0gbmVUaWxlQ29vcmRpbmF0ZXNTY3JhdGNoO1xuICAgICAgbmUueCA9IHRpbGluZ1NjaGVtZS5nZXROdW1iZXJPZlhUaWxlc0F0TGV2ZWwoem9vbSkgLSAxO1xuICAgICAgbmUueSA9IDA7XG4gICAgfVxuXG4gICAgY29uc3QgbmV4dENyZWRpdHMgPSBbXTtcblxuICAgIGZvciAobGV0IGogPSBuZS55OyBqIDwgc3cueTsgKytqKSB7XG4gICAgICBmb3IgKGxldCBpID0gc3cueDsgaSA8IG5lLng7ICsraSkge1xuICAgICAgICBjb25zdCBjcmVkaXRzID0gdGhpcy5pbWFnZXJ5UHJvdmlkZXIuZ2V0VGlsZUNyZWRpdHMoXG4gICAgICAgICAgaSxcbiAgICAgICAgICBqLFxuICAgICAgICAgIHpvb21cbiAgICAgICAgKSBhcyBDcmVkaXRbXTtcbiAgICAgICAgaWYgKCFkZWZpbmVkKGNyZWRpdHMpKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IGNyZWRpdHMubGVuZ3RoOyArK2spIHtcbiAgICAgICAgICBjb25zdCBjcmVkaXQgPSBjcmVkaXRzW2tdO1xuICAgICAgICAgIGlmIChjcmVkaXQuX3Nob3duSW5MZWFmbGV0KSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjcmVkaXQuX3Nob3duSW5MZWFmbGV0ID0gdHJ1ZTtcbiAgICAgICAgICBuZXh0Q3JlZGl0cy5wdXNoKGNyZWRpdCk7XG5cbiAgICAgICAgICBpZiAoIWNyZWRpdC5fc2hvd25JbkxlYWZsZXRMYXN0VXBkYXRlKSB7XG4gICAgICAgICAgICAodGhpcy5fbWFwIGFzIGFueSkuYXR0cmlidXRpb25Db250cm9sLmFkZEF0dHJpYnV0aW9uKFxuICAgICAgICAgICAgICBnZXRDcmVkaXRIdG1sKGNyZWRpdClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gUmVtb3ZlIGF0dHJpYnV0aW9ucyB0aGF0IGFwcGxpZWQgbGFzdCB1cGRhdGUgYnV0IG5vdCB0aGlzIG9uZS5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX3ByZXZpb3VzQ3JlZGl0cy5sZW5ndGg7ICsraSkge1xuICAgICAgaWYgKCF0aGlzLl9wcmV2aW91c0NyZWRpdHNbaV0uX3Nob3duSW5MZWFmbGV0KSB7XG4gICAgICAgICh0aGlzLl9tYXAgYXMgYW55KS5hdHRyaWJ1dGlvbkNvbnRyb2wucmVtb3ZlQXR0cmlidXRpb24oXG4gICAgICAgICAgZ2V0Q3JlZGl0SHRtbCh0aGlzLl9wcmV2aW91c0NyZWRpdHNbaV0pXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuX3ByZXZpb3VzQ3JlZGl0c1tpXS5fc2hvd25JbkxlYWZsZXRMYXN0VXBkYXRlID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5fcHJldmlvdXNDcmVkaXRzID0gbmV4dENyZWRpdHM7XG4gIH1cblxuICBhc3luYyBnZXRGZWF0dXJlUGlja2luZ0Nvb3JkcyhcbiAgICBtYXA6IEwuTWFwLFxuICAgIGxvbmdpdHVkZVJhZGlhbnM6IG51bWJlcixcbiAgICBsYXRpdHVkZVJhZGlhbnM6IG51bWJlclxuICApOiBQcm9taXNlPFByb3ZpZGVyQ29vcmRzPiB7XG4gICAgY29uc3QgbGwgPSBuZXcgQ2FydG9ncmFwaGljKFxuICAgICAgQ2VzaXVtTWF0aC5uZWdhdGl2ZVBpVG9QaShsb25naXR1ZGVSYWRpYW5zKSxcbiAgICAgIGxhdGl0dWRlUmFkaWFucyxcbiAgICAgIDAuMFxuICAgICk7XG4gICAgY29uc3QgbGV2ZWwgPSBNYXRoLnJvdW5kKG1hcC5nZXRab29tKCkpO1xuXG4gICAgY29uc3QgdGlsaW5nU2NoZW1lID0gdGhpcy5pbWFnZXJ5UHJvdmlkZXIudGlsaW5nU2NoZW1lO1xuICAgIGNvbnN0IGNvb3JkcyA9IHRpbGluZ1NjaGVtZS5wb3NpdGlvblRvVGlsZVhZKGxsLCBsZXZlbCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHg6IGNvb3Jkcy54LFxuICAgICAgeTogY29vcmRzLnksXG4gICAgICBsZXZlbDogbGV2ZWxcbiAgICB9O1xuICB9XG5cbiAgYXN5bmMgcGlja0ZlYXR1cmVzKFxuICAgIHg6IG51bWJlcixcbiAgICB5OiBudW1iZXIsXG4gICAgbGV2ZWw6IG51bWJlcixcbiAgICBsb25naXR1ZGVSYWRpYW5zOiBudW1iZXIsXG4gICAgbGF0aXR1ZGVSYWRpYW5zOiBudW1iZXJcbiAgKTogUHJvbWlzZTxJbWFnZXJ5TGF5ZXJGZWF0dXJlSW5mb1tdIHwgdW5kZWZpbmVkPiB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmltYWdlcnlQcm92aWRlci5waWNrRmVhdHVyZXMoXG4gICAgICAgIHgsXG4gICAgICAgIHksXG4gICAgICAgIGxldmVsLFxuICAgICAgICBsb25naXR1ZGVSYWRpYW5zLFxuICAgICAgICBsYXRpdHVkZVJhZGlhbnNcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgVGVycmlhRXJyb3IuZnJvbShcbiAgICAgICAgZSxcbiAgICAgICAgYEFuIGVycm9yIG9jdXJyZWQgd2hpbGUgY2FsbGluZyBcXGBJbWFnZXJ5UHJvdmlkZXIjLnBpY2tGZWF0dXJlc1xcYC4gXFxgSW1hZ2VyeVByb3ZpZGVyLnVybCA9ICR7XG4gICAgICAgICAgKHRoaXMuaW1hZ2VyeVByb3ZpZGVyIGFzIGFueSkudXJsXG4gICAgICAgIH1cXGBgXG4gICAgICApLmxvZygpO1xuICAgIH1cbiAgfVxuXG4gIG9uUmVtb3ZlKG1hcDogTC5NYXApIHtcbiAgICBpZiAodGhpcy5fZGVsYXllZFVwZGF0ZSkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX2RlbGF5ZWRVcGRhdGUpO1xuICAgICAgdGhpcy5fZGVsYXllZFVwZGF0ZSA9IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX3ByZXZpb3VzQ3JlZGl0cy5sZW5ndGg7ICsraSkge1xuICAgICAgdGhpcy5fcHJldmlvdXNDcmVkaXRzW2ldLl9zaG93bkluTGVhZmxldExhc3RVcGRhdGUgPSBmYWxzZTtcbiAgICAgIHRoaXMuX3ByZXZpb3VzQ3JlZGl0c1tpXS5fc2hvd25JbkxlYWZsZXQgPSBmYWxzZTtcbiAgICAgIChtYXAgYXMgYW55KS5hdHRyaWJ1dGlvbkNvbnRyb2wucmVtb3ZlQXR0cmlidXRpb24oXG4gICAgICAgIGdldENyZWRpdEh0bWwodGhpcy5fcHJldmlvdXNDcmVkaXRzW2ldKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5fdXNhYmxlICYmIGRlZmluZWQodGhpcy5pbWFnZXJ5UHJvdmlkZXIuY3JlZGl0KSkge1xuICAgICAgKG1hcCBhcyBhbnkpLmF0dHJpYnV0aW9uQ29udHJvbC5yZW1vdmVBdHRyaWJ1dGlvbihcbiAgICAgICAgZ2V0Q3JlZGl0SHRtbCh0aGlzLmltYWdlcnlQcm92aWRlci5jcmVkaXQpXG4gICAgICApO1xuICAgIH1cblxuICAgIEwuVGlsZUxheWVyLnByb3RvdHlwZS5vblJlbW92ZS5hcHBseSh0aGlzLCBbbWFwXSk7XG5cbiAgICAvLyBDaGVjayB0aGF0IHRoaXMgY2FuY2VscyB0aWxlIHJlcXVlc3RzIHdoZW4gZHJhZ2dpbmcgdGhlIHRpbWUgc2xpZGVyIGFuZCByYXBpZGx5IGNyZWF0aW5nXG4gICAgLy8gYW5kIGRlc3Ryb3lpbmcgbGF5ZXJzLiAgSWYgdGhlIGltYWdlIHJlcXVlc3RzIGZvciBwcmV2aW91cyB0aW1lcy9sYXllcnMgYXJlIGFsbG93ZWQgdG8gaGFuZ1xuICAgIC8vIGFyb3VuZCwgdGhleSBjbG9nIHVwIHRoZSBwaXBlbGluZSBhbmQgaXQgdGFrZXMgYXBwcm94aW1hdGVseSBmb3JldmVyIGZvciB0aGUgYnJvd3NlclxuICAgIC8vIHRvIGdldCBhcm91bmQgdG8gZG93bmxvYWRpbmcgdGhlIHRpbGVzIHRoYXQgYXJlIGFjdHVhbGx5IG5lZWRlZC5cbiAgICB0aGlzLl9hYm9ydExvYWRpbmcoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRDcmVkaXRIdG1sKGNyZWRpdDogQ3JlZGl0KSB7XG4gIHJldHVybiBjcmVkaXQuZWxlbWVudC5vdXRlckhUTUw7XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletTileLayer.ts\n\n}");

/***/ }),

/***/ "./packages/terriajs/lib/Map/Leaflet/LeafletDataSourceDisplay.ts":
/*!***********************************************************************!*\
  !*** ./packages/terriajs/lib/Map/Leaflet/LeafletDataSourceDisplay.ts ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ LeafletDataSourceDisplay)\n/* harmony export */ });\n/* harmony import */ var core_js_modules_web_dom_collections_iterator_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"./node_modules/core-js/modules/web.dom-collections.iterator.js\");\n/* harmony import */ var core_js_modules_web_dom_collections_iterator_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(core_js_modules_web_dom_collections_iterator_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var leaflet__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\");\n/* harmony import */ var leaflet__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(leaflet__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var terriajs_cesium_Source_Core_BoundingSphere__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! terriajs-cesium/Source/Core/BoundingSphere */ \"./node_modules/terriajs-cesium/Source/Core/BoundingSphere.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_EventHelper__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! terriajs-cesium/Source/Core/EventHelper */ \"./node_modules/terriajs-cesium/Source/Core/EventHelper.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_JulianDate__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! terriajs-cesium/Source/Core/JulianDate */ \"./node_modules/terriajs-cesium/Source/Core/JulianDate.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_createGuid__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! terriajs-cesium/Source/Core/createGuid */ \"./node_modules/terriajs-cesium/Source/Core/createGuid.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_destroyObject__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! terriajs-cesium/Source/Core/destroyObject */ \"./node_modules/terriajs-cesium/Source/Core/destroyObject.js\");\n/* harmony import */ var terriajs_cesium_Source_DataSources_BoundingSphereState__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! terriajs-cesium/Source/DataSources/BoundingSphereState */ \"./node_modules/terriajs-cesium/Source/DataSources/BoundingSphereState.js\");\n/* harmony import */ var terriajs_cesium_Source_DataSources_CustomDataSource__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! terriajs-cesium/Source/DataSources/CustomDataSource */ \"./node_modules/terriajs-cesium/Source/DataSources/CustomDataSource.js\");\n/* harmony import */ var terriajs_cesium_Source_DataSources_DataSource__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! terriajs-cesium/Source/DataSources/DataSource */ \"./node_modules/terriajs-cesium/Source/DataSources/DataSource.js\");\n/* harmony import */ var _Core_isDefined__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../Core/isDefined */ \"./packages/terriajs/lib/Core/isDefined.ts\");\n\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\n\n\n\n\n\n\n\n\n\n\nclass LeafletDataSource extends terriajs_cesium_Source_DataSources_DataSource__WEBPACK_IMPORTED_MODULE_9__[\"default\"] {\n  constructor() {\n    super(...arguments);\n    _defineProperty(this, \"visualizersByDisplayID\", void 0);\n    _defineProperty(this, \"visualizers\", void 0);\n  }\n}\n/**\n * Visualizes a collection of {@link DataSource} instances in Leaflet.\n */\nclass LeafletDataSourceDisplay {\n  constructor(options) {\n    var _options$visualizersC;\n    _defineProperty(this, \"_displayID\", void 0);\n    // Gets the scene associated with this display.\n    _defineProperty(this, \"_scene\", void 0);\n    /**\n     * Gets the default data source instance which can be used to\n     * manually create and visualize entities not tied to\n     * a specific data source. This instance is always available\n     * and does not appear in the list dataSources collection.\n     */\n    _defineProperty(this, \"_defaultDataSource\", void 0);\n    // Gets the collection of data sources to display.\n    _defineProperty(this, \"_dataSourceCollection\", void 0);\n    _defineProperty(this, \"_visualizersCallback\", void 0);\n    _defineProperty(this, \"_eventHelper\", void 0);\n    // Gets a value indicating whether or not all entities in the data source are ready\n    _defineProperty(this, \"_ready\", void 0);\n    _defineProperty(this, \"_lastTime\", void 0);\n    this._displayID = (0,terriajs_cesium_Source_Core_createGuid__WEBPACK_IMPORTED_MODULE_5__[\"default\"])();\n    this._scene = options.scene;\n    this._dataSourceCollection = options.dataSourceCollection;\n    this._visualizersCallback = (_options$visualizersC = options.visualizersCallback) !== null && _options$visualizersC !== void 0 ? _options$visualizersC : LeafletDataSourceDisplay.defaultVisualizersCallback;\n    this._eventHelper = new terriajs_cesium_Source_Core_EventHelper__WEBPACK_IMPORTED_MODULE_3__[\"default\"]();\n    this._eventHelper.add(this._dataSourceCollection.dataSourceAdded, this._onDataSourceAdded, this);\n    this._eventHelper.add(this._dataSourceCollection.dataSourceRemoved, this._onDataSourceRemoved, this);\n    for (let i = 0, len = this._dataSourceCollection.length; i < len; i++) {\n      this._onDataSourceAdded(this._dataSourceCollection, this._dataSourceCollection.get(i));\n    }\n    const defaultDataSource = new terriajs_cesium_Source_DataSources_CustomDataSource__WEBPACK_IMPORTED_MODULE_8__[\"default\"]();\n    this._onDataSourceAdded(undefined, defaultDataSource);\n    this._defaultDataSource = defaultDataSource;\n    this._ready = false;\n    this._lastTime = terriajs_cesium_Source_Core_JulianDate__WEBPACK_IMPORTED_MODULE_4__[\"default\"].now();\n  }\n\n  /**\n   * Gets or sets the default function which creates an array of visualizers used for visualization.\n   * By default, this function uses all standard visualizers.\n   *\n   */\n  static defaultVisualizersCallback(_leafletScene, _entityCluster, _dataSource) {\n    return [];\n  }\n\n  /**\n   * Updates the display to the provided time.\n   *\n   */\n  update(time) {\n    let result = true;\n    let x;\n    let visualizers;\n    let vLength;\n    const dataSources = this._dataSourceCollection;\n    const length = dataSources.length;\n    for (let i = 0; i < length; i++) {\n      const dataSource = dataSources.get(i);\n      if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_10__[\"default\"])(dataSource.update)) {\n        result = dataSource.update(time) && result;\n      }\n      visualizers = this._getVisualizersForDataSource(dataSource);\n      if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_10__[\"default\"])(visualizers)) {\n        vLength = visualizers.length;\n        for (x = 0; x < vLength; x++) {\n          result = visualizers[x].update(time) && result;\n        }\n      }\n    }\n    visualizers = this._getVisualizersForDataSource(this._defaultDataSource);\n    if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_10__[\"default\"])(visualizers)) {\n      vLength = visualizers.length;\n      for (x = 0; x < vLength; x++) {\n        result = visualizers[x].update(time) && result;\n      }\n    }\n    this._ready = result;\n    this._lastTime = terriajs_cesium_Source_Core_JulianDate__WEBPACK_IMPORTED_MODULE_4__[\"default\"].clone(time, this._lastTime);\n    return result;\n  }\n  destroy() {\n    this._eventHelper.removeAll();\n    const dataSourceCollection = this._dataSourceCollection;\n    for (let i = 0, length = dataSourceCollection.length; i < length; ++i) {\n      this._onDataSourceRemoved(this._dataSourceCollection, dataSourceCollection.get(i));\n    }\n    this._onDataSourceRemoved(undefined, this._defaultDataSource);\n    return (0,terriajs_cesium_Source_Core_destroyObject__WEBPACK_IMPORTED_MODULE_6__[\"default\"])(this);\n  }\n  _onDataSourceAdded(_dataSourceCollection, dataSource) {\n    const visualizers = this._visualizersCallback(this._scene, undefined, dataSource);\n    dataSource.visualizersByDisplayID = dataSource.visualizersByDisplayID || {};\n    dataSource.visualizersByDisplayID[this._displayID] = visualizers;\n    dataSource.visualizers = dataSource.visualizers || [];\n    dataSource.visualizers = dataSource.visualizers.concat(visualizers);\n  }\n  _onDataSourceRemoved(_dataSourceCollection, dataSource) {\n    const visualizers = this._getVisualizersForDataSource(dataSource);\n    if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_10__[\"default\"])(visualizers)) {\n      return;\n    }\n    const length = visualizers.length;\n    for (let i = 0; i < length; i++) {\n      const visualizer = visualizers[i];\n      visualizer.destroy();\n      if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_10__[\"default\"])(dataSource.visualizers)) {\n        const index = dataSource.visualizers.indexOf(visualizer);\n        dataSource.visualizers.splice(index, 1);\n      }\n    }\n    if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_10__[\"default\"])(dataSource.visualizersByDisplayID)) {\n      delete dataSource.visualizersByDisplayID[this._displayID];\n    }\n  }\n  _getVisualizersForDataSource(dataSource) {\n    const visualizersByDisplayID = dataSource.visualizersByDisplayID;\n    if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_10__[\"default\"])(visualizersByDisplayID) && (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_10__[\"default\"])(visualizersByDisplayID[this._displayID])) {\n      return visualizersByDisplayID[this._displayID];\n    }\n  }\n\n  /**\n   * Computes the rectangular bounds which encloses the visualization\n   * produced for the given entities.\n   */\n  getLatLngBounds(dataSource) {\n    this.update(this._lastTime);\n    const visualizers = this._getVisualizersForDataSource(dataSource);\n    if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_10__[\"default\"])(visualizers)) {\n      return;\n    }\n    let result;\n    for (let j = 0, vLength = visualizers.length; j < vLength; j++) {\n      const visualizer = visualizers[j];\n      const bounds = visualizer.getLatLngBounds();\n      if (bounds === undefined) {\n        continue;\n      }\n      result = result === undefined ? leaflet__WEBPACK_IMPORTED_MODULE_1___default().latLngBounds(bounds.getSouthWest(), bounds.getNorthEast()) : result.extend(bounds);\n    }\n    return result;\n  }\n\n  /**\n   * Computes a bounding sphere which encloses the visualization produced for the specified entity.\n   * The bounding sphere is in the fixed frame of the scene's globe.\n   */\n  getBoundingSphere(entity, allowPartial, result) {\n    if (!this._ready) {\n      return terriajs_cesium_Source_DataSources_BoundingSphereState__WEBPACK_IMPORTED_MODULE_7__[\"default\"].PENDING;\n    }\n    let length;\n    let dataSource = this._defaultDataSource;\n    if (!dataSource.entities.contains(entity)) {\n      dataSource = undefined;\n      const dataSources = this._dataSourceCollection;\n      length = dataSources.length;\n      for (let i = 0; i < length; i++) {\n        const d = dataSources.get(i);\n        if (d.entities.contains(entity)) {\n          dataSource = d;\n          break;\n        }\n      }\n    }\n    if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_10__[\"default\"])(dataSource) || !(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_10__[\"default\"])(dataSource.visualizers)) {\n      return terriajs_cesium_Source_DataSources_BoundingSphereState__WEBPACK_IMPORTED_MODULE_7__[\"default\"].FAILED;\n    }\n    const boundingSpheres = [];\n    const tmp = new terriajs_cesium_Source_Core_BoundingSphere__WEBPACK_IMPORTED_MODULE_2__[\"default\"]();\n    let count = 0;\n    let state = terriajs_cesium_Source_DataSources_BoundingSphereState__WEBPACK_IMPORTED_MODULE_7__[\"default\"].DONE;\n    const visualizers = dataSource.visualizers;\n    const visualizersLength = visualizers.length;\n    for (let i = 0; i < visualizersLength; i++) {\n      const visualizer = visualizers[i];\n      if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_10__[\"default\"])(visualizer.getBoundingSphere)) {\n        state = visualizer.getBoundingSphere(entity, tmp);\n        if (!allowPartial && state === terriajs_cesium_Source_DataSources_BoundingSphereState__WEBPACK_IMPORTED_MODULE_7__[\"default\"].PENDING) {\n          return terriajs_cesium_Source_DataSources_BoundingSphereState__WEBPACK_IMPORTED_MODULE_7__[\"default\"].PENDING;\n        } else if (state === terriajs_cesium_Source_DataSources_BoundingSphereState__WEBPACK_IMPORTED_MODULE_7__[\"default\"].DONE) {\n          boundingSpheres[count] = terriajs_cesium_Source_Core_BoundingSphere__WEBPACK_IMPORTED_MODULE_2__[\"default\"].clone(tmp, boundingSpheres[count]);\n          count++;\n        }\n      }\n    }\n    if (count === 0) {\n      return terriajs_cesium_Source_DataSources_BoundingSphereState__WEBPACK_IMPORTED_MODULE_7__[\"default\"].FAILED;\n    }\n    boundingSpheres.length = count;\n    terriajs_cesium_Source_Core_BoundingSphere__WEBPACK_IMPORTED_MODULE_2__[\"default\"].fromBoundingSpheres(boundingSpheres, result);\n    return terriajs_cesium_Source_DataSources_BoundingSphereState__WEBPACK_IMPORTED_MODULE_7__[\"default\"].DONE;\n  }\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXQvTGVhZmxldERhdGFTb3VyY2VEaXNwbGF5LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBYUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFjQTtBQUNBO0FBQ0E7QUFDQTtBQXlCQTtBQUFBO0FBQUE7QUF0QkE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBUUE7QUFBQTtBQUFBO0FBQUE7QUFNQTtBQUFBO0FBQUE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFLQTtBQU1BO0FBQ0E7QUFJQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUlBO0FBTUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFJQTtBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdGVycmlhanMtbWFwLy4vcGFja2FnZXMvdGVycmlhanMvbGliL01hcC9MZWFmbGV0L0xlYWZsZXREYXRhU291cmNlRGlzcGxheS50cz81M2I2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBMIGZyb20gXCJsZWFmbGV0XCI7XG5pbXBvcnQgQm91bmRpbmdTcGhlcmUgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9Cb3VuZGluZ1NwaGVyZVwiO1xuaW1wb3J0IEV2ZW50SGVscGVyIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvRXZlbnRIZWxwZXJcIjtcbmltcG9ydCBKdWxpYW5EYXRlIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvSnVsaWFuRGF0ZVwiO1xuaW1wb3J0IGNyZWF0ZUd1aWQgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9jcmVhdGVHdWlkXCI7XG5pbXBvcnQgZGVzdHJveU9iamVjdCBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL2Rlc3Ryb3lPYmplY3RcIjtcbmltcG9ydCBCb3VuZGluZ1NwaGVyZVN0YXRlIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0RhdGFTb3VyY2VzL0JvdW5kaW5nU3BoZXJlU3RhdGVcIjtcbmltcG9ydCBDdXN0b21EYXRhU291cmNlIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0RhdGFTb3VyY2VzL0N1c3RvbURhdGFTb3VyY2VcIjtcbmltcG9ydCBEYXRhU291cmNlIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0RhdGFTb3VyY2VzL0RhdGFTb3VyY2VcIjtcbmltcG9ydCBEYXRhU291cmNlQ29sbGVjdGlvbiBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9EYXRhU291cmNlcy9EYXRhU291cmNlQ29sbGVjdGlvblwiO1xuaW1wb3J0IEVudGl0eSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9EYXRhU291cmNlcy9FbnRpdHlcIjtcbmltcG9ydCBFbnRpdHlDbHVzdGVyIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0RhdGFTb3VyY2VzL0VudGl0eUNsdXN0ZXJcIjtcbmltcG9ydCBpc0RlZmluZWQgZnJvbSBcIi4uLy4uL0NvcmUvaXNEZWZpbmVkXCI7XG5pbXBvcnQgTGVhZmxldFNjZW5lIGZyb20gXCIuL0xlYWZsZXRTY2VuZVwiO1xuXG5pbnRlcmZhY2UgVmlzdWFsaXplciB7XG4gIHVwZGF0ZSh0aW1lOiBKdWxpYW5EYXRlKTogYm9vbGVhbjtcbiAgZGVzdHJveSgpOiB2b2lkO1xuICBnZXRMYXRMbmdCb3VuZHMoKTogTC5MYXRMbmdCb3VuZHMgfCB1bmRlZmluZWQ7XG4gIGdldEJvdW5kaW5nU3BoZXJlPzogKFxuICAgIGVudGl0eTogRW50aXR5LFxuICAgIHRtcDogQm91bmRpbmdTcGhlcmVcbiAgKSA9PiBCb3VuZGluZ1NwaGVyZVN0YXRlO1xufVxuXG5jbGFzcyBMZWFmbGV0RGF0YVNvdXJjZSBleHRlbmRzIERhdGFTb3VyY2Uge1xuICB2aXN1YWxpemVyc0J5RGlzcGxheUlEPzogeyBbaW5kZXg6IHN0cmluZ106IFZpc3VhbGl6ZXJbXSB9O1xuICB2aXN1YWxpemVycz86IFZpc3VhbGl6ZXJbXTtcbn1cblxudHlwZSBWaXN1YWxpemVyc0NhbGxiYWNrID0gKFxuICBzY2VuZTogTGVhZmxldFNjZW5lLFxuICBlbnRpdHlDbHVzdGVyOiBFbnRpdHlDbHVzdGVyIHwgdW5kZWZpbmVkLFxuICBkYXRhU291cmNlOiBEYXRhU291cmNlXG4pID0+IFZpc3VhbGl6ZXJbXTtcblxuaW50ZXJmYWNlIExlYWZsZXREYXRhU291cmNlRGlzcGxheU9wdGlvbnMge1xuICBzY2VuZTogTGVhZmxldFNjZW5lO1xuICBkYXRhU291cmNlQ29sbGVjdGlvbjogRGF0YVNvdXJjZUNvbGxlY3Rpb247XG4gIHZpc3VhbGl6ZXJzQ2FsbGJhY2s6IFZpc3VhbGl6ZXJzQ2FsbGJhY2s7XG59XG5cbi8qKlxuICogVmlzdWFsaXplcyBhIGNvbGxlY3Rpb24gb2Yge0BsaW5rIERhdGFTb3VyY2V9IGluc3RhbmNlcyBpbiBMZWFmbGV0LlxuICovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBMZWFmbGV0RGF0YVNvdXJjZURpc3BsYXkge1xuICBwcml2YXRlIHJlYWRvbmx5IF9kaXNwbGF5SUQ6IHN0cmluZztcblxuICAvLyBHZXRzIHRoZSBzY2VuZSBhc3NvY2lhdGVkIHdpdGggdGhpcyBkaXNwbGF5LlxuICBwcml2YXRlIHJlYWRvbmx5IF9zY2VuZTogTGVhZmxldFNjZW5lO1xuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBkZWZhdWx0IGRhdGEgc291cmNlIGluc3RhbmNlIHdoaWNoIGNhbiBiZSB1c2VkIHRvXG4gICAqIG1hbnVhbGx5IGNyZWF0ZSBhbmQgdmlzdWFsaXplIGVudGl0aWVzIG5vdCB0aWVkIHRvXG4gICAqIGEgc3BlY2lmaWMgZGF0YSBzb3VyY2UuIFRoaXMgaW5zdGFuY2UgaXMgYWx3YXlzIGF2YWlsYWJsZVxuICAgKiBhbmQgZG9lcyBub3QgYXBwZWFyIGluIHRoZSBsaXN0IGRhdGFTb3VyY2VzIGNvbGxlY3Rpb24uXG4gICAqL1xuICBwcml2YXRlIHJlYWRvbmx5IF9kZWZhdWx0RGF0YVNvdXJjZTogTGVhZmxldERhdGFTb3VyY2U7XG5cbiAgLy8gR2V0cyB0aGUgY29sbGVjdGlvbiBvZiBkYXRhIHNvdXJjZXMgdG8gZGlzcGxheS5cbiAgcHJpdmF0ZSByZWFkb25seSBfZGF0YVNvdXJjZUNvbGxlY3Rpb246IERhdGFTb3VyY2VDb2xsZWN0aW9uO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgX3Zpc3VhbGl6ZXJzQ2FsbGJhY2s6IFZpc3VhbGl6ZXJzQ2FsbGJhY2s7XG4gIHByaXZhdGUgcmVhZG9ubHkgX2V2ZW50SGVscGVyOiBFdmVudEhlbHBlcjtcblxuICAvLyBHZXRzIGEgdmFsdWUgaW5kaWNhdGluZyB3aGV0aGVyIG9yIG5vdCBhbGwgZW50aXRpZXMgaW4gdGhlIGRhdGEgc291cmNlIGFyZSByZWFkeVxuICBwcml2YXRlIF9yZWFkeTogYm9vbGVhbjtcblxuICBwcml2YXRlIF9sYXN0VGltZTogSnVsaWFuRGF0ZTtcblxuICBjb25zdHJ1Y3RvcihvcHRpb25zOiBMZWFmbGV0RGF0YVNvdXJjZURpc3BsYXlPcHRpb25zKSB7XG4gICAgdGhpcy5fZGlzcGxheUlEID0gY3JlYXRlR3VpZCgpO1xuICAgIHRoaXMuX3NjZW5lID0gb3B0aW9ucy5zY2VuZTtcbiAgICB0aGlzLl9kYXRhU291cmNlQ29sbGVjdGlvbiA9IG9wdGlvbnMuZGF0YVNvdXJjZUNvbGxlY3Rpb247XG4gICAgdGhpcy5fdmlzdWFsaXplcnNDYWxsYmFjayA9XG4gICAgICBvcHRpb25zLnZpc3VhbGl6ZXJzQ2FsbGJhY2sgPz9cbiAgICAgIExlYWZsZXREYXRhU291cmNlRGlzcGxheS5kZWZhdWx0VmlzdWFsaXplcnNDYWxsYmFjaztcblxuICAgIHRoaXMuX2V2ZW50SGVscGVyID0gbmV3IEV2ZW50SGVscGVyKCk7XG4gICAgdGhpcy5fZXZlbnRIZWxwZXIuYWRkKFxuICAgICAgdGhpcy5fZGF0YVNvdXJjZUNvbGxlY3Rpb24uZGF0YVNvdXJjZUFkZGVkLFxuICAgICAgdGhpcy5fb25EYXRhU291cmNlQWRkZWQgYXMgKCkgPT4gdm9pZCxcbiAgICAgIHRoaXNcbiAgICApO1xuICAgIHRoaXMuX2V2ZW50SGVscGVyLmFkZChcbiAgICAgIHRoaXMuX2RhdGFTb3VyY2VDb2xsZWN0aW9uLmRhdGFTb3VyY2VSZW1vdmVkLFxuICAgICAgdGhpcy5fb25EYXRhU291cmNlUmVtb3ZlZCBhcyAoKSA9PiB2b2lkLFxuICAgICAgdGhpc1xuICAgICk7XG5cbiAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gdGhpcy5fZGF0YVNvdXJjZUNvbGxlY3Rpb24ubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIHRoaXMuX29uRGF0YVNvdXJjZUFkZGVkKFxuICAgICAgICB0aGlzLl9kYXRhU291cmNlQ29sbGVjdGlvbixcbiAgICAgICAgdGhpcy5fZGF0YVNvdXJjZUNvbGxlY3Rpb24uZ2V0KGkpXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IGRlZmF1bHREYXRhU291cmNlID0gbmV3IEN1c3RvbURhdGFTb3VyY2UoKTtcbiAgICB0aGlzLl9vbkRhdGFTb3VyY2VBZGRlZCh1bmRlZmluZWQsIGRlZmF1bHREYXRhU291cmNlKTtcbiAgICB0aGlzLl9kZWZhdWx0RGF0YVNvdXJjZSA9IGRlZmF1bHREYXRhU291cmNlO1xuXG4gICAgdGhpcy5fcmVhZHkgPSBmYWxzZTtcbiAgICB0aGlzLl9sYXN0VGltZSA9IEp1bGlhbkRhdGUubm93KCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBvciBzZXRzIHRoZSBkZWZhdWx0IGZ1bmN0aW9uIHdoaWNoIGNyZWF0ZXMgYW4gYXJyYXkgb2YgdmlzdWFsaXplcnMgdXNlZCBmb3IgdmlzdWFsaXphdGlvbi5cbiAgICogQnkgZGVmYXVsdCwgdGhpcyBmdW5jdGlvbiB1c2VzIGFsbCBzdGFuZGFyZCB2aXN1YWxpemVycy5cbiAgICpcbiAgICovXG4gIHN0YXRpYyBkZWZhdWx0VmlzdWFsaXplcnNDYWxsYmFjayhcbiAgICBfbGVhZmxldFNjZW5lOiBMZWFmbGV0U2NlbmUsXG4gICAgX2VudGl0eUNsdXN0ZXI6IEVudGl0eUNsdXN0ZXIsXG4gICAgX2RhdGFTb3VyY2U6IERhdGFTb3VyY2VcbiAgKSB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgdGhlIGRpc3BsYXkgdG8gdGhlIHByb3ZpZGVkIHRpbWUuXG4gICAqXG4gICAqL1xuICB1cGRhdGUodGltZTogSnVsaWFuRGF0ZSkge1xuICAgIGxldCByZXN1bHQgPSB0cnVlO1xuXG4gICAgbGV0IHg7XG4gICAgbGV0IHZpc3VhbGl6ZXJzO1xuICAgIGxldCB2TGVuZ3RoO1xuICAgIGNvbnN0IGRhdGFTb3VyY2VzID0gdGhpcy5fZGF0YVNvdXJjZUNvbGxlY3Rpb247XG4gICAgY29uc3QgbGVuZ3RoID0gZGF0YVNvdXJjZXMubGVuZ3RoO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGRhdGFTb3VyY2UgPSBkYXRhU291cmNlcy5nZXQoaSkgYXMgTGVhZmxldERhdGFTb3VyY2U7XG4gICAgICBpZiAoaXNEZWZpbmVkKGRhdGFTb3VyY2UudXBkYXRlKSkge1xuICAgICAgICByZXN1bHQgPSBkYXRhU291cmNlLnVwZGF0ZSh0aW1lKSAmJiByZXN1bHQ7XG4gICAgICB9XG5cbiAgICAgIHZpc3VhbGl6ZXJzID0gdGhpcy5fZ2V0VmlzdWFsaXplcnNGb3JEYXRhU291cmNlKGRhdGFTb3VyY2UpO1xuICAgICAgaWYgKGlzRGVmaW5lZCh2aXN1YWxpemVycykpIHtcbiAgICAgICAgdkxlbmd0aCA9IHZpc3VhbGl6ZXJzLmxlbmd0aDtcbiAgICAgICAgZm9yICh4ID0gMDsgeCA8IHZMZW5ndGg7IHgrKykge1xuICAgICAgICAgIHJlc3VsdCA9IHZpc3VhbGl6ZXJzW3hdLnVwZGF0ZSh0aW1lKSAmJiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB2aXN1YWxpemVycyA9IHRoaXMuX2dldFZpc3VhbGl6ZXJzRm9yRGF0YVNvdXJjZSh0aGlzLl9kZWZhdWx0RGF0YVNvdXJjZSk7XG4gICAgaWYgKGlzRGVmaW5lZCh2aXN1YWxpemVycykpIHtcbiAgICAgIHZMZW5ndGggPSB2aXN1YWxpemVycy5sZW5ndGg7XG4gICAgICBmb3IgKHggPSAwOyB4IDwgdkxlbmd0aDsgeCsrKSB7XG4gICAgICAgIHJlc3VsdCA9IHZpc3VhbGl6ZXJzW3hdLnVwZGF0ZSh0aW1lKSAmJiByZXN1bHQ7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5fcmVhZHkgPSByZXN1bHQ7XG4gICAgdGhpcy5fbGFzdFRpbWUgPSBKdWxpYW5EYXRlLmNsb25lKHRpbWUsIHRoaXMuX2xhc3RUaW1lKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgZGVzdHJveSgpIHtcbiAgICB0aGlzLl9ldmVudEhlbHBlci5yZW1vdmVBbGwoKTtcblxuICAgIGNvbnN0IGRhdGFTb3VyY2VDb2xsZWN0aW9uID0gdGhpcy5fZGF0YVNvdXJjZUNvbGxlY3Rpb247XG4gICAgZm9yIChsZXQgaSA9IDAsIGxlbmd0aCA9IGRhdGFTb3VyY2VDb2xsZWN0aW9uLmxlbmd0aDsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgICB0aGlzLl9vbkRhdGFTb3VyY2VSZW1vdmVkKFxuICAgICAgICB0aGlzLl9kYXRhU291cmNlQ29sbGVjdGlvbixcbiAgICAgICAgZGF0YVNvdXJjZUNvbGxlY3Rpb24uZ2V0KGkpXG4gICAgICApO1xuICAgIH1cbiAgICB0aGlzLl9vbkRhdGFTb3VyY2VSZW1vdmVkKHVuZGVmaW5lZCwgdGhpcy5fZGVmYXVsdERhdGFTb3VyY2UpO1xuICAgIHJldHVybiBkZXN0cm95T2JqZWN0KHRoaXMpO1xuICB9XG5cbiAgcHJpdmF0ZSBfb25EYXRhU291cmNlQWRkZWQoXG4gICAgX2RhdGFTb3VyY2VDb2xsZWN0aW9uOiBEYXRhU291cmNlQ29sbGVjdGlvbiB8IHVuZGVmaW5lZCxcbiAgICBkYXRhU291cmNlOiBMZWFmbGV0RGF0YVNvdXJjZVxuICApIHtcbiAgICBjb25zdCB2aXN1YWxpemVycyA9IHRoaXMuX3Zpc3VhbGl6ZXJzQ2FsbGJhY2soXG4gICAgICB0aGlzLl9zY2VuZSxcbiAgICAgIHVuZGVmaW5lZCxcbiAgICAgIGRhdGFTb3VyY2VcbiAgICApO1xuXG4gICAgZGF0YVNvdXJjZS52aXN1YWxpemVyc0J5RGlzcGxheUlEID0gZGF0YVNvdXJjZS52aXN1YWxpemVyc0J5RGlzcGxheUlEIHx8IHt9O1xuICAgIGRhdGFTb3VyY2UudmlzdWFsaXplcnNCeURpc3BsYXlJRFt0aGlzLl9kaXNwbGF5SURdID0gdmlzdWFsaXplcnM7XG5cbiAgICBkYXRhU291cmNlLnZpc3VhbGl6ZXJzID0gZGF0YVNvdXJjZS52aXN1YWxpemVycyB8fCBbXTtcbiAgICBkYXRhU291cmNlLnZpc3VhbGl6ZXJzID0gZGF0YVNvdXJjZS52aXN1YWxpemVycy5jb25jYXQodmlzdWFsaXplcnMpO1xuICB9XG5cbiAgcHJpdmF0ZSBfb25EYXRhU291cmNlUmVtb3ZlZChcbiAgICBfZGF0YVNvdXJjZUNvbGxlY3Rpb246IERhdGFTb3VyY2VDb2xsZWN0aW9uIHwgdW5kZWZpbmVkLFxuICAgIGRhdGFTb3VyY2U6IExlYWZsZXREYXRhU291cmNlXG4gICkge1xuICAgIGNvbnN0IHZpc3VhbGl6ZXJzID0gdGhpcy5fZ2V0VmlzdWFsaXplcnNGb3JEYXRhU291cmNlKGRhdGFTb3VyY2UpO1xuICAgIGlmICghaXNEZWZpbmVkKHZpc3VhbGl6ZXJzKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGxlbmd0aCA9IHZpc3VhbGl6ZXJzLmxlbmd0aDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCB2aXN1YWxpemVyID0gdmlzdWFsaXplcnNbaV07XG4gICAgICB2aXN1YWxpemVyLmRlc3Ryb3koKTtcblxuICAgICAgaWYgKGlzRGVmaW5lZChkYXRhU291cmNlLnZpc3VhbGl6ZXJzKSkge1xuICAgICAgICBjb25zdCBpbmRleCA9IGRhdGFTb3VyY2UudmlzdWFsaXplcnMuaW5kZXhPZih2aXN1YWxpemVyKTtcbiAgICAgICAgZGF0YVNvdXJjZS52aXN1YWxpemVycy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChpc0RlZmluZWQoZGF0YVNvdXJjZS52aXN1YWxpemVyc0J5RGlzcGxheUlEKSkge1xuICAgICAgZGVsZXRlIGRhdGFTb3VyY2UudmlzdWFsaXplcnNCeURpc3BsYXlJRFt0aGlzLl9kaXNwbGF5SURdO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX2dldFZpc3VhbGl6ZXJzRm9yRGF0YVNvdXJjZShkYXRhU291cmNlOiBMZWFmbGV0RGF0YVNvdXJjZSkge1xuICAgIGNvbnN0IHZpc3VhbGl6ZXJzQnlEaXNwbGF5SUQgPSBkYXRhU291cmNlLnZpc3VhbGl6ZXJzQnlEaXNwbGF5SUQ7XG4gICAgaWYgKFxuICAgICAgaXNEZWZpbmVkKHZpc3VhbGl6ZXJzQnlEaXNwbGF5SUQpICYmXG4gICAgICBpc0RlZmluZWQodmlzdWFsaXplcnNCeURpc3BsYXlJRFt0aGlzLl9kaXNwbGF5SURdKVxuICAgICkge1xuICAgICAgcmV0dXJuIHZpc3VhbGl6ZXJzQnlEaXNwbGF5SURbdGhpcy5fZGlzcGxheUlEXTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ29tcHV0ZXMgdGhlIHJlY3Rhbmd1bGFyIGJvdW5kcyB3aGljaCBlbmNsb3NlcyB0aGUgdmlzdWFsaXphdGlvblxuICAgKiBwcm9kdWNlZCBmb3IgdGhlIGdpdmVuIGVudGl0aWVzLlxuICAgKi9cbiAgZ2V0TGF0TG5nQm91bmRzKGRhdGFTb3VyY2U6IExlYWZsZXREYXRhU291cmNlKSB7XG4gICAgdGhpcy51cGRhdGUodGhpcy5fbGFzdFRpbWUpO1xuXG4gICAgY29uc3QgdmlzdWFsaXplcnMgPSB0aGlzLl9nZXRWaXN1YWxpemVyc0ZvckRhdGFTb3VyY2UoZGF0YVNvdXJjZSk7XG4gICAgaWYgKCFpc0RlZmluZWQodmlzdWFsaXplcnMpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IHJlc3VsdDtcblxuICAgIGZvciAobGV0IGogPSAwLCB2TGVuZ3RoID0gdmlzdWFsaXplcnMubGVuZ3RoOyBqIDwgdkxlbmd0aDsgaisrKSB7XG4gICAgICBjb25zdCB2aXN1YWxpemVyID0gdmlzdWFsaXplcnNbal07XG4gICAgICBjb25zdCBib3VuZHMgPSB2aXN1YWxpemVyLmdldExhdExuZ0JvdW5kcygpO1xuICAgICAgaWYgKGJvdW5kcyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICByZXN1bHQgPVxuICAgICAgICByZXN1bHQgPT09IHVuZGVmaW5lZFxuICAgICAgICAgID8gTC5sYXRMbmdCb3VuZHMoYm91bmRzLmdldFNvdXRoV2VzdCgpLCBib3VuZHMuZ2V0Tm9ydGhFYXN0KCkpXG4gICAgICAgICAgOiByZXN1bHQuZXh0ZW5kKGJvdW5kcyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb21wdXRlcyBhIGJvdW5kaW5nIHNwaGVyZSB3aGljaCBlbmNsb3NlcyB0aGUgdmlzdWFsaXphdGlvbiBwcm9kdWNlZCBmb3IgdGhlIHNwZWNpZmllZCBlbnRpdHkuXG4gICAqIFRoZSBib3VuZGluZyBzcGhlcmUgaXMgaW4gdGhlIGZpeGVkIGZyYW1lIG9mIHRoZSBzY2VuZSdzIGdsb2JlLlxuICAgKi9cbiAgZ2V0Qm91bmRpbmdTcGhlcmUoXG4gICAgZW50aXR5OiBFbnRpdHksXG4gICAgYWxsb3dQYXJ0aWFsOiBib29sZWFuLFxuICAgIHJlc3VsdDogQm91bmRpbmdTcGhlcmVcbiAgKSB7XG4gICAgaWYgKCF0aGlzLl9yZWFkeSkge1xuICAgICAgcmV0dXJuIEJvdW5kaW5nU3BoZXJlU3RhdGUuUEVORElORztcbiAgICB9XG5cbiAgICBsZXQgbGVuZ3RoO1xuICAgIGxldCBkYXRhU291cmNlOiBMZWFmbGV0RGF0YVNvdXJjZSB8IHVuZGVmaW5lZCA9IHRoaXMuX2RlZmF1bHREYXRhU291cmNlO1xuICAgIGlmICghZGF0YVNvdXJjZS5lbnRpdGllcy5jb250YWlucyhlbnRpdHkpKSB7XG4gICAgICBkYXRhU291cmNlID0gdW5kZWZpbmVkO1xuXG4gICAgICBjb25zdCBkYXRhU291cmNlcyA9IHRoaXMuX2RhdGFTb3VyY2VDb2xsZWN0aW9uO1xuICAgICAgbGVuZ3RoID0gZGF0YVNvdXJjZXMubGVuZ3RoO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBkID0gZGF0YVNvdXJjZXMuZ2V0KGkpO1xuICAgICAgICBpZiAoZC5lbnRpdGllcy5jb250YWlucyhlbnRpdHkpKSB7XG4gICAgICAgICAgZGF0YVNvdXJjZSA9IGQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIWlzRGVmaW5lZChkYXRhU291cmNlKSB8fCAhaXNEZWZpbmVkKGRhdGFTb3VyY2UudmlzdWFsaXplcnMpKSB7XG4gICAgICByZXR1cm4gQm91bmRpbmdTcGhlcmVTdGF0ZS5GQUlMRUQ7XG4gICAgfVxuXG4gICAgY29uc3QgYm91bmRpbmdTcGhlcmVzOiBCb3VuZGluZ1NwaGVyZVtdID0gW107XG4gICAgY29uc3QgdG1wID0gbmV3IEJvdW5kaW5nU3BoZXJlKCk7XG5cbiAgICBsZXQgY291bnQgPSAwO1xuICAgIGxldCBzdGF0ZSA9IEJvdW5kaW5nU3BoZXJlU3RhdGUuRE9ORTtcbiAgICBjb25zdCB2aXN1YWxpemVycyA9IGRhdGFTb3VyY2UudmlzdWFsaXplcnM7XG4gICAgY29uc3QgdmlzdWFsaXplcnNMZW5ndGggPSB2aXN1YWxpemVycy5sZW5ndGg7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZpc3VhbGl6ZXJzTGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHZpc3VhbGl6ZXIgPSB2aXN1YWxpemVyc1tpXTtcbiAgICAgIGlmIChpc0RlZmluZWQodmlzdWFsaXplci5nZXRCb3VuZGluZ1NwaGVyZSkpIHtcbiAgICAgICAgc3RhdGUgPSB2aXN1YWxpemVyLmdldEJvdW5kaW5nU3BoZXJlKGVudGl0eSwgdG1wKTtcbiAgICAgICAgaWYgKCFhbGxvd1BhcnRpYWwgJiYgc3RhdGUgPT09IEJvdW5kaW5nU3BoZXJlU3RhdGUuUEVORElORykge1xuICAgICAgICAgIHJldHVybiBCb3VuZGluZ1NwaGVyZVN0YXRlLlBFTkRJTkc7XG4gICAgICAgIH0gZWxzZSBpZiAoc3RhdGUgPT09IEJvdW5kaW5nU3BoZXJlU3RhdGUuRE9ORSkge1xuICAgICAgICAgIGJvdW5kaW5nU3BoZXJlc1tjb3VudF0gPSBCb3VuZGluZ1NwaGVyZS5jbG9uZShcbiAgICAgICAgICAgIHRtcCxcbiAgICAgICAgICAgIGJvdW5kaW5nU3BoZXJlc1tjb3VudF1cbiAgICAgICAgICApO1xuICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoY291bnQgPT09IDApIHtcbiAgICAgIHJldHVybiBCb3VuZGluZ1NwaGVyZVN0YXRlLkZBSUxFRDtcbiAgICB9XG5cbiAgICBib3VuZGluZ1NwaGVyZXMubGVuZ3RoID0gY291bnQ7XG4gICAgQm91bmRpbmdTcGhlcmUuZnJvbUJvdW5kaW5nU3BoZXJlcyhib3VuZGluZ1NwaGVyZXMsIHJlc3VsdCk7XG4gICAgcmV0dXJuIEJvdW5kaW5nU3BoZXJlU3RhdGUuRE9ORTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/Leaflet/LeafletDataSourceDisplay.ts\n\n}");

/***/ }),

/***/ "./packages/terriajs/lib/Map/Leaflet/LeafletScene.ts":
/*!***********************************************************!*\
  !*** ./packages/terriajs/lib/Map/Leaflet/LeafletScene.ts ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ LeafletScene)\n/* harmony export */ });\n/* harmony import */ var terriajs_cesium_Source_Core_Event__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Event */ \"./node_modules/terriajs-cesium/Source/Core/Event.js\");\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\n\nclass LeafletScene {\n  constructor(map) {\n    _defineProperty(this, \"map\", void 0);\n    _defineProperty(this, \"featureClicked\", new terriajs_cesium_Source_Core_Event__WEBPACK_IMPORTED_MODULE_0__[\"default\"]());\n    _defineProperty(this, \"featureMousedown\", new terriajs_cesium_Source_Core_Event__WEBPACK_IMPORTED_MODULE_0__[\"default\"]());\n    this.map = map;\n  }\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXQvTGVhZmxldFNjZW5lLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFHQTtBQUlBO0FBQUE7QUFBQTtBQUZBO0FBR0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdGVycmlhanMtbWFwLy4vcGFja2FnZXMvdGVycmlhanMvbGliL01hcC9MZWFmbGV0L0xlYWZsZXRTY2VuZS50cz84ODM2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBDZXNpdW1FdmVudCBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0V2ZW50XCI7XG5pbXBvcnQgTCBmcm9tIFwibGVhZmxldFwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBMZWFmbGV0U2NlbmUge1xuICByZWFkb25seSBtYXA6IEwuTWFwO1xuICByZWFkb25seSBmZWF0dXJlQ2xpY2tlZCA9IG5ldyBDZXNpdW1FdmVudCgpO1xuICByZWFkb25seSBmZWF0dXJlTW91c2Vkb3duID0gbmV3IENlc2l1bUV2ZW50KCk7XG4gIGNvbnN0cnVjdG9yKG1hcDogTC5NYXApIHtcbiAgICB0aGlzLm1hcCA9IG1hcDtcbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/Leaflet/LeafletScene.ts\n\n}");

/***/ }),

/***/ "./packages/terriajs/lib/Map/Leaflet/LeafletSelectionIndicator.ts":
/*!************************************************************************!*\
  !*** ./packages/terriajs/lib/Map/Leaflet/LeafletSelectionIndicator.ts ***!
  \************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ LeafletSelectionIndicator)\n/* harmony export */ });\n/* harmony import */ var leaflet__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\");\n/* harmony import */ var leaflet__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(leaflet__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var terriajs_cesium_Source_Core_Cartographic__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Cartographic */ \"./node_modules/terriajs-cesium/Source/Core/Cartographic.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_EasingFunction__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! terriajs-cesium/Source/Core/EasingFunction */ \"./node_modules/terriajs-cesium/Source/Core/EasingFunction.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_Ellipsoid__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Ellipsoid */ \"./node_modules/terriajs-cesium/Source/Core/Ellipsoid.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Math */ \"./node_modules/terriajs-cesium/Source/Core/Math.js\");\n/* harmony import */ var terriajs_cesium_Source_Scene_TweenCollection__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! terriajs-cesium/Source/Scene/TweenCollection */ \"./node_modules/terriajs-cesium/Source/Scene/TweenCollection.js\");\n/* harmony import */ var _wwwroot_images_NM_LocationTarget_svg__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../wwwroot/images/NM-LocationTarget.svg */ \"./packages/terriajs/wwwroot/images/NM-LocationTarget.svg\");\n/* harmony import */ var _Core_isDefined__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../Core/isDefined */ \"./packages/terriajs/lib/Core/isDefined.ts\");\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\n\n\n\n\n\n\n\n\nconst cartographicScratch = new terriajs_cesium_Source_Core_Cartographic__WEBPACK_IMPORTED_MODULE_1__[\"default\"]();\nclass LeafletSelectionIndicator {\n  constructor(leaflet) {\n    _defineProperty(this, \"_leaflet\", void 0);\n    _defineProperty(this, \"_marker\", void 0);\n    _defineProperty(this, \"_tweens\", new terriajs_cesium_Source_Scene_TweenCollection__WEBPACK_IMPORTED_MODULE_5__[\"default\"]());\n    _defineProperty(this, \"_selectionIndicatorTween\", void 0);\n    _defineProperty(this, \"_selectionIndicatorIsAppearing\", false);\n    _defineProperty(this, \"_selectionIndicatorDomElement\", void 0);\n    _defineProperty(this, \"_tweensAreRunning\", false);\n    this._leaflet = leaflet;\n    this._marker = leaflet__WEBPACK_IMPORTED_MODULE_0___default().marker([0, 0], {\n      icon: leaflet__WEBPACK_IMPORTED_MODULE_0___default().divIcon({\n        className: \"\",\n        html: '<img src=\"' + _wwwroot_images_NM_LocationTarget_svg__WEBPACK_IMPORTED_MODULE_6__ + '\" width=\"50\" height=\"50\" alt=\"\" />',\n        iconSize: leaflet__WEBPACK_IMPORTED_MODULE_0___default().point(50, 50)\n      }),\n      zIndexOffset: 1,\n      // We increment the z index so that the selection marker appears above the item.\n      interactive: false,\n      keyboard: false\n    });\n    this._marker.addTo(this._leaflet.map);\n    this._selectionIndicatorDomElement = this._marker._icon.children[0];\n  }\n  setLatLng(latlng) {\n    this._marker.setLatLng(latlng);\n  }\n  animateSelectionIndicatorAppear() {\n    if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_7__[\"default\"])(this._selectionIndicatorTween)) {\n      if (this._selectionIndicatorIsAppearing) {\n        // Already appearing; don't restart the animation.\n        return;\n      }\n      this._selectionIndicatorTween.cancelTween();\n      this._selectionIndicatorTween = undefined;\n    }\n    const style = this._selectionIndicatorDomElement.style;\n    this._selectionIndicatorIsAppearing = true;\n    const that = this;\n    this._selectionIndicatorTween = this._tweens.add({\n      startObject: {\n        scale: 2.0,\n        opacity: 0.0,\n        rotate: -180\n      },\n      stopObject: {\n        scale: 1.0,\n        opacity: 1.0,\n        rotate: 0\n      },\n      duration: 0.8,\n      easingFunction: terriajs_cesium_Source_Core_EasingFunction__WEBPACK_IMPORTED_MODULE_2__[\"default\"].EXPONENTIAL_OUT,\n      update: function (value) {\n        style.opacity = value.opacity;\n        style.transform = \"scale(\" + value.scale + \") rotate(\" + value.rotate + \"deg)\";\n      },\n      complete: function () {\n        that._selectionIndicatorTween = undefined;\n      },\n      cancel: function () {\n        that._selectionIndicatorTween = undefined;\n      }\n    });\n    this._startTweens();\n  }\n  animateSelectionIndicatorDepart() {\n    if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_7__[\"default\"])(this._selectionIndicatorTween)) {\n      if (!this._selectionIndicatorIsAppearing) {\n        // Already disappearing, dont' restart the animation.\n        return;\n      }\n      this._selectionIndicatorTween.cancelTween();\n      this._selectionIndicatorTween = undefined;\n    }\n    const style = this._selectionIndicatorDomElement.style;\n    this._selectionIndicatorIsAppearing = false;\n    const that = this;\n    this._selectionIndicatorTween = this._tweens.add({\n      startObject: {\n        scale: 1.0,\n        opacity: 1.0\n      },\n      stopObject: {\n        scale: 1.5,\n        opacity: 0.0\n      },\n      duration: 0.8,\n      easingFunction: terriajs_cesium_Source_Core_EasingFunction__WEBPACK_IMPORTED_MODULE_2__[\"default\"].EXPONENTIAL_OUT,\n      update: function (value) {\n        style.opacity = value.opacity;\n        style.transform = \"scale(\" + value.scale + \") rotate(0deg)\";\n      },\n      complete: function () {\n        that._selectionIndicatorTween = undefined;\n      },\n      cancel: function () {\n        that._selectionIndicatorTween = undefined;\n      }\n    });\n    this._startTweens();\n  }\n  _startTweens() {\n    if (this._tweensAreRunning) {\n      return;\n    }\n    const feature = this._leaflet.terria.selectedFeature;\n    if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_7__[\"default\"])(feature) && (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_7__[\"default\"])(feature.position)) {\n      const positionValue = feature.position.getValue(this._leaflet.terria.timelineClock.currentTime);\n      if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_7__[\"default\"])(positionValue)) {\n        const cartographic = terriajs_cesium_Source_Core_Ellipsoid__WEBPACK_IMPORTED_MODULE_3__[\"default\"].WGS84.cartesianToCartographic(positionValue, cartographicScratch);\n        this._marker.setLatLng([terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_4__[\"default\"].toDegrees(cartographic.latitude), terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_4__[\"default\"].toDegrees(cartographic.longitude)]);\n      }\n    }\n    if (this._tweens.length > 0) {\n      this._tweens.update();\n    }\n    if (this._tweens.length !== 0 || (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_7__[\"default\"])(feature) && (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_7__[\"default\"])(feature.position)) {\n      requestAnimationFrame(() => {\n        this._startTweens();\n      });\n    }\n  }\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXQvTGVhZmxldFNlbGVjdGlvbkluZGljYXRvci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU9BO0FBRUE7QUFTQTtBQUFBO0FBQUE7QUFBQTtBQU5BO0FBQUE7QUFFQTtBQUFBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUdBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUlBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdGVycmlhanMtbWFwLy4vcGFja2FnZXMvdGVycmlhanMvbGliL01hcC9MZWFmbGV0L0xlYWZsZXRTZWxlY3Rpb25JbmRpY2F0b3IudHM/MzUzZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTCBmcm9tIFwibGVhZmxldFwiO1xuaW1wb3J0IENhcnRvZ3JhcGhpYyBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0NhcnRvZ3JhcGhpY1wiO1xuaW1wb3J0IEVhc2luZ0Z1bmN0aW9uIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvRWFzaW5nRnVuY3Rpb25cIjtcbmltcG9ydCBFbGxpcHNvaWQgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9FbGxpcHNvaWRcIjtcbmltcG9ydCBDZXNpdW1NYXRoIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvTWF0aFwiO1xuaW1wb3J0IFR3ZWVuQ29sbGVjdGlvbiBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9TY2VuZS9Ud2VlbkNvbGxlY3Rpb25cIjtcbmltcG9ydCBzZWxlY3Rpb25JbmRpY2F0b3JVcmwgZnJvbSBcIi4uLy4uLy4uL3d3d3Jvb3QvaW1hZ2VzL05NLUxvY2F0aW9uVGFyZ2V0LnN2Z1wiO1xuaW1wb3J0IGlzRGVmaW5lZCBmcm9tIFwiLi4vLi4vQ29yZS9pc0RlZmluZWRcIjtcbmltcG9ydCBMZWFmbGV0IGZyb20gXCIuLi8uLi9Nb2RlbHMvTGVhZmxldFwiO1xuXG5pbnRlcmZhY2UgVHdlZW4ge1xuICBjYW5jZWxUd2VlbigpOiB2b2lkO1xufVxuXG5jb25zdCBjYXJ0b2dyYXBoaWNTY3JhdGNoID0gbmV3IENhcnRvZ3JhcGhpYygpO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBMZWFmbGV0U2VsZWN0aW9uSW5kaWNhdG9yIHtcbiAgcHJpdmF0ZSByZWFkb25seSBfbGVhZmxldDogTGVhZmxldDtcbiAgcHJpdmF0ZSByZWFkb25seSBfbWFya2VyOiBMLk1hcmtlcjtcbiAgcHJpdmF0ZSByZWFkb25seSBfdHdlZW5zOiBUd2VlbkNvbGxlY3Rpb24gPSBuZXcgVHdlZW5Db2xsZWN0aW9uKCk7XG4gIHByaXZhdGUgX3NlbGVjdGlvbkluZGljYXRvclR3ZWVuPzogVHdlZW47XG4gIHByaXZhdGUgX3NlbGVjdGlvbkluZGljYXRvcklzQXBwZWFyaW5nOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgcmVhZG9ubHkgX3NlbGVjdGlvbkluZGljYXRvckRvbUVsZW1lbnQ6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIF90d2VlbnNBcmVSdW5uaW5nOiBib29sZWFuID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IobGVhZmxldDogTGVhZmxldCkge1xuICAgIHRoaXMuX2xlYWZsZXQgPSBsZWFmbGV0O1xuICAgIHRoaXMuX21hcmtlciA9IEwubWFya2VyKFswLCAwXSwge1xuICAgICAgaWNvbjogTC5kaXZJY29uKHtcbiAgICAgICAgY2xhc3NOYW1lOiBcIlwiLFxuICAgICAgICBodG1sOlxuICAgICAgICAgICc8aW1nIHNyYz1cIicgK1xuICAgICAgICAgIHNlbGVjdGlvbkluZGljYXRvclVybCArXG4gICAgICAgICAgJ1wiIHdpZHRoPVwiNTBcIiBoZWlnaHQ9XCI1MFwiIGFsdD1cIlwiIC8+JyxcbiAgICAgICAgaWNvblNpemU6IEwucG9pbnQoNTAsIDUwKVxuICAgICAgfSksXG4gICAgICB6SW5kZXhPZmZzZXQ6IDEsIC8vIFdlIGluY3JlbWVudCB0aGUgeiBpbmRleCBzbyB0aGF0IHRoZSBzZWxlY3Rpb24gbWFya2VyIGFwcGVhcnMgYWJvdmUgdGhlIGl0ZW0uXG4gICAgICBpbnRlcmFjdGl2ZTogZmFsc2UsXG4gICAgICBrZXlib2FyZDogZmFsc2VcbiAgICB9KTtcblxuICAgIHRoaXMuX21hcmtlci5hZGRUbyh0aGlzLl9sZWFmbGV0Lm1hcCk7XG4gICAgdGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9yRG9tRWxlbWVudCA9IChcbiAgICAgIHRoaXMuX21hcmtlciBhcyBhbnlcbiAgICApLl9pY29uLmNoaWxkcmVuWzBdO1xuICB9XG5cbiAgc2V0TGF0TG5nKGxhdGxuZzogTC5MYXRMbmcpIHtcbiAgICB0aGlzLl9tYXJrZXIuc2V0TGF0TG5nKGxhdGxuZyk7XG4gIH1cblxuICBhbmltYXRlU2VsZWN0aW9uSW5kaWNhdG9yQXBwZWFyKCkge1xuICAgIGlmIChpc0RlZmluZWQodGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9yVHdlZW4pKSB7XG4gICAgICBpZiAodGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9ySXNBcHBlYXJpbmcpIHtcbiAgICAgICAgLy8gQWxyZWFkeSBhcHBlYXJpbmc7IGRvbid0IHJlc3RhcnQgdGhlIGFuaW1hdGlvbi5cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9yVHdlZW4uY2FuY2VsVHdlZW4oKTtcbiAgICAgIHRoaXMuX3NlbGVjdGlvbkluZGljYXRvclR3ZWVuID0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGNvbnN0IHN0eWxlID0gdGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9yRG9tRWxlbWVudC5zdHlsZTtcblxuICAgIHRoaXMuX3NlbGVjdGlvbkluZGljYXRvcklzQXBwZWFyaW5nID0gdHJ1ZTtcblxuICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuICAgIHRoaXMuX3NlbGVjdGlvbkluZGljYXRvclR3ZWVuID0gdGhpcy5fdHdlZW5zLmFkZCh7XG4gICAgICBzdGFydE9iamVjdDoge1xuICAgICAgICBzY2FsZTogMi4wLFxuICAgICAgICBvcGFjaXR5OiAwLjAsXG4gICAgICAgIHJvdGF0ZTogLTE4MFxuICAgICAgfSxcbiAgICAgIHN0b3BPYmplY3Q6IHtcbiAgICAgICAgc2NhbGU6IDEuMCxcbiAgICAgICAgb3BhY2l0eTogMS4wLFxuICAgICAgICByb3RhdGU6IDBcbiAgICAgIH0sXG4gICAgICBkdXJhdGlvbjogMC44LFxuICAgICAgZWFzaW5nRnVuY3Rpb246IEVhc2luZ0Z1bmN0aW9uLkVYUE9ORU5USUFMX09VVCxcbiAgICAgIHVwZGF0ZTogZnVuY3Rpb24gKHZhbHVlOiBhbnkpIHtcbiAgICAgICAgc3R5bGUub3BhY2l0eSA9IHZhbHVlLm9wYWNpdHk7XG4gICAgICAgIHN0eWxlLnRyYW5zZm9ybSA9XG4gICAgICAgICAgXCJzY2FsZShcIiArIHZhbHVlLnNjYWxlICsgXCIpIHJvdGF0ZShcIiArIHZhbHVlLnJvdGF0ZSArIFwiZGVnKVwiO1xuICAgICAgfSxcbiAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoYXQuX3NlbGVjdGlvbkluZGljYXRvclR3ZWVuID0gdW5kZWZpbmVkO1xuICAgICAgfSxcbiAgICAgIGNhbmNlbDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGF0Ll9zZWxlY3Rpb25JbmRpY2F0b3JUd2VlbiA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuX3N0YXJ0VHdlZW5zKCk7XG4gIH1cblxuICBhbmltYXRlU2VsZWN0aW9uSW5kaWNhdG9yRGVwYXJ0KCkge1xuICAgIGlmIChpc0RlZmluZWQodGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9yVHdlZW4pKSB7XG4gICAgICBpZiAoIXRoaXMuX3NlbGVjdGlvbkluZGljYXRvcklzQXBwZWFyaW5nKSB7XG4gICAgICAgIC8vIEFscmVhZHkgZGlzYXBwZWFyaW5nLCBkb250JyByZXN0YXJ0IHRoZSBhbmltYXRpb24uXG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3NlbGVjdGlvbkluZGljYXRvclR3ZWVuLmNhbmNlbFR3ZWVuKCk7XG4gICAgICB0aGlzLl9zZWxlY3Rpb25JbmRpY2F0b3JUd2VlbiA9IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBjb25zdCBzdHlsZSA9IHRoaXMuX3NlbGVjdGlvbkluZGljYXRvckRvbUVsZW1lbnQuc3R5bGU7XG5cbiAgICB0aGlzLl9zZWxlY3Rpb25JbmRpY2F0b3JJc0FwcGVhcmluZyA9IGZhbHNlO1xuXG4gICAgY29uc3QgdGhhdCA9IHRoaXM7XG4gICAgdGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9yVHdlZW4gPSB0aGlzLl90d2VlbnMuYWRkKHtcbiAgICAgIHN0YXJ0T2JqZWN0OiB7XG4gICAgICAgIHNjYWxlOiAxLjAsXG4gICAgICAgIG9wYWNpdHk6IDEuMFxuICAgICAgfSxcbiAgICAgIHN0b3BPYmplY3Q6IHtcbiAgICAgICAgc2NhbGU6IDEuNSxcbiAgICAgICAgb3BhY2l0eTogMC4wXG4gICAgICB9LFxuICAgICAgZHVyYXRpb246IDAuOCxcbiAgICAgIGVhc2luZ0Z1bmN0aW9uOiBFYXNpbmdGdW5jdGlvbi5FWFBPTkVOVElBTF9PVVQsXG4gICAgICB1cGRhdGU6IGZ1bmN0aW9uICh2YWx1ZTogYW55KSB7XG4gICAgICAgIHN0eWxlLm9wYWNpdHkgPSB2YWx1ZS5vcGFjaXR5O1xuICAgICAgICBzdHlsZS50cmFuc2Zvcm0gPSBcInNjYWxlKFwiICsgdmFsdWUuc2NhbGUgKyBcIikgcm90YXRlKDBkZWcpXCI7XG4gICAgICB9LFxuICAgICAgY29tcGxldGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhhdC5fc2VsZWN0aW9uSW5kaWNhdG9yVHdlZW4gPSB1bmRlZmluZWQ7XG4gICAgICB9LFxuICAgICAgY2FuY2VsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoYXQuX3NlbGVjdGlvbkluZGljYXRvclR3ZWVuID0gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5fc3RhcnRUd2VlbnMoKTtcbiAgfVxuXG4gIHByaXZhdGUgX3N0YXJ0VHdlZW5zKCkge1xuICAgIGlmICh0aGlzLl90d2VlbnNBcmVSdW5uaW5nKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgZmVhdHVyZSA9IHRoaXMuX2xlYWZsZXQudGVycmlhLnNlbGVjdGVkRmVhdHVyZTtcbiAgICBpZiAoaXNEZWZpbmVkKGZlYXR1cmUpICYmIGlzRGVmaW5lZChmZWF0dXJlLnBvc2l0aW9uKSkge1xuICAgICAgY29uc3QgcG9zaXRpb25WYWx1ZSA9IGZlYXR1cmUucG9zaXRpb24uZ2V0VmFsdWUoXG4gICAgICAgIHRoaXMuX2xlYWZsZXQudGVycmlhLnRpbWVsaW5lQ2xvY2suY3VycmVudFRpbWVcbiAgICAgICk7XG4gICAgICBpZiAoaXNEZWZpbmVkKHBvc2l0aW9uVmFsdWUpKSB7XG4gICAgICAgIGNvbnN0IGNhcnRvZ3JhcGhpYyA9IEVsbGlwc29pZC5XR1M4NC5jYXJ0ZXNpYW5Ub0NhcnRvZ3JhcGhpYyhcbiAgICAgICAgICBwb3NpdGlvblZhbHVlLFxuICAgICAgICAgIGNhcnRvZ3JhcGhpY1NjcmF0Y2hcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5fbWFya2VyLnNldExhdExuZyhbXG4gICAgICAgICAgQ2VzaXVtTWF0aC50b0RlZ3JlZXMoY2FydG9ncmFwaGljLmxhdGl0dWRlKSxcbiAgICAgICAgICBDZXNpdW1NYXRoLnRvRGVncmVlcyhjYXJ0b2dyYXBoaWMubG9uZ2l0dWRlKVxuICAgICAgICBdKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5fdHdlZW5zLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuX3R3ZWVucy51cGRhdGUoKTtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICB0aGlzLl90d2VlbnMubGVuZ3RoICE9PSAwIHx8XG4gICAgICAoaXNEZWZpbmVkKGZlYXR1cmUpICYmIGlzRGVmaW5lZChmZWF0dXJlLnBvc2l0aW9uKSlcbiAgICApIHtcbiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICAgIHRoaXMuX3N0YXJ0VHdlZW5zKCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/Leaflet/LeafletSelectionIndicator.ts\n\n}");

/***/ }),

/***/ "./packages/terriajs/lib/Map/Leaflet/LeafletVisualizer.ts":
/*!****************************************************************!*\
  !*** ./packages/terriajs/lib/Map/Leaflet/LeafletVisualizer.ts ***!
  \****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ LeafletVisualizer)\n/* harmony export */ });\n/* harmony import */ var core_js_modules_web_dom_collections_iterator_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"./node_modules/core-js/modules/web.dom-collections.iterator.js\");\n/* harmony import */ var core_js_modules_web_dom_collections_iterator_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(core_js_modules_web_dom_collections_iterator_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var leaflet__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\");\n/* harmony import */ var leaflet__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(leaflet__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var terriajs_cesium_Source_Core_AssociativeArray__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! terriajs-cesium/Source/Core/AssociativeArray */ \"./node_modules/terriajs-cesium/Source/Core/AssociativeArray.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_Cartesian2__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Cartesian2 */ \"./node_modules/terriajs-cesium/Source/Core/Cartesian2.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_Cartesian3__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Cartesian3 */ \"./node_modules/terriajs-cesium/Source/Core/Cartesian3.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Color */ \"./node_modules/terriajs-cesium/Source/Core/Color.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_destroyObject__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! terriajs-cesium/Source/Core/destroyObject */ \"./node_modules/terriajs-cesium/Source/Core/destroyObject.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_Ellipsoid__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Ellipsoid */ \"./node_modules/terriajs-cesium/Source/Core/Ellipsoid.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Math */ \"./node_modules/terriajs-cesium/Source/Core/Math.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_writeTextToCanvas__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! terriajs-cesium/Source/Core/writeTextToCanvas */ \"./node_modules/terriajs-cesium/Source/Core/writeTextToCanvas.js\");\n/* harmony import */ var terriajs_cesium_Source_DataSources_PolylineDashMaterialProperty__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! terriajs-cesium/Source/DataSources/PolylineDashMaterialProperty */ \"./node_modules/terriajs-cesium/Source/DataSources/PolylineDashMaterialProperty.js\");\n/* harmony import */ var terriajs_cesium_Source_DataSources_PolylineGlowMaterialProperty__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! terriajs-cesium/Source/DataSources/PolylineGlowMaterialProperty */ \"./node_modules/terriajs-cesium/Source/DataSources/PolylineGlowMaterialProperty.js\");\n/* harmony import */ var _Core_isDefined__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../Core/isDefined */ \"./packages/terriajs/lib/Core/isDefined.ts\");\n/* harmony import */ var _Models_Catalog_Esri_esriStyleToTableStyle__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../Models/Catalog/Esri/esriStyleToTableStyle */ \"./packages/terriajs/lib/Models/Catalog/Esri/esriStyleToTableStyle.ts\");\n\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst defaultColor = terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"].WHITE;\nconst defaultOutlineColor = terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"].BLACK;\nconst defaultOutlineWidth = 1.0;\nconst defaultPixelSize = 5.0;\nconst defaultWidth = 5.0;\n\n//Single pixel black dot\nconst tmpImage = \"data:image/gif;base64,R0lGODlhAQABAPAAAAAAAP///yH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==\";\n\n//NOT IMPLEMENTED\n// Path primitive - no need identified\n// Ellipse primitive - no need identified\n// Ellipsoid primitive - 3d prim - no plans for this\n// Model primitive - 3d prim - no plans for this\n\n/**\n * A variable to store what sort of bounds our leaflet map has been looking at\n * 0 = a normal extent\n * 1 = zoomed in close to the east/left of anti-meridian\n * 2 = zoomed in close to the west/right of the anti-meridian\n * When this value changes we'll need to recompute the location of our points\n * to help them wrap around the anti-meridian\n */\nlet prevBoundsType = 0;\n\n/**\n * A {@link Visualizer} which maps {@link Entity#point} to Leaflet primitives.\n **/\nclass LeafletGeomVisualizer {\n  constructor(leafletScene, entityCollection) {\n    this.leafletScene = leafletScene;\n    this.entityCollection = entityCollection;\n    _defineProperty(this, \"_featureGroup\", void 0);\n    _defineProperty(this, \"_entitiesToVisualize\", void 0);\n    _defineProperty(this, \"_entityHash\", void 0);\n    entityCollection.collectionChanged.addEventListener(this._onCollectionChanged, this);\n    this._featureGroup = leaflet__WEBPACK_IMPORTED_MODULE_1___default().featureGroup().addTo(leafletScene.map);\n    this._entitiesToVisualize = new terriajs_cesium_Source_Core_AssociativeArray__WEBPACK_IMPORTED_MODULE_2__[\"default\"]();\n    this._entityHash = {};\n    this._onCollectionChanged(entityCollection, entityCollection.values, [], []);\n  }\n  _onCollectionChanged(_entityCollection, added, removed, changed) {\n    let entity;\n    const featureGroup = this._featureGroup;\n    const entities = this._entitiesToVisualize;\n    const entityHash = this._entityHash;\n    for (let i = added.length - 1; i > -1; i--) {\n      entity = added[i];\n      if (((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(entity.point) || (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(entity.billboard) || (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(entity.label)) && (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(entity.position) || (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(entity.polyline) || (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(entity.polygon) || (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(entity.rectangle)) {\n        entities.set(entity.id, entity);\n        entityHash[entity.id] = {};\n      }\n    }\n    for (let i = changed.length - 1; i > -1; i--) {\n      entity = changed[i];\n      if (((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(entity.point) || (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(entity.billboard) || (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(entity.label)) && (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(entity.position) || (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(entity.polyline) || (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(entity.polygon) || (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(entity.rectangle)) {\n        entities.set(entity.id, entity);\n        entityHash[entity.id] = entityHash[entity.id] || {};\n      } else {\n        cleanEntity(entity, featureGroup, entityHash);\n        entities.remove(entity.id);\n      }\n    }\n    for (let i = removed.length - 1; i > -1; i--) {\n      entity = removed[i];\n      cleanEntity(entity, featureGroup, entityHash);\n      entities.remove(entity.id);\n    }\n  }\n\n  /**\n   * Updates the primitives created by this visualizer to match their\n   * Entity counterpart at the given time.\n   *\n   */\n  update(time) {\n    const entities = this._entitiesToVisualize.values;\n    const entityHash = this._entityHash;\n    const bounds = this.leafletScene.map.getBounds();\n    let applyLocalisedAntiMeridianFix = false;\n    let currentBoundsType = 0;\n    if (_isCloseToEasternAntiMeridian(bounds)) {\n      applyLocalisedAntiMeridianFix = true;\n      currentBoundsType = 1;\n    } else if (_isCloseToWesternAntiMeridian(bounds)) {\n      applyLocalisedAntiMeridianFix = true;\n      currentBoundsType = 2;\n    }\n    for (let i = 0, len = entities.length; i < len; i++) {\n      const entity = entities[i];\n      const entityDetails = entityHash[entity.id];\n      if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(entity._point)) {\n        this._updatePoint(entity, time, entityHash, entityDetails, applyLocalisedAntiMeridianFix === true ? bounds : undefined, prevBoundsType !== currentBoundsType);\n      }\n      if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(entity.billboard)) {\n        this._updateBillboard(entity, time, entityHash, entityDetails, applyLocalisedAntiMeridianFix === true ? bounds : undefined);\n      }\n      if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(entity.label)) {\n        this._updateLabel(entity, time, entityHash, entityDetails);\n      }\n      if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(entity.polyline)) {\n        this._updatePolyline(entity, time, entityHash, entityDetails);\n      }\n      if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(entity.polygon)) {\n        this._updatePolygon(entity, time, entityHash, entityDetails);\n      }\n      if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(entity.rectangle)) {\n        this._updateRectangle(entity, time, entityHash, entityDetails);\n      }\n    }\n    prevBoundsType = currentBoundsType;\n    return true;\n  }\n  _updatePoint(entity, time, _entityHash, entityDetails, bounds, boundsJustChanged) {\n    const featureGroup = this._featureGroup;\n    const pointGraphics = entity.point;\n    const show = entity.isAvailable(time) && getValueOrDefault(pointGraphics.show, time, true);\n    if (!show) {\n      cleanPoint(entity, featureGroup, entityDetails);\n      return;\n    }\n    let details = entityDetails.point;\n    if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(details)) {\n      details = entityDetails.point = {\n        layer: undefined,\n        lastPosition: new terriajs_cesium_Source_Core_Cartesian3__WEBPACK_IMPORTED_MODULE_4__[\"default\"](),\n        lastPixelSize: 1,\n        lastColor: new terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"](),\n        lastOutlineColor: new terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"](),\n        lastOutlineWidth: 1\n      };\n    }\n    const position = getValueOrUndefined(entity.position, time);\n    if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(position)) {\n      cleanPoint(entity, featureGroup, entityDetails);\n      return;\n    }\n    const pixelSize = getValueOrDefault(pointGraphics.pixelSize, time, defaultPixelSize);\n    const color = getValueOrDefault(pointGraphics.color, time, defaultColor);\n    const outlineColor = getValueOrDefault(pointGraphics.outlineColor, time, defaultOutlineColor);\n    const outlineWidth = getValueOrDefault(pointGraphics.outlineWidth, time, defaultOutlineWidth);\n    let layer = details.layer;\n    if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(layer)) {\n      const pointOptions = {\n        radius: pixelSize / 2.0,\n        fillColor: color.toCssColorString(),\n        fillOpacity: color.alpha,\n        color: outlineColor.toCssColorString(),\n        weight: outlineWidth,\n        opacity: outlineColor.alpha\n      };\n      layer = details.layer = leaflet__WEBPACK_IMPORTED_MODULE_1___default().circleMarker(positionToLatLng(position, bounds), pointOptions);\n      layer.on(\"click\", featureClicked.bind(undefined, this, entity));\n      layer.on(\"mousedown\", featureMousedown.bind(undefined, this, entity));\n      featureGroup.addLayer(layer);\n      terriajs_cesium_Source_Core_Cartesian3__WEBPACK_IMPORTED_MODULE_4__[\"default\"].clone(position, details.lastPosition);\n      details.lastPixelSize = pixelSize;\n      terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"].clone(color, details.lastColor);\n      terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"].clone(outlineColor, details.lastOutlineColor);\n      details.lastOutlineWidth = outlineWidth;\n      return layer;\n    }\n    if (!terriajs_cesium_Source_Core_Cartesian3__WEBPACK_IMPORTED_MODULE_4__[\"default\"].equals(position, details.lastPosition) || boundsJustChanged) {\n      layer.setLatLng(positionToLatLng(position, bounds));\n      terriajs_cesium_Source_Core_Cartesian3__WEBPACK_IMPORTED_MODULE_4__[\"default\"].clone(position, details.lastPosition);\n    }\n    if (pixelSize !== details.lastPixelSize) {\n      layer.setRadius(pixelSize / 2.0);\n      details.lastPixelSize = pixelSize;\n    }\n    const options = layer.options;\n    let applyStyle = false;\n    if (!terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"].equals(color, details.lastColor)) {\n      options.fillColor = color.toCssColorString();\n      options.fillOpacity = color.alpha;\n      terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"].clone(color, details.lastColor);\n      applyStyle = true;\n    }\n    if (!terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"].equals(outlineColor, details.lastOutlineColor)) {\n      options.color = outlineColor.toCssColorString();\n      options.opacity = outlineColor.alpha;\n      terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"].clone(outlineColor, details.lastOutlineColor);\n      applyStyle = true;\n    }\n    if (outlineWidth !== details.lastOutlineWidth) {\n      options.weight = outlineWidth;\n      details.lastOutlineWidth = outlineWidth;\n      applyStyle = true;\n    }\n    if (applyStyle) {\n      layer.setStyle(options);\n    }\n  }\n  _updateBillboard(entity, time, _entityHash, entityDetails, bounds) {\n    const markerGraphics = entity.billboard;\n    const featureGroup = this._featureGroup;\n    let position;\n    let marker;\n    let details = entityDetails.billboard;\n    if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(details)) {\n      details = entityDetails.billboard = {\n        layer: undefined\n      };\n    }\n    const geomLayer = details.layer;\n    let show = entity.isAvailable(time) && getValueOrDefault(markerGraphics.show, time, true);\n    if (show) {\n      position = getValueOrUndefined(entity.position, time);\n      show = (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(position);\n    }\n    if (!show) {\n      cleanBillboard(entity, featureGroup, entityDetails);\n      return;\n    }\n    const latlng = positionToLatLng(position, bounds);\n    const image = getValue(markerGraphics.image, time);\n    const height = getValue(markerGraphics.height, time);\n    const width = getValue(markerGraphics.width, time);\n    const color = getValueOrDefault(markerGraphics.color, time, defaultColor);\n    const scale = getValueOrDefault(markerGraphics.scale, time, 1.0);\n    const verticalOrigin = getValueOrDefault(markerGraphics.verticalOrigin, time, 0);\n    const horizontalOrigin = getValueOrDefault(markerGraphics.horizontalOrigin, time, 0);\n    const pixelOffset = getValueOrDefault(markerGraphics.pixelOffset, time, terriajs_cesium_Source_Core_Cartesian2__WEBPACK_IMPORTED_MODULE_3__[\"default\"].ZERO);\n    let imageUrl;\n    if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(image)) {\n      if (typeof image === \"string\") {\n        imageUrl = image;\n      } else if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(image.toDataURL)) {\n        imageUrl = image.toDataURL();\n      } else if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(image.url)) {\n        imageUrl = image.url;\n      } else {\n        imageUrl = image.src;\n      }\n    }\n    const iconOptions = {\n      color: color.toCssColorString(),\n      origUrl: imageUrl,\n      scale: scale,\n      horizontalOrigin: horizontalOrigin,\n      //value: left, center, right\n      verticalOrigin: verticalOrigin //value: bottom, center, top\n    };\n    if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(height) || (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(width)) {\n      iconOptions.iconSize = [width, height];\n    }\n    let redrawIcon = false;\n    if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(geomLayer)) {\n      const markerOptions = {\n        icon: leaflet__WEBPACK_IMPORTED_MODULE_1___default().icon({\n          iconUrl: tmpImage\n        })\n      };\n      marker = leaflet__WEBPACK_IMPORTED_MODULE_1___default().marker(latlng, markerOptions);\n      marker.on(\"click\", featureClicked.bind(undefined, this, entity));\n      marker.on(\"mousedown\", featureMousedown.bind(undefined, this, entity));\n      featureGroup.addLayer(marker);\n      details.layer = marker;\n      redrawIcon = true;\n    } else {\n      marker = geomLayer;\n      if (!marker.getLatLng().equals(latlng)) {\n        marker.setLatLng(latlng);\n      }\n      for (const prop in iconOptions) {\n        if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(marker.options.icon) && iconOptions[prop] !== marker.options.icon.options[prop]) {\n          redrawIcon = true;\n          break;\n        }\n      }\n    }\n    if (redrawIcon) {\n      const recolorNeeded = !color.equals(defaultColor);\n      const drawBillboard = function (image, dataurl) {\n        iconOptions.iconUrl = dataurl || image;\n        if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(iconOptions.iconSize)) {\n          iconOptions.iconSize = [image.width * scale, image.height * scale];\n        }\n        const w = iconOptions.iconSize[0],\n          h = iconOptions.iconSize[1];\n        const xOff = w / 2 * (1 - horizontalOrigin) - pixelOffset.x;\n        const yOff = h / 2 * (1 + verticalOrigin) - pixelOffset.y;\n        iconOptions.iconAnchor = [xOff, yOff];\n        if (recolorNeeded) {\n          iconOptions.iconUrl = recolorBillboard(image, color);\n        }\n        marker.setIcon(leaflet__WEBPACK_IMPORTED_MODULE_1___default().icon(iconOptions));\n      };\n      const img = new Image();\n      img.onload = function () {\n        drawBillboard(img, imageUrl);\n      };\n      if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(imageUrl)) {\n        img.src = imageUrl;\n        if (recolorNeeded) {\n          img.crossOrigin = \"anonymous\";\n        }\n      }\n    }\n  }\n  _updateLabel(entity, time, _entityHash, entityDetails) {\n    const labelGraphics = entity.label;\n    const featureGroup = this._featureGroup;\n    let position;\n    let marker;\n    let details = entityDetails.label;\n    if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(details)) {\n      details = entityDetails.label = {\n        layer: undefined\n      };\n    }\n    const geomLayer = details.layer;\n    let show = entity.isAvailable(time) && getValueOrDefault(labelGraphics.show, time, true);\n    if (show) {\n      position = getValueOrUndefined(entity.position, time);\n      show = (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(position);\n    }\n    if (!show) {\n      cleanLabel(entity, featureGroup, entityDetails);\n      return;\n    }\n    const cart = terriajs_cesium_Source_Core_Ellipsoid__WEBPACK_IMPORTED_MODULE_7__[\"default\"].WGS84.cartesianToCartographic(position);\n    const latlng = leaflet__WEBPACK_IMPORTED_MODULE_1___default().latLng(terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_8__[\"default\"].toDegrees(cart.latitude), terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_8__[\"default\"].toDegrees(cart.longitude));\n    const text = getValue(labelGraphics.text, time);\n    const font = getValue(labelGraphics.font, time);\n    const scale = getValueOrDefault(labelGraphics.scale, time, 1.0);\n    const fillColor = getValueOrDefault(labelGraphics.fillColor, time, defaultColor);\n    const verticalOrigin = getValueOrDefault(labelGraphics.verticalOrigin, time, 0);\n    const horizontalOrigin = getValueOrDefault(labelGraphics.horizontalOrigin, time, 0);\n    const pixelOffset = getValueOrDefault(labelGraphics.pixelOffset, time, terriajs_cesium_Source_Core_Cartesian2__WEBPACK_IMPORTED_MODULE_3__[\"default\"].ZERO);\n    const iconOptions = {\n      text: text,\n      font: font,\n      color: fillColor.toCssColorString(),\n      scale: scale,\n      horizontalOrigin: horizontalOrigin,\n      //value: left, center, right\n      verticalOrigin: verticalOrigin //value: bottom, center, top\n    };\n    let redrawLabel = false;\n    if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(geomLayer)) {\n      const markerOptions = {\n        icon: leaflet__WEBPACK_IMPORTED_MODULE_1___default().icon({\n          iconUrl: tmpImage\n        })\n      };\n      marker = leaflet__WEBPACK_IMPORTED_MODULE_1___default().marker(latlng, markerOptions);\n      marker.on(\"click\", featureClicked.bind(undefined, this, entity));\n      marker.on(\"mousedown\", featureMousedown.bind(undefined, this, entity));\n      featureGroup.addLayer(marker);\n      details.layer = marker;\n      redrawLabel = true;\n    } else {\n      marker = geomLayer;\n      if (!marker.getLatLng().equals(latlng)) {\n        marker.setLatLng(latlng);\n      }\n      for (const prop in iconOptions) {\n        if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(marker.options.icon) && iconOptions[prop] !== marker.options.icon.options[prop]) {\n          redrawLabel = true;\n          break;\n        }\n      }\n    }\n    if (redrawLabel && (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(text)) {\n      const drawBillboard = function (image, dataurl) {\n        iconOptions.iconUrl = dataurl || image;\n        if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(iconOptions.iconSize)) {\n          iconOptions.iconSize = [image.width * scale, image.height * scale];\n        }\n        const w = iconOptions.iconSize[0],\n          h = iconOptions.iconSize[1];\n        const xOff = w / 2 * (1 - horizontalOrigin) - pixelOffset.x;\n        const yOff = h / 2 * (1 + verticalOrigin) - pixelOffset.y;\n        iconOptions.iconAnchor = [xOff, yOff];\n        marker.setIcon(leaflet__WEBPACK_IMPORTED_MODULE_1___default().icon(iconOptions));\n      };\n      const canvas = (0,terriajs_cesium_Source_Core_writeTextToCanvas__WEBPACK_IMPORTED_MODULE_9__[\"default\"])(text, {\n        fillColor: fillColor,\n        font: font\n      });\n      if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(canvas)) {\n        const imageUrl = canvas.toDataURL();\n        const img = new Image();\n        img.onload = function () {\n          drawBillboard(img, imageUrl);\n        };\n        img.src = imageUrl;\n      }\n    }\n  }\n  _updateRectangle(entity, time, _entityHash, entityDetails) {\n    var _rectangleGraphics$co;\n    const featureGroup = this._featureGroup;\n    const rectangleGraphics = entity.rectangle;\n    if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(rectangleGraphics)) {\n      return;\n    }\n    const show = entity.isAvailable(time) && getValueOrDefault(rectangleGraphics.show, time, true);\n    const rectangleCoordinates = (_rectangleGraphics$co = rectangleGraphics.coordinates) === null || _rectangleGraphics$co === void 0 ? void 0 : _rectangleGraphics$co.getValue(time);\n    if (!show || !(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(rectangleCoordinates)) {\n      cleanRectangle(entity, featureGroup, entityDetails);\n      return;\n    }\n    const rectangleBounds = [[terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_8__[\"default\"].toDegrees(rectangleCoordinates.south), terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_8__[\"default\"].toDegrees(rectangleCoordinates.west)], [terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_8__[\"default\"].toDegrees(rectangleCoordinates.north), terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_8__[\"default\"].toDegrees(rectangleCoordinates.east)]];\n    let details = entityDetails.rectangle;\n    if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(details)) {\n      details = entityDetails.rectangle = {\n        layer: undefined,\n        lastFill: undefined,\n        lastFillColor: new terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"](),\n        lastOutline: undefined,\n        lastOutlineColor: new terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"]()\n      };\n    }\n    const fill = getValueOrDefault(rectangleGraphics.fill, time, true);\n    const outline = getValueOrDefault(rectangleGraphics.outline, time, true);\n    let dashArray;\n    if (rectangleGraphics.outline instanceof terriajs_cesium_Source_DataSources_PolylineDashMaterialProperty__WEBPACK_IMPORTED_MODULE_10__[\"default\"]) {\n      dashArray = getDashArray(rectangleGraphics.outline, time);\n    }\n    const outlineWidth = getValueOrDefault(rectangleGraphics.outlineWidth, time, defaultOutlineWidth);\n    const outlineColor = getValueOrDefault(rectangleGraphics.outlineColor, time, defaultOutlineColor);\n    const material = getValueOrUndefined(rectangleGraphics.material, time);\n    let fillColor;\n    if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(material) && (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(material.color)) {\n      fillColor = material.color;\n    } else {\n      fillColor = defaultColor;\n    }\n    let layer = details.layer;\n    if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(layer)) {\n      const polygonOptions = {\n        fill: fill,\n        fillColor: fillColor.toCssColorString(),\n        fillOpacity: fillColor.alpha,\n        weight: outline ? outlineWidth : 0.0,\n        color: outlineColor.toCssColorString(),\n        opacity: outlineColor.alpha\n      };\n      if (outline && dashArray) {\n        polygonOptions.dashArray = dashArray.map(x => x * outlineWidth).join(\",\");\n      }\n      layer = details.layer = leaflet__WEBPACK_IMPORTED_MODULE_1___default().rectangle(rectangleBounds, polygonOptions);\n      layer.on(\"click\", featureClicked.bind(undefined, this, entity));\n      layer.on(\"mousedown\", featureMousedown.bind(undefined, this, entity));\n      featureGroup.addLayer(layer);\n      details.lastFill = fill;\n      details.lastOutline = outline;\n      terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"].clone(fillColor, details.lastFillColor);\n      terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"].clone(outlineColor, details.lastOutlineColor);\n      return;\n    }\n    const options = layer.options;\n    let applyStyle = false;\n    if (fill !== details.lastFill) {\n      options.fill = fill;\n      details.lastFill = fill;\n      applyStyle = true;\n    }\n    if (outline !== details.lastOutline) {\n      options.weight = outline ? outlineWidth : 0.0;\n      details.lastOutline = outline;\n      applyStyle = true;\n    }\n    if (!terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"].equals(fillColor, details.lastFillColor)) {\n      options.fillColor = fillColor.toCssColorString();\n      options.fillOpacity = fillColor.alpha;\n      terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"].clone(fillColor, details.lastFillColor);\n      applyStyle = true;\n    }\n    if (!terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"].equals(outlineColor, details.lastOutlineColor)) {\n      options.color = outlineColor.toCssColorString();\n      options.opacity = outlineColor.alpha;\n      terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"].clone(outlineColor, details.lastOutlineColor);\n      applyStyle = true;\n    }\n    if (!layer.getBounds().equals(rectangleBounds)) {\n      layer.setBounds(rectangleBounds);\n    }\n    if (applyStyle) {\n      layer.setStyle(options);\n    }\n  }\n  _updatePolygon(entity, time, _entityHash, entityDetails) {\n    const featureGroup = this._featureGroup;\n    const polygonGraphics = entity.polygon;\n    const show = entity.isAvailable(time) && getValueOrDefault(polygonGraphics.show, time, true);\n    if (!show) {\n      cleanPolygon(entity, featureGroup, entityDetails);\n      return;\n    }\n    let details = entityDetails.polygon;\n    if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(details)) {\n      details = entityDetails.polygon = {\n        layer: undefined,\n        lastHierarchy: undefined,\n        lastFill: undefined,\n        lastFillColor: new terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"](),\n        lastOutline: undefined,\n        lastOutlineColor: new terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"]()\n      };\n    }\n    const hierarchy = getValueOrUndefined(polygonGraphics.hierarchy, time);\n    if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(hierarchy)) {\n      cleanPolygon(entity, featureGroup, entityDetails);\n      return;\n    }\n    const fill = getValueOrDefault(polygonGraphics.fill, time, true);\n    const outline = getValueOrDefault(polygonGraphics.outline, time, true);\n    let dashArray;\n    if (polygonGraphics.outline instanceof terriajs_cesium_Source_DataSources_PolylineDashMaterialProperty__WEBPACK_IMPORTED_MODULE_10__[\"default\"]) {\n      dashArray = getDashArray(polygonGraphics.outline, time);\n    }\n    const outlineWidth = getValueOrDefault(polygonGraphics.outlineWidth, time, defaultOutlineWidth);\n    const outlineColor = getValueOrDefault(polygonGraphics.outlineColor, time, defaultOutlineColor);\n    const material = getValueOrUndefined(polygonGraphics.material, time);\n    let fillColor;\n    if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(material) && (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(material.color)) {\n      fillColor = material.color;\n    } else {\n      fillColor = defaultColor;\n    }\n    let layer = details.layer;\n    if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(layer)) {\n      const polygonOptions = {\n        fill: fill,\n        fillColor: fillColor.toCssColorString(),\n        fillOpacity: fillColor.alpha,\n        weight: outline ? outlineWidth : 0.0,\n        color: outlineColor.toCssColorString(),\n        opacity: outlineColor.alpha\n      };\n      if (outline && dashArray) {\n        polygonOptions.dashArray = dashArray.map(x => x * outlineWidth).join(\",\");\n      }\n      layer = details.layer = leaflet__WEBPACK_IMPORTED_MODULE_1___default().polygon(hierarchyToLatLngs(hierarchy), polygonOptions);\n      layer.on(\"click\", featureClicked.bind(undefined, this, entity));\n      layer.on(\"mousedown\", featureMousedown.bind(undefined, this, entity));\n      featureGroup.addLayer(layer);\n      details.lastHierarchy = hierarchy;\n      details.lastFill = fill;\n      details.lastOutline = outline;\n      terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"].clone(fillColor, details.lastFillColor);\n      terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"].clone(outlineColor, details.lastOutlineColor);\n      return;\n    }\n    if (hierarchy !== details.lastHierarchy) {\n      layer.setLatLngs(hierarchyToLatLngs(hierarchy));\n      details.lastHierarchy = hierarchy;\n    }\n    const options = layer.options;\n    let applyStyle = false;\n    if (fill !== details.lastFill) {\n      options.fill = fill;\n      details.lastFill = fill;\n      applyStyle = true;\n    }\n    if (outline !== details.lastOutline) {\n      options.weight = outline ? outlineWidth : 0.0;\n      details.lastOutline = outline;\n      applyStyle = true;\n    }\n    if (!terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"].equals(fillColor, details.lastFillColor)) {\n      options.fillColor = fillColor.toCssColorString();\n      options.fillOpacity = fillColor.alpha;\n      terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"].clone(fillColor, details.lastFillColor);\n      applyStyle = true;\n    }\n    if (!terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"].equals(outlineColor, details.lastOutlineColor)) {\n      options.color = outlineColor.toCssColorString();\n      options.opacity = outlineColor.alpha;\n      terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_5__[\"default\"].clone(outlineColor, details.lastOutlineColor);\n      applyStyle = true;\n    }\n    if (applyStyle) {\n      layer.setStyle(options);\n    }\n  }\n  _updatePolyline(entity, time, _entityHash, entityDetails) {\n    const polylineGraphics = entity.polyline;\n    const featureGroup = this._featureGroup;\n    let positions, polyline;\n    let details = entityDetails.polyline;\n    if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(details)) {\n      details = entityDetails.polyline = {\n        layer: undefined\n      };\n    }\n    const geomLayer = details.layer;\n    let show = entity.isAvailable(time) && getValueOrDefault(polylineGraphics.show, time, true);\n    if (show) {\n      positions = getValueOrUndefined(polylineGraphics.positions, time);\n      show = (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(positions);\n    }\n    if (!show) {\n      cleanPolyline(entity, featureGroup, entityDetails);\n      return;\n    }\n    const carts = terriajs_cesium_Source_Core_Ellipsoid__WEBPACK_IMPORTED_MODULE_7__[\"default\"].WGS84.cartesianArrayToCartographicArray(positions);\n    const latlngs = [];\n    for (let p = 0; p < carts.length; p++) {\n      latlngs.push(leaflet__WEBPACK_IMPORTED_MODULE_1___default().latLng(terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_8__[\"default\"].toDegrees(carts[p].latitude), terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_8__[\"default\"].toDegrees(carts[p].longitude)));\n    }\n    let color;\n    let dashArray;\n    let width;\n    if (polylineGraphics.material instanceof terriajs_cesium_Source_DataSources_PolylineGlowMaterialProperty__WEBPACK_IMPORTED_MODULE_11__[\"default\"]) {\n      color = defaultColor;\n      width = defaultWidth;\n    } else {\n      const material = polylineGraphics.material.getValue(time);\n      if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(material)) {\n        color = material.color;\n      }\n      color = color || defaultColor;\n      width = getValueOrDefault(polylineGraphics.width, time, defaultWidth);\n    }\n    if (polylineGraphics.material instanceof terriajs_cesium_Source_DataSources_PolylineDashMaterialProperty__WEBPACK_IMPORTED_MODULE_10__[\"default\"]) {\n      dashArray = getDashArray(polylineGraphics.material, time);\n    }\n    const polylineOptions = {\n      color: color.toCssColorString(),\n      weight: width,\n      opacity: color.alpha\n    };\n    if (dashArray) {\n      polylineOptions.dashArray = dashArray.map(x => x * width).join(\",\");\n    }\n    if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(geomLayer)) {\n      if (latlngs.length > 0) {\n        polyline = leaflet__WEBPACK_IMPORTED_MODULE_1___default().polyline(latlngs, polylineOptions);\n        polyline.on(\"click\", featureClicked.bind(undefined, this, entity));\n        polyline.on(\"mousedown\", featureMousedown.bind(undefined, this, entity));\n        featureGroup.addLayer(polyline);\n        details.layer = polyline;\n      }\n    } else {\n      polyline = geomLayer;\n      const curLatLngs = polyline.getLatLngs();\n      let bPosChange = latlngs.length !== curLatLngs.length;\n      for (let i = 0; i < curLatLngs.length && !bPosChange; i++) {\n        const latlng = curLatLngs[i];\n        if (latlng instanceof (leaflet__WEBPACK_IMPORTED_MODULE_1___default().LatLng) && !latlng.equals(latlngs[i])) {\n          bPosChange = true;\n        }\n      }\n      if (bPosChange) {\n        polyline.setLatLngs(latlngs);\n      }\n      for (const prop in polylineOptions) {\n        if (polylineOptions[prop] !== polyline.options[prop]) {\n          polyline.setStyle(polylineOptions);\n          break;\n        }\n      }\n    }\n  }\n\n  /**\n   * Returns true if this object was destroyed; otherwise, false.\n   *\n   */\n  isDestroyed() {\n    return false;\n  }\n\n  /**\n   * Removes and destroys all primitives created by this instance.\n   */\n  destroy() {\n    const entities = this._entitiesToVisualize.values;\n    const entityHash = this._entityHash;\n    for (let i = entities.length - 1; i > -1; i--) {\n      cleanEntity(entities[i], this._featureGroup, entityHash);\n    }\n    this.entityCollection.collectionChanged.removeEventListener(this._onCollectionChanged, this);\n    this.leafletScene.map.removeLayer(this._featureGroup);\n    return (0,terriajs_cesium_Source_Core_destroyObject__WEBPACK_IMPORTED_MODULE_6__[\"default\"])(this);\n  }\n\n  /**\n   * Computes the rectangular bounds which encloses the collection of\n   * entities to be visualized.\n   */\n  getLatLngBounds() {\n    let result;\n    Object.keys(this._entityHash).forEach(entityId => {\n      const entityDetails = this._entityHash[entityId];\n      Object.keys(entityDetails).forEach(primitiveId => {\n        const primitive = entityDetails[primitiveId];\n        if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(primitive.layer)) {\n          if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(primitive.layer.getBounds)) {\n            const bounds = primitive.layer.getBounds();\n            if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(bounds)) {\n              result = result === undefined ? leaflet__WEBPACK_IMPORTED_MODULE_1___default().latLngBounds(bounds.getSouthWest(), bounds.getNorthEast()) : result.extend(bounds);\n            }\n          }\n          if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(primitive.layer.getLatLng)) {\n            const latLng = primitive.layer.getLatLng();\n            if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(latLng)) {\n              result = result === undefined ? leaflet__WEBPACK_IMPORTED_MODULE_1___default().latLngBounds([latLng]) : result.extend(latLng);\n            }\n          }\n        }\n      });\n    });\n    return result;\n  }\n}\nfunction getDashArray(material, time) {\n  const dashPattern = material.dashPattern ? material.dashPattern.getValue(time) : undefined;\n  return (0,_Models_Catalog_Esri_esriStyleToTableStyle__WEBPACK_IMPORTED_MODULE_13__.convertCesiumDashNumberToDashArray)(dashPattern);\n}\nfunction cleanEntity(entity, group, entityHash) {\n  const details = entityHash[entity.id];\n  cleanPoint(entity, group, details);\n  cleanPolygon(entity, group, details);\n  cleanBillboard(entity, group, details);\n  cleanLabel(entity, group, details);\n  cleanPolyline(entity, group, details);\n  delete entityHash[entity.id];\n}\nfunction cleanPoint(_entity, group, details) {\n  if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(details.point) && (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(details.point.layer)) {\n    group.removeLayer(details.point.layer);\n    details.point = undefined;\n  }\n}\nfunction cleanPolygon(_entity, group, details) {\n  if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(details.polygon) && (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(details.polygon.layer)) {\n    group.removeLayer(details.polygon.layer);\n    details.polygon = undefined;\n  }\n}\nfunction cleanBillboard(_entity, group, details) {\n  if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(details.billboard) && (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(details.billboard.layer)) {\n    group.removeLayer(details.billboard.layer);\n    details.billboard = undefined;\n  }\n}\nfunction cleanLabel(_entity, group, details) {\n  if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(details.label) && (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(details.label.layer)) {\n    group.removeLayer(details.label.layer);\n    details.label = undefined;\n  }\n}\nfunction cleanPolyline(_entity, group, details) {\n  if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(details.polyline) && (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(details.polyline.layer)) {\n    group.removeLayer(details.polyline.layer);\n    details.polyline = undefined;\n  }\n}\nfunction cleanRectangle(_entity, group, details) {\n  if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(details.rectangle) && (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(details.rectangle.layer)) {\n    group.removeLayer(details.rectangle.layer);\n    details.rectangle = undefined;\n  }\n}\nfunction _isCloseToEasternAntiMeridian(bounds) {\n  const w = bounds.getWest();\n  const e = bounds.getEast();\n  if (w > 140 && (e < -140 || e > 180)) {\n    return true;\n  }\n  return false;\n}\nfunction _isCloseToWesternAntiMeridian(bounds) {\n  const w = bounds.getWest();\n  const e = bounds.getEast();\n  if ((w > 180 || w < -140) && e < -140) {\n    return true;\n  }\n  return false;\n}\nfunction positionToLatLng(position, bounds) {\n  const cartographic = terriajs_cesium_Source_Core_Ellipsoid__WEBPACK_IMPORTED_MODULE_7__[\"default\"].WGS84.cartesianToCartographic(position);\n  let lon = terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_8__[\"default\"].toDegrees(cartographic.longitude);\n  if (bounds !== undefined) {\n    if (_isCloseToEasternAntiMeridian(bounds)) {\n      if (lon < -140) {\n        lon = lon + 360;\n      }\n    } else if (_isCloseToWesternAntiMeridian(bounds)) {\n      if (lon > 140) {\n        lon = lon - 360;\n      }\n    }\n  }\n  return leaflet__WEBPACK_IMPORTED_MODULE_1___default().latLng(terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_8__[\"default\"].toDegrees(cartographic.latitude), lon);\n}\nfunction hierarchyToLatLngs(hierarchy) {\n  const holes = [];\n  const positions = Array.isArray(hierarchy) ? hierarchy : hierarchy.positions;\n  if (hierarchy.holes.length > 0) {\n    hierarchy.holes.forEach(hole => {\n      holes.push(convertEntityPositionsToLatLons(hole.positions));\n    });\n    return [convertEntityPositionsToLatLons(positions), ...holes];\n  } else {\n    return convertEntityPositionsToLatLons(positions);\n  }\n}\n\n//Recolor an image using 2d canvas\nfunction recolorBillboard(img, color) {\n  const canvas = document.createElement(\"canvas\");\n  canvas.width = img.width;\n  canvas.height = img.height;\n\n  // Copy the image contents to the canvas\n  const context = canvas.getContext(\"2d\");\n  if (context === null) {\n    return;\n  }\n  context.drawImage(img, 0, 0);\n  const image = context.getImageData(0, 0, canvas.width, canvas.height);\n  const normClr = [color.red, color.green, color.blue, color.alpha];\n  const length = image.data.length; //pixel count * 4\n  for (let i = 0; i < length; i += 4) {\n    for (let j = 0; j < 4; j++) {\n      image.data[j + i] *= normClr[j];\n    }\n  }\n  context.putImageData(image, 0, 0);\n  return canvas.toDataURL();\n}\nfunction featureClicked(visualizer, entity, event) {\n  visualizer.leafletScene.featureClicked.raiseEvent(entity, event);\n}\nfunction featureMousedown(visualizer, entity, event) {\n  visualizer.leafletScene.featureMousedown.raiseEvent(entity, event);\n}\nfunction getValue(property, time) {\n  if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(property)) {\n    return property.getValue(time);\n  }\n}\nfunction getValueOrDefault(property, time, defaultValue) {\n  if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(property)) {\n    const value = property.getValue(time);\n    if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(value)) {\n      return value;\n    }\n  }\n  return defaultValue;\n}\nfunction getValueOrUndefined(property, time) {\n  if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_12__[\"default\"])(property)) {\n    return property.getValue(time);\n  }\n}\nfunction convertEntityPositionsToLatLons(positions) {\n  const carts = terriajs_cesium_Source_Core_Ellipsoid__WEBPACK_IMPORTED_MODULE_7__[\"default\"].WGS84.cartesianArrayToCartographicArray(positions);\n  const latlngs = [];\n  let lastLongitude;\n  for (let p = 0; p < carts.length; p++) {\n    let lon = terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_8__[\"default\"].toDegrees(carts[p].longitude);\n    if (lastLongitude !== undefined) {\n      if (lastLongitude - lon > 180) {\n        lon = lon + 360;\n      } else if (lastLongitude - lon < -180) {\n        lon = lon - 360;\n      }\n    }\n    latlngs.push(leaflet__WEBPACK_IMPORTED_MODULE_1___default().latLng(terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_8__[\"default\"].toDegrees(carts[p].latitude), lon));\n    lastLongitude = lon;\n  }\n  return latlngs;\n}\nclass LeafletVisualizer {\n  visualizersCallback(leafletScene, _entityCluster, dataSource) {\n    const entities = dataSource.entities;\n    return [new LeafletGeomVisualizer(leafletScene, entities)];\n  }\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXQvTGVhZmxldFZpc3VhbGl6ZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUdBO0FBS0E7QUFDQTtBQUVBO0FBQ0E7QUFzREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFHQTtBQUZBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFJQTtBQUNBO0FBQ0E7QUFFQTtBQU1BO0FBRUE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQVFBO0FBQ0E7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQVFBO0FBQ0E7QUFFQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUtBO0FBQ0E7QUFLQTtBQU1BO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFJQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBSUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQUtBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBS0E7QUFLQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFLQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUlBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFNQTtBQU1BO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFNQTtBQUNBO0FBRUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFNQTtBQU1BO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFFQTtBQUlBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBTUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQU1BO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBSUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUlBO0FBSUE7QUFDQTtBQUVBO0FBS0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUlBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFLQTtBQUNBO0FBRUE7QUFLQTtBQUNBO0FBRUE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90ZXJyaWFqcy1tYXAvLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXQvTGVhZmxldFZpc3VhbGl6ZXIudHM/ZmRlOCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTCwgeyBMYXRMbmdCb3VuZHMsIExhdExuZ0JvdW5kc0xpdGVyYWwsIFBvbHlsaW5lT3B0aW9ucyB9IGZyb20gXCJsZWFmbGV0XCI7XG5pbXBvcnQgQXNzb2NpYXRpdmVBcnJheSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0Fzc29jaWF0aXZlQXJyYXlcIjtcbmltcG9ydCBDYXJ0ZXNpYW4yIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvQ2FydGVzaWFuMlwiO1xuaW1wb3J0IENhcnRlc2lhbjMgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9DYXJ0ZXNpYW4zXCI7XG5pbXBvcnQgQ29sb3IgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9Db2xvclwiO1xuaW1wb3J0IGRlc3Ryb3lPYmplY3QgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9kZXN0cm95T2JqZWN0XCI7XG5pbXBvcnQgRWxsaXBzb2lkIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvRWxsaXBzb2lkXCI7XG5pbXBvcnQgSnVsaWFuRGF0ZSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0p1bGlhbkRhdGVcIjtcbmltcG9ydCBDZXNpdW1NYXRoIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvTWF0aFwiO1xuaW1wb3J0IFBvbHlnb25IaWVyYXJjaHkgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9Qb2x5Z29uSGllcmFyY2h5XCI7XG5pbXBvcnQgUmVjdGFuZ2xlIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvUmVjdGFuZ2xlXCI7XG5pbXBvcnQgd3JpdGVUZXh0VG9DYW52YXMgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS93cml0ZVRleHRUb0NhbnZhc1wiO1xuaW1wb3J0IERhdGFTb3VyY2UgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvRGF0YVNvdXJjZXMvRGF0YVNvdXJjZVwiO1xuaW1wb3J0IEVudGl0eSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9EYXRhU291cmNlcy9FbnRpdHlcIjtcbmltcG9ydCBFbnRpdHlDbHVzdGVyIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0RhdGFTb3VyY2VzL0VudGl0eUNsdXN0ZXJcIjtcbmltcG9ydCBFbnRpdHlDb2xsZWN0aW9uIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0RhdGFTb3VyY2VzL0VudGl0eUNvbGxlY3Rpb25cIjtcbmltcG9ydCBQb2x5bGluZURhc2hNYXRlcmlhbFByb3BlcnR5IGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0RhdGFTb3VyY2VzL1BvbHlsaW5lRGFzaE1hdGVyaWFsUHJvcGVydHlcIjtcbmltcG9ydCBQb2x5bGluZUdsb3dNYXRlcmlhbFByb3BlcnR5IGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0RhdGFTb3VyY2VzL1BvbHlsaW5lR2xvd01hdGVyaWFsUHJvcGVydHlcIjtcbmltcG9ydCBQcm9wZXJ0eSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9EYXRhU291cmNlcy9Qcm9wZXJ0eVwiO1xuaW1wb3J0IGlzRGVmaW5lZCBmcm9tIFwiLi4vLi4vQ29yZS9pc0RlZmluZWRcIjtcbmltcG9ydCB7IGNvbnZlcnRDZXNpdW1EYXNoTnVtYmVyVG9EYXNoQXJyYXkgfSBmcm9tIFwiLi4vLi4vTW9kZWxzL0NhdGFsb2cvRXNyaS9lc3JpU3R5bGVUb1RhYmxlU3R5bGVcIjtcbmltcG9ydCBMZWFmbGV0U2NlbmUgZnJvbSBcIi4vTGVhZmxldFNjZW5lXCI7XG5cbmludGVyZmFjZSBQb2ludERldGFpbHMge1xuICBsYXllcj86IEwuQ2lyY2xlTWFya2VyO1xuICBsYXN0UG9zaXRpb246IENhcnRlc2lhbjM7XG4gIGxhc3RQaXhlbFNpemU6IG51bWJlcjtcbiAgbGFzdENvbG9yOiBDb2xvcjtcbiAgbGFzdE91dGxpbmVDb2xvcjogQ29sb3I7XG4gIGxhc3RPdXRsaW5lV2lkdGg6IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIFBvbHlnb25EZXRhaWxzIHtcbiAgbGF5ZXI/OiBMLlBvbHlnb247XG4gIGxhc3RIaWVyYXJjaHk/OiBQb2x5Z29uSGllcmFyY2h5O1xuICBsYXN0RmlsbD86IGJvb2xlYW47XG4gIGxhc3RGaWxsQ29sb3I6IENvbG9yO1xuICBsYXN0T3V0bGluZT86IGJvb2xlYW47XG4gIGxhc3RPdXRsaW5lQ29sb3I6IENvbG9yO1xufVxuXG5pbnRlcmZhY2UgUmVjdGFuZ2xlRGV0YWlscyB7XG4gIGxheWVyPzogTC5SZWN0YW5nbGU7XG4gIGxhc3RGaWxsPzogYm9vbGVhbjtcbiAgbGFzdEZpbGxDb2xvcjogQ29sb3I7XG4gIGxhc3RPdXRsaW5lPzogYm9vbGVhbjtcbiAgbGFzdE91dGxpbmVDb2xvcjogQ29sb3I7XG59XG5cbmludGVyZmFjZSBCaWxsYm9hcmREZXRhaWxzIHtcbiAgbGF5ZXI/OiBMLk1hcmtlcjtcbn1cblxuaW50ZXJmYWNlIExhYmVsRGV0YWlscyB7XG4gIGxheWVyPzogTC5NYXJrZXI7XG59XG5cbmludGVyZmFjZSBQb2x5bGluZURldGFpbHMge1xuICBsYXllcj86IEwuUG9seWxpbmU7XG59XG5cbmludGVyZmFjZSBFbnRpdHlEZXRhaWxzIHtcbiAgcG9pbnQ/OiBQb2ludERldGFpbHM7XG4gIHBvbHlnb24/OiBQb2x5Z29uRGV0YWlscztcbiAgYmlsbGJvYXJkPzogQmlsbGJvYXJkRGV0YWlscztcbiAgbGFiZWw/OiBMYWJlbERldGFpbHM7XG4gIHBvbHlsaW5lPzogUG9seWxpbmVEZXRhaWxzO1xuICByZWN0YW5nbGU/OiBSZWN0YW5nbGVEZXRhaWxzO1xufVxuXG5pbnRlcmZhY2UgRW50aXR5SGFzaCB7XG4gIFtrZXk6IHN0cmluZ106IEVudGl0eURldGFpbHM7XG59XG5cbmNvbnN0IGRlZmF1bHRDb2xvciA9IENvbG9yLldISVRFO1xuY29uc3QgZGVmYXVsdE91dGxpbmVDb2xvciA9IENvbG9yLkJMQUNLO1xuY29uc3QgZGVmYXVsdE91dGxpbmVXaWR0aCA9IDEuMDtcbmNvbnN0IGRlZmF1bHRQaXhlbFNpemUgPSA1LjA7XG5jb25zdCBkZWZhdWx0V2lkdGggPSA1LjA7XG5cbi8vU2luZ2xlIHBpeGVsIGJsYWNrIGRvdFxuY29uc3QgdG1wSW1hZ2UgPVxuICBcImRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEFRQUJBUEFBQUFBQUFQLy8veUg1QkFBQUFBQUFMQUFBQUFBQkFBRUFBQUlDUkFFQU93PT1cIjtcblxuLy9OT1QgSU1QTEVNRU5URURcbi8vIFBhdGggcHJpbWl0aXZlIC0gbm8gbmVlZCBpZGVudGlmaWVkXG4vLyBFbGxpcHNlIHByaW1pdGl2ZSAtIG5vIG5lZWQgaWRlbnRpZmllZFxuLy8gRWxsaXBzb2lkIHByaW1pdGl2ZSAtIDNkIHByaW0gLSBubyBwbGFucyBmb3IgdGhpc1xuLy8gTW9kZWwgcHJpbWl0aXZlIC0gM2QgcHJpbSAtIG5vIHBsYW5zIGZvciB0aGlzXG5cbi8qKlxuICogQSB2YXJpYWJsZSB0byBzdG9yZSB3aGF0IHNvcnQgb2YgYm91bmRzIG91ciBsZWFmbGV0IG1hcCBoYXMgYmVlbiBsb29raW5nIGF0XG4gKiAwID0gYSBub3JtYWwgZXh0ZW50XG4gKiAxID0gem9vbWVkIGluIGNsb3NlIHRvIHRoZSBlYXN0L2xlZnQgb2YgYW50aS1tZXJpZGlhblxuICogMiA9IHpvb21lZCBpbiBjbG9zZSB0byB0aGUgd2VzdC9yaWdodCBvZiB0aGUgYW50aS1tZXJpZGlhblxuICogV2hlbiB0aGlzIHZhbHVlIGNoYW5nZXMgd2UnbGwgbmVlZCB0byByZWNvbXB1dGUgdGhlIGxvY2F0aW9uIG9mIG91ciBwb2ludHNcbiAqIHRvIGhlbHAgdGhlbSB3cmFwIGFyb3VuZCB0aGUgYW50aS1tZXJpZGlhblxuICovXG5sZXQgcHJldkJvdW5kc1R5cGUgPSAwO1xuXG4vKipcbiAqIEEge0BsaW5rIFZpc3VhbGl6ZXJ9IHdoaWNoIG1hcHMge0BsaW5rIEVudGl0eSNwb2ludH0gdG8gTGVhZmxldCBwcmltaXRpdmVzLlxuICoqL1xuY2xhc3MgTGVhZmxldEdlb21WaXN1YWxpemVyIHtcbiAgcHJpdmF0ZSByZWFkb25seSBfZmVhdHVyZUdyb3VwOiBMLkZlYXR1cmVHcm91cDtcbiAgcHJpdmF0ZSByZWFkb25seSBfZW50aXRpZXNUb1Zpc3VhbGl6ZTogQXNzb2NpYXRpdmVBcnJheTtcbiAgcHJpdmF0ZSByZWFkb25seSBfZW50aXR5SGFzaDogRW50aXR5SGFzaDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICByZWFkb25seSBsZWFmbGV0U2NlbmU6IExlYWZsZXRTY2VuZSxcbiAgICByZWFkb25seSBlbnRpdHlDb2xsZWN0aW9uOiBFbnRpdHlDb2xsZWN0aW9uXG4gICkge1xuICAgIGVudGl0eUNvbGxlY3Rpb24uY29sbGVjdGlvbkNoYW5nZWQuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgIHRoaXMuX29uQ29sbGVjdGlvbkNoYW5nZWQsXG4gICAgICB0aGlzXG4gICAgKTtcbiAgICB0aGlzLl9mZWF0dXJlR3JvdXAgPSBMLmZlYXR1cmVHcm91cCgpLmFkZFRvKGxlYWZsZXRTY2VuZS5tYXApO1xuICAgIHRoaXMuX2VudGl0aWVzVG9WaXN1YWxpemUgPSBuZXcgQXNzb2NpYXRpdmVBcnJheSgpO1xuICAgIHRoaXMuX2VudGl0eUhhc2ggPSB7fTtcblxuICAgIHRoaXMuX29uQ29sbGVjdGlvbkNoYW5nZWQoXG4gICAgICBlbnRpdHlDb2xsZWN0aW9uLFxuICAgICAgZW50aXR5Q29sbGVjdGlvbi52YWx1ZXMsXG4gICAgICBbXSxcbiAgICAgIFtdXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgX29uQ29sbGVjdGlvbkNoYW5nZWQoXG4gICAgX2VudGl0eUNvbGxlY3Rpb246IEVudGl0eUNvbGxlY3Rpb24sXG4gICAgYWRkZWQ6IEVudGl0eVtdLFxuICAgIHJlbW92ZWQ6IEVudGl0eVtdLFxuICAgIGNoYW5nZWQ6IEVudGl0eVtdXG4gICkge1xuICAgIGxldCBlbnRpdHk7XG4gICAgY29uc3QgZmVhdHVyZUdyb3VwID0gdGhpcy5fZmVhdHVyZUdyb3VwO1xuICAgIGNvbnN0IGVudGl0aWVzID0gdGhpcy5fZW50aXRpZXNUb1Zpc3VhbGl6ZTtcbiAgICBjb25zdCBlbnRpdHlIYXNoID0gdGhpcy5fZW50aXR5SGFzaDtcblxuICAgIGZvciAobGV0IGkgPSBhZGRlZC5sZW5ndGggLSAxOyBpID4gLTE7IGktLSkge1xuICAgICAgZW50aXR5ID0gYWRkZWRbaV07XG4gICAgICBpZiAoXG4gICAgICAgICgoaXNEZWZpbmVkKGVudGl0eS5wb2ludCkgfHxcbiAgICAgICAgICBpc0RlZmluZWQoZW50aXR5LmJpbGxib2FyZCkgfHxcbiAgICAgICAgICBpc0RlZmluZWQoZW50aXR5LmxhYmVsKSkgJiZcbiAgICAgICAgICBpc0RlZmluZWQoZW50aXR5LnBvc2l0aW9uKSkgfHxcbiAgICAgICAgaXNEZWZpbmVkKGVudGl0eS5wb2x5bGluZSkgfHxcbiAgICAgICAgaXNEZWZpbmVkKGVudGl0eS5wb2x5Z29uKSB8fFxuICAgICAgICBpc0RlZmluZWQoZW50aXR5LnJlY3RhbmdsZSlcbiAgICAgICkge1xuICAgICAgICBlbnRpdGllcy5zZXQoZW50aXR5LmlkLCBlbnRpdHkpO1xuICAgICAgICBlbnRpdHlIYXNoW2VudGl0eS5pZF0gPSB7fTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IgKGxldCBpID0gY2hhbmdlZC5sZW5ndGggLSAxOyBpID4gLTE7IGktLSkge1xuICAgICAgZW50aXR5ID0gY2hhbmdlZFtpXTtcbiAgICAgIGlmIChcbiAgICAgICAgKChpc0RlZmluZWQoZW50aXR5LnBvaW50KSB8fFxuICAgICAgICAgIGlzRGVmaW5lZChlbnRpdHkuYmlsbGJvYXJkKSB8fFxuICAgICAgICAgIGlzRGVmaW5lZChlbnRpdHkubGFiZWwpKSAmJlxuICAgICAgICAgIGlzRGVmaW5lZChlbnRpdHkucG9zaXRpb24pKSB8fFxuICAgICAgICBpc0RlZmluZWQoZW50aXR5LnBvbHlsaW5lKSB8fFxuICAgICAgICBpc0RlZmluZWQoZW50aXR5LnBvbHlnb24pIHx8XG4gICAgICAgIGlzRGVmaW5lZChlbnRpdHkucmVjdGFuZ2xlKVxuICAgICAgKSB7XG4gICAgICAgIGVudGl0aWVzLnNldChlbnRpdHkuaWQsIGVudGl0eSk7XG4gICAgICAgIGVudGl0eUhhc2hbZW50aXR5LmlkXSA9IGVudGl0eUhhc2hbZW50aXR5LmlkXSB8fCB7fTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNsZWFuRW50aXR5KGVudGl0eSwgZmVhdHVyZUdyb3VwLCBlbnRpdHlIYXNoKTtcbiAgICAgICAgZW50aXRpZXMucmVtb3ZlKGVudGl0eS5pZCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZm9yIChsZXQgaSA9IHJlbW92ZWQubGVuZ3RoIC0gMTsgaSA+IC0xOyBpLS0pIHtcbiAgICAgIGVudGl0eSA9IHJlbW92ZWRbaV07XG4gICAgICBjbGVhbkVudGl0eShlbnRpdHksIGZlYXR1cmVHcm91cCwgZW50aXR5SGFzaCk7XG4gICAgICBlbnRpdGllcy5yZW1vdmUoZW50aXR5LmlkKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyB0aGUgcHJpbWl0aXZlcyBjcmVhdGVkIGJ5IHRoaXMgdmlzdWFsaXplciB0byBtYXRjaCB0aGVpclxuICAgKiBFbnRpdHkgY291bnRlcnBhcnQgYXQgdGhlIGdpdmVuIHRpbWUuXG4gICAqXG4gICAqL1xuICBwdWJsaWMgdXBkYXRlKHRpbWU6IEp1bGlhbkRhdGUpOiBib29sZWFuIHtcbiAgICBjb25zdCBlbnRpdGllcyA9IHRoaXMuX2VudGl0aWVzVG9WaXN1YWxpemUudmFsdWVzO1xuICAgIGNvbnN0IGVudGl0eUhhc2ggPSB0aGlzLl9lbnRpdHlIYXNoO1xuXG4gICAgY29uc3QgYm91bmRzID0gdGhpcy5sZWFmbGV0U2NlbmUubWFwLmdldEJvdW5kcygpO1xuICAgIGxldCBhcHBseUxvY2FsaXNlZEFudGlNZXJpZGlhbkZpeCA9IGZhbHNlO1xuICAgIGxldCBjdXJyZW50Qm91bmRzVHlwZSA9IDA7XG4gICAgaWYgKF9pc0Nsb3NlVG9FYXN0ZXJuQW50aU1lcmlkaWFuKGJvdW5kcykpIHtcbiAgICAgIGFwcGx5TG9jYWxpc2VkQW50aU1lcmlkaWFuRml4ID0gdHJ1ZTtcbiAgICAgIGN1cnJlbnRCb3VuZHNUeXBlID0gMTtcbiAgICB9IGVsc2UgaWYgKF9pc0Nsb3NlVG9XZXN0ZXJuQW50aU1lcmlkaWFuKGJvdW5kcykpIHtcbiAgICAgIGFwcGx5TG9jYWxpc2VkQW50aU1lcmlkaWFuRml4ID0gdHJ1ZTtcbiAgICAgIGN1cnJlbnRCb3VuZHNUeXBlID0gMjtcbiAgICB9XG5cbiAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gZW50aXRpZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIGNvbnN0IGVudGl0eSA9IGVudGl0aWVzW2ldO1xuICAgICAgY29uc3QgZW50aXR5RGV0YWlscyA9IGVudGl0eUhhc2hbZW50aXR5LmlkXTtcblxuICAgICAgaWYgKGlzRGVmaW5lZChlbnRpdHkuX3BvaW50KSkge1xuICAgICAgICB0aGlzLl91cGRhdGVQb2ludChcbiAgICAgICAgICBlbnRpdHksXG4gICAgICAgICAgdGltZSxcbiAgICAgICAgICBlbnRpdHlIYXNoLFxuICAgICAgICAgIGVudGl0eURldGFpbHMsXG4gICAgICAgICAgYXBwbHlMb2NhbGlzZWRBbnRpTWVyaWRpYW5GaXggPT09IHRydWUgPyBib3VuZHMgOiB1bmRlZmluZWQsXG4gICAgICAgICAgcHJldkJvdW5kc1R5cGUgIT09IGN1cnJlbnRCb3VuZHNUeXBlXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoaXNEZWZpbmVkKGVudGl0eS5iaWxsYm9hcmQpKSB7XG4gICAgICAgIHRoaXMuX3VwZGF0ZUJpbGxib2FyZChcbiAgICAgICAgICBlbnRpdHksXG4gICAgICAgICAgdGltZSxcbiAgICAgICAgICBlbnRpdHlIYXNoLFxuICAgICAgICAgIGVudGl0eURldGFpbHMsXG4gICAgICAgICAgYXBwbHlMb2NhbGlzZWRBbnRpTWVyaWRpYW5GaXggPT09IHRydWUgPyBib3VuZHMgOiB1bmRlZmluZWRcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmIChpc0RlZmluZWQoZW50aXR5LmxhYmVsKSkge1xuICAgICAgICB0aGlzLl91cGRhdGVMYWJlbChlbnRpdHksIHRpbWUsIGVudGl0eUhhc2gsIGVudGl0eURldGFpbHMpO1xuICAgICAgfVxuICAgICAgaWYgKGlzRGVmaW5lZChlbnRpdHkucG9seWxpbmUpKSB7XG4gICAgICAgIHRoaXMuX3VwZGF0ZVBvbHlsaW5lKGVudGl0eSwgdGltZSwgZW50aXR5SGFzaCwgZW50aXR5RGV0YWlscyk7XG4gICAgICB9XG4gICAgICBpZiAoaXNEZWZpbmVkKGVudGl0eS5wb2x5Z29uKSkge1xuICAgICAgICB0aGlzLl91cGRhdGVQb2x5Z29uKGVudGl0eSwgdGltZSwgZW50aXR5SGFzaCwgZW50aXR5RGV0YWlscyk7XG4gICAgICB9XG4gICAgICBpZiAoaXNEZWZpbmVkKGVudGl0eS5yZWN0YW5nbGUpKSB7XG4gICAgICAgIHRoaXMuX3VwZGF0ZVJlY3RhbmdsZShlbnRpdHksIHRpbWUsIGVudGl0eUhhc2gsIGVudGl0eURldGFpbHMpO1xuICAgICAgfVxuICAgIH1cbiAgICBwcmV2Qm91bmRzVHlwZSA9IGN1cnJlbnRCb3VuZHNUeXBlO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgcHJpdmF0ZSBfdXBkYXRlUG9pbnQoXG4gICAgZW50aXR5OiBFbnRpdHksXG4gICAgdGltZTogSnVsaWFuRGF0ZSxcbiAgICBfZW50aXR5SGFzaDogRW50aXR5SGFzaCxcbiAgICBlbnRpdHlEZXRhaWxzOiBFbnRpdHlEZXRhaWxzLFxuICAgIGJvdW5kczogTGF0TG5nQm91bmRzIHwgdW5kZWZpbmVkLFxuICAgIGJvdW5kc0p1c3RDaGFuZ2VkOiBib29sZWFuXG4gICkge1xuICAgIGNvbnN0IGZlYXR1cmVHcm91cCA9IHRoaXMuX2ZlYXR1cmVHcm91cDtcbiAgICBjb25zdCBwb2ludEdyYXBoaWNzID0gZW50aXR5LnBvaW50ITtcblxuICAgIGNvbnN0IHNob3cgPVxuICAgICAgZW50aXR5LmlzQXZhaWxhYmxlKHRpbWUpICYmXG4gICAgICBnZXRWYWx1ZU9yRGVmYXVsdChwb2ludEdyYXBoaWNzLnNob3csIHRpbWUsIHRydWUpO1xuICAgIGlmICghc2hvdykge1xuICAgICAgY2xlYW5Qb2ludChlbnRpdHksIGZlYXR1cmVHcm91cCwgZW50aXR5RGV0YWlscyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IGRldGFpbHMgPSBlbnRpdHlEZXRhaWxzLnBvaW50O1xuICAgIGlmICghaXNEZWZpbmVkKGRldGFpbHMpKSB7XG4gICAgICBkZXRhaWxzID0gZW50aXR5RGV0YWlscy5wb2ludCA9IHtcbiAgICAgICAgbGF5ZXI6IHVuZGVmaW5lZCxcbiAgICAgICAgbGFzdFBvc2l0aW9uOiBuZXcgQ2FydGVzaWFuMygpLFxuICAgICAgICBsYXN0UGl4ZWxTaXplOiAxLFxuICAgICAgICBsYXN0Q29sb3I6IG5ldyBDb2xvcigpLFxuICAgICAgICBsYXN0T3V0bGluZUNvbG9yOiBuZXcgQ29sb3IoKSxcbiAgICAgICAgbGFzdE91dGxpbmVXaWR0aDogMVxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCBwb3NpdGlvbiA9IGdldFZhbHVlT3JVbmRlZmluZWQoZW50aXR5LnBvc2l0aW9uLCB0aW1lKTtcbiAgICBpZiAoIWlzRGVmaW5lZChwb3NpdGlvbikpIHtcbiAgICAgIGNsZWFuUG9pbnQoZW50aXR5LCBmZWF0dXJlR3JvdXAsIGVudGl0eURldGFpbHMpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHBpeGVsU2l6ZSA9IGdldFZhbHVlT3JEZWZhdWx0KFxuICAgICAgcG9pbnRHcmFwaGljcy5waXhlbFNpemUsXG4gICAgICB0aW1lLFxuICAgICAgZGVmYXVsdFBpeGVsU2l6ZVxuICAgICk7XG4gICAgY29uc3QgY29sb3IgPSBnZXRWYWx1ZU9yRGVmYXVsdChwb2ludEdyYXBoaWNzLmNvbG9yLCB0aW1lLCBkZWZhdWx0Q29sb3IpO1xuICAgIGNvbnN0IG91dGxpbmVDb2xvciA9IGdldFZhbHVlT3JEZWZhdWx0KFxuICAgICAgcG9pbnRHcmFwaGljcy5vdXRsaW5lQ29sb3IsXG4gICAgICB0aW1lLFxuICAgICAgZGVmYXVsdE91dGxpbmVDb2xvclxuICAgICk7XG4gICAgY29uc3Qgb3V0bGluZVdpZHRoID0gZ2V0VmFsdWVPckRlZmF1bHQoXG4gICAgICBwb2ludEdyYXBoaWNzLm91dGxpbmVXaWR0aCxcbiAgICAgIHRpbWUsXG4gICAgICBkZWZhdWx0T3V0bGluZVdpZHRoXG4gICAgKTtcblxuICAgIGxldCBsYXllciA9IGRldGFpbHMubGF5ZXI7XG5cbiAgICBpZiAoIWlzRGVmaW5lZChsYXllcikpIHtcbiAgICAgIGNvbnN0IHBvaW50T3B0aW9ucyA9IHtcbiAgICAgICAgcmFkaXVzOiBwaXhlbFNpemUgLyAyLjAsXG4gICAgICAgIGZpbGxDb2xvcjogY29sb3IudG9Dc3NDb2xvclN0cmluZygpLFxuICAgICAgICBmaWxsT3BhY2l0eTogY29sb3IuYWxwaGEsXG4gICAgICAgIGNvbG9yOiBvdXRsaW5lQ29sb3IudG9Dc3NDb2xvclN0cmluZygpLFxuICAgICAgICB3ZWlnaHQ6IG91dGxpbmVXaWR0aCxcbiAgICAgICAgb3BhY2l0eTogb3V0bGluZUNvbG9yLmFscGhhXG4gICAgICB9O1xuXG4gICAgICBsYXllciA9IGRldGFpbHMubGF5ZXIgPSBMLmNpcmNsZU1hcmtlcihcbiAgICAgICAgcG9zaXRpb25Ub0xhdExuZyhwb3NpdGlvbiwgYm91bmRzKSxcbiAgICAgICAgcG9pbnRPcHRpb25zXG4gICAgICApO1xuICAgICAgbGF5ZXIub24oXCJjbGlja1wiLCBmZWF0dXJlQ2xpY2tlZC5iaW5kKHVuZGVmaW5lZCwgdGhpcywgZW50aXR5KSk7XG4gICAgICBsYXllci5vbihcIm1vdXNlZG93blwiLCBmZWF0dXJlTW91c2Vkb3duLmJpbmQodW5kZWZpbmVkLCB0aGlzLCBlbnRpdHkpKTtcbiAgICAgIGZlYXR1cmVHcm91cC5hZGRMYXllcihsYXllcik7XG5cbiAgICAgIENhcnRlc2lhbjMuY2xvbmUocG9zaXRpb24sIGRldGFpbHMubGFzdFBvc2l0aW9uKTtcbiAgICAgIGRldGFpbHMubGFzdFBpeGVsU2l6ZSA9IHBpeGVsU2l6ZTtcbiAgICAgIENvbG9yLmNsb25lKGNvbG9yLCBkZXRhaWxzLmxhc3RDb2xvcik7XG4gICAgICBDb2xvci5jbG9uZShvdXRsaW5lQ29sb3IsIGRldGFpbHMubGFzdE91dGxpbmVDb2xvcik7XG4gICAgICBkZXRhaWxzLmxhc3RPdXRsaW5lV2lkdGggPSBvdXRsaW5lV2lkdGg7XG5cbiAgICAgIHJldHVybiBsYXllcjtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICAhQ2FydGVzaWFuMy5lcXVhbHMocG9zaXRpb24sIGRldGFpbHMubGFzdFBvc2l0aW9uKSB8fFxuICAgICAgYm91bmRzSnVzdENoYW5nZWRcbiAgICApIHtcbiAgICAgIGxheWVyLnNldExhdExuZyhwb3NpdGlvblRvTGF0TG5nKHBvc2l0aW9uLCBib3VuZHMpKTtcbiAgICAgIENhcnRlc2lhbjMuY2xvbmUocG9zaXRpb24sIGRldGFpbHMubGFzdFBvc2l0aW9uKTtcbiAgICB9XG5cbiAgICBpZiAocGl4ZWxTaXplICE9PSBkZXRhaWxzLmxhc3RQaXhlbFNpemUpIHtcbiAgICAgIGxheWVyLnNldFJhZGl1cyhwaXhlbFNpemUgLyAyLjApO1xuICAgICAgZGV0YWlscy5sYXN0UGl4ZWxTaXplID0gcGl4ZWxTaXplO1xuICAgIH1cblxuICAgIGNvbnN0IG9wdGlvbnMgPSBsYXllci5vcHRpb25zO1xuICAgIGxldCBhcHBseVN0eWxlID0gZmFsc2U7XG5cbiAgICBpZiAoIUNvbG9yLmVxdWFscyhjb2xvciwgZGV0YWlscy5sYXN0Q29sb3IpKSB7XG4gICAgICBvcHRpb25zLmZpbGxDb2xvciA9IGNvbG9yLnRvQ3NzQ29sb3JTdHJpbmcoKTtcbiAgICAgIG9wdGlvbnMuZmlsbE9wYWNpdHkgPSBjb2xvci5hbHBoYTtcbiAgICAgIENvbG9yLmNsb25lKGNvbG9yLCBkZXRhaWxzLmxhc3RDb2xvcik7XG4gICAgICBhcHBseVN0eWxlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAoIUNvbG9yLmVxdWFscyhvdXRsaW5lQ29sb3IsIGRldGFpbHMubGFzdE91dGxpbmVDb2xvcikpIHtcbiAgICAgIG9wdGlvbnMuY29sb3IgPSBvdXRsaW5lQ29sb3IudG9Dc3NDb2xvclN0cmluZygpO1xuICAgICAgb3B0aW9ucy5vcGFjaXR5ID0gb3V0bGluZUNvbG9yLmFscGhhO1xuICAgICAgQ29sb3IuY2xvbmUob3V0bGluZUNvbG9yLCBkZXRhaWxzLmxhc3RPdXRsaW5lQ29sb3IpO1xuICAgICAgYXBwbHlTdHlsZSA9IHRydWU7XG4gICAgfVxuXG4gICAgaWYgKG91dGxpbmVXaWR0aCAhPT0gZGV0YWlscy5sYXN0T3V0bGluZVdpZHRoKSB7XG4gICAgICBvcHRpb25zLndlaWdodCA9IG91dGxpbmVXaWR0aDtcbiAgICAgIGRldGFpbHMubGFzdE91dGxpbmVXaWR0aCA9IG91dGxpbmVXaWR0aDtcbiAgICAgIGFwcGx5U3R5bGUgPSB0cnVlO1xuICAgIH1cblxuICAgIGlmIChhcHBseVN0eWxlKSB7XG4gICAgICBsYXllci5zZXRTdHlsZShvcHRpb25zKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF91cGRhdGVCaWxsYm9hcmQoXG4gICAgZW50aXR5OiBFbnRpdHksXG4gICAgdGltZTogSnVsaWFuRGF0ZSxcbiAgICBfZW50aXR5SGFzaDogRW50aXR5SGFzaCxcbiAgICBlbnRpdHlEZXRhaWxzOiBFbnRpdHlEZXRhaWxzLFxuICAgIGJvdW5kczogTGF0TG5nQm91bmRzIHwgdW5kZWZpbmVkXG4gICkge1xuICAgIGNvbnN0IG1hcmtlckdyYXBoaWNzID0gZW50aXR5LmJpbGxib2FyZCE7XG4gICAgY29uc3QgZmVhdHVyZUdyb3VwID0gdGhpcy5fZmVhdHVyZUdyb3VwO1xuICAgIGxldCBwb3NpdGlvbjtcbiAgICBsZXQgbWFya2VyOiBMLk1hcmtlcjtcblxuICAgIGxldCBkZXRhaWxzID0gZW50aXR5RGV0YWlscy5iaWxsYm9hcmQ7XG4gICAgaWYgKCFpc0RlZmluZWQoZGV0YWlscykpIHtcbiAgICAgIGRldGFpbHMgPSBlbnRpdHlEZXRhaWxzLmJpbGxib2FyZCA9IHtcbiAgICAgICAgbGF5ZXI6IHVuZGVmaW5lZFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCBnZW9tTGF5ZXIgPSBkZXRhaWxzLmxheWVyO1xuXG4gICAgbGV0IHNob3cgPVxuICAgICAgZW50aXR5LmlzQXZhaWxhYmxlKHRpbWUpICYmXG4gICAgICBnZXRWYWx1ZU9yRGVmYXVsdChtYXJrZXJHcmFwaGljcy5zaG93LCB0aW1lLCB0cnVlKTtcbiAgICBpZiAoc2hvdykge1xuICAgICAgcG9zaXRpb24gPSBnZXRWYWx1ZU9yVW5kZWZpbmVkKGVudGl0eS5wb3NpdGlvbiwgdGltZSk7XG4gICAgICBzaG93ID0gaXNEZWZpbmVkKHBvc2l0aW9uKTtcbiAgICB9XG4gICAgaWYgKCFzaG93KSB7XG4gICAgICBjbGVhbkJpbGxib2FyZChlbnRpdHksIGZlYXR1cmVHcm91cCwgZW50aXR5RGV0YWlscyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgbGF0bG5nID0gcG9zaXRpb25Ub0xhdExuZyhwb3NpdGlvbiwgYm91bmRzKTtcbiAgICBjb25zdCBpbWFnZTogYW55ID0gZ2V0VmFsdWUobWFya2VyR3JhcGhpY3MuaW1hZ2UsIHRpbWUpO1xuICAgIGNvbnN0IGhlaWdodDogbnVtYmVyIHwgdW5kZWZpbmVkID0gZ2V0VmFsdWUobWFya2VyR3JhcGhpY3MuaGVpZ2h0LCB0aW1lKTtcbiAgICBjb25zdCB3aWR0aDogbnVtYmVyIHwgdW5kZWZpbmVkID0gZ2V0VmFsdWUobWFya2VyR3JhcGhpY3Mud2lkdGgsIHRpbWUpO1xuICAgIGNvbnN0IGNvbG9yID0gZ2V0VmFsdWVPckRlZmF1bHQobWFya2VyR3JhcGhpY3MuY29sb3IsIHRpbWUsIGRlZmF1bHRDb2xvcik7XG4gICAgY29uc3Qgc2NhbGUgPSBnZXRWYWx1ZU9yRGVmYXVsdChtYXJrZXJHcmFwaGljcy5zY2FsZSwgdGltZSwgMS4wKTtcbiAgICBjb25zdCB2ZXJ0aWNhbE9yaWdpbiA9IGdldFZhbHVlT3JEZWZhdWx0KFxuICAgICAgbWFya2VyR3JhcGhpY3MudmVydGljYWxPcmlnaW4sXG4gICAgICB0aW1lLFxuICAgICAgMFxuICAgICk7XG4gICAgY29uc3QgaG9yaXpvbnRhbE9yaWdpbiA9IGdldFZhbHVlT3JEZWZhdWx0KFxuICAgICAgbWFya2VyR3JhcGhpY3MuaG9yaXpvbnRhbE9yaWdpbixcbiAgICAgIHRpbWUsXG4gICAgICAwXG4gICAgKTtcbiAgICBjb25zdCBwaXhlbE9mZnNldCA9IGdldFZhbHVlT3JEZWZhdWx0KFxuICAgICAgbWFya2VyR3JhcGhpY3MucGl4ZWxPZmZzZXQsXG4gICAgICB0aW1lLFxuICAgICAgQ2FydGVzaWFuMi5aRVJPXG4gICAgKTtcblxuICAgIGxldCBpbWFnZVVybDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgIGlmIChpc0RlZmluZWQoaW1hZ2UpKSB7XG4gICAgICBpZiAodHlwZW9mIGltYWdlID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIGltYWdlVXJsID0gaW1hZ2U7XG4gICAgICB9IGVsc2UgaWYgKGlzRGVmaW5lZChpbWFnZS50b0RhdGFVUkwpKSB7XG4gICAgICAgIGltYWdlVXJsID0gaW1hZ2UudG9EYXRhVVJMKCk7XG4gICAgICB9IGVsc2UgaWYgKGlzRGVmaW5lZChpbWFnZS51cmwpKSB7XG4gICAgICAgIGltYWdlVXJsID0gaW1hZ2UudXJsO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaW1hZ2VVcmwgPSBpbWFnZS5zcmM7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgaWNvbk9wdGlvbnM6IGFueSA9IHtcbiAgICAgIGNvbG9yOiBjb2xvci50b0Nzc0NvbG9yU3RyaW5nKCksXG4gICAgICBvcmlnVXJsOiBpbWFnZVVybCxcbiAgICAgIHNjYWxlOiBzY2FsZSxcbiAgICAgIGhvcml6b250YWxPcmlnaW46IGhvcml6b250YWxPcmlnaW4sIC8vdmFsdWU6IGxlZnQsIGNlbnRlciwgcmlnaHRcbiAgICAgIHZlcnRpY2FsT3JpZ2luOiB2ZXJ0aWNhbE9yaWdpbiAvL3ZhbHVlOiBib3R0b20sIGNlbnRlciwgdG9wXG4gICAgfTtcblxuICAgIGlmIChpc0RlZmluZWQoaGVpZ2h0KSB8fCBpc0RlZmluZWQod2lkdGgpKSB7XG4gICAgICBpY29uT3B0aW9ucy5pY29uU2l6ZSA9IFt3aWR0aCwgaGVpZ2h0XTtcbiAgICB9XG5cbiAgICBsZXQgcmVkcmF3SWNvbiA9IGZhbHNlO1xuICAgIGlmICghaXNEZWZpbmVkKGdlb21MYXllcikpIHtcbiAgICAgIGNvbnN0IG1hcmtlck9wdGlvbnMgPSB7IGljb246IEwuaWNvbih7IGljb25Vcmw6IHRtcEltYWdlIH0pIH07XG4gICAgICBtYXJrZXIgPSBMLm1hcmtlcihsYXRsbmcsIG1hcmtlck9wdGlvbnMpO1xuICAgICAgbWFya2VyLm9uKFwiY2xpY2tcIiwgZmVhdHVyZUNsaWNrZWQuYmluZCh1bmRlZmluZWQsIHRoaXMsIGVudGl0eSkpO1xuICAgICAgbWFya2VyLm9uKFwibW91c2Vkb3duXCIsIGZlYXR1cmVNb3VzZWRvd24uYmluZCh1bmRlZmluZWQsIHRoaXMsIGVudGl0eSkpO1xuICAgICAgZmVhdHVyZUdyb3VwLmFkZExheWVyKG1hcmtlcik7XG4gICAgICBkZXRhaWxzLmxheWVyID0gbWFya2VyO1xuICAgICAgcmVkcmF3SWNvbiA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIG1hcmtlciA9IGdlb21MYXllcjtcbiAgICAgIGlmICghbWFya2VyLmdldExhdExuZygpLmVxdWFscyhsYXRsbmcpKSB7XG4gICAgICAgIG1hcmtlci5zZXRMYXRMbmcobGF0bG5nKTtcbiAgICAgIH1cbiAgICAgIGZvciAoY29uc3QgcHJvcCBpbiBpY29uT3B0aW9ucykge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgaXNEZWZpbmVkKG1hcmtlci5vcHRpb25zLmljb24pICYmXG4gICAgICAgICAgaWNvbk9wdGlvbnNbcHJvcF0gIT09IChtYXJrZXIub3B0aW9ucy5pY29uLm9wdGlvbnMgYXMgYW55KVtwcm9wXVxuICAgICAgICApIHtcbiAgICAgICAgICByZWRyYXdJY29uID0gdHJ1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChyZWRyYXdJY29uKSB7XG4gICAgICBjb25zdCByZWNvbG9yTmVlZGVkID0gIWNvbG9yLmVxdWFscyhkZWZhdWx0Q29sb3IpO1xuICAgICAgY29uc3QgZHJhd0JpbGxib2FyZCA9IGZ1bmN0aW9uIChcbiAgICAgICAgaW1hZ2U6IEhUTUxJbWFnZUVsZW1lbnQsXG4gICAgICAgIGRhdGF1cmw6IHN0cmluZyB8IHVuZGVmaW5lZFxuICAgICAgKSB7XG4gICAgICAgIGljb25PcHRpb25zLmljb25VcmwgPSBkYXRhdXJsIHx8IGltYWdlO1xuICAgICAgICBpZiAoIWlzRGVmaW5lZChpY29uT3B0aW9ucy5pY29uU2l6ZSkpIHtcbiAgICAgICAgICBpY29uT3B0aW9ucy5pY29uU2l6ZSA9IFtpbWFnZS53aWR0aCAqIHNjYWxlLCBpbWFnZS5oZWlnaHQgKiBzY2FsZV07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdyA9IGljb25PcHRpb25zLmljb25TaXplWzBdLFxuICAgICAgICAgIGggPSBpY29uT3B0aW9ucy5pY29uU2l6ZVsxXTtcbiAgICAgICAgY29uc3QgeE9mZiA9ICh3IC8gMikgKiAoMSAtIGhvcml6b250YWxPcmlnaW4pIC0gcGl4ZWxPZmZzZXQueDtcbiAgICAgICAgY29uc3QgeU9mZiA9IChoIC8gMikgKiAoMSArIHZlcnRpY2FsT3JpZ2luKSAtIHBpeGVsT2Zmc2V0Lnk7XG4gICAgICAgIGljb25PcHRpb25zLmljb25BbmNob3IgPSBbeE9mZiwgeU9mZl07XG5cbiAgICAgICAgaWYgKHJlY29sb3JOZWVkZWQpIHtcbiAgICAgICAgICBpY29uT3B0aW9ucy5pY29uVXJsID0gcmVjb2xvckJpbGxib2FyZChpbWFnZSwgY29sb3IpO1xuICAgICAgICB9XG4gICAgICAgIG1hcmtlci5zZXRJY29uKEwuaWNvbihpY29uT3B0aW9ucykpO1xuICAgICAgfTtcbiAgICAgIGNvbnN0IGltZyA9IG5ldyBJbWFnZSgpO1xuICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZHJhd0JpbGxib2FyZChpbWcsIGltYWdlVXJsKTtcbiAgICAgIH07XG4gICAgICBpZiAoaXNEZWZpbmVkKGltYWdlVXJsKSkge1xuICAgICAgICBpbWcuc3JjID0gaW1hZ2VVcmw7XG4gICAgICAgIGlmIChyZWNvbG9yTmVlZGVkKSB7XG4gICAgICAgICAgaW1nLmNyb3NzT3JpZ2luID0gXCJhbm9ueW1vdXNcIjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX3VwZGF0ZUxhYmVsKFxuICAgIGVudGl0eTogRW50aXR5LFxuICAgIHRpbWU6IEp1bGlhbkRhdGUsXG4gICAgX2VudGl0eUhhc2g6IEVudGl0eUhhc2gsXG4gICAgZW50aXR5RGV0YWlsczogRW50aXR5RGV0YWlsc1xuICApIHtcbiAgICBjb25zdCBsYWJlbEdyYXBoaWNzID0gZW50aXR5LmxhYmVsITtcbiAgICBjb25zdCBmZWF0dXJlR3JvdXAgPSB0aGlzLl9mZWF0dXJlR3JvdXA7XG4gICAgbGV0IHBvc2l0aW9uO1xuICAgIGxldCBtYXJrZXI6IEwuTWFya2VyO1xuXG4gICAgbGV0IGRldGFpbHMgPSBlbnRpdHlEZXRhaWxzLmxhYmVsO1xuICAgIGlmICghaXNEZWZpbmVkKGRldGFpbHMpKSB7XG4gICAgICBkZXRhaWxzID0gZW50aXR5RGV0YWlscy5sYWJlbCA9IHtcbiAgICAgICAgbGF5ZXI6IHVuZGVmaW5lZFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCBnZW9tTGF5ZXIgPSBkZXRhaWxzLmxheWVyO1xuXG4gICAgbGV0IHNob3cgPVxuICAgICAgZW50aXR5LmlzQXZhaWxhYmxlKHRpbWUpICYmXG4gICAgICBnZXRWYWx1ZU9yRGVmYXVsdChsYWJlbEdyYXBoaWNzLnNob3csIHRpbWUsIHRydWUpO1xuICAgIGlmIChzaG93KSB7XG4gICAgICBwb3NpdGlvbiA9IGdldFZhbHVlT3JVbmRlZmluZWQoZW50aXR5LnBvc2l0aW9uLCB0aW1lKTtcbiAgICAgIHNob3cgPSBpc0RlZmluZWQocG9zaXRpb24pO1xuICAgIH1cbiAgICBpZiAoIXNob3cpIHtcbiAgICAgIGNsZWFuTGFiZWwoZW50aXR5LCBmZWF0dXJlR3JvdXAsIGVudGl0eURldGFpbHMpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGNhcnQgPSBFbGxpcHNvaWQuV0dTODQuY2FydGVzaWFuVG9DYXJ0b2dyYXBoaWMocG9zaXRpb24pO1xuICAgIGNvbnN0IGxhdGxuZyA9IEwubGF0TG5nKFxuICAgICAgQ2VzaXVtTWF0aC50b0RlZ3JlZXMoY2FydC5sYXRpdHVkZSksXG4gICAgICBDZXNpdW1NYXRoLnRvRGVncmVlcyhjYXJ0LmxvbmdpdHVkZSlcbiAgICApO1xuICAgIGNvbnN0IHRleHQgPSBnZXRWYWx1ZTxzdHJpbmc+KGxhYmVsR3JhcGhpY3MudGV4dCwgdGltZSk7XG4gICAgY29uc3QgZm9udCA9IGdldFZhbHVlPHN0cmluZz4obGFiZWxHcmFwaGljcy5mb250LCB0aW1lKTtcbiAgICBjb25zdCBzY2FsZSA9IGdldFZhbHVlT3JEZWZhdWx0KGxhYmVsR3JhcGhpY3Muc2NhbGUsIHRpbWUsIDEuMCk7XG4gICAgY29uc3QgZmlsbENvbG9yID0gZ2V0VmFsdWVPckRlZmF1bHQoXG4gICAgICBsYWJlbEdyYXBoaWNzLmZpbGxDb2xvcixcbiAgICAgIHRpbWUsXG4gICAgICBkZWZhdWx0Q29sb3JcbiAgICApO1xuICAgIGNvbnN0IHZlcnRpY2FsT3JpZ2luID0gZ2V0VmFsdWVPckRlZmF1bHQoXG4gICAgICBsYWJlbEdyYXBoaWNzLnZlcnRpY2FsT3JpZ2luLFxuICAgICAgdGltZSxcbiAgICAgIDBcbiAgICApO1xuICAgIGNvbnN0IGhvcml6b250YWxPcmlnaW4gPSBnZXRWYWx1ZU9yRGVmYXVsdChcbiAgICAgIGxhYmVsR3JhcGhpY3MuaG9yaXpvbnRhbE9yaWdpbixcbiAgICAgIHRpbWUsXG4gICAgICAwXG4gICAgKTtcbiAgICBjb25zdCBwaXhlbE9mZnNldCA9IGdldFZhbHVlT3JEZWZhdWx0KFxuICAgICAgbGFiZWxHcmFwaGljcy5waXhlbE9mZnNldCxcbiAgICAgIHRpbWUsXG4gICAgICBDYXJ0ZXNpYW4yLlpFUk9cbiAgICApO1xuXG4gICAgY29uc3QgaWNvbk9wdGlvbnM6IGFueSA9IHtcbiAgICAgIHRleHQ6IHRleHQsXG4gICAgICBmb250OiBmb250LFxuICAgICAgY29sb3I6IGZpbGxDb2xvci50b0Nzc0NvbG9yU3RyaW5nKCksXG4gICAgICBzY2FsZTogc2NhbGUsXG4gICAgICBob3Jpem9udGFsT3JpZ2luOiBob3Jpem9udGFsT3JpZ2luLCAvL3ZhbHVlOiBsZWZ0LCBjZW50ZXIsIHJpZ2h0XG4gICAgICB2ZXJ0aWNhbE9yaWdpbjogdmVydGljYWxPcmlnaW4gLy92YWx1ZTogYm90dG9tLCBjZW50ZXIsIHRvcFxuICAgIH07XG5cbiAgICBsZXQgcmVkcmF3TGFiZWwgPSBmYWxzZTtcbiAgICBpZiAoIWlzRGVmaW5lZChnZW9tTGF5ZXIpKSB7XG4gICAgICBjb25zdCBtYXJrZXJPcHRpb25zID0geyBpY29uOiBMLmljb24oeyBpY29uVXJsOiB0bXBJbWFnZSB9KSB9O1xuICAgICAgbWFya2VyID0gTC5tYXJrZXIobGF0bG5nLCBtYXJrZXJPcHRpb25zKTtcbiAgICAgIG1hcmtlci5vbihcImNsaWNrXCIsIGZlYXR1cmVDbGlja2VkLmJpbmQodW5kZWZpbmVkLCB0aGlzLCBlbnRpdHkpKTtcbiAgICAgIG1hcmtlci5vbihcIm1vdXNlZG93blwiLCBmZWF0dXJlTW91c2Vkb3duLmJpbmQodW5kZWZpbmVkLCB0aGlzLCBlbnRpdHkpKTtcbiAgICAgIGZlYXR1cmVHcm91cC5hZGRMYXllcihtYXJrZXIpO1xuICAgICAgZGV0YWlscy5sYXllciA9IG1hcmtlcjtcbiAgICAgIHJlZHJhd0xhYmVsID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgbWFya2VyID0gZ2VvbUxheWVyO1xuICAgICAgaWYgKCFtYXJrZXIuZ2V0TGF0TG5nKCkuZXF1YWxzKGxhdGxuZykpIHtcbiAgICAgICAgbWFya2VyLnNldExhdExuZyhsYXRsbmcpO1xuICAgICAgfVxuICAgICAgZm9yIChjb25zdCBwcm9wIGluIGljb25PcHRpb25zKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBpc0RlZmluZWQobWFya2VyLm9wdGlvbnMuaWNvbikgJiZcbiAgICAgICAgICBpY29uT3B0aW9uc1twcm9wXSAhPT0gKG1hcmtlci5vcHRpb25zLmljb24ub3B0aW9ucyBhcyBhbnkpW3Byb3BdXG4gICAgICAgICkge1xuICAgICAgICAgIHJlZHJhd0xhYmVsID0gdHJ1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChyZWRyYXdMYWJlbCAmJiBpc0RlZmluZWQodGV4dCkpIHtcbiAgICAgIGNvbnN0IGRyYXdCaWxsYm9hcmQgPSBmdW5jdGlvbiAoXG4gICAgICAgIGltYWdlOiBIVE1MSW1hZ2VFbGVtZW50LFxuICAgICAgICBkYXRhdXJsOiBzdHJpbmdcbiAgICAgICkge1xuICAgICAgICBpY29uT3B0aW9ucy5pY29uVXJsID0gZGF0YXVybCB8fCBpbWFnZTtcbiAgICAgICAgaWYgKCFpc0RlZmluZWQoaWNvbk9wdGlvbnMuaWNvblNpemUpKSB7XG4gICAgICAgICAgaWNvbk9wdGlvbnMuaWNvblNpemUgPSBbaW1hZ2Uud2lkdGggKiBzY2FsZSwgaW1hZ2UuaGVpZ2h0ICogc2NhbGVdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHcgPSBpY29uT3B0aW9ucy5pY29uU2l6ZVswXSxcbiAgICAgICAgICBoID0gaWNvbk9wdGlvbnMuaWNvblNpemVbMV07XG4gICAgICAgIGNvbnN0IHhPZmYgPSAodyAvIDIpICogKDEgLSBob3Jpem9udGFsT3JpZ2luKSAtIHBpeGVsT2Zmc2V0Lng7XG4gICAgICAgIGNvbnN0IHlPZmYgPSAoaCAvIDIpICogKDEgKyB2ZXJ0aWNhbE9yaWdpbikgLSBwaXhlbE9mZnNldC55O1xuICAgICAgICBpY29uT3B0aW9ucy5pY29uQW5jaG9yID0gW3hPZmYsIHlPZmZdO1xuICAgICAgICBtYXJrZXIuc2V0SWNvbihMLmljb24oaWNvbk9wdGlvbnMpKTtcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGNhbnZhcyA9IHdyaXRlVGV4dFRvQ2FudmFzKHRleHQsIHtcbiAgICAgICAgZmlsbENvbG9yOiBmaWxsQ29sb3IsXG4gICAgICAgIGZvbnQ6IGZvbnRcbiAgICAgIH0pO1xuICAgICAgaWYgKGlzRGVmaW5lZChjYW52YXMpKSB7XG4gICAgICAgIGNvbnN0IGltYWdlVXJsID0gY2FudmFzLnRvRGF0YVVSTCgpO1xuXG4gICAgICAgIGNvbnN0IGltZyA9IG5ldyBJbWFnZSgpO1xuICAgICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGRyYXdCaWxsYm9hcmQoaW1nLCBpbWFnZVVybCk7XG4gICAgICAgIH07XG4gICAgICAgIGltZy5zcmMgPSBpbWFnZVVybDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF91cGRhdGVSZWN0YW5nbGUoXG4gICAgZW50aXR5OiBFbnRpdHksXG4gICAgdGltZTogSnVsaWFuRGF0ZSxcbiAgICBfZW50aXR5SGFzaDogRW50aXR5SGFzaCxcbiAgICBlbnRpdHlEZXRhaWxzOiBFbnRpdHlEZXRhaWxzXG4gICkge1xuICAgIGNvbnN0IGZlYXR1cmVHcm91cCA9IHRoaXMuX2ZlYXR1cmVHcm91cDtcbiAgICBjb25zdCByZWN0YW5nbGVHcmFwaGljcyA9IGVudGl0eS5yZWN0YW5nbGU7XG5cbiAgICBpZiAoIWlzRGVmaW5lZChyZWN0YW5nbGVHcmFwaGljcykpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBzaG93ID1cbiAgICAgIGVudGl0eS5pc0F2YWlsYWJsZSh0aW1lKSAmJlxuICAgICAgZ2V0VmFsdWVPckRlZmF1bHQocmVjdGFuZ2xlR3JhcGhpY3Muc2hvdywgdGltZSwgdHJ1ZSk7XG5cbiAgICBjb25zdCByZWN0YW5nbGVDb29yZGluYXRlcyA9IHJlY3RhbmdsZUdyYXBoaWNzLmNvb3JkaW5hdGVzPy5nZXRWYWx1ZShcbiAgICAgIHRpbWVcbiAgICApIGFzIFJlY3RhbmdsZTtcblxuICAgIGlmICghc2hvdyB8fCAhaXNEZWZpbmVkKHJlY3RhbmdsZUNvb3JkaW5hdGVzKSkge1xuICAgICAgY2xlYW5SZWN0YW5nbGUoZW50aXR5LCBmZWF0dXJlR3JvdXAsIGVudGl0eURldGFpbHMpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHJlY3RhbmdsZUJvdW5kczogTGF0TG5nQm91bmRzTGl0ZXJhbCA9IFtcbiAgICAgIFtcbiAgICAgICAgQ2VzaXVtTWF0aC50b0RlZ3JlZXMocmVjdGFuZ2xlQ29vcmRpbmF0ZXMuc291dGgpLFxuICAgICAgICBDZXNpdW1NYXRoLnRvRGVncmVlcyhyZWN0YW5nbGVDb29yZGluYXRlcy53ZXN0KVxuICAgICAgXSxcbiAgICAgIFtcbiAgICAgICAgQ2VzaXVtTWF0aC50b0RlZ3JlZXMocmVjdGFuZ2xlQ29vcmRpbmF0ZXMubm9ydGgpLFxuICAgICAgICBDZXNpdW1NYXRoLnRvRGVncmVlcyhyZWN0YW5nbGVDb29yZGluYXRlcy5lYXN0KVxuICAgICAgXVxuICAgIF07XG5cbiAgICBsZXQgZGV0YWlscyA9IGVudGl0eURldGFpbHMucmVjdGFuZ2xlO1xuICAgIGlmICghaXNEZWZpbmVkKGRldGFpbHMpKSB7XG4gICAgICBkZXRhaWxzID0gZW50aXR5RGV0YWlscy5yZWN0YW5nbGUgPSB7XG4gICAgICAgIGxheWVyOiB1bmRlZmluZWQsXG4gICAgICAgIGxhc3RGaWxsOiB1bmRlZmluZWQsXG4gICAgICAgIGxhc3RGaWxsQ29sb3I6IG5ldyBDb2xvcigpLFxuICAgICAgICBsYXN0T3V0bGluZTogdW5kZWZpbmVkLFxuICAgICAgICBsYXN0T3V0bGluZUNvbG9yOiBuZXcgQ29sb3IoKVxuICAgICAgfTtcbiAgICB9XG4gICAgY29uc3QgZmlsbCA9IGdldFZhbHVlT3JEZWZhdWx0KFxuICAgICAgcmVjdGFuZ2xlR3JhcGhpY3MuZmlsbCBhcyB1bmtub3duIGFzIFByb3BlcnR5LFxuICAgICAgdGltZSxcbiAgICAgIHRydWVcbiAgICApO1xuICAgIGNvbnN0IG91dGxpbmUgPSBnZXRWYWx1ZU9yRGVmYXVsdChyZWN0YW5nbGVHcmFwaGljcy5vdXRsaW5lLCB0aW1lLCB0cnVlKTtcbiAgICBsZXQgZGFzaEFycmF5O1xuICAgIGlmIChyZWN0YW5nbGVHcmFwaGljcy5vdXRsaW5lIGluc3RhbmNlb2YgUG9seWxpbmVEYXNoTWF0ZXJpYWxQcm9wZXJ0eSkge1xuICAgICAgZGFzaEFycmF5ID0gZ2V0RGFzaEFycmF5KHJlY3RhbmdsZUdyYXBoaWNzLm91dGxpbmUsIHRpbWUpO1xuICAgIH1cblxuICAgIGNvbnN0IG91dGxpbmVXaWR0aCA9IGdldFZhbHVlT3JEZWZhdWx0KFxuICAgICAgcmVjdGFuZ2xlR3JhcGhpY3Mub3V0bGluZVdpZHRoIGFzIHVua25vd24gYXMgUHJvcGVydHksXG4gICAgICB0aW1lLFxuICAgICAgZGVmYXVsdE91dGxpbmVXaWR0aFxuICAgICk7XG5cbiAgICBjb25zdCBvdXRsaW5lQ29sb3IgPSBnZXRWYWx1ZU9yRGVmYXVsdChcbiAgICAgIHJlY3RhbmdsZUdyYXBoaWNzLm91dGxpbmVDb2xvciBhcyB1bmtub3duIGFzIFByb3BlcnR5LFxuICAgICAgdGltZSxcbiAgICAgIGRlZmF1bHRPdXRsaW5lQ29sb3JcbiAgICApO1xuXG4gICAgY29uc3QgbWF0ZXJpYWwgPSBnZXRWYWx1ZU9yVW5kZWZpbmVkKFxuICAgICAgcmVjdGFuZ2xlR3JhcGhpY3MubWF0ZXJpYWwgYXMgdW5rbm93biBhcyBQcm9wZXJ0eSxcbiAgICAgIHRpbWVcbiAgICApO1xuICAgIGxldCBmaWxsQ29sb3I7XG4gICAgaWYgKGlzRGVmaW5lZChtYXRlcmlhbCkgJiYgaXNEZWZpbmVkKG1hdGVyaWFsLmNvbG9yKSkge1xuICAgICAgZmlsbENvbG9yID0gbWF0ZXJpYWwuY29sb3I7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZpbGxDb2xvciA9IGRlZmF1bHRDb2xvcjtcbiAgICB9XG5cbiAgICBsZXQgbGF5ZXIgPSBkZXRhaWxzLmxheWVyO1xuICAgIGlmICghaXNEZWZpbmVkKGxheWVyKSkge1xuICAgICAgY29uc3QgcG9seWdvbk9wdGlvbnM6IFBvbHlsaW5lT3B0aW9ucyA9IHtcbiAgICAgICAgZmlsbDogZmlsbCxcbiAgICAgICAgZmlsbENvbG9yOiBmaWxsQ29sb3IudG9Dc3NDb2xvclN0cmluZygpLFxuICAgICAgICBmaWxsT3BhY2l0eTogZmlsbENvbG9yLmFscGhhLFxuICAgICAgICB3ZWlnaHQ6IG91dGxpbmUgPyBvdXRsaW5lV2lkdGggOiAwLjAsXG4gICAgICAgIGNvbG9yOiBvdXRsaW5lQ29sb3IudG9Dc3NDb2xvclN0cmluZygpLFxuICAgICAgICBvcGFjaXR5OiBvdXRsaW5lQ29sb3IuYWxwaGFcbiAgICAgIH07XG5cbiAgICAgIGlmIChvdXRsaW5lICYmIGRhc2hBcnJheSkge1xuICAgICAgICBwb2x5Z29uT3B0aW9ucy5kYXNoQXJyYXkgPSBkYXNoQXJyYXlcbiAgICAgICAgICAubWFwKCh4KSA9PiB4ICogb3V0bGluZVdpZHRoKVxuICAgICAgICAgIC5qb2luKFwiLFwiKTtcbiAgICAgIH1cblxuICAgICAgbGF5ZXIgPSBkZXRhaWxzLmxheWVyID0gTC5yZWN0YW5nbGUocmVjdGFuZ2xlQm91bmRzLCBwb2x5Z29uT3B0aW9ucyk7XG5cbiAgICAgIGxheWVyLm9uKFwiY2xpY2tcIiwgZmVhdHVyZUNsaWNrZWQuYmluZCh1bmRlZmluZWQsIHRoaXMsIGVudGl0eSkpO1xuICAgICAgbGF5ZXIub24oXCJtb3VzZWRvd25cIiwgZmVhdHVyZU1vdXNlZG93bi5iaW5kKHVuZGVmaW5lZCwgdGhpcywgZW50aXR5KSk7XG4gICAgICBmZWF0dXJlR3JvdXAuYWRkTGF5ZXIobGF5ZXIpO1xuXG4gICAgICBkZXRhaWxzLmxhc3RGaWxsID0gZmlsbDtcbiAgICAgIGRldGFpbHMubGFzdE91dGxpbmUgPSBvdXRsaW5lO1xuICAgICAgQ29sb3IuY2xvbmUoZmlsbENvbG9yLCBkZXRhaWxzLmxhc3RGaWxsQ29sb3IpO1xuICAgICAgQ29sb3IuY2xvbmUob3V0bGluZUNvbG9yLCBkZXRhaWxzLmxhc3RPdXRsaW5lQ29sb3IpO1xuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3Qgb3B0aW9ucyA9IGxheWVyLm9wdGlvbnM7XG4gICAgbGV0IGFwcGx5U3R5bGUgPSBmYWxzZTtcblxuICAgIGlmIChmaWxsICE9PSBkZXRhaWxzLmxhc3RGaWxsKSB7XG4gICAgICBvcHRpb25zLmZpbGwgPSBmaWxsO1xuICAgICAgZGV0YWlscy5sYXN0RmlsbCA9IGZpbGw7XG4gICAgICBhcHBseVN0eWxlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAob3V0bGluZSAhPT0gZGV0YWlscy5sYXN0T3V0bGluZSkge1xuICAgICAgb3B0aW9ucy53ZWlnaHQgPSBvdXRsaW5lID8gb3V0bGluZVdpZHRoIDogMC4wO1xuICAgICAgZGV0YWlscy5sYXN0T3V0bGluZSA9IG91dGxpbmU7XG4gICAgICBhcHBseVN0eWxlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAoIUNvbG9yLmVxdWFscyhmaWxsQ29sb3IsIGRldGFpbHMubGFzdEZpbGxDb2xvcikpIHtcbiAgICAgIG9wdGlvbnMuZmlsbENvbG9yID0gZmlsbENvbG9yLnRvQ3NzQ29sb3JTdHJpbmcoKTtcbiAgICAgIG9wdGlvbnMuZmlsbE9wYWNpdHkgPSBmaWxsQ29sb3IuYWxwaGE7XG4gICAgICBDb2xvci5jbG9uZShmaWxsQ29sb3IsIGRldGFpbHMubGFzdEZpbGxDb2xvcik7XG4gICAgICBhcHBseVN0eWxlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAoIUNvbG9yLmVxdWFscyhvdXRsaW5lQ29sb3IsIGRldGFpbHMubGFzdE91dGxpbmVDb2xvcikpIHtcbiAgICAgIG9wdGlvbnMuY29sb3IgPSBvdXRsaW5lQ29sb3IudG9Dc3NDb2xvclN0cmluZygpO1xuICAgICAgb3B0aW9ucy5vcGFjaXR5ID0gb3V0bGluZUNvbG9yLmFscGhhO1xuICAgICAgQ29sb3IuY2xvbmUob3V0bGluZUNvbG9yLCBkZXRhaWxzLmxhc3RPdXRsaW5lQ29sb3IpO1xuICAgICAgYXBwbHlTdHlsZSA9IHRydWU7XG4gICAgfVxuXG4gICAgaWYgKCFsYXllci5nZXRCb3VuZHMoKS5lcXVhbHMocmVjdGFuZ2xlQm91bmRzKSkge1xuICAgICAgbGF5ZXIuc2V0Qm91bmRzKHJlY3RhbmdsZUJvdW5kcyk7XG4gICAgfVxuXG4gICAgaWYgKGFwcGx5U3R5bGUpIHtcbiAgICAgIGxheWVyLnNldFN0eWxlKG9wdGlvbnMpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX3VwZGF0ZVBvbHlnb24oXG4gICAgZW50aXR5OiBFbnRpdHksXG4gICAgdGltZTogSnVsaWFuRGF0ZSxcbiAgICBfZW50aXR5SGFzaDogRW50aXR5SGFzaCxcbiAgICBlbnRpdHlEZXRhaWxzOiBFbnRpdHlEZXRhaWxzXG4gICkge1xuICAgIGNvbnN0IGZlYXR1cmVHcm91cCA9IHRoaXMuX2ZlYXR1cmVHcm91cDtcbiAgICBjb25zdCBwb2x5Z29uR3JhcGhpY3MgPSBlbnRpdHkucG9seWdvbiE7XG5cbiAgICBjb25zdCBzaG93ID1cbiAgICAgIGVudGl0eS5pc0F2YWlsYWJsZSh0aW1lKSAmJlxuICAgICAgZ2V0VmFsdWVPckRlZmF1bHQocG9seWdvbkdyYXBoaWNzLnNob3csIHRpbWUsIHRydWUpO1xuICAgIGlmICghc2hvdykge1xuICAgICAgY2xlYW5Qb2x5Z29uKGVudGl0eSwgZmVhdHVyZUdyb3VwLCBlbnRpdHlEZXRhaWxzKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgZGV0YWlscyA9IGVudGl0eURldGFpbHMucG9seWdvbjtcbiAgICBpZiAoIWlzRGVmaW5lZChkZXRhaWxzKSkge1xuICAgICAgZGV0YWlscyA9IGVudGl0eURldGFpbHMucG9seWdvbiA9IHtcbiAgICAgICAgbGF5ZXI6IHVuZGVmaW5lZCxcbiAgICAgICAgbGFzdEhpZXJhcmNoeTogdW5kZWZpbmVkLFxuICAgICAgICBsYXN0RmlsbDogdW5kZWZpbmVkLFxuICAgICAgICBsYXN0RmlsbENvbG9yOiBuZXcgQ29sb3IoKSxcbiAgICAgICAgbGFzdE91dGxpbmU6IHVuZGVmaW5lZCxcbiAgICAgICAgbGFzdE91dGxpbmVDb2xvcjogbmV3IENvbG9yKClcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgaGllcmFyY2h5ID0gZ2V0VmFsdWVPclVuZGVmaW5lZChwb2x5Z29uR3JhcGhpY3MuaGllcmFyY2h5LCB0aW1lKTtcbiAgICBpZiAoIWlzRGVmaW5lZChoaWVyYXJjaHkpKSB7XG4gICAgICBjbGVhblBvbHlnb24oZW50aXR5LCBmZWF0dXJlR3JvdXAsIGVudGl0eURldGFpbHMpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGZpbGwgPSBnZXRWYWx1ZU9yRGVmYXVsdChcbiAgICAgIHBvbHlnb25HcmFwaGljcy5maWxsIGFzIHVua25vd24gYXMgUHJvcGVydHksXG4gICAgICB0aW1lLFxuICAgICAgdHJ1ZVxuICAgICk7XG4gICAgY29uc3Qgb3V0bGluZSA9IGdldFZhbHVlT3JEZWZhdWx0KHBvbHlnb25HcmFwaGljcy5vdXRsaW5lLCB0aW1lLCB0cnVlKTtcbiAgICBsZXQgZGFzaEFycmF5O1xuICAgIGlmIChwb2x5Z29uR3JhcGhpY3Mub3V0bGluZSBpbnN0YW5jZW9mIFBvbHlsaW5lRGFzaE1hdGVyaWFsUHJvcGVydHkpIHtcbiAgICAgIGRhc2hBcnJheSA9IGdldERhc2hBcnJheShwb2x5Z29uR3JhcGhpY3Mub3V0bGluZSwgdGltZSk7XG4gICAgfVxuXG4gICAgY29uc3Qgb3V0bGluZVdpZHRoID0gZ2V0VmFsdWVPckRlZmF1bHQoXG4gICAgICBwb2x5Z29uR3JhcGhpY3Mub3V0bGluZVdpZHRoIGFzIHVua25vd24gYXMgUHJvcGVydHksXG4gICAgICB0aW1lLFxuICAgICAgZGVmYXVsdE91dGxpbmVXaWR0aFxuICAgICk7XG5cbiAgICBjb25zdCBvdXRsaW5lQ29sb3IgPSBnZXRWYWx1ZU9yRGVmYXVsdChcbiAgICAgIHBvbHlnb25HcmFwaGljcy5vdXRsaW5lQ29sb3IgYXMgdW5rbm93biBhcyBQcm9wZXJ0eSxcbiAgICAgIHRpbWUsXG4gICAgICBkZWZhdWx0T3V0bGluZUNvbG9yXG4gICAgKTtcblxuICAgIGNvbnN0IG1hdGVyaWFsID0gZ2V0VmFsdWVPclVuZGVmaW5lZChcbiAgICAgIHBvbHlnb25HcmFwaGljcy5tYXRlcmlhbCBhcyB1bmtub3duIGFzIFByb3BlcnR5LFxuICAgICAgdGltZVxuICAgICk7XG4gICAgbGV0IGZpbGxDb2xvcjtcbiAgICBpZiAoaXNEZWZpbmVkKG1hdGVyaWFsKSAmJiBpc0RlZmluZWQobWF0ZXJpYWwuY29sb3IpKSB7XG4gICAgICBmaWxsQ29sb3IgPSBtYXRlcmlhbC5jb2xvcjtcbiAgICB9IGVsc2Uge1xuICAgICAgZmlsbENvbG9yID0gZGVmYXVsdENvbG9yO1xuICAgIH1cblxuICAgIGxldCBsYXllciA9IGRldGFpbHMubGF5ZXI7XG4gICAgaWYgKCFpc0RlZmluZWQobGF5ZXIpKSB7XG4gICAgICBjb25zdCBwb2x5Z29uT3B0aW9uczogUG9seWxpbmVPcHRpb25zID0ge1xuICAgICAgICBmaWxsOiBmaWxsLFxuICAgICAgICBmaWxsQ29sb3I6IGZpbGxDb2xvci50b0Nzc0NvbG9yU3RyaW5nKCksXG4gICAgICAgIGZpbGxPcGFjaXR5OiBmaWxsQ29sb3IuYWxwaGEsXG4gICAgICAgIHdlaWdodDogb3V0bGluZSA/IG91dGxpbmVXaWR0aCA6IDAuMCxcbiAgICAgICAgY29sb3I6IG91dGxpbmVDb2xvci50b0Nzc0NvbG9yU3RyaW5nKCksXG4gICAgICAgIG9wYWNpdHk6IG91dGxpbmVDb2xvci5hbHBoYVxuICAgICAgfTtcblxuICAgICAgaWYgKG91dGxpbmUgJiYgZGFzaEFycmF5KSB7XG4gICAgICAgIHBvbHlnb25PcHRpb25zLmRhc2hBcnJheSA9IGRhc2hBcnJheVxuICAgICAgICAgIC5tYXAoKHgpID0+IHggKiBvdXRsaW5lV2lkdGgpXG4gICAgICAgICAgLmpvaW4oXCIsXCIpO1xuICAgICAgfVxuXG4gICAgICBsYXllciA9IGRldGFpbHMubGF5ZXIgPSBMLnBvbHlnb24oXG4gICAgICAgIGhpZXJhcmNoeVRvTGF0TG5ncyhoaWVyYXJjaHkpLFxuICAgICAgICBwb2x5Z29uT3B0aW9uc1xuICAgICAgKTtcbiAgICAgIGxheWVyLm9uKFwiY2xpY2tcIiwgZmVhdHVyZUNsaWNrZWQuYmluZCh1bmRlZmluZWQsIHRoaXMsIGVudGl0eSkpO1xuICAgICAgbGF5ZXIub24oXCJtb3VzZWRvd25cIiwgZmVhdHVyZU1vdXNlZG93bi5iaW5kKHVuZGVmaW5lZCwgdGhpcywgZW50aXR5KSk7XG4gICAgICBmZWF0dXJlR3JvdXAuYWRkTGF5ZXIobGF5ZXIpO1xuXG4gICAgICBkZXRhaWxzLmxhc3RIaWVyYXJjaHkgPSBoaWVyYXJjaHk7XG4gICAgICBkZXRhaWxzLmxhc3RGaWxsID0gZmlsbDtcbiAgICAgIGRldGFpbHMubGFzdE91dGxpbmUgPSBvdXRsaW5lO1xuICAgICAgQ29sb3IuY2xvbmUoZmlsbENvbG9yLCBkZXRhaWxzLmxhc3RGaWxsQ29sb3IpO1xuICAgICAgQ29sb3IuY2xvbmUob3V0bGluZUNvbG9yLCBkZXRhaWxzLmxhc3RPdXRsaW5lQ29sb3IpO1xuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGhpZXJhcmNoeSAhPT0gZGV0YWlscy5sYXN0SGllcmFyY2h5KSB7XG4gICAgICBsYXllci5zZXRMYXRMbmdzKGhpZXJhcmNoeVRvTGF0TG5ncyhoaWVyYXJjaHkpKTtcbiAgICAgIGRldGFpbHMubGFzdEhpZXJhcmNoeSA9IGhpZXJhcmNoeTtcbiAgICB9XG5cbiAgICBjb25zdCBvcHRpb25zID0gbGF5ZXIub3B0aW9ucztcbiAgICBsZXQgYXBwbHlTdHlsZSA9IGZhbHNlO1xuXG4gICAgaWYgKGZpbGwgIT09IGRldGFpbHMubGFzdEZpbGwpIHtcbiAgICAgIG9wdGlvbnMuZmlsbCA9IGZpbGw7XG4gICAgICBkZXRhaWxzLmxhc3RGaWxsID0gZmlsbDtcbiAgICAgIGFwcGx5U3R5bGUgPSB0cnVlO1xuICAgIH1cblxuICAgIGlmIChvdXRsaW5lICE9PSBkZXRhaWxzLmxhc3RPdXRsaW5lKSB7XG4gICAgICBvcHRpb25zLndlaWdodCA9IG91dGxpbmUgPyBvdXRsaW5lV2lkdGggOiAwLjA7XG4gICAgICBkZXRhaWxzLmxhc3RPdXRsaW5lID0gb3V0bGluZTtcbiAgICAgIGFwcGx5U3R5bGUgPSB0cnVlO1xuICAgIH1cblxuICAgIGlmICghQ29sb3IuZXF1YWxzKGZpbGxDb2xvciwgZGV0YWlscy5sYXN0RmlsbENvbG9yKSkge1xuICAgICAgb3B0aW9ucy5maWxsQ29sb3IgPSBmaWxsQ29sb3IudG9Dc3NDb2xvclN0cmluZygpO1xuICAgICAgb3B0aW9ucy5maWxsT3BhY2l0eSA9IGZpbGxDb2xvci5hbHBoYTtcbiAgICAgIENvbG9yLmNsb25lKGZpbGxDb2xvciwgZGV0YWlscy5sYXN0RmlsbENvbG9yKTtcbiAgICAgIGFwcGx5U3R5bGUgPSB0cnVlO1xuICAgIH1cblxuICAgIGlmICghQ29sb3IuZXF1YWxzKG91dGxpbmVDb2xvciwgZGV0YWlscy5sYXN0T3V0bGluZUNvbG9yKSkge1xuICAgICAgb3B0aW9ucy5jb2xvciA9IG91dGxpbmVDb2xvci50b0Nzc0NvbG9yU3RyaW5nKCk7XG4gICAgICBvcHRpb25zLm9wYWNpdHkgPSBvdXRsaW5lQ29sb3IuYWxwaGE7XG4gICAgICBDb2xvci5jbG9uZShvdXRsaW5lQ29sb3IsIGRldGFpbHMubGFzdE91dGxpbmVDb2xvcik7XG4gICAgICBhcHBseVN0eWxlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAoYXBwbHlTdHlsZSkge1xuICAgICAgbGF5ZXIuc2V0U3R5bGUob3B0aW9ucyk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBfdXBkYXRlUG9seWxpbmUoXG4gICAgZW50aXR5OiBFbnRpdHksXG4gICAgdGltZTogSnVsaWFuRGF0ZSxcbiAgICBfZW50aXR5SGFzaDogRW50aXR5SGFzaCxcbiAgICBlbnRpdHlEZXRhaWxzOiBFbnRpdHlEZXRhaWxzXG4gICkge1xuICAgIGNvbnN0IHBvbHlsaW5lR3JhcGhpY3MgPSBlbnRpdHkucG9seWxpbmUhO1xuICAgIGNvbnN0IGZlYXR1cmVHcm91cCA9IHRoaXMuX2ZlYXR1cmVHcm91cDtcbiAgICBsZXQgcG9zaXRpb25zLCBwb2x5bGluZTtcblxuICAgIGxldCBkZXRhaWxzID0gZW50aXR5RGV0YWlscy5wb2x5bGluZTtcbiAgICBpZiAoIWlzRGVmaW5lZChkZXRhaWxzKSkge1xuICAgICAgZGV0YWlscyA9IGVudGl0eURldGFpbHMucG9seWxpbmUgPSB7XG4gICAgICAgIGxheWVyOiB1bmRlZmluZWRcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgZ2VvbUxheWVyID0gZGV0YWlscy5sYXllcjtcblxuICAgIGxldCBzaG93ID1cbiAgICAgIGVudGl0eS5pc0F2YWlsYWJsZSh0aW1lKSAmJlxuICAgICAgZ2V0VmFsdWVPckRlZmF1bHQocG9seWxpbmVHcmFwaGljcy5zaG93LCB0aW1lLCB0cnVlKTtcbiAgICBpZiAoc2hvdykge1xuICAgICAgcG9zaXRpb25zID0gZ2V0VmFsdWVPclVuZGVmaW5lZChwb2x5bGluZUdyYXBoaWNzLnBvc2l0aW9ucywgdGltZSk7XG4gICAgICBzaG93ID0gaXNEZWZpbmVkKHBvc2l0aW9ucyk7XG4gICAgfVxuICAgIGlmICghc2hvdykge1xuICAgICAgY2xlYW5Qb2x5bGluZShlbnRpdHksIGZlYXR1cmVHcm91cCwgZW50aXR5RGV0YWlscyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgY2FydHMgPSBFbGxpcHNvaWQuV0dTODQuY2FydGVzaWFuQXJyYXlUb0NhcnRvZ3JhcGhpY0FycmF5KHBvc2l0aW9ucyk7XG4gICAgY29uc3QgbGF0bG5ncyA9IFtdO1xuICAgIGZvciAobGV0IHAgPSAwOyBwIDwgY2FydHMubGVuZ3RoOyBwKyspIHtcbiAgICAgIGxhdGxuZ3MucHVzaChcbiAgICAgICAgTC5sYXRMbmcoXG4gICAgICAgICAgQ2VzaXVtTWF0aC50b0RlZ3JlZXMoY2FydHNbcF0ubGF0aXR1ZGUpLFxuICAgICAgICAgIENlc2l1bU1hdGgudG9EZWdyZWVzKGNhcnRzW3BdLmxvbmdpdHVkZSlcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBsZXQgY29sb3I7XG4gICAgbGV0IGRhc2hBcnJheTogbnVtYmVyW10gfCB1bmRlZmluZWQ7XG4gICAgbGV0IHdpZHRoOiBudW1iZXI7XG4gICAgaWYgKHBvbHlsaW5lR3JhcGhpY3MubWF0ZXJpYWwgaW5zdGFuY2VvZiBQb2x5bGluZUdsb3dNYXRlcmlhbFByb3BlcnR5KSB7XG4gICAgICBjb2xvciA9IGRlZmF1bHRDb2xvcjtcbiAgICAgIHdpZHRoID0gZGVmYXVsdFdpZHRoO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBtYXRlcmlhbCA9IHBvbHlsaW5lR3JhcGhpY3MubWF0ZXJpYWwuZ2V0VmFsdWUodGltZSk7XG4gICAgICBpZiAoaXNEZWZpbmVkKG1hdGVyaWFsKSkge1xuICAgICAgICBjb2xvciA9IG1hdGVyaWFsLmNvbG9yO1xuICAgICAgfVxuICAgICAgY29sb3IgPSBjb2xvciB8fCBkZWZhdWx0Q29sb3I7XG4gICAgICB3aWR0aCA9IGdldFZhbHVlT3JEZWZhdWx0KFxuICAgICAgICBwb2x5bGluZUdyYXBoaWNzLndpZHRoIGFzIHVua25vd24gYXMgUHJvcGVydHksXG4gICAgICAgIHRpbWUsXG4gICAgICAgIGRlZmF1bHRXaWR0aFxuICAgICAgKTtcbiAgICB9XG4gICAgaWYgKHBvbHlsaW5lR3JhcGhpY3MubWF0ZXJpYWwgaW5zdGFuY2VvZiBQb2x5bGluZURhc2hNYXRlcmlhbFByb3BlcnR5KSB7XG4gICAgICBkYXNoQXJyYXkgPSBnZXREYXNoQXJyYXkocG9seWxpbmVHcmFwaGljcy5tYXRlcmlhbCwgdGltZSk7XG4gICAgfVxuXG4gICAgY29uc3QgcG9seWxpbmVPcHRpb25zOiBQb2x5bGluZU9wdGlvbnMgPSB7XG4gICAgICBjb2xvcjogY29sb3IudG9Dc3NDb2xvclN0cmluZygpLFxuICAgICAgd2VpZ2h0OiB3aWR0aCxcbiAgICAgIG9wYWNpdHk6IGNvbG9yLmFscGhhXG4gICAgfTtcblxuICAgIGlmIChkYXNoQXJyYXkpIHtcbiAgICAgIHBvbHlsaW5lT3B0aW9ucy5kYXNoQXJyYXkgPSBkYXNoQXJyYXkubWFwKCh4KSA9PiB4ICogd2lkdGgpLmpvaW4oXCIsXCIpO1xuICAgIH1cblxuICAgIGlmICghaXNEZWZpbmVkKGdlb21MYXllcikpIHtcbiAgICAgIGlmIChsYXRsbmdzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcG9seWxpbmUgPSBMLnBvbHlsaW5lKGxhdGxuZ3MsIHBvbHlsaW5lT3B0aW9ucyk7XG4gICAgICAgIHBvbHlsaW5lLm9uKFwiY2xpY2tcIiwgZmVhdHVyZUNsaWNrZWQuYmluZCh1bmRlZmluZWQsIHRoaXMsIGVudGl0eSkpO1xuICAgICAgICBwb2x5bGluZS5vbihcbiAgICAgICAgICBcIm1vdXNlZG93blwiLFxuICAgICAgICAgIGZlYXR1cmVNb3VzZWRvd24uYmluZCh1bmRlZmluZWQsIHRoaXMsIGVudGl0eSlcbiAgICAgICAgKTtcbiAgICAgICAgZmVhdHVyZUdyb3VwLmFkZExheWVyKHBvbHlsaW5lKTtcbiAgICAgICAgZGV0YWlscy5sYXllciA9IHBvbHlsaW5lO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBwb2x5bGluZSA9IGdlb21MYXllcjtcbiAgICAgIGNvbnN0IGN1ckxhdExuZ3MgPSBwb2x5bGluZS5nZXRMYXRMbmdzKCk7XG4gICAgICBsZXQgYlBvc0NoYW5nZSA9IGxhdGxuZ3MubGVuZ3RoICE9PSBjdXJMYXRMbmdzLmxlbmd0aDtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY3VyTGF0TG5ncy5sZW5ndGggJiYgIWJQb3NDaGFuZ2U7IGkrKykge1xuICAgICAgICBjb25zdCBsYXRsbmcgPSBjdXJMYXRMbmdzW2ldO1xuICAgICAgICBpZiAobGF0bG5nIGluc3RhbmNlb2YgTC5MYXRMbmcgJiYgIWxhdGxuZy5lcXVhbHMobGF0bG5nc1tpXSkpIHtcbiAgICAgICAgICBiUG9zQ2hhbmdlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGJQb3NDaGFuZ2UpIHtcbiAgICAgICAgcG9seWxpbmUuc2V0TGF0TG5ncyhsYXRsbmdzKTtcbiAgICAgIH1cblxuICAgICAgZm9yIChjb25zdCBwcm9wIGluIHBvbHlsaW5lT3B0aW9ucykge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgKHBvbHlsaW5lT3B0aW9ucyBhcyBhbnkpW3Byb3BdICE9PSAocG9seWxpbmUub3B0aW9ucyBhcyBhbnkpW3Byb3BdXG4gICAgICAgICkge1xuICAgICAgICAgIHBvbHlsaW5lLnNldFN0eWxlKHBvbHlsaW5lT3B0aW9ucyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0cnVlIGlmIHRoaXMgb2JqZWN0IHdhcyBkZXN0cm95ZWQ7IG90aGVyd2lzZSwgZmFsc2UuXG4gICAqXG4gICAqL1xuICBpc0Rlc3Ryb3llZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlcyBhbmQgZGVzdHJveXMgYWxsIHByaW1pdGl2ZXMgY3JlYXRlZCBieSB0aGlzIGluc3RhbmNlLlxuICAgKi9cbiAgZGVzdHJveSgpIHtcbiAgICBjb25zdCBlbnRpdGllcyA9IHRoaXMuX2VudGl0aWVzVG9WaXN1YWxpemUudmFsdWVzO1xuICAgIGNvbnN0IGVudGl0eUhhc2ggPSB0aGlzLl9lbnRpdHlIYXNoO1xuXG4gICAgZm9yIChsZXQgaSA9IGVudGl0aWVzLmxlbmd0aCAtIDE7IGkgPiAtMTsgaS0tKSB7XG4gICAgICBjbGVhbkVudGl0eShlbnRpdGllc1tpXSwgdGhpcy5fZmVhdHVyZUdyb3VwLCBlbnRpdHlIYXNoKTtcbiAgICB9XG5cbiAgICB0aGlzLmVudGl0eUNvbGxlY3Rpb24uY29sbGVjdGlvbkNoYW5nZWQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcbiAgICAgIHRoaXMuX29uQ29sbGVjdGlvbkNoYW5nZWQsXG4gICAgICB0aGlzXG4gICAgKTtcbiAgICB0aGlzLmxlYWZsZXRTY2VuZS5tYXAucmVtb3ZlTGF5ZXIodGhpcy5fZmVhdHVyZUdyb3VwKTtcbiAgICByZXR1cm4gZGVzdHJveU9iamVjdCh0aGlzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb21wdXRlcyB0aGUgcmVjdGFuZ3VsYXIgYm91bmRzIHdoaWNoIGVuY2xvc2VzIHRoZSBjb2xsZWN0aW9uIG9mXG4gICAqIGVudGl0aWVzIHRvIGJlIHZpc3VhbGl6ZWQuXG4gICAqL1xuICBnZXRMYXRMbmdCb3VuZHMoKTogTGF0TG5nQm91bmRzIHwgdW5kZWZpbmVkIHtcbiAgICBsZXQgcmVzdWx0OiBMYXRMbmdCb3VuZHMgfCB1bmRlZmluZWQ7XG5cbiAgICBPYmplY3Qua2V5cyh0aGlzLl9lbnRpdHlIYXNoKS5mb3JFYWNoKChlbnRpdHlJZCkgPT4ge1xuICAgICAgY29uc3QgZW50aXR5RGV0YWlsczogYW55ID0gdGhpcy5fZW50aXR5SGFzaFtlbnRpdHlJZF07XG5cbiAgICAgIE9iamVjdC5rZXlzKGVudGl0eURldGFpbHMpLmZvckVhY2goKHByaW1pdGl2ZUlkKSA9PiB7XG4gICAgICAgIGNvbnN0IHByaW1pdGl2ZSA9IGVudGl0eURldGFpbHNbcHJpbWl0aXZlSWRdO1xuXG4gICAgICAgIGlmIChpc0RlZmluZWQocHJpbWl0aXZlLmxheWVyKSkge1xuICAgICAgICAgIGlmIChpc0RlZmluZWQocHJpbWl0aXZlLmxheWVyLmdldEJvdW5kcykpIHtcbiAgICAgICAgICAgIGNvbnN0IGJvdW5kcyA9IHByaW1pdGl2ZS5sYXllci5nZXRCb3VuZHMoKTtcbiAgICAgICAgICAgIGlmIChpc0RlZmluZWQoYm91bmRzKSkge1xuICAgICAgICAgICAgICByZXN1bHQgPVxuICAgICAgICAgICAgICAgIHJlc3VsdCA9PT0gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICA/IEwubGF0TG5nQm91bmRzKGJvdW5kcy5nZXRTb3V0aFdlc3QoKSwgYm91bmRzLmdldE5vcnRoRWFzdCgpKVxuICAgICAgICAgICAgICAgICAgOiByZXN1bHQuZXh0ZW5kKGJvdW5kcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChpc0RlZmluZWQocHJpbWl0aXZlLmxheWVyLmdldExhdExuZykpIHtcbiAgICAgICAgICAgIGNvbnN0IGxhdExuZyA9IHByaW1pdGl2ZS5sYXllci5nZXRMYXRMbmcoKTtcbiAgICAgICAgICAgIGlmIChpc0RlZmluZWQobGF0TG5nKSkge1xuICAgICAgICAgICAgICByZXN1bHQgPVxuICAgICAgICAgICAgICAgIHJlc3VsdCA9PT0gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICA/IEwubGF0TG5nQm91bmRzKFtsYXRMbmddKVxuICAgICAgICAgICAgICAgICAgOiByZXN1bHQuZXh0ZW5kKGxhdExuZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0RGFzaEFycmF5KFxuICBtYXRlcmlhbDogUG9seWxpbmVEYXNoTWF0ZXJpYWxQcm9wZXJ0eSxcbiAgdGltZTogSnVsaWFuRGF0ZVxuKTogbnVtYmVyW10ge1xuICBjb25zdCBkYXNoUGF0dGVybiA9IG1hdGVyaWFsLmRhc2hQYXR0ZXJuXG4gICAgPyBtYXRlcmlhbC5kYXNoUGF0dGVybi5nZXRWYWx1ZSh0aW1lKVxuICAgIDogdW5kZWZpbmVkO1xuXG4gIHJldHVybiBjb252ZXJ0Q2VzaXVtRGFzaE51bWJlclRvRGFzaEFycmF5KGRhc2hQYXR0ZXJuKTtcbn1cblxuZnVuY3Rpb24gY2xlYW5FbnRpdHkoXG4gIGVudGl0eTogRW50aXR5LFxuICBncm91cDogTC5GZWF0dXJlR3JvdXAsXG4gIGVudGl0eUhhc2g6IEVudGl0eUhhc2hcbikge1xuICBjb25zdCBkZXRhaWxzID0gZW50aXR5SGFzaFtlbnRpdHkuaWRdO1xuXG4gIGNsZWFuUG9pbnQoZW50aXR5LCBncm91cCwgZGV0YWlscyk7XG4gIGNsZWFuUG9seWdvbihlbnRpdHksIGdyb3VwLCBkZXRhaWxzKTtcbiAgY2xlYW5CaWxsYm9hcmQoZW50aXR5LCBncm91cCwgZGV0YWlscyk7XG4gIGNsZWFuTGFiZWwoZW50aXR5LCBncm91cCwgZGV0YWlscyk7XG4gIGNsZWFuUG9seWxpbmUoZW50aXR5LCBncm91cCwgZGV0YWlscyk7XG5cbiAgZGVsZXRlIGVudGl0eUhhc2hbZW50aXR5LmlkXTtcbn1cblxuZnVuY3Rpb24gY2xlYW5Qb2ludChcbiAgX2VudGl0eTogRW50aXR5LFxuICBncm91cDogTC5GZWF0dXJlR3JvdXAsXG4gIGRldGFpbHM6IEVudGl0eURldGFpbHNcbikge1xuICBpZiAoaXNEZWZpbmVkKGRldGFpbHMucG9pbnQpICYmIGlzRGVmaW5lZChkZXRhaWxzLnBvaW50LmxheWVyKSkge1xuICAgIGdyb3VwLnJlbW92ZUxheWVyKGRldGFpbHMucG9pbnQubGF5ZXIpO1xuICAgIGRldGFpbHMucG9pbnQgPSB1bmRlZmluZWQ7XG4gIH1cbn1cblxuZnVuY3Rpb24gY2xlYW5Qb2x5Z29uKFxuICBfZW50aXR5OiBFbnRpdHksXG4gIGdyb3VwOiBMLkZlYXR1cmVHcm91cCxcbiAgZGV0YWlsczogRW50aXR5RGV0YWlsc1xuKSB7XG4gIGlmIChpc0RlZmluZWQoZGV0YWlscy5wb2x5Z29uKSAmJiBpc0RlZmluZWQoZGV0YWlscy5wb2x5Z29uLmxheWVyKSkge1xuICAgIGdyb3VwLnJlbW92ZUxheWVyKGRldGFpbHMucG9seWdvbi5sYXllcik7XG4gICAgZGV0YWlscy5wb2x5Z29uID0gdW5kZWZpbmVkO1xuICB9XG59XG5cbmZ1bmN0aW9uIGNsZWFuQmlsbGJvYXJkKFxuICBfZW50aXR5OiBFbnRpdHksXG4gIGdyb3VwOiBMLkZlYXR1cmVHcm91cCxcbiAgZGV0YWlsczogRW50aXR5RGV0YWlsc1xuKSB7XG4gIGlmIChpc0RlZmluZWQoZGV0YWlscy5iaWxsYm9hcmQpICYmIGlzRGVmaW5lZChkZXRhaWxzLmJpbGxib2FyZC5sYXllcikpIHtcbiAgICBncm91cC5yZW1vdmVMYXllcihkZXRhaWxzLmJpbGxib2FyZC5sYXllcik7XG4gICAgZGV0YWlscy5iaWxsYm9hcmQgPSB1bmRlZmluZWQ7XG4gIH1cbn1cblxuZnVuY3Rpb24gY2xlYW5MYWJlbChcbiAgX2VudGl0eTogRW50aXR5LFxuICBncm91cDogTC5GZWF0dXJlR3JvdXAsXG4gIGRldGFpbHM6IEVudGl0eURldGFpbHNcbikge1xuICBpZiAoaXNEZWZpbmVkKGRldGFpbHMubGFiZWwpICYmIGlzRGVmaW5lZChkZXRhaWxzLmxhYmVsLmxheWVyKSkge1xuICAgIGdyb3VwLnJlbW92ZUxheWVyKGRldGFpbHMubGFiZWwubGF5ZXIpO1xuICAgIGRldGFpbHMubGFiZWwgPSB1bmRlZmluZWQ7XG4gIH1cbn1cblxuZnVuY3Rpb24gY2xlYW5Qb2x5bGluZShcbiAgX2VudGl0eTogRW50aXR5LFxuICBncm91cDogTC5GZWF0dXJlR3JvdXAsXG4gIGRldGFpbHM6IEVudGl0eURldGFpbHNcbikge1xuICBpZiAoaXNEZWZpbmVkKGRldGFpbHMucG9seWxpbmUpICYmIGlzRGVmaW5lZChkZXRhaWxzLnBvbHlsaW5lLmxheWVyKSkge1xuICAgIGdyb3VwLnJlbW92ZUxheWVyKGRldGFpbHMucG9seWxpbmUubGF5ZXIpO1xuICAgIGRldGFpbHMucG9seWxpbmUgPSB1bmRlZmluZWQ7XG4gIH1cbn1cblxuZnVuY3Rpb24gY2xlYW5SZWN0YW5nbGUoXG4gIF9lbnRpdHk6IEVudGl0eSxcbiAgZ3JvdXA6IEwuRmVhdHVyZUdyb3VwLFxuICBkZXRhaWxzOiBFbnRpdHlEZXRhaWxzXG4pIHtcbiAgaWYgKGlzRGVmaW5lZChkZXRhaWxzLnJlY3RhbmdsZSkgJiYgaXNEZWZpbmVkKGRldGFpbHMucmVjdGFuZ2xlLmxheWVyKSkge1xuICAgIGdyb3VwLnJlbW92ZUxheWVyKGRldGFpbHMucmVjdGFuZ2xlLmxheWVyKTtcbiAgICBkZXRhaWxzLnJlY3RhbmdsZSA9IHVuZGVmaW5lZDtcbiAgfVxufVxuXG5mdW5jdGlvbiBfaXNDbG9zZVRvRWFzdGVybkFudGlNZXJpZGlhbihib3VuZHM6IExhdExuZ0JvdW5kcykge1xuICBjb25zdCB3ID0gYm91bmRzLmdldFdlc3QoKTtcbiAgY29uc3QgZSA9IGJvdW5kcy5nZXRFYXN0KCk7XG4gIGlmICh3ID4gMTQwICYmIChlIDwgLTE0MCB8fCBlID4gMTgwKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gX2lzQ2xvc2VUb1dlc3Rlcm5BbnRpTWVyaWRpYW4oYm91bmRzOiBMYXRMbmdCb3VuZHMpIHtcbiAgY29uc3QgdyA9IGJvdW5kcy5nZXRXZXN0KCk7XG4gIGNvbnN0IGUgPSBib3VuZHMuZ2V0RWFzdCgpO1xuICBpZiAoKHcgPiAxODAgfHwgdyA8IC0xNDApICYmIGUgPCAtMTQwKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiBwb3NpdGlvblRvTGF0TG5nKFxuICBwb3NpdGlvbjogQ2FydGVzaWFuMyxcbiAgYm91bmRzOiBMYXRMbmdCb3VuZHMgfCB1bmRlZmluZWRcbikge1xuICBjb25zdCBjYXJ0b2dyYXBoaWMgPSBFbGxpcHNvaWQuV0dTODQuY2FydGVzaWFuVG9DYXJ0b2dyYXBoaWMocG9zaXRpb24pO1xuICBsZXQgbG9uID0gQ2VzaXVtTWF0aC50b0RlZ3JlZXMoY2FydG9ncmFwaGljLmxvbmdpdHVkZSk7XG4gIGlmIChib3VuZHMgIT09IHVuZGVmaW5lZCkge1xuICAgIGlmIChfaXNDbG9zZVRvRWFzdGVybkFudGlNZXJpZGlhbihib3VuZHMpKSB7XG4gICAgICBpZiAobG9uIDwgLTE0MCkge1xuICAgICAgICBsb24gPSBsb24gKyAzNjA7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChfaXNDbG9zZVRvV2VzdGVybkFudGlNZXJpZGlhbihib3VuZHMpKSB7XG4gICAgICBpZiAobG9uID4gMTQwKSB7XG4gICAgICAgIGxvbiA9IGxvbiAtIDM2MDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIEwubGF0TG5nKENlc2l1bU1hdGgudG9EZWdyZWVzKGNhcnRvZ3JhcGhpYy5sYXRpdHVkZSksIGxvbik7XG59XG5cbmZ1bmN0aW9uIGhpZXJhcmNoeVRvTGF0TG5ncyhoaWVyYXJjaHk6IFBvbHlnb25IaWVyYXJjaHkpIHtcbiAgY29uc3QgaG9sZXM6IEwuTGF0TG5nW11bXSA9IFtdO1xuICBjb25zdCBwb3NpdGlvbnMgPSBBcnJheS5pc0FycmF5KGhpZXJhcmNoeSkgPyBoaWVyYXJjaHkgOiBoaWVyYXJjaHkucG9zaXRpb25zO1xuICBpZiAoaGllcmFyY2h5LmhvbGVzLmxlbmd0aCA+IDApIHtcbiAgICBoaWVyYXJjaHkuaG9sZXMuZm9yRWFjaCgoaG9sZSkgPT4ge1xuICAgICAgaG9sZXMucHVzaChjb252ZXJ0RW50aXR5UG9zaXRpb25zVG9MYXRMb25zKGhvbGUucG9zaXRpb25zKSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIFtjb252ZXJ0RW50aXR5UG9zaXRpb25zVG9MYXRMb25zKHBvc2l0aW9ucyksIC4uLmhvbGVzXTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gY29udmVydEVudGl0eVBvc2l0aW9uc1RvTGF0TG9ucyhwb3NpdGlvbnMpO1xuICB9XG59XG5cbi8vUmVjb2xvciBhbiBpbWFnZSB1c2luZyAyZCBjYW52YXNcbmZ1bmN0aW9uIHJlY29sb3JCaWxsYm9hcmQoXG4gIGltZzogSFRNTEltYWdlRWxlbWVudCxcbiAgY29sb3I6IENvbG9yXG4pOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICBjYW52YXMud2lkdGggPSBpbWcud2lkdGg7XG4gIGNhbnZhcy5oZWlnaHQgPSBpbWcuaGVpZ2h0O1xuXG4gIC8vIENvcHkgdGhlIGltYWdlIGNvbnRlbnRzIHRvIHRoZSBjYW52YXNcbiAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gIGlmIChjb250ZXh0ID09PSBudWxsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29udGV4dC5kcmF3SW1hZ2UoaW1nLCAwLCAwKTtcbiAgY29uc3QgaW1hZ2UgPSBjb250ZXh0LmdldEltYWdlRGF0YSgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICBjb25zdCBub3JtQ2xyID0gW2NvbG9yLnJlZCwgY29sb3IuZ3JlZW4sIGNvbG9yLmJsdWUsIGNvbG9yLmFscGhhXTtcblxuICBjb25zdCBsZW5ndGggPSBpbWFnZS5kYXRhLmxlbmd0aDsgLy9waXhlbCBjb3VudCAqIDRcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gNCkge1xuICAgIGZvciAobGV0IGogPSAwOyBqIDwgNDsgaisrKSB7XG4gICAgICBpbWFnZS5kYXRhW2ogKyBpXSAqPSBub3JtQ2xyW2pdO1xuICAgIH1cbiAgfVxuXG4gIGNvbnRleHQucHV0SW1hZ2VEYXRhKGltYWdlLCAwLCAwKTtcbiAgcmV0dXJuIGNhbnZhcy50b0RhdGFVUkwoKTtcbn1cblxuZnVuY3Rpb24gZmVhdHVyZUNsaWNrZWQoXG4gIHZpc3VhbGl6ZXI6IExlYWZsZXRHZW9tVmlzdWFsaXplcixcbiAgZW50aXR5OiBFbnRpdHksXG4gIGV2ZW50OiBMLkxlYWZsZXRFdmVudFxuKSB7XG4gIHZpc3VhbGl6ZXIubGVhZmxldFNjZW5lLmZlYXR1cmVDbGlja2VkLnJhaXNlRXZlbnQoZW50aXR5LCBldmVudCk7XG59XG5cbmZ1bmN0aW9uIGZlYXR1cmVNb3VzZWRvd24oXG4gIHZpc3VhbGl6ZXI6IExlYWZsZXRHZW9tVmlzdWFsaXplcixcbiAgZW50aXR5OiBFbnRpdHksXG4gIGV2ZW50OiBMLkxlYWZsZXRFdmVudFxuKSB7XG4gIHZpc3VhbGl6ZXIubGVhZmxldFNjZW5lLmZlYXR1cmVNb3VzZWRvd24ucmFpc2VFdmVudChlbnRpdHksIGV2ZW50KTtcbn1cblxuZnVuY3Rpb24gZ2V0VmFsdWU8VD4oXG4gIHByb3BlcnR5OiBQcm9wZXJ0eSB8IHVuZGVmaW5lZCxcbiAgdGltZTogSnVsaWFuRGF0ZVxuKTogVCB8IHVuZGVmaW5lZCB7XG4gIGlmIChpc0RlZmluZWQocHJvcGVydHkpKSB7XG4gICAgcmV0dXJuIHByb3BlcnR5LmdldFZhbHVlKHRpbWUpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGdldFZhbHVlT3JEZWZhdWx0PFQ+KFxuICBwcm9wZXJ0eTogUHJvcGVydHkgfCB1bmRlZmluZWQsXG4gIHRpbWU6IEp1bGlhbkRhdGUsXG4gIGRlZmF1bHRWYWx1ZTogVFxuKTogVCB7XG4gIGlmIChpc0RlZmluZWQocHJvcGVydHkpKSB7XG4gICAgY29uc3QgdmFsdWUgPSBwcm9wZXJ0eS5nZXRWYWx1ZSh0aW1lKTtcbiAgICBpZiAoaXNEZWZpbmVkKHZhbHVlKSkge1xuICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZGVmYXVsdFZhbHVlO1xufVxuXG5mdW5jdGlvbiBnZXRWYWx1ZU9yVW5kZWZpbmVkKHByb3BlcnR5OiBQcm9wZXJ0eSB8IHVuZGVmaW5lZCwgdGltZTogSnVsaWFuRGF0ZSkge1xuICBpZiAoaXNEZWZpbmVkKHByb3BlcnR5KSkge1xuICAgIHJldHVybiBwcm9wZXJ0eS5nZXRWYWx1ZSh0aW1lKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBjb252ZXJ0RW50aXR5UG9zaXRpb25zVG9MYXRMb25zKHBvc2l0aW9uczogQ2FydGVzaWFuM1tdKTogTC5MYXRMbmdbXSB7XG4gIGNvbnN0IGNhcnRzID0gRWxsaXBzb2lkLldHUzg0LmNhcnRlc2lhbkFycmF5VG9DYXJ0b2dyYXBoaWNBcnJheShwb3NpdGlvbnMpO1xuICBjb25zdCBsYXRsbmdzOiBMLkxhdExuZ1tdID0gW107XG4gIGxldCBsYXN0TG9uZ2l0dWRlO1xuICBmb3IgKGxldCBwID0gMDsgcCA8IGNhcnRzLmxlbmd0aDsgcCsrKSB7XG4gICAgbGV0IGxvbiA9IENlc2l1bU1hdGgudG9EZWdyZWVzKGNhcnRzW3BdLmxvbmdpdHVkZSk7XG5cbiAgICBpZiAobGFzdExvbmdpdHVkZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBpZiAobGFzdExvbmdpdHVkZSAtIGxvbiA+IDE4MCkge1xuICAgICAgICBsb24gPSBsb24gKyAzNjA7XG4gICAgICB9IGVsc2UgaWYgKGxhc3RMb25naXR1ZGUgLSBsb24gPCAtMTgwKSB7XG4gICAgICAgIGxvbiA9IGxvbiAtIDM2MDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsYXRsbmdzLnB1c2goTC5sYXRMbmcoQ2VzaXVtTWF0aC50b0RlZ3JlZXMoY2FydHNbcF0ubGF0aXR1ZGUpLCBsb24pKTtcbiAgICBsYXN0TG9uZ2l0dWRlID0gbG9uO1xuICB9XG4gIHJldHVybiBsYXRsbmdzO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBMZWFmbGV0VmlzdWFsaXplciB7XG4gIHZpc3VhbGl6ZXJzQ2FsbGJhY2soXG4gICAgbGVhZmxldFNjZW5lOiBMZWFmbGV0U2NlbmUsXG4gICAgX2VudGl0eUNsdXN0ZXI6IEVudGl0eUNsdXN0ZXIgfCB1bmRlZmluZWQsXG4gICAgZGF0YVNvdXJjZTogRGF0YVNvdXJjZVxuICApIHtcbiAgICBjb25zdCBlbnRpdGllcyA9IGRhdGFTb3VyY2UuZW50aXRpZXM7XG4gICAgcmV0dXJuIFtuZXcgTGVhZmxldEdlb21WaXN1YWxpemVyKGxlYWZsZXRTY2VuZSwgZW50aXRpZXMpXTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/Leaflet/LeafletVisualizer.ts\n\n}");

/***/ }),

/***/ "./packages/terriajs/lib/Map/LeafletPatched.ts":
/*!*****************************************************!*\
  !*** ./packages/terriajs/lib/Map/LeafletPatched.ts ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var leaflet__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\");\n/* harmony import */ var leaflet__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(leaflet__WEBPACK_IMPORTED_MODULE_0__);\n\n\n// Function taken from Leaflet 1.0.1 (https://github.com/Leaflet/Leaflet/blob/v1.0.1/src/layer/vector/Canvas.js#L254-L267)\n// Leaflet 1.0.2 and later don't trigger click events for every Path, so feature selection only gives 1 result.\n// Updated to incorporate function changes up to v1.7.1\nconst Canvas = (leaflet__WEBPACK_IMPORTED_MODULE_0___default().Canvas);\nCanvas.prototype._onClick = function (e) {\n  const point = this._map.mouseEventToLayerPoint(e);\n  const layers = [];\n  for (let order = this._drawFirst; order; order = order.next) {\n    const layer = order.layer;\n    if (layer.options.interactive && layer._containsPoint(point)) {\n      if (!(e.type === \"click\" || e.type !== \"preclick\") || !this._map._draggableMoved(layer)) {\n        layers.push(layer);\n      }\n    }\n  }\n  this._fireEvent(layers.length ? layers : false, e);\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((leaflet__WEBPACK_IMPORTED_MODULE_0___default()));//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXRQYXRjaGVkLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQSIsInNvdXJjZXMiOlsid2VicGFjazovL3RlcnJpYWpzLW1hcC8uL3BhY2thZ2VzL3RlcnJpYWpzL2xpYi9NYXAvTGVhZmxldFBhdGNoZWQudHM/ZjE3YiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTCBmcm9tIFwibGVhZmxldFwiO1xuXG4vLyBGdW5jdGlvbiB0YWtlbiBmcm9tIExlYWZsZXQgMS4wLjEgKGh0dHBzOi8vZ2l0aHViLmNvbS9MZWFmbGV0L0xlYWZsZXQvYmxvYi92MS4wLjEvc3JjL2xheWVyL3ZlY3Rvci9DYW52YXMuanMjTDI1NC1MMjY3KVxuLy8gTGVhZmxldCAxLjAuMiBhbmQgbGF0ZXIgZG9uJ3QgdHJpZ2dlciBjbGljayBldmVudHMgZm9yIGV2ZXJ5IFBhdGgsIHNvIGZlYXR1cmUgc2VsZWN0aW9uIG9ubHkgZ2l2ZXMgMSByZXN1bHQuXG4vLyBVcGRhdGVkIHRvIGluY29ycG9yYXRlIGZ1bmN0aW9uIGNoYW5nZXMgdXAgdG8gdjEuNy4xXG5jb25zdCBDYW52YXMgPSBMLkNhbnZhcyBhcyBhbnk7XG5DYW52YXMucHJvdG90eXBlLl9vbkNsaWNrID0gZnVuY3Rpb24gKGU6IGFueSkge1xuICBjb25zdCBwb2ludCA9IHRoaXMuX21hcC5tb3VzZUV2ZW50VG9MYXllclBvaW50KGUpO1xuICBjb25zdCBsYXllcnMgPSBbXTtcbiAgZm9yIChsZXQgb3JkZXIgPSB0aGlzLl9kcmF3Rmlyc3Q7IG9yZGVyOyBvcmRlciA9IG9yZGVyLm5leHQpIHtcbiAgICBjb25zdCBsYXllciA9IG9yZGVyLmxheWVyO1xuICAgIGlmIChsYXllci5vcHRpb25zLmludGVyYWN0aXZlICYmIGxheWVyLl9jb250YWluc1BvaW50KHBvaW50KSkge1xuICAgICAgaWYgKFxuICAgICAgICAhKGUudHlwZSA9PT0gXCJjbGlja1wiIHx8IGUudHlwZSAhPT0gXCJwcmVjbGlja1wiKSB8fFxuICAgICAgICAhdGhpcy5fbWFwLl9kcmFnZ2FibGVNb3ZlZChsYXllcilcbiAgICAgICkge1xuICAgICAgICBsYXllcnMucHVzaChsYXllcik7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHRoaXMuX2ZpcmVFdmVudChsYXllcnMubGVuZ3RoID8gbGF5ZXJzIDogZmFsc2UsIGUpO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgTDtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/LeafletPatched.ts\n\n}");

/***/ }),

/***/ "./packages/terriajs/lib/Map/Vector/rectangleToLatLngBounds.ts":
/*!*********************************************************************!*\
  !*** ./packages/terriajs/lib/Map/Vector/rectangleToLatLngBounds.ts ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ rectangleToLatLngBounds)\n/* harmony export */ });\n/* harmony import */ var leaflet__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\");\n/* harmony import */ var leaflet__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(leaflet__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Math */ \"./node_modules/terriajs-cesium/Source/Core/Math.js\");\n\n\n/**\n * Converts a Cesium Rectangle into a Leaflet LatLngBounds.\n * @param {Rectangle} rectangle The rectangle to convert.\n * @return {L.latLngBounds} The equivalent Leaflet latLngBounds.\n */\nfunction rectangleToLatLngBounds(rectangle) {\n  const west = terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_1__[\"default\"].toDegrees(rectangle.west);\n  const south = terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_1__[\"default\"].toDegrees(rectangle.south);\n  const east = terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_1__[\"default\"].toDegrees(rectangle.east);\n  const north = terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_1__[\"default\"].toDegrees(rectangle.north);\n  return leaflet__WEBPACK_IMPORTED_MODULE_0___default().latLngBounds([south, west], [north, east]);\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL1ZlY3Rvci9yZWN0YW5nbGVUb0xhdExuZ0JvdW5kcy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL3RlcnJpYWpzLW1hcC8uL3BhY2thZ2VzL3RlcnJpYWpzL2xpYi9NYXAvVmVjdG9yL3JlY3RhbmdsZVRvTGF0TG5nQm91bmRzLnRzPzllOGQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEwgZnJvbSBcImxlYWZsZXRcIjtcbmltcG9ydCBDZXNpdW1NYXRoIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvTWF0aFwiO1xuaW1wb3J0IFJlY3RhbmdsZSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL1JlY3RhbmdsZVwiO1xuXG4vKipcbiAqIENvbnZlcnRzIGEgQ2VzaXVtIFJlY3RhbmdsZSBpbnRvIGEgTGVhZmxldCBMYXRMbmdCb3VuZHMuXG4gKiBAcGFyYW0ge1JlY3RhbmdsZX0gcmVjdGFuZ2xlIFRoZSByZWN0YW5nbGUgdG8gY29udmVydC5cbiAqIEByZXR1cm4ge0wubGF0TG5nQm91bmRzfSBUaGUgZXF1aXZhbGVudCBMZWFmbGV0IGxhdExuZ0JvdW5kcy5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gcmVjdGFuZ2xlVG9MYXRMbmdCb3VuZHMocmVjdGFuZ2xlOiBSZWN0YW5nbGUpIHtcbiAgY29uc3Qgd2VzdCA9IENlc2l1bU1hdGgudG9EZWdyZWVzKHJlY3RhbmdsZS53ZXN0KTtcbiAgY29uc3Qgc291dGggPSBDZXNpdW1NYXRoLnRvRGVncmVlcyhyZWN0YW5nbGUuc291dGgpO1xuICBjb25zdCBlYXN0ID0gQ2VzaXVtTWF0aC50b0RlZ3JlZXMocmVjdGFuZ2xlLmVhc3QpO1xuICBjb25zdCBub3J0aCA9IENlc2l1bU1hdGgudG9EZWdyZWVzKHJlY3RhbmdsZS5ub3J0aCk7XG4gIHJldHVybiBMLmxhdExuZ0JvdW5kcyhbc291dGgsIHdlc3RdLCBbbm9ydGgsIGVhc3RdKTtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/Vector/rectangleToLatLngBounds.ts\n\n}");

/***/ }),

/***/ "./packages/terriajs/lib/Models/Catalog/Esri/esriStyleToTableStyle.ts":
/*!****************************************************************************!*\
  !*** ./packages/terriajs/lib/Models/Catalog/Esri/esriStyleToTableStyle.ts ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   convertCesiumDashNumberToDashArray: () => (/* binding */ convertCesiumDashNumberToDashArray),\n/* harmony export */   convertEsriLineStyleToCesiumDashNumber: () => (/* binding */ convertEsriLineStyleToCesiumDashNumber),\n/* harmony export */   convertEsriPointSizeToPixels: () => (/* binding */ convertEsriPointSizeToPixels),\n/* harmony export */   esriStyleToTableStyle: () => (/* binding */ esriStyleToTableStyle)\n/* harmony export */ });\n/* harmony import */ var terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Color */ \"./node_modules/terriajs-cesium/Source/Core/Color.js\");\n/* harmony import */ var _Core_isDefined__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../Core/isDefined */ \"./packages/terriajs/lib/Core/isDefined.ts\");\n/* harmony import */ var _Traits_TraitsClasses_Table_OutlineStyleTraits__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../Traits/TraitsClasses/Table/OutlineStyleTraits */ \"./packages/terriajs/lib/Traits/TraitsClasses/Table/OutlineStyleTraits.ts\");\n/* harmony import */ var _Traits_TraitsClasses_Table_PointSizeStyleTraits__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../Traits/TraitsClasses/Table/PointSizeStyleTraits */ \"./packages/terriajs/lib/Traits/TraitsClasses/Table/PointSizeStyleTraits.ts\");\n/* harmony import */ var _Traits_TraitsClasses_Table_PointStyleTraits__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../Traits/TraitsClasses/Table/PointStyleTraits */ \"./packages/terriajs/lib/Traits/TraitsClasses/Table/PointStyleTraits.ts\");\n/* harmony import */ var _Definition_createStratumInstance__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../Definition/createStratumInstance */ \"./packages/terriajs/lib/Models/Definition/createStratumInstance.ts\");\n\n\n\n\n\n\nfunction esriStyleToTableStyle(esriStyle, label) {\n  var _convertEsriColorToCe, _convertEsriPointSize, _convertEsriPointSize2, _esriStyle$xoffset, _esriStyle$yoffset, _esriStyle$outline, _convertEsriColorToCe2, _convertEsriColorToCe3, _esriStyle$outline2, _esriStyle$outline3, _esriStyle$outline4;\n  if (!esriStyle) return {};\n  return {\n    // For esriPMS - just use white color\n    // This is so marker icons aren't colored by default\n    color: esriStyle.type === \"esriPMS\" ? \"#FFFFFF\" : (_convertEsriColorToCe = convertEsriColorToCesiumColor(esriStyle.color)) === null || _convertEsriColorToCe === void 0 ? void 0 : _convertEsriColorToCe.toCssColorString(),\n    pointSize: (0,_Definition_createStratumInstance__WEBPACK_IMPORTED_MODULE_5__[\"default\"])(_Traits_TraitsClasses_Table_PointSizeStyleTraits__WEBPACK_IMPORTED_MODULE_3__[\"default\"], {}),\n    point: (0,_Definition_createStratumInstance__WEBPACK_IMPORTED_MODULE_5__[\"default\"])(_Traits_TraitsClasses_Table_PointStyleTraits__WEBPACK_IMPORTED_MODULE_4__.PointSymbolTraits, {\n      marker: esriStyle.type === \"esriPMS\" ? \"data:\".concat(esriStyle.contentType, \";base64,\").concat(esriStyle.imageData) : convertEsriMarkerToMaki(esriStyle.style),\n      // symbol.size is used by \"esriSMS\"\n      // height and width is used by \"esriPMS\"\n      height: (_convertEsriPointSize = convertEsriPointSizeToPixels(esriStyle.size)) !== null && _convertEsriPointSize !== void 0 ? _convertEsriPointSize : convertEsriPointSizeToPixels(esriStyle.height),\n      width: (_convertEsriPointSize2 = convertEsriPointSizeToPixels(esriStyle.size)) !== null && _convertEsriPointSize2 !== void 0 ? _convertEsriPointSize2 : convertEsriPointSizeToPixels(esriStyle.width),\n      rotation: esriStyle.angle,\n      pixelOffset: [(_esriStyle$xoffset = esriStyle.xoffset) !== null && _esriStyle$xoffset !== void 0 ? _esriStyle$xoffset : 0, (_esriStyle$yoffset = esriStyle.yoffset) !== null && _esriStyle$yoffset !== void 0 ? _esriStyle$yoffset : 0],\n      legendTitle: label || undefined\n    }),\n    outline: ((_esriStyle$outline = esriStyle.outline) === null || _esriStyle$outline === void 0 ? void 0 : _esriStyle$outline.style) !== \"esriSLSNull\" ? (0,_Definition_createStratumInstance__WEBPACK_IMPORTED_MODULE_5__[\"default\"])(_Traits_TraitsClasses_Table_OutlineStyleTraits__WEBPACK_IMPORTED_MODULE_2__.OutlineSymbolTraits, {\n      color: esriStyle.type === \"esriSLS\" ? (_convertEsriColorToCe2 = convertEsriColorToCesiumColor(esriStyle.color)) === null || _convertEsriColorToCe2 === void 0 ? void 0 : _convertEsriColorToCe2.toCssColorString() : (_convertEsriColorToCe3 = convertEsriColorToCesiumColor((_esriStyle$outline2 = esriStyle.outline) === null || _esriStyle$outline2 === void 0 ? void 0 : _esriStyle$outline2.color)) === null || _convertEsriColorToCe3 === void 0 ? void 0 : _convertEsriColorToCe3.toCssColorString(),\n      // Use width if Line style\n      width: esriStyle.type === \"esriSLS\" ? convertEsriPointSizeToPixels(esriStyle.width) : convertEsriPointSizeToPixels((_esriStyle$outline3 = esriStyle.outline) === null || _esriStyle$outline3 === void 0 ? void 0 : _esriStyle$outline3.width),\n      legendTitle: label || undefined,\n      dash: esriStyle.type === \"esriSLS\" ? convertEsriLineStyleToDashArray(esriStyle.style) : convertEsriLineStyleToDashArray((_esriStyle$outline4 = esriStyle.outline) === null || _esriStyle$outline4 === void 0 ? void 0 : _esriStyle$outline4.style)\n    }) : undefined\n  };\n}\nfunction convertEsriMarkerToMaki(esri) {\n  switch (esri) {\n    case \"esriSMSCross\":\n      return \"hospital\";\n    case \"esriSMSDiamond\":\n      return \"diamond\";\n    case \"esriSMSSquare\":\n      return \"square\";\n    case \"esriSMSTriangle\":\n      return \"triangle\";\n    case \"esriSMSX\":\n      return \"cross\";\n    case \"esriSMSCircle\":\n    default:\n      return \"point\";\n  }\n}\n\n// ESRI uses points for styling while cesium uses pixels\nfunction convertEsriPointSizeToPixels(pointSize) {\n  if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(pointSize)) return undefined;\n  // 1 px = 0.75 point\n  // 1 point = 4/3 point\n  return pointSize * 4 / 3;\n}\nfunction convertEsriColorToCesiumColor(esriColor) {\n  if (!esriColor) return;\n  return terriajs_cesium_Source_Core_Color__WEBPACK_IMPORTED_MODULE_0__[\"default\"].fromBytes(esriColor[0], esriColor[1], esriColor[2], esriColor[3]);\n}\nconst defaultDashArray = [4, 3];\nconst esriLineStyleCesium = {\n  esriSLSNull: 0,\n  esriSLSSolid: 255,\n  esriSLSDash: 3087,\n  //\"   ----\" parseInt(\"110000001111\", 2)\n  esriSLSDot: 7,\n  //\"   -\"\n  esriSLSDashDot: 2017,\n  //\"   ----   -\"\n  esriSLSDashDotDot: 16273,\n  // '  --------   -   - '\n  esriSLSLongDash: 2047,\n  // '   --------'\n  esriSLSLongDashDot: 4081,\n  // '   --------   -'\n  esriSLSShortDash: 4095,\n  //' ----'\n  esriSLSShortDot: 13107,\n  //' ---- -'\n  esriSLSShortDashDot: 8179,\n  //' ---- - -'\n  esriSLSShortDashDotDot: 16281 //' - - - -'\n};\nconst cesiumDashNumberToDashArray = {\n  0: [],\n  255: [],\n  3087: [6, 6],\n  7: [1, 3],\n  2017: [4, 3, 1, 3],\n  16273: [8, 3, 1, 3, 1, 3],\n  2047: [8, 3],\n  4081: [8, 3, 1, 3],\n  4095: [4, 1],\n  13107: [1, 1],\n  8179: [4, 1, 1, 1],\n  16281: [4, 1, 1, 1, 1, 1]\n};\nfunction convertCesiumDashNumberToDashArray(dashPattern) {\n  if (cesiumDashNumberToDashArray[dashPattern]) {\n    return cesiumDashNumberToDashArray[dashPattern];\n  }\n  return defaultDashArray;\n}\nfunction convertEsriLineStyleToCesiumDashNumber(styleName) {\n  if (styleName in esriLineStyleCesium) {\n    return esriLineStyleCesium[styleName];\n  }\n  return undefined;\n}\nfunction convertEsriLineStyleToDashArray(styleName) {\n  if (styleName) {\n    const dashNumber = convertEsriLineStyleToCesiumDashNumber(styleName);\n    if (dashNumber !== undefined) {\n      return convertCesiumDashNumberToDashArray(dashNumber);\n    }\n  }\n  return [];\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTW9kZWxzL0NhdGFsb2cvRXNyaS9lc3JpU3R5bGVUb1RhYmxlU3R5bGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU9BO0FBR0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBR0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFRQTtBQUNBO0FBSUE7QUFDQTtBQUlBO0FBRUE7QUFDQTtBQUVBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUdBO0FBQ0E7QUFNQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90ZXJyaWFqcy1tYXAvLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTW9kZWxzL0NhdGFsb2cvRXNyaS9lc3JpU3R5bGVUb1RhYmxlU3R5bGUudHM/MGVjZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQ29sb3IgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9Db2xvclwiO1xuaW1wb3J0IGlzRGVmaW5lZCBmcm9tIFwiLi4vLi4vLi4vQ29yZS9pc0RlZmluZWRcIjtcbmltcG9ydCB7IE91dGxpbmVTeW1ib2xUcmFpdHMgfSBmcm9tIFwiLi4vLi4vLi4vVHJhaXRzL1RyYWl0c0NsYXNzZXMvVGFibGUvT3V0bGluZVN0eWxlVHJhaXRzXCI7XG5pbXBvcnQgVGFibGVQb2ludFNpemVTdHlsZVRyYWl0cyBmcm9tIFwiLi4vLi4vLi4vVHJhaXRzL1RyYWl0c0NsYXNzZXMvVGFibGUvUG9pbnRTaXplU3R5bGVUcmFpdHNcIjtcbmltcG9ydCB7IFBvaW50U3ltYm9sVHJhaXRzIH0gZnJvbSBcIi4uLy4uLy4uL1RyYWl0cy9UcmFpdHNDbGFzc2VzL1RhYmxlL1BvaW50U3R5bGVUcmFpdHNcIjtcbmltcG9ydCBjcmVhdGVTdHJhdHVtSW5zdGFuY2UgZnJvbSBcIi4uLy4uL0RlZmluaXRpb24vY3JlYXRlU3RyYXR1bUluc3RhbmNlXCI7XG5pbXBvcnQge1xuICBFc3JpU3R5bGUsXG4gIFN1cHBvcnRlZEVzcmlTaW1wbGVNYXJrZXJTdHlsZSxcbiAgU3VwcG9ydGVkTGluZVN0eWxlXG59IGZyb20gXCIuL0FyY0dpc0ZlYXR1cmVTZXJ2ZXJTdHJhdHVtXCI7XG5cbmV4cG9ydCBmdW5jdGlvbiBlc3JpU3R5bGVUb1RhYmxlU3R5bGUoXG4gIGVzcmlTdHlsZT86IEVzcmlTdHlsZSB8IG51bGwsXG4gIGxhYmVsPzogc3RyaW5nIHwgdW5kZWZpbmVkXG4pIHtcbiAgaWYgKCFlc3JpU3R5bGUpIHJldHVybiB7fTtcblxuICByZXR1cm4ge1xuICAgIC8vIEZvciBlc3JpUE1TIC0ganVzdCB1c2Ugd2hpdGUgY29sb3JcbiAgICAvLyBUaGlzIGlzIHNvIG1hcmtlciBpY29ucyBhcmVuJ3QgY29sb3JlZCBieSBkZWZhdWx0XG4gICAgY29sb3I6XG4gICAgICBlc3JpU3R5bGUudHlwZSA9PT0gXCJlc3JpUE1TXCJcbiAgICAgICAgPyBcIiNGRkZGRkZcIlxuICAgICAgICA6IGNvbnZlcnRFc3JpQ29sb3JUb0Nlc2l1bUNvbG9yKGVzcmlTdHlsZS5jb2xvcik/LnRvQ3NzQ29sb3JTdHJpbmcoKSxcbiAgICBwb2ludFNpemU6IGNyZWF0ZVN0cmF0dW1JbnN0YW5jZShUYWJsZVBvaW50U2l6ZVN0eWxlVHJhaXRzLCB7fSksXG4gICAgcG9pbnQ6IGNyZWF0ZVN0cmF0dW1JbnN0YW5jZShQb2ludFN5bWJvbFRyYWl0cywge1xuICAgICAgbWFya2VyOlxuICAgICAgICBlc3JpU3R5bGUudHlwZSA9PT0gXCJlc3JpUE1TXCJcbiAgICAgICAgICA/IGBkYXRhOiR7ZXNyaVN0eWxlLmNvbnRlbnRUeXBlfTtiYXNlNjQsJHtlc3JpU3R5bGUuaW1hZ2VEYXRhfWBcbiAgICAgICAgICA6IGNvbnZlcnRFc3JpTWFya2VyVG9NYWtpKGVzcmlTdHlsZS5zdHlsZSksXG4gICAgICAvLyBzeW1ib2wuc2l6ZSBpcyB1c2VkIGJ5IFwiZXNyaVNNU1wiXG4gICAgICAvLyBoZWlnaHQgYW5kIHdpZHRoIGlzIHVzZWQgYnkgXCJlc3JpUE1TXCJcbiAgICAgIGhlaWdodDpcbiAgICAgICAgY29udmVydEVzcmlQb2ludFNpemVUb1BpeGVscyhlc3JpU3R5bGUuc2l6ZSkgPz9cbiAgICAgICAgY29udmVydEVzcmlQb2ludFNpemVUb1BpeGVscyhlc3JpU3R5bGUuaGVpZ2h0KSxcbiAgICAgIHdpZHRoOlxuICAgICAgICBjb252ZXJ0RXNyaVBvaW50U2l6ZVRvUGl4ZWxzKGVzcmlTdHlsZS5zaXplKSA/P1xuICAgICAgICBjb252ZXJ0RXNyaVBvaW50U2l6ZVRvUGl4ZWxzKGVzcmlTdHlsZS53aWR0aCksXG4gICAgICByb3RhdGlvbjogZXNyaVN0eWxlLmFuZ2xlLFxuICAgICAgcGl4ZWxPZmZzZXQ6IFtlc3JpU3R5bGUueG9mZnNldCA/PyAwLCBlc3JpU3R5bGUueW9mZnNldCA/PyAwXSxcbiAgICAgIGxlZ2VuZFRpdGxlOiBsYWJlbCB8fCB1bmRlZmluZWRcbiAgICB9KSxcbiAgICBvdXRsaW5lOlxuICAgICAgZXNyaVN0eWxlLm91dGxpbmU/LnN0eWxlICE9PSBcImVzcmlTTFNOdWxsXCJcbiAgICAgICAgPyBjcmVhdGVTdHJhdHVtSW5zdGFuY2UoT3V0bGluZVN5bWJvbFRyYWl0cywge1xuICAgICAgICAgICAgY29sb3I6XG4gICAgICAgICAgICAgIGVzcmlTdHlsZS50eXBlID09PSBcImVzcmlTTFNcIlxuICAgICAgICAgICAgICAgID8gY29udmVydEVzcmlDb2xvclRvQ2VzaXVtQ29sb3IoXG4gICAgICAgICAgICAgICAgICAgIGVzcmlTdHlsZS5jb2xvclxuICAgICAgICAgICAgICAgICAgKT8udG9Dc3NDb2xvclN0cmluZygpXG4gICAgICAgICAgICAgICAgOiBjb252ZXJ0RXNyaUNvbG9yVG9DZXNpdW1Db2xvcihcbiAgICAgICAgICAgICAgICAgICAgZXNyaVN0eWxlLm91dGxpbmU/LmNvbG9yXG4gICAgICAgICAgICAgICAgICApPy50b0Nzc0NvbG9yU3RyaW5nKCksXG4gICAgICAgICAgICAvLyBVc2Ugd2lkdGggaWYgTGluZSBzdHlsZVxuICAgICAgICAgICAgd2lkdGg6XG4gICAgICAgICAgICAgIGVzcmlTdHlsZS50eXBlID09PSBcImVzcmlTTFNcIlxuICAgICAgICAgICAgICAgID8gY29udmVydEVzcmlQb2ludFNpemVUb1BpeGVscyhlc3JpU3R5bGUud2lkdGgpXG4gICAgICAgICAgICAgICAgOiBjb252ZXJ0RXNyaVBvaW50U2l6ZVRvUGl4ZWxzKGVzcmlTdHlsZS5vdXRsaW5lPy53aWR0aCksXG4gICAgICAgICAgICBsZWdlbmRUaXRsZTogbGFiZWwgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgICAgZGFzaDpcbiAgICAgICAgICAgICAgZXNyaVN0eWxlLnR5cGUgPT09IFwiZXNyaVNMU1wiXG4gICAgICAgICAgICAgICAgPyBjb252ZXJ0RXNyaUxpbmVTdHlsZVRvRGFzaEFycmF5KGVzcmlTdHlsZS5zdHlsZSlcbiAgICAgICAgICAgICAgICA6IGNvbnZlcnRFc3JpTGluZVN0eWxlVG9EYXNoQXJyYXkoZXNyaVN0eWxlLm91dGxpbmU/LnN0eWxlKVxuICAgICAgICAgIH0pXG4gICAgICAgIDogdW5kZWZpbmVkXG4gIH07XG59XG5cbmZ1bmN0aW9uIGNvbnZlcnRFc3JpTWFya2VyVG9NYWtpKFxuICBlc3JpOiBTdXBwb3J0ZWRFc3JpU2ltcGxlTWFya2VyU3R5bGUgfCBzdHJpbmcgfCB1bmRlZmluZWRcbik6IHN0cmluZyB7XG4gIHN3aXRjaCAoZXNyaSkge1xuICAgIGNhc2UgXCJlc3JpU01TQ3Jvc3NcIjpcbiAgICAgIHJldHVybiBcImhvc3BpdGFsXCI7XG4gICAgY2FzZSBcImVzcmlTTVNEaWFtb25kXCI6XG4gICAgICByZXR1cm4gXCJkaWFtb25kXCI7XG4gICAgY2FzZSBcImVzcmlTTVNTcXVhcmVcIjpcbiAgICAgIHJldHVybiBcInNxdWFyZVwiO1xuICAgIGNhc2UgXCJlc3JpU01TVHJpYW5nbGVcIjpcbiAgICAgIHJldHVybiBcInRyaWFuZ2xlXCI7XG4gICAgY2FzZSBcImVzcmlTTVNYXCI6XG4gICAgICByZXR1cm4gXCJjcm9zc1wiO1xuICAgIGNhc2UgXCJlc3JpU01TQ2lyY2xlXCI6XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBcInBvaW50XCI7XG4gIH1cbn1cblxuLy8gRVNSSSB1c2VzIHBvaW50cyBmb3Igc3R5bGluZyB3aGlsZSBjZXNpdW0gdXNlcyBwaXhlbHNcbmV4cG9ydCBmdW5jdGlvbiBjb252ZXJ0RXNyaVBvaW50U2l6ZVRvUGl4ZWxzKHBvaW50U2l6ZT86IG51bWJlcikge1xuICBpZiAoIWlzRGVmaW5lZChwb2ludFNpemUpKSByZXR1cm4gdW5kZWZpbmVkO1xuICAvLyAxIHB4ID0gMC43NSBwb2ludFxuICAvLyAxIHBvaW50ID0gNC8zIHBvaW50XG4gIHJldHVybiAocG9pbnRTaXplICogNCkgLyAzO1xufVxuXG5mdW5jdGlvbiBjb252ZXJ0RXNyaUNvbG9yVG9DZXNpdW1Db2xvcihcbiAgZXNyaUNvbG9yPzogbnVsbCB8IG51bWJlcltdIHwgdW5kZWZpbmVkXG4pOiBDb2xvciB8IHVuZGVmaW5lZCB7XG4gIGlmICghZXNyaUNvbG9yKSByZXR1cm47XG4gIHJldHVybiBDb2xvci5mcm9tQnl0ZXMoXG4gICAgZXNyaUNvbG9yWzBdLFxuICAgIGVzcmlDb2xvclsxXSxcbiAgICBlc3JpQ29sb3JbMl0sXG4gICAgZXNyaUNvbG9yWzNdXG4gICk7XG59XG5cbmNvbnN0IGRlZmF1bHREYXNoQXJyYXkgPSBbNCwgM107XG5cbmNvbnN0IGVzcmlMaW5lU3R5bGVDZXNpdW06IFJlY29yZDxTdXBwb3J0ZWRMaW5lU3R5bGUsIG51bWJlcj4gPSB7XG4gIGVzcmlTTFNOdWxsOiAwLFxuICBlc3JpU0xTU29saWQ6IDI1NSxcbiAgZXNyaVNMU0Rhc2g6IDMwODcsIC8vXCIgICAtLS0tXCIgcGFyc2VJbnQoXCIxMTAwMDAwMDExMTFcIiwgMilcbiAgZXNyaVNMU0RvdDogNywgLy9cIiAgIC1cIlxuICBlc3JpU0xTRGFzaERvdDogMjAxNywgLy9cIiAgIC0tLS0gICAtXCJcbiAgZXNyaVNMU0Rhc2hEb3REb3Q6IDE2MjczLCAvLyAnICAtLS0tLS0tLSAgIC0gICAtICdcbiAgZXNyaVNMU0xvbmdEYXNoOiAyMDQ3LCAvLyAnICAgLS0tLS0tLS0nXG4gIGVzcmlTTFNMb25nRGFzaERvdDogNDA4MSwgLy8gJyAgIC0tLS0tLS0tICAgLSdcbiAgZXNyaVNMU1Nob3J0RGFzaDogNDA5NSwgLy8nIC0tLS0nXG4gIGVzcmlTTFNTaG9ydERvdDogMTMxMDcsIC8vJyAtLS0tIC0nXG4gIGVzcmlTTFNTaG9ydERhc2hEb3Q6IDgxNzksIC8vJyAtLS0tIC0gLSdcbiAgZXNyaVNMU1Nob3J0RGFzaERvdERvdDogMTYyODEgLy8nIC0gLSAtIC0nXG59O1xuXG5jb25zdCBjZXNpdW1EYXNoTnVtYmVyVG9EYXNoQXJyYXk6IHtcbiAgW2tleTogbnVtYmVyXTogbnVtYmVyW107XG59ID0ge1xuICAwOiBbXSxcbiAgMjU1OiBbXSxcbiAgMzA4NzogWzYsIDZdLFxuICA3OiBbMSwgM10sXG4gIDIwMTc6IFs0LCAzLCAxLCAzXSxcbiAgMTYyNzM6IFs4LCAzLCAxLCAzLCAxLCAzXSxcbiAgMjA0NzogWzgsIDNdLFxuICA0MDgxOiBbOCwgMywgMSwgM10sXG4gIDQwOTU6IFs0LCAxXSxcbiAgMTMxMDc6IFsxLCAxXSxcbiAgODE3OTogWzQsIDEsIDEsIDFdLFxuICAxNjI4MTogWzQsIDEsIDEsIDEsIDEsIDFdXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gY29udmVydENlc2l1bURhc2hOdW1iZXJUb0Rhc2hBcnJheShcbiAgZGFzaFBhdHRlcm46IG51bWJlclxuKTogbnVtYmVyW10ge1xuICBpZiAoY2VzaXVtRGFzaE51bWJlclRvRGFzaEFycmF5W2Rhc2hQYXR0ZXJuXSkge1xuICAgIHJldHVybiBjZXNpdW1EYXNoTnVtYmVyVG9EYXNoQXJyYXlbZGFzaFBhdHRlcm5dO1xuICB9XG4gIHJldHVybiBkZWZhdWx0RGFzaEFycmF5O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY29udmVydEVzcmlMaW5lU3R5bGVUb0Nlc2l1bURhc2hOdW1iZXIoc3R5bGVOYW1lOiBzdHJpbmcpIHtcbiAgaWYgKHN0eWxlTmFtZSBpbiBlc3JpTGluZVN0eWxlQ2VzaXVtKSB7XG4gICAgcmV0dXJuIGVzcmlMaW5lU3R5bGVDZXNpdW1bc3R5bGVOYW1lIGFzIFN1cHBvcnRlZExpbmVTdHlsZV07XG4gIH1cbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cblxuZnVuY3Rpb24gY29udmVydEVzcmlMaW5lU3R5bGVUb0Rhc2hBcnJheShzdHlsZU5hbWU6IHN0cmluZyB8IHVuZGVmaW5lZCkge1xuICBpZiAoc3R5bGVOYW1lKSB7XG4gICAgY29uc3QgZGFzaE51bWJlciA9IGNvbnZlcnRFc3JpTGluZVN0eWxlVG9DZXNpdW1EYXNoTnVtYmVyKHN0eWxlTmFtZSk7XG4gICAgaWYgKGRhc2hOdW1iZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIGNvbnZlcnRDZXNpdW1EYXNoTnVtYmVyVG9EYXNoQXJyYXkoZGFzaE51bWJlcik7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIFtdO1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Models/Catalog/Esri/esriStyleToTableStyle.ts\n\n}");

/***/ }),

/***/ "./packages/terriajs/lib/Models/Leaflet.ts":
/*!*************************************************!*\
  !*** ./packages/terriajs/lib/Models/Leaflet.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ Leaflet)\n/* harmony export */ });\n/* harmony import */ var core_js_modules_es_array_reverse_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! core-js/modules/es.array.reverse.js */ \"./node_modules/core-js/modules/es.array.reverse.js\");\n/* harmony import */ var core_js_modules_es_array_reverse_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(core_js_modules_es_array_reverse_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var core_js_modules_es_array_sort_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! core-js/modules/es.array.sort.js */ \"./node_modules/core-js/modules/es.array.sort.js\");\n/* harmony import */ var core_js_modules_es_array_sort_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(core_js_modules_es_array_sort_js__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var core_js_modules_es_promise_finally_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! core-js/modules/es.promise.finally.js */ \"./node_modules/core-js/modules/es.promise.finally.js\");\n/* harmony import */ var core_js_modules_es_promise_finally_js__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(core_js_modules_es_promise_finally_js__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! core-js/modules/es.regexp.exec.js */ \"./node_modules/core-js/modules/es.regexp.exec.js\");\n/* harmony import */ var core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! core-js/modules/es.string.replace.js */ \"./node_modules/core-js/modules/es.string.replace.js\");\n/* harmony import */ var core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var core_js_modules_web_dom_collections_iterator_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"./node_modules/core-js/modules/web.dom-collections.iterator.js\");\n/* harmony import */ var core_js_modules_web_dom_collections_iterator_js__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(core_js_modules_web_dom_collections_iterator_js__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var mobx__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! mobx */ \"./node_modules/mobx/dist/mobx.esm.js\");\n/* harmony import */ var mobx_utils__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! mobx-utils */ \"./node_modules/mobx-utils/mobx-utils.module.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_Cartesian2__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Cartesian2 */ \"./node_modules/terriajs-cesium/Source/Core/Cartesian2.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_Cartographic__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Cartographic */ \"./node_modules/terriajs-cesium/Source/Core/Cartographic.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_Ellipsoid__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Ellipsoid */ \"./node_modules/terriajs-cesium/Source/Core/Ellipsoid.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_EventHelper__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! terriajs-cesium/Source/Core/EventHelper */ \"./node_modules/terriajs-cesium/Source/Core/EventHelper.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Math */ \"./node_modules/terriajs-cesium/Source/Core/Math.js\");\n/* harmony import */ var terriajs_cesium_Source_Core_Rectangle__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! terriajs-cesium/Source/Core/Rectangle */ \"./node_modules/terriajs-cesium/Source/Core/Rectangle.js\");\n/* harmony import */ var terriajs_cesium_Source_DataSources_DataSource__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! terriajs-cesium/Source/DataSources/DataSource */ \"./node_modules/terriajs-cesium/Source/DataSources/DataSource.js\");\n/* harmony import */ var terriajs_cesium_Source_DataSources_DataSourceCollection__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! terriajs-cesium/Source/DataSources/DataSourceCollection */ \"./node_modules/terriajs-cesium/Source/DataSources/DataSourceCollection.js\");\n/* harmony import */ var terriajs_cesium_Source_Scene_SplitDirection__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! terriajs-cesium/Source/Scene/SplitDirection */ \"./node_modules/terriajs-cesium/Source/Scene/SplitDirection.js\");\n/* harmony import */ var terriajs_html2canvas__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! terriajs-html2canvas */ \"./node_modules/terriajs-html2canvas/dist/npm/index.js\");\n/* harmony import */ var terriajs_html2canvas__WEBPACK_IMPORTED_MODULE_17___default = /*#__PURE__*/__webpack_require__.n(terriajs_html2canvas__WEBPACK_IMPORTED_MODULE_17__);\n/* harmony import */ var _Core_filterOutUndefined__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../Core/filterOutUndefined */ \"./packages/terriajs/lib/Core/filterOutUndefined.ts\");\n/* harmony import */ var _Core_isDefined__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../Core/isDefined */ \"./packages/terriajs/lib/Core/isDefined.ts\");\n/* harmony import */ var _Core_runLater__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../Core/runLater */ \"./packages/terriajs/lib/Core/runLater.ts\");\n/* harmony import */ var _Map_Leaflet_ImageryProviderLeafletGridLayer__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../Map/Leaflet/ImageryProviderLeafletGridLayer */ \"./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletGridLayer.ts\");\n/* harmony import */ var _Map_Leaflet_ImageryProviderLeafletTileLayer__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../Map/Leaflet/ImageryProviderLeafletTileLayer */ \"./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletTileLayer.ts\");\n/* harmony import */ var _Map_Leaflet_LeafletDataSourceDisplay__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../Map/Leaflet/LeafletDataSourceDisplay */ \"./packages/terriajs/lib/Map/Leaflet/LeafletDataSourceDisplay.ts\");\n/* harmony import */ var _Map_Leaflet_LeafletScene__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../Map/Leaflet/LeafletScene */ \"./packages/terriajs/lib/Map/Leaflet/LeafletScene.ts\");\n/* harmony import */ var _Map_Leaflet_LeafletSelectionIndicator__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../Map/Leaflet/LeafletSelectionIndicator */ \"./packages/terriajs/lib/Map/Leaflet/LeafletSelectionIndicator.ts\");\n/* harmony import */ var _Map_Leaflet_LeafletVisualizer__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../Map/Leaflet/LeafletVisualizer */ \"./packages/terriajs/lib/Map/Leaflet/LeafletVisualizer.ts\");\n/* harmony import */ var _Map_LeafletPatched__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../Map/LeafletPatched */ \"./packages/terriajs/lib/Map/LeafletPatched.ts\");\n/* harmony import */ var _Map_PickedFeatures_PickedFeatures__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../Map/PickedFeatures/PickedFeatures */ \"./packages/terriajs/lib/Map/PickedFeatures/PickedFeatures.ts\");\n/* harmony import */ var _Map_Vector_rectangleToLatLngBounds__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ../Map/Vector/rectangleToLatLngBounds */ \"./packages/terriajs/lib/Map/Vector/rectangleToLatLngBounds.ts\");\n/* harmony import */ var _ModelMixins_FeatureInfoUrlTemplateMixin__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ../ModelMixins/FeatureInfoUrlTemplateMixin */ \"./packages/terriajs/lib/ModelMixins/FeatureInfoUrlTemplateMixin.ts\");\n/* harmony import */ var _ModelMixins_MappableMixin__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ../ModelMixins/MappableMixin */ \"./packages/terriajs/lib/ModelMixins/MappableMixin.ts\");\n/* harmony import */ var _ModelMixins_TileErrorHandlerMixin__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ../ModelMixins/TileErrorHandlerMixin */ \"./packages/terriajs/lib/ModelMixins/TileErrorHandlerMixin.ts\");\n/* harmony import */ var _Traits_TraitsClasses_ImageryProviderTraits__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ../Traits/TraitsClasses/ImageryProviderTraits */ \"./packages/terriajs/lib/Traits/TraitsClasses/ImageryProviderTraits.ts\");\n/* harmony import */ var _Traits_TraitsClasses_SplitterTraits__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ../Traits/TraitsClasses/SplitterTraits */ \"./packages/terriajs/lib/Traits/TraitsClasses/SplitterTraits.ts\");\n/* harmony import */ var _CameraView__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./CameraView */ \"./packages/terriajs/lib/Models/CameraView.ts\");\n/* harmony import */ var _Definition_hasTraits__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./Definition/hasTraits */ \"./packages/terriajs/lib/Models/Definition/hasTraits.ts\");\n/* harmony import */ var _Feature_Feature__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./Feature/Feature */ \"./packages/terriajs/lib/Models/Feature/Feature.ts\");\n/* harmony import */ var _GlobeOrMap__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./GlobeOrMap */ \"./packages/terriajs/lib/Models/GlobeOrMap.ts\");\n/* harmony import */ var _LeafletAttribution__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ./LeafletAttribution */ \"./packages/terriajs/lib/Models/LeafletAttribution.ts\");\nvar _class, _descriptor, _descriptor2, _descriptor3;\n\n\n\n\n\n\nfunction _initializerDefineProperty(e, i, r, l) { r && Object.defineProperty(e, i, { enumerable: r.enumerable, configurable: r.configurable, writable: r.writable, value: r.initializer ? r.initializer.call(l) : void 0 }); }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction _applyDecoratedDescriptor(i, e, r, n, l) { var a = {}; return Object.keys(n).forEach(function (i) { a[i] = n[i]; }), a.enumerable = !!a.enumerable, a.configurable = !!a.configurable, (\"value\" in a || a.initializer) && (a.writable = !0), a = r.slice().reverse().reduce(function (r, n) { return n(i, e, r) || r; }, a), l && void 0 !== a.initializer && (a.value = a.initializer ? a.initializer.call(l) : void 0, a.initializer = void 0), void 0 === a.initializer ? (Object.defineProperty(i, e, a), null) : a; }\nfunction _initializerWarningHelper(r, e) { throw Error(\"Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.\"); }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// This class is an observer. It probably won't contain any observables itself\nlet Leaflet = (_class = class Leaflet extends _GlobeOrMap__WEBPACK_IMPORTED_MODULE_38__[\"default\"] {\n  updateMapObservables() {\n    this.size = this.map.getSize();\n    this.nw = this.map.containerPointToLayerPoint([0, 0]);\n    this.se = this.map.containerPointToLayerPoint(this.size);\n  }\n  _makeImageryLayerFromParts(parts, item) {\n    if (parts.imageryProvider === undefined) return undefined;\n    if (_ModelMixins_TileErrorHandlerMixin__WEBPACK_IMPORTED_MODULE_32__[\"default\"].isMixedInto(item)) {\n      // because this code path can run multiple times, make sure we remove the\n      // handler if it is already registered\n      parts.imageryProvider.errorEvent.removeEventListener(item.onTileLoadError, item);\n      parts.imageryProvider.errorEvent.addEventListener(item.onTileLoadError, item);\n    }\n    return this._createImageryLayer(parts.imageryProvider, parts.clippingRectangle);\n  }\n  constructor(terriaViewer, container) {\n    super();\n    _defineProperty(this, \"type\", \"Leaflet\");\n    _defineProperty(this, \"terria\", void 0);\n    _defineProperty(this, \"terriaViewer\", void 0);\n    _defineProperty(this, \"map\", void 0);\n    _defineProperty(this, \"scene\", void 0);\n    _defineProperty(this, \"dataSources\", new terriajs_cesium_Source_DataSources_DataSourceCollection__WEBPACK_IMPORTED_MODULE_15__[\"default\"]());\n    _defineProperty(this, \"dataSourceDisplay\", void 0);\n    _defineProperty(this, \"canShowSplitter\", true);\n    _defineProperty(this, \"_attributionControl\", void 0);\n    _defineProperty(this, \"_leafletVisualizer\", void 0);\n    _defineProperty(this, \"_eventHelper\", void 0);\n    _defineProperty(this, \"_selectionIndicator\", void 0);\n    _defineProperty(this, \"_stopRequestAnimationFrame\", false);\n    _defineProperty(this, \"_cesiumReqAnimFrameId\", void 0);\n    _defineProperty(this, \"_pickedFeatures\", undefined);\n    _defineProperty(this, \"_pauseMapInteractionCount\", 0);\n    /* Disposers */\n    _defineProperty(this, \"_disposeWorkbenchMapItemsSubscription\", void 0);\n    _defineProperty(this, \"_disposeDisableInteractionSubscription\", void 0);\n    _defineProperty(this, \"_disposeSelectedFeatureSubscription\", void 0);\n    _defineProperty(this, \"_disposeSplitterReaction\", void 0);\n    // These are used to split CesiumTileLayer and MapboxCanvasVectorTileLayer\n    _initializerDefineProperty(this, \"size\", _descriptor, this);\n    _initializerDefineProperty(this, \"nw\", _descriptor2, this);\n    _initializerDefineProperty(this, \"se\", _descriptor3, this);\n    /**\n     * Initial view set when the viewer is created\n     */\n    _defineProperty(this, \"_initialView\", void 0);\n    _defineProperty(this, \"_createImageryLayer\", (0,mobx_utils__WEBPACK_IMPORTED_MODULE_7__.computedFn)((ip, clippingRectangle) => {\n      const layerOptions = {\n        maxZoom: this.terria.configParameters.leafletMaxZoom,\n        bounds: clippingRectangle && (0,_Map_Vector_rectangleToLatLngBounds__WEBPACK_IMPORTED_MODULE_29__[\"default\"])(clippingRectangle)\n      };\n      // We have two different kinds of ImageryProviderLeaflet layers\n      // - Grid layer will use the ImageryProvider in the more traditional way - calling `requestImage` to draw the image on to a canvas\n      // - Tile layer will pass tile URLs to leaflet objects - which is a bit more \"Leaflety\" than Grid layer\n      // Tile layer is preferred. Grid layer mainly exists for custom Imagery Providers which aren't just a tile of image URLs\n      if ((0,_Map_Leaflet_ImageryProviderLeafletGridLayer__WEBPACK_IMPORTED_MODULE_21__.isImageryProviderGridLayer)(ip)) {\n        return new _Map_Leaflet_ImageryProviderLeafletGridLayer__WEBPACK_IMPORTED_MODULE_21__[\"default\"](this, ip, layerOptions);\n      } else {\n        return new _Map_Leaflet_ImageryProviderLeafletTileLayer__WEBPACK_IMPORTED_MODULE_22__[\"default\"](this, ip, layerOptions);\n      }\n    }));\n    (0,mobx__WEBPACK_IMPORTED_MODULE_6__.makeObservable)(this);\n    this.terria = terriaViewer.terria;\n    this.terriaViewer = terriaViewer;\n    this.map = _Map_LeafletPatched__WEBPACK_IMPORTED_MODULE_27__[\"default\"].map(container, {\n      zoomControl: false,\n      attributionControl: false,\n      zoomSnap: 1,\n      // Change to  0.2 for incremental zoom when Chrome fixes canvas scaling gaps\n      preferCanvas: true,\n      worldCopyJump: false\n    }).setView([-28.5, 135], 5);\n    this.map.on(\"move\", () => this.updateMapObservables());\n    this.map.on(\"zoom\", () => this.updateMapObservables());\n    this.scene = new _Map_Leaflet_LeafletScene__WEBPACK_IMPORTED_MODULE_24__[\"default\"](this.map);\n    this._attributionControl = new _LeafletAttribution__WEBPACK_IMPORTED_MODULE_39__.LeafletAttribution(this.terria);\n    this.map.addControl(this._attributionControl);\n    this._leafletVisualizer = new _Map_Leaflet_LeafletVisualizer__WEBPACK_IMPORTED_MODULE_26__[\"default\"]();\n    this._selectionIndicator = new _Map_Leaflet_LeafletSelectionIndicator__WEBPACK_IMPORTED_MODULE_25__[\"default\"](this);\n    this.dataSourceDisplay = new _Map_Leaflet_LeafletDataSourceDisplay__WEBPACK_IMPORTED_MODULE_23__[\"default\"]({\n      scene: this.scene,\n      dataSourceCollection: this.dataSources,\n      visualizersCallback: this._leafletVisualizer.visualizersCallback\n    });\n    this._eventHelper = new terriajs_cesium_Source_Core_EventHelper__WEBPACK_IMPORTED_MODULE_11__[\"default\"]();\n    this._eventHelper.add(this.terria.timelineClock.onTick, clock => {\n      this.dataSourceDisplay.update(clock.currentTime);\n    });\n    const ticker = () => {\n      if (!this._stopRequestAnimationFrame) {\n        this.terria.timelineClock.tick();\n        this._cesiumReqAnimFrameId = requestAnimationFrame(ticker);\n      }\n    };\n\n    // Start ticker asynchronously to avoid calling an action in the consctructor\n    (0,_Core_runLater__WEBPACK_IMPORTED_MODULE_20__[\"default\"])(ticker);\n    this._disposeWorkbenchMapItemsSubscription = this.observeModelLayer();\n    this._disposeSplitterReaction = this._reactToSplitterChanges();\n    this._disposeDisableInteractionSubscription = (0,mobx__WEBPACK_IMPORTED_MODULE_6__.autorun)(() => {\n      const map = this.map;\n      const interactions = (0,_Core_filterOutUndefined__WEBPACK_IMPORTED_MODULE_18__[\"default\"])([map.touchZoom, map.doubleClickZoom, map.scrollWheelZoom, map.boxZoom, map.keyboard, map.dragging, map.tapHold]);\n      const pickLocation = this.pickLocation.bind(this);\n      const pickFeature = (entity, event) => {\n        this._featurePicked(entity, event);\n      };\n\n      // Update mouse coords on mouse move\n      this.map.on(\"mousemove\", e => {\n        const mouseEvent = e;\n        this.mouseCoords.updateCoordinatesFromLeaflet(this.terria, mouseEvent.originalEvent);\n      });\n      if (this.terriaViewer.disableInteraction) {\n        interactions.forEach(handler => handler.disable());\n        this.map.off(\"click\", pickLocation);\n        this.scene.featureClicked.removeEventListener(pickFeature);\n        if (this._disposeSelectedFeatureSubscription) {\n          this._disposeSelectedFeatureSubscription();\n        }\n      } else {\n        interactions.forEach(handler => handler.enable());\n        this.map.on(\"click\", pickLocation);\n        this.scene.featureClicked.addEventListener(pickFeature);\n        this._disposeSelectedFeatureSubscription = (0,mobx__WEBPACK_IMPORTED_MODULE_6__.autorun)(() => {\n          const feature = this.terria.selectedFeature;\n          this._selectFeature(feature);\n        });\n      }\n    });\n    this._initProgressEvent();\n  }\n  get attributionPrefix() {\n    return this._attributionControl.prefix;\n  }\n  get attributions() {\n    return this._attributionControl.dataAttributions;\n  }\n\n  /**\n   * sets up loading listeners\n   */\n  _initProgressEvent() {\n    const onTileLoadChange = () => {\n      let tilesLoadingCount = 0;\n      this.map.eachLayer(function (layerOrGridlayer) {\n        // _tiles is protected but our knockout-loading-logic accesses it here anyway\n        const layer = layerOrGridlayer;\n        if (layer !== null && layer !== void 0 && layer._tiles) {\n          // Count all tiles not marked as loaded\n          tilesLoadingCount += Object.keys(layer._tiles).filter(key => !layer._tiles[key].loaded).length;\n        }\n      });\n      this._updateTilesLoadingCount(tilesLoadingCount);\n    };\n    this.map.on(\"layeradd\", function (evt) {\n      // This check makes sure we only watch tile layers, and also protects us if this private variable gets changed.\n      if (typeof evt.layer._tiles !== \"undefined\") {\n        evt.layer.on(\"tileloadstart tileload load\", onTileLoadChange);\n      }\n    }.bind(this));\n    this.map.on(\"layerremove\", function (evt) {\n      evt.layer.off(\"tileloadstart tileload load\", onTileLoadChange);\n    }.bind(this));\n  }\n\n  /**\n   * Pick feature from mouse click event.\n   */\n  pickLocation(e) {\n    const mouseEvent = e;\n\n    // Handle click events that cross the anti-meridian\n    if (mouseEvent.latlng.lng > 180 || mouseEvent.latlng.lng < -180) {\n      mouseEvent.latlng = mouseEvent.latlng.wrap();\n    }\n\n    // if (!this._dragboxcompleted && that.map.dragging.enabled()) {\n    this._pickFeatures(mouseEvent.latlng);\n    // }\n    // this._dragboxcompleted = false;\n  }\n  getContainer() {\n    return this.map.getContainer();\n  }\n  pauseMapInteraction() {\n    ++this._pauseMapInteractionCount;\n    if (this._pauseMapInteractionCount === 1) {\n      this.map.dragging.disable();\n    }\n  }\n  resumeMapInteraction() {\n    --this._pauseMapInteractionCount;\n    if (this._pauseMapInteractionCount === 0) {\n      setTimeout(() => {\n        if (this._pauseMapInteractionCount === 0) {\n          this.map.dragging.enable();\n        }\n      }, 0);\n    }\n  }\n  destroy() {\n    if (this._disposeSelectedFeatureSubscription) {\n      this._disposeSelectedFeatureSubscription();\n    }\n    this._disposeSplitterReaction();\n    this._disposeWorkbenchMapItemsSubscription();\n    this._eventHelper.removeAll();\n    this._disposeDisableInteractionSubscription();\n    // This variable prevents a race condition if destroy() is called\n    // synchronously as a result of timelineClock ticking due to ticker()\n    this._stopRequestAnimationFrame = true;\n    if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(this._cesiumReqAnimFrameId)) {\n      cancelAnimationFrame(this._cesiumReqAnimFrameId);\n    }\n    this.dataSourceDisplay.destroy();\n    this.map.off(\"move\");\n    this.map.off(\"zoom\");\n    this.map.off(\"zoomlevelschange\");\n    this.map.remove();\n  }\n  get availableCatalogItems() {\n    const catalogItems = [...this.terriaViewer.items.get(), this.terriaViewer.baseMap];\n    return catalogItems;\n  }\n  get availableDataSources() {\n    const catalogItems = this.availableCatalogItems;\n    /* Handle datasources */\n    const allMapItems = [].concat(...catalogItems.filter(_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"]).map(item => item.mapItems));\n    const dataSources = allMapItems.filter(isDataSource);\n    return dataSources;\n  }\n  observeModelLayer() {\n    // Setup reaction to sync datSources collection with availableDataSources\n    //\n    // To avoid buggy concurrent syncs, we have to ensure that even when\n    // multiple sync reactions are triggered, we run them one after the\n    // other. To do this, we make each run of the reaction wait for the\n    // previous `syncDataSourcesPromise` to finish before starting itself.\n    let syncDataSourcesPromise = Promise.resolve();\n    const dataSourcesReactionDisposer = (0,mobx__WEBPACK_IMPORTED_MODULE_6__.reaction)(() => this.availableDataSources, () => {\n      syncDataSourcesPromise = syncDataSourcesPromise.then(async () => {\n        await this.syncDataSourceCollection(this.availableDataSources, this.dataSources);\n        this.notifyRepaintRequired();\n      }).catch(console.error);\n    }, {\n      fireImmediately: true\n    });\n\n    // Reaction to sync imagery from model layer with cesium map\n    const imageryReactionDisposer = (0,mobx__WEBPACK_IMPORTED_MODULE_6__.autorun)(() => {\n      const catalogItems = this.availableCatalogItems;\n      // Flatmap\n      const allImageryMapItems = [].concat(...catalogItems.filter(_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"]).map(item => item.mapItems.filter(_ModelMixins_MappableMixin__WEBPACK_IMPORTED_MODULE_31__.ImageryParts.is).map(parts => ({\n        item,\n        parts\n      }))));\n      const allImagery = allImageryMapItems.map(_ref => {\n        let {\n          item,\n          parts\n        } = _ref;\n        if ((0,_Definition_hasTraits__WEBPACK_IMPORTED_MODULE_36__[\"default\"])(item, _Traits_TraitsClasses_ImageryProviderTraits__WEBPACK_IMPORTED_MODULE_33__[\"default\"], \"leafletUpdateInterval\")) {\n          parts.imageryProvider._leafletUpdateInterval = item.leafletUpdateInterval;\n        }\n        return {\n          parts: parts,\n          layer: this._makeImageryLayerFromParts(parts, item)\n        };\n      });\n\n      // Delete imagery layers no longer in the model\n      this.map.eachLayer(mapLayer => {\n        if (isImageryLayer(mapLayer) || mapLayer instanceof _Map_Leaflet_ImageryProviderLeafletGridLayer__WEBPACK_IMPORTED_MODULE_21__[\"default\"]) {\n          const index = allImagery.findIndex(im => im.layer === mapLayer);\n          if (index === -1) {\n            this.map.removeLayer(mapLayer);\n          }\n        }\n      });\n\n      // Add layer and update its zIndex\n      let zIndex = 100; // Start at an arbitrary value\n      allImagery.reverse().forEach(_ref2 => {\n        let {\n          parts,\n          layer\n        } = _ref2;\n        if (layer && parts.show) {\n          layer.setOpacity(parts.alpha);\n          layer.setZIndex(zIndex);\n          zIndex++;\n          if (!this.map.hasLayer(layer)) {\n            this.map.addLayer(layer);\n          }\n        } else if (layer) {\n          this.map.removeLayer(layer);\n        }\n      });\n    });\n    return () => {\n      dataSourcesReactionDisposer();\n      imageryReactionDisposer();\n    };\n  }\n\n  /**\n   * Syncs the `dataSources` collection against the latest `availableDataSources`.\n   *\n   */\n  async syncDataSourceCollection(availableDataSources, dataSources) {\n    // 1. Remove deleted data sources\n    //\n    // Iterate backwards because we're removing items.\n    for (let i = dataSources.length - 1; i >= 0; i--) {\n      const ds = dataSources.get(i);\n      if (availableDataSources.indexOf(ds) === -1 || !ds.show) {\n        dataSources.remove(ds);\n      }\n    }\n\n    // 2. Add new data sources\n    for (const ds of availableDataSources) {\n      if (!dataSources.contains(ds) && ds.show) {\n        await dataSources.add(ds);\n      }\n    }\n\n    // 3. Ensure stacking order matches order in `availableDataSources` - first item appears on top.\n    (0,mobx__WEBPACK_IMPORTED_MODULE_6__.runInAction)(() => availableDataSources.forEach(ds => {\n      // There is a buggy/un-intended side-effect when calling raiseToTop() with\n      // a source that doesn't exist in the collection. Doing this will replace\n      // the last entry in the collection with the new one. So we should be\n      // careful to raiseToTop() only if the DS already exists in the collection.\n      // Relevant code:\n      //   https://github.com/CesiumGS/cesium/blob/dbd452328a48bfc4e192146862a9f8fa15789dc8/packages/engine/Source/DataSources/DataSourceCollection.js#L298-L299\n      if (dataSources.contains(ds)) {\n        dataSources.raiseToTop(ds);\n      }\n    }));\n  }\n  doZoomTo(target) {\n    let flightDurationSeconds = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 3.0;\n    if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(target)) {\n      return Promise.resolve();\n    }\n    let bounds;\n    if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(target.entities)) {\n      if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(this.dataSourceDisplay)) {\n        bounds = this.dataSourceDisplay.getLatLngBounds(target);\n      }\n    } else {\n      let extent;\n      if (target instanceof terriajs_cesium_Source_Core_Rectangle__WEBPACK_IMPORTED_MODULE_13__[\"default\"]) {\n        extent = target;\n      } else if (target instanceof _CameraView__WEBPACK_IMPORTED_MODULE_35__[\"default\"]) {\n        extent = target.rectangle;\n      } else if (_ModelMixins_MappableMixin__WEBPACK_IMPORTED_MODULE_31__[\"default\"].isMixedInto(target)) {\n        if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(target.cesiumRectangle)) {\n          extent = target.cesiumRectangle;\n        }\n        if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(extent)) {\n          return this.doZoomTo(target.mapItems[0], flightDurationSeconds);\n        }\n      } else {\n        extent = target.rectangle;\n      }\n\n      // Ensure extent is defined before accessing its properties\n      if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(extent)) {\n        // Account for a bounding box crossing the date line.\n        if (extent.east < extent.west) {\n          extent = terriajs_cesium_Source_Core_Rectangle__WEBPACK_IMPORTED_MODULE_13__[\"default\"].clone(extent);\n          extent.east += terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_12__[\"default\"].TWO_PI;\n        }\n        bounds = (0,_Map_Vector_rectangleToLatLngBounds__WEBPACK_IMPORTED_MODULE_29__[\"default\"])(extent);\n      } else {\n        // Handle the case where extent is undefined\n        console.error(\"Unable to determine bounds for zooming.\");\n        return Promise.resolve();\n      }\n    }\n    if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(bounds)) {\n      this.map.flyToBounds(bounds, {\n        animate: flightDurationSeconds > 0.0,\n        duration: flightDurationSeconds\n      });\n    }\n    return Promise.resolve();\n  }\n  setInitialView(view) {\n    this.doZoomTo(view, 0);\n    this._initialView = view;\n    this.map.addOneTimeEventListener(\"move\", () => {\n      this._initialView = undefined;\n    });\n  }\n\n  /**\n   * Return the initial view if it hasn't changed. Otherwise return undefined.\n   */\n  getInitialView() {\n    return this._initialView;\n  }\n  getCurrentCameraView() {\n    // Return the initial view if the camera hasn't changed since setting it.\n    // This ensures that the view remains constant when switching between\n    // viewer modes.\n    const initialView = this.getInitialView();\n    if (initialView) {\n      return initialView;\n    }\n    const bounds = this.map.getBounds();\n    return new _CameraView__WEBPACK_IMPORTED_MODULE_35__[\"default\"](terriajs_cesium_Source_Core_Rectangle__WEBPACK_IMPORTED_MODULE_13__[\"default\"].fromDegrees(bounds.getWest(), bounds.getSouth(), bounds.getEast(), bounds.getNorth()));\n  }\n  notifyRepaintRequired() {\n    // No action necessary.\n  }\n  pickFromLocation(latLngHeight, providerCoords, existingFeatures) {\n    this._pickFeatures(_Map_LeafletPatched__WEBPACK_IMPORTED_MODULE_27__[\"default\"].latLng({\n      lat: latLngHeight.latitude,\n      lng: latLngHeight.longitude,\n      alt: latLngHeight.height\n    }), providerCoords, existingFeatures);\n  }\n\n  /*\n   * There are two \"listeners\" for clicks which are set up in our constructor.\n   * - One fires for any click: `map.on('click', ...`.  It calls `pickFeatures`.\n   * - One fires only for vector features: `this.scene.featureClicked.addEventListener`.\n   *    It calls `featurePicked`, which calls `pickFeatures` and then adds the feature it found, if any.\n   * These events can fire in either order.\n   * Billboards do not fire the first event.\n   *\n   * Note that `pickFeatures` does nothing if `leaflet._pickedFeatures` is already set.\n   * Otherwise, it sets it, runs `runLater` to clear it, and starts the asynchronous raster feature picking.\n   *\n   * So:\n   * If only the first event is received, it triggers the raster-feature picking as desired.\n   * If both are received in the order above, the second adds the vector features to the list of raster features as desired.\n   * If both are received in the reverse order, the vector-feature click kicks off the same behavior as the other click would have;\n   * and when the next click is received, it is ignored - again, as desired.\n   */\n\n  async _featurePicked(entity, event) {\n    this._pickFeatures(event.latlng);\n\n    // Ignore clicks on the feature highlight.\n    if (entity.entityCollection && entity.entityCollection.owner) {\n      const owner = entity.entityCollection.owner;\n      if (owner instanceof terriajs_cesium_Source_DataSources_DataSource__WEBPACK_IMPORTED_MODULE_14__[\"default\"] && owner.name === _GlobeOrMap__WEBPACK_IMPORTED_MODULE_38__[\"default\"]._featureHighlightName) {\n        return;\n      }\n    }\n    const feature = _Feature_Feature__WEBPACK_IMPORTED_MODULE_37__[\"default\"].fromEntityCollectionOrEntity(entity);\n    const catalogItem = feature._catalogItem;\n    if (_ModelMixins_FeatureInfoUrlTemplateMixin__WEBPACK_IMPORTED_MODULE_30__[\"default\"].isMixedInto(catalogItem) && typeof catalogItem.getFeaturesFromPickResult === \"function\" && this.terria.allowFeatureInfoRequests) {\n      var _this$_pickedFeatures;\n      const result = await catalogItem.getFeaturesFromPickResult.bind(catalogItem)(undefined, entity, (((_this$_pickedFeatures = this._pickedFeatures) === null || _this$_pickedFeatures === void 0 ? void 0 : _this$_pickedFeatures.features.length) || 0) < catalogItem.maxRequests);\n      if (result && (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(this._pickedFeatures)) {\n        if (Array.isArray(result)) {\n          this._pickedFeatures.features.push(...result);\n        } else {\n          this._pickedFeatures.features.push(result);\n        }\n      }\n    } else if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(this._pickedFeatures)) {\n      this._pickedFeatures.features.push(feature);\n    }\n    if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(this._pickedFeatures) && (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(feature) && feature.position) {\n      this._pickedFeatures.pickPosition = feature.position._value;\n    }\n  }\n  _pickFeatures(latlng, tileCoordinates, existingFeatures) {\n    let ignoreSplitter = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n    if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(this._pickedFeatures)) {\n      // Picking is already in progress.\n      return;\n    }\n    this._pickedFeatures = new _Map_PickedFeatures_PickedFeatures__WEBPACK_IMPORTED_MODULE_28__[\"default\"]();\n    if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(existingFeatures)) {\n      this._pickedFeatures.features = existingFeatures;\n    }\n\n    // We run this later because vector click events and the map click event can come through in any order, but we can\n    // be reasonably sure that all of them will be processed by the time our runLater func is invoked.\n    const cleanup = (0,_Core_runLater__WEBPACK_IMPORTED_MODULE_20__[\"default\"])(() => {\n      // Set this again just in case a vector pick came through and reset it to the vector's position.\n      const newPickLocation = terriajs_cesium_Source_Core_Ellipsoid__WEBPACK_IMPORTED_MODULE_10__[\"default\"].WGS84.cartographicToCartesian(pickedLocation);\n      (0,mobx__WEBPACK_IMPORTED_MODULE_6__.runInAction)(() => {\n        const mapInteractionModeStack = this.terria.mapInteractionModeStack;\n        if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(mapInteractionModeStack) && mapInteractionModeStack.length > 0) {\n          const pickedFeatures = mapInteractionModeStack[mapInteractionModeStack.length - 1].pickedFeatures;\n          if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(pickedFeatures)) {\n            pickedFeatures.pickPosition = newPickLocation;\n          }\n        } else if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(this.terria.pickedFeatures)) {\n          this.terria.pickedFeatures.pickPosition = newPickLocation;\n        }\n      });\n\n      // Unset this so that the next click will start building features from scratch.\n      this._pickedFeatures = undefined;\n    });\n    const imageryLayers = [];\n    if (this.terria.allowFeatureInfoRequests) {\n      this.map.eachLayer(layer => {\n        if (isImageryLayer(layer)) {\n          imageryLayers.push(layer);\n        }\n      });\n    }\n\n    // we need items sorted in reverse order by their zIndex to get correct ordering of feature info\n    imageryLayers.sort((a, b) => {\n      if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(a.options.zIndex) || !(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(b.options.zIndex)) {\n        return 0;\n      }\n      if (a.options.zIndex < b.options.zIndex) {\n        return 1;\n      }\n      if (a.options.zIndex > b.options.zIndex) {\n        return -1;\n      }\n      return 0;\n    });\n    tileCoordinates = tileCoordinates !== null && tileCoordinates !== void 0 ? tileCoordinates : {};\n    const pickedLocation = terriajs_cesium_Source_Core_Cartographic__WEBPACK_IMPORTED_MODULE_9__[\"default\"].fromDegrees(latlng.lng, latlng.lat);\n    this._pickedFeatures.pickPosition = terriajs_cesium_Source_Core_Ellipsoid__WEBPACK_IMPORTED_MODULE_10__[\"default\"].WGS84.cartographicToCartesian(pickedLocation);\n    const imageryFeaturePromises = imageryLayers.map(async imageryLayer => {\n      var _tileCoordinates$imag, _tileCoordinates;\n      const imageryLayerUrl = imageryLayer.imageryProvider.url;\n      const longRadians = terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_12__[\"default\"].toRadians(latlng.lng);\n      const latRadians = terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_12__[\"default\"].toRadians(latlng.lat);\n      const coords = (_tileCoordinates$imag = (_tileCoordinates = tileCoordinates) === null || _tileCoordinates === void 0 ? void 0 : _tileCoordinates[imageryLayerUrl]) !== null && _tileCoordinates$imag !== void 0 ? _tileCoordinates$imag : await imageryLayer.getFeaturePickingCoords(this.map, longRadians, latRadians);\n      const features = await imageryLayer.pickFeatures(coords.x, coords.y, coords.level, longRadians, latRadians);\n\n      // Make sure ImageryLayerFeatureInfo has imagery layer property\n      features === null || features === void 0 || features.forEach(feature => feature.imageryLayer = imageryLayer);\n      return {\n        features: features,\n        imageryLayer: imageryLayer,\n        coords: coords\n      };\n    });\n    const pickedFeatures = this._pickedFeatures;\n\n    // We want the all available promise to return after the cleanup one to\n    // make sure all vector click events have resolved.\n    pickedFeatures.allFeaturesAvailablePromise = Promise.all([cleanup, Promise.all(imageryFeaturePromises).then(results => {\n      (0,mobx__WEBPACK_IMPORTED_MODULE_6__.runInAction)(() => {\n        pickedFeatures.isLoading = false;\n      });\n      pickedFeatures.providerCoords = {};\n      const filteredResults = results.filter(result => (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(result.features) && result.features.length > 0);\n      pickedFeatures.providerCoords = filteredResults.reduce(function (coordsSoFar, result) {\n        var _result$imageryLayer;\n        const imageryProvider = (_result$imageryLayer = result.imageryLayer) === null || _result$imageryLayer === void 0 ? void 0 : _result$imageryLayer.imageryProvider;\n        if (imageryProvider) coordsSoFar[imageryProvider.url] = result.coords;\n        return coordsSoFar;\n      }, {});\n      const features = filteredResults.reduce((allFeatures, result) => {\n        if (this.terria.showSplitter && ignoreSplitter === false && (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(pickedFeatures.pickPosition)) {\n          // Skip this feature, unless the imagery layer is on the picked side or\n          // belongs to both sides of the splitter\n          const screenPosition = this._computePositionOnScreen(pickedFeatures.pickPosition);\n          const pickedSide = this._getSplitterSideForScreenPosition(screenPosition);\n          const layerDirection = result.imageryLayer.splitDirection;\n          if (!(layerDirection === pickedSide || layerDirection === terriajs_cesium_Source_Scene_SplitDirection__WEBPACK_IMPORTED_MODULE_16__[\"default\"].NONE)) {\n            return allFeatures;\n          }\n        }\n        return allFeatures.concat(result.features.map(feature => {\n          // For features without a position, use the picked location.\n          if (!(0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(feature.position)) {\n            feature.position = pickedLocation;\n          }\n          return this._createFeatureFromImageryLayerFeature(feature);\n        }));\n      }, pickedFeatures.features);\n      (0,mobx__WEBPACK_IMPORTED_MODULE_6__.runInAction)(() => {\n        pickedFeatures.features = features;\n      });\n    }).catch(e => {\n      (0,mobx__WEBPACK_IMPORTED_MODULE_6__.runInAction)(() => {\n        pickedFeatures.isLoading = false;\n        pickedFeatures.error = \"An unknown error occurred while picking features.\";\n      });\n      throw e;\n    })]).then(() => undefined);\n    (0,mobx__WEBPACK_IMPORTED_MODULE_6__.runInAction)(() => {\n      const mapInteractionModeStack = this.terria.mapInteractionModeStack;\n      if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(mapInteractionModeStack) && mapInteractionModeStack.length > 0) {\n        mapInteractionModeStack[mapInteractionModeStack.length - 1].pickedFeatures = this._pickedFeatures;\n      } else {\n        this.terria.pickedFeatures = this._pickedFeatures;\n      }\n    });\n  }\n  _reactToSplitterChanges() {\n    return (0,mobx__WEBPACK_IMPORTED_MODULE_6__.autorun)(() => {\n      const items = this.terria.mainViewer.items.get();\n      const showSplitter = this.terria.showSplitter;\n      const splitPosition = this.terria.splitPosition;\n      items.forEach(item => {\n        if (_ModelMixins_MappableMixin__WEBPACK_IMPORTED_MODULE_31__[\"default\"].isMixedInto(item) && (0,_Definition_hasTraits__WEBPACK_IMPORTED_MODULE_36__[\"default\"])(item, _Traits_TraitsClasses_SplitterTraits__WEBPACK_IMPORTED_MODULE_34__[\"default\"], \"splitDirection\")) {\n          const layers = this.getImageryLayersForItem(item);\n          const splitDirection = item.splitDirection;\n          layers.forEach((0,mobx__WEBPACK_IMPORTED_MODULE_6__.action)(layer => {\n            if (showSplitter) {\n              layer.splitDirection = splitDirection;\n              layer.splitPosition = splitPosition;\n            } else {\n              layer.splitDirection = terriajs_cesium_Source_Scene_SplitDirection__WEBPACK_IMPORTED_MODULE_16__[\"default\"].NONE;\n              layer.splitPosition = splitPosition;\n            }\n          }));\n        }\n      });\n      this.notifyRepaintRequired();\n    });\n  }\n  getImageryLayersForItem(item) {\n    return (0,_Core_filterOutUndefined__WEBPACK_IMPORTED_MODULE_18__[\"default\"])(item.mapItems.map(m => {\n      if (_ModelMixins_MappableMixin__WEBPACK_IMPORTED_MODULE_31__.ImageryParts.is(m)) {\n        const layer = this._makeImageryLayerFromParts(m, item);\n        return layer instanceof _Map_Leaflet_ImageryProviderLeafletTileLayer__WEBPACK_IMPORTED_MODULE_22__[\"default\"] || layer instanceof _Map_Leaflet_ImageryProviderLeafletGridLayer__WEBPACK_IMPORTED_MODULE_21__[\"default\"] ? layer : undefined;\n      }\n    }));\n  }\n\n  /**\n   * Computes the screen position of a given world position.\n   * @param position The world position in Earth-centered Fixed coordinates.\n   * @param [result] The instance to which to copy the result.\n   * @return The screen position, or undefined if the position is not on the screen.\n   */\n  _computePositionOnScreen(position, result) {\n    const cartographicScratch = new terriajs_cesium_Source_Core_Cartographic__WEBPACK_IMPORTED_MODULE_9__[\"default\"]();\n    const cartographic = terriajs_cesium_Source_Core_Ellipsoid__WEBPACK_IMPORTED_MODULE_10__[\"default\"].WGS84.cartesianToCartographic(position, cartographicScratch);\n    const point = this.map.latLngToContainerPoint(_Map_LeafletPatched__WEBPACK_IMPORTED_MODULE_27__[\"default\"].latLng(terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_12__[\"default\"].toDegrees(cartographic.latitude), terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_12__[\"default\"].toDegrees(cartographic.longitude)));\n    if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(result)) {\n      result.x = point.x;\n      result.y = point.y;\n    } else {\n      result = new terriajs_cesium_Source_Core_Cartesian2__WEBPACK_IMPORTED_MODULE_8__[\"default\"](point.x, point.y);\n    }\n    return result;\n  }\n  _selectFeature(feature) {\n    this._highlightFeature(feature);\n    if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(feature) && (0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(feature.position)) {\n      const cartographicScratch = new terriajs_cesium_Source_Core_Cartographic__WEBPACK_IMPORTED_MODULE_9__[\"default\"]();\n      const cartesianPosition = feature.position.getValue(this.terria.timelineClock.currentTime);\n      if (cartesianPosition === undefined) {\n        this._selectionIndicator.animateSelectionIndicatorDepart();\n        return;\n      }\n      const cartographic = terriajs_cesium_Source_Core_Ellipsoid__WEBPACK_IMPORTED_MODULE_10__[\"default\"].WGS84.cartesianToCartographic(cartesianPosition, cartographicScratch);\n      this._selectionIndicator.setLatLng(_Map_LeafletPatched__WEBPACK_IMPORTED_MODULE_27__[\"default\"].latLng([terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_12__[\"default\"].toDegrees(cartographic.latitude), terriajs_cesium_Source_Core_Math__WEBPACK_IMPORTED_MODULE_12__[\"default\"].toDegrees(cartographic.longitude)]));\n      this._selectionIndicator.animateSelectionIndicatorAppear();\n    } else {\n      this._selectionIndicator.animateSelectionIndicatorDepart();\n    }\n  }\n  getClipsForSplitter() {\n    let clipLeft = \"\";\n    let clipRight = \"\";\n    let clipPositionWithinMap = 0;\n    let clipX = 0;\n    if (this.terria.showSplitter) {\n      const map = this.map;\n      const size = map.getSize();\n      const nw = map.containerPointToLayerPoint([0, 0]);\n      const se = map.containerPointToLayerPoint(size);\n      clipPositionWithinMap = size.x * this.terria.splitPosition;\n      clipX = Math.round(nw.x + clipPositionWithinMap);\n      clipLeft = \"rect(\" + [nw.y, clipX, se.y, nw.x].join(\"px,\") + \"px)\";\n      clipRight = \"rect(\" + [nw.y, se.x, se.y, clipX].join(\"px,\") + \"px)\";\n    }\n    return {\n      left: clipLeft,\n      right: clipRight,\n      clipPositionWithinMap: clipPositionWithinMap,\n      clipX: clipX\n    };\n  }\n  isSplitterDragThumb(element) {\n    return element.className && element.className.indexOf && element.className.indexOf(\"tjs-splitter__thumb\") >= 0;\n  }\n  captureScreenshot() {\n    // Temporarily hide the map credits.\n    this._attributionControl.remove();\n    try {\n      // html2canvas can't handle the clip style which is used for the splitter. So if the splitter is active, we render\n      // a left image and a right image and compose them. Also remove the splitter drag thumb.\n      let promise;\n      if (this.terria.showSplitter) {\n        const clips = this.getClipsForSplitter();\n        const clipLeft = clips.left.replace(/ /g, \"\");\n        const clipRight = clips.right.replace(/ /g, \"\");\n        promise = terriajs_html2canvas__WEBPACK_IMPORTED_MODULE_17___default()(this.map.getContainer(), {\n          useCORS: true,\n          ignoreElements: element => element.style.clip !== undefined && element.style.clip !== null && element.style.clip.replace(/ /g, \"\") === clipRight || this.isSplitterDragThumb(element)\n        }).then(leftCanvas => {\n          return terriajs_html2canvas__WEBPACK_IMPORTED_MODULE_17___default()(this.map.getContainer(), {\n            useCORS: true,\n            ignoreElements: element => element.style.clip !== undefined && element.style.clip !== null && element.style.clip.replace(/ /g, \"\") === clipLeft || this.isSplitterDragThumb(element)\n          }).then(rightCanvas => {\n            const combined = document.createElement(\"canvas\");\n            combined.width = leftCanvas.width;\n            combined.height = leftCanvas.height;\n            const context = combined.getContext(\"2d\");\n            if (context === undefined || context === null) {\n              // Error\n              return null;\n            }\n            const split = clips.clipPositionWithinMap * window.devicePixelRatio;\n            context.drawImage(leftCanvas, 0, 0, split, combined.height, 0, 0, split, combined.height);\n            context.drawImage(rightCanvas, split, 0, combined.width - split, combined.height, split, 0, combined.width - split, combined.height);\n            return combined;\n          });\n        });\n      } else {\n        promise = terriajs_html2canvas__WEBPACK_IMPORTED_MODULE_17___default()(this.map.getContainer(), {\n          useCORS: true\n        });\n      }\n      return promise.then(canvas => {\n        return canvas.toDataURL(\"image/png\");\n      }).finally(() => {\n        this._attributionControl.addTo(this.map);\n      });\n    } catch (e) {\n      this._attributionControl.addTo(this.map);\n      return Promise.reject(e);\n    }\n  }\n  _addVectorTileHighlight(imageryProvider, rectangle) {\n    const map = this.map;\n    const options = {\n      opacity: 1,\n      bounds: (0,_Map_Vector_rectangleToLatLngBounds__WEBPACK_IMPORTED_MODULE_29__[\"default\"])(rectangle)\n    };\n    if ((0,_Core_isDefined__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(map.options.maxZoom)) {\n      options.maxZoom = map.options.maxZoom;\n    }\n    const layer = new _Map_Leaflet_ImageryProviderLeafletGridLayer__WEBPACK_IMPORTED_MODULE_21__[\"default\"](this, imageryProvider, options);\n    layer.addTo(map);\n    layer.bringToFront();\n    return function () {\n      map.removeLayer(layer);\n    };\n  }\n}, _descriptor = _applyDecoratedDescriptor(_class.prototype, \"size\", [mobx__WEBPACK_IMPORTED_MODULE_6__.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor2 = _applyDecoratedDescriptor(_class.prototype, \"nw\", [mobx__WEBPACK_IMPORTED_MODULE_6__.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor3 = _applyDecoratedDescriptor(_class.prototype, \"se\", [mobx__WEBPACK_IMPORTED_MODULE_6__.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _applyDecoratedDescriptor(_class.prototype, \"updateMapObservables\", [mobx__WEBPACK_IMPORTED_MODULE_6__.action], Object.getOwnPropertyDescriptor(_class.prototype, \"updateMapObservables\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"attributions\", [mobx__WEBPACK_IMPORTED_MODULE_6__.computed], Object.getOwnPropertyDescriptor(_class.prototype, \"attributions\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"availableCatalogItems\", [mobx__WEBPACK_IMPORTED_MODULE_6__.computed], Object.getOwnPropertyDescriptor(_class.prototype, \"availableCatalogItems\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"availableDataSources\", [mobx__WEBPACK_IMPORTED_MODULE_6__.computed], Object.getOwnPropertyDescriptor(_class.prototype, \"availableDataSources\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"_featurePicked\", [mobx__WEBPACK_IMPORTED_MODULE_6__.action], Object.getOwnPropertyDescriptor(_class.prototype, \"_featurePicked\"), _class.prototype), _class);\n\nfunction isImageryLayer(someLayer) {\n  return \"imageryProvider\" in someLayer;\n}\nfunction isDataSource(object) {\n  return \"entities\" in object;\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTW9kZWxzL0xlYWZsZXQudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUNBO0FBVUE7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFBQTtBQXFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBcUJBO0FBSUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBSUE7QUFDQTtBQUlBO0FBRUE7QUFDQTtBQUFBO0FBcEZBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFLQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUtBO0FBQUE7QUFFQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFNQTtBQUFBO0FBQUE7QUFBQTtBQUtBO0FBQ0E7QUFDQTtBQUZBO0FBQUE7QUFnQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTRCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFTQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUdBO0FBQ0E7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBSUE7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFFQTtBQUlBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVdBO0FBQUE7QUFBQTtBQUlBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFRQTtBQUVBO0FBQ0E7QUFBQTtBQUdBO0FBS0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUlBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFFQTtBQUlBO0FBQ0E7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBRUE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUlBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBRUE7QUFDQTtBQUdBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQVFBOztBQVFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBSUE7QUFHQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUdBO0FBRUE7QUFFQTtBQU1BO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUlBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUdBO0FBRUE7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUlBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBS0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBV0E7QUFXQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUtBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBL2dDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUEyaEJBO0FBb2ZBO0FBR0E7QUFDQTtBQUVBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL3RlcnJpYWpzLW1hcC8uL3BhY2thZ2VzL3RlcnJpYWpzL2xpYi9Nb2RlbHMvTGVhZmxldC50cz9mZDgxIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEdyaWRMYXllciB9IGZyb20gXCJsZWFmbGV0XCI7XG5pbXBvcnQge1xuICBhY3Rpb24sXG4gIGF1dG9ydW4sXG4gIGNvbXB1dGVkLFxuICBJUmVhY3Rpb25EaXNwb3NlcixcbiAgbWFrZU9ic2VydmFibGUsXG4gIG9ic2VydmFibGUsXG4gIHJlYWN0aW9uLFxuICBydW5JbkFjdGlvblxufSBmcm9tIFwibW9ieFwiO1xuaW1wb3J0IHsgY29tcHV0ZWRGbiB9IGZyb20gXCJtb2J4LXV0aWxzXCI7XG5pbXBvcnQgQ2FydGVzaWFuMiBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0NhcnRlc2lhbjJcIjtcbmltcG9ydCBDYXJ0ZXNpYW4zIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvQ2FydGVzaWFuM1wiO1xuaW1wb3J0IENhcnRvZ3JhcGhpYyBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0NhcnRvZ3JhcGhpY1wiO1xuaW1wb3J0IENsb2NrIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvQ2xvY2tcIjtcbmltcG9ydCBFbGxpcHNvaWQgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9FbGxpcHNvaWRcIjtcbmltcG9ydCBFdmVudEhlbHBlciBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0V2ZW50SGVscGVyXCI7XG5pbXBvcnQgQ2VzaXVtTWF0aCBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL01hdGhcIjtcbmltcG9ydCBSZWN0YW5nbGUgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9SZWN0YW5nbGVcIjtcbmltcG9ydCBEYXRhU291cmNlIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0RhdGFTb3VyY2VzL0RhdGFTb3VyY2VcIjtcbmltcG9ydCBEYXRhU291cmNlQ29sbGVjdGlvbiBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9EYXRhU291cmNlcy9EYXRhU291cmNlQ29sbGVjdGlvblwiO1xuaW1wb3J0IEVudGl0eSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9EYXRhU291cmNlcy9FbnRpdHlcIjtcbmltcG9ydCBJbWFnZXJ5UHJvdmlkZXIgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvU2NlbmUvSW1hZ2VyeVByb3ZpZGVyXCI7XG5pbXBvcnQgU3BsaXREaXJlY3Rpb24gZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvU2NlbmUvU3BsaXREaXJlY3Rpb25cIjtcbmltcG9ydCBodG1sMmNhbnZhcyBmcm9tIFwidGVycmlhanMtaHRtbDJjYW52YXNcIjtcbmltcG9ydCBmaWx0ZXJPdXRVbmRlZmluZWQgZnJvbSBcIi4uL0NvcmUvZmlsdGVyT3V0VW5kZWZpbmVkXCI7XG5pbXBvcnQgaXNEZWZpbmVkIGZyb20gXCIuLi9Db3JlL2lzRGVmaW5lZFwiO1xuaW1wb3J0IExhdExvbkhlaWdodCBmcm9tIFwiLi4vQ29yZS9MYXRMb25IZWlnaHRcIjtcbmltcG9ydCBydW5MYXRlciBmcm9tIFwiLi4vQ29yZS9ydW5MYXRlclwiO1xuaW1wb3J0IFByb3RvbWFwc0ltYWdlcnlQcm92aWRlciBmcm9tIFwiLi4vTWFwL0ltYWdlcnlQcm92aWRlci9Qcm90b21hcHNJbWFnZXJ5UHJvdmlkZXJcIjtcbmltcG9ydCBJbWFnZXJ5UHJvdmlkZXJMZWFmbGV0R3JpZExheWVyLCB7XG4gIGlzSW1hZ2VyeVByb3ZpZGVyR3JpZExheWVyIGFzIHN1cHBvcnRzSW1hZ2VyeVByb3ZpZGVyR3JpZExheWVyXG59IGZyb20gXCIuLi9NYXAvTGVhZmxldC9JbWFnZXJ5UHJvdmlkZXJMZWFmbGV0R3JpZExheWVyXCI7XG5pbXBvcnQgSW1hZ2VyeVByb3ZpZGVyTGVhZmxldFRpbGVMYXllciBmcm9tIFwiLi4vTWFwL0xlYWZsZXQvSW1hZ2VyeVByb3ZpZGVyTGVhZmxldFRpbGVMYXllclwiO1xuaW1wb3J0IExlYWZsZXREYXRhU291cmNlRGlzcGxheSBmcm9tIFwiLi4vTWFwL0xlYWZsZXQvTGVhZmxldERhdGFTb3VyY2VEaXNwbGF5XCI7XG5pbXBvcnQgTGVhZmxldFNjZW5lIGZyb20gXCIuLi9NYXAvTGVhZmxldC9MZWFmbGV0U2NlbmVcIjtcbmltcG9ydCBMZWFmbGV0U2VsZWN0aW9uSW5kaWNhdG9yIGZyb20gXCIuLi9NYXAvTGVhZmxldC9MZWFmbGV0U2VsZWN0aW9uSW5kaWNhdG9yXCI7XG5pbXBvcnQgTGVhZmxldFZpc3VhbGl6ZXIgZnJvbSBcIi4uL01hcC9MZWFmbGV0L0xlYWZsZXRWaXN1YWxpemVyXCI7XG5pbXBvcnQgTCBmcm9tIFwiLi4vTWFwL0xlYWZsZXRQYXRjaGVkXCI7XG5pbXBvcnQgUGlja2VkRmVhdHVyZXMsIHtcbiAgUHJvdmlkZXJDb29yZHMsXG4gIFByb3ZpZGVyQ29vcmRzTWFwXG59IGZyb20gXCIuLi9NYXAvUGlja2VkRmVhdHVyZXMvUGlja2VkRmVhdHVyZXNcIjtcbmltcG9ydCByZWN0YW5nbGVUb0xhdExuZ0JvdW5kcyBmcm9tIFwiLi4vTWFwL1ZlY3Rvci9yZWN0YW5nbGVUb0xhdExuZ0JvdW5kc1wiO1xuaW1wb3J0IEZlYXR1cmVJbmZvVXJsVGVtcGxhdGVNaXhpbiBmcm9tIFwiLi4vTW9kZWxNaXhpbnMvRmVhdHVyZUluZm9VcmxUZW1wbGF0ZU1peGluXCI7XG5pbXBvcnQgTWFwcGFibGVNaXhpbiwge1xuICBJbWFnZXJ5UGFydHMsXG4gIE1hcEl0ZW1cbn0gZnJvbSBcIi4uL01vZGVsTWl4aW5zL01hcHBhYmxlTWl4aW5cIjtcbmltcG9ydCBUaWxlRXJyb3JIYW5kbGVyTWl4aW4gZnJvbSBcIi4uL01vZGVsTWl4aW5zL1RpbGVFcnJvckhhbmRsZXJNaXhpblwiO1xuaW1wb3J0IEltYWdlcnlQcm92aWRlclRyYWl0cyBmcm9tIFwiLi4vVHJhaXRzL1RyYWl0c0NsYXNzZXMvSW1hZ2VyeVByb3ZpZGVyVHJhaXRzXCI7XG5pbXBvcnQgU3BsaXR0ZXJUcmFpdHMgZnJvbSBcIi4uL1RyYWl0cy9UcmFpdHNDbGFzc2VzL1NwbGl0dGVyVHJhaXRzXCI7XG5pbXBvcnQgVGVycmlhVmlld2VyIGZyb20gXCIuLi9WaWV3TW9kZWxzL1RlcnJpYVZpZXdlclwiO1xuaW1wb3J0IENhbWVyYVZpZXcgZnJvbSBcIi4vQ2FtZXJhVmlld1wiO1xuaW1wb3J0IGhhc1RyYWl0cyBmcm9tIFwiLi9EZWZpbml0aW9uL2hhc1RyYWl0c1wiO1xuaW1wb3J0IFRlcnJpYUZlYXR1cmUgZnJvbSBcIi4vRmVhdHVyZS9GZWF0dXJlXCI7XG5pbXBvcnQgR2xvYmVPck1hcCBmcm9tIFwiLi9HbG9iZU9yTWFwXCI7XG5pbXBvcnQgeyBMZWFmbGV0QXR0cmlidXRpb24gfSBmcm9tIFwiLi9MZWFmbGV0QXR0cmlidXRpb25cIjtcbmltcG9ydCBUZXJyaWEgZnJvbSBcIi4vVGVycmlhXCI7XG5cbi8vIFRoaXMgY2xhc3MgaXMgYW4gb2JzZXJ2ZXIuIEl0IHByb2JhYmx5IHdvbid0IGNvbnRhaW4gYW55IG9ic2VydmFibGVzIGl0c2VsZlxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBMZWFmbGV0IGV4dGVuZHMgR2xvYmVPck1hcCB7XG4gIHJlYWRvbmx5IHR5cGUgPSBcIkxlYWZsZXRcIjtcbiAgcmVhZG9ubHkgdGVycmlhOiBUZXJyaWE7XG4gIHJlYWRvbmx5IHRlcnJpYVZpZXdlcjogVGVycmlhVmlld2VyO1xuICByZWFkb25seSBtYXA6IEwuTWFwO1xuICByZWFkb25seSBzY2VuZTogTGVhZmxldFNjZW5lO1xuICByZWFkb25seSBkYXRhU291cmNlczogRGF0YVNvdXJjZUNvbGxlY3Rpb24gPSBuZXcgRGF0YVNvdXJjZUNvbGxlY3Rpb24oKTtcbiAgcmVhZG9ubHkgZGF0YVNvdXJjZURpc3BsYXk6IExlYWZsZXREYXRhU291cmNlRGlzcGxheTtcbiAgcmVhZG9ubHkgY2FuU2hvd1NwbGl0dGVyID0gdHJ1ZTtcbiAgcHJpdmF0ZSByZWFkb25seSBfYXR0cmlidXRpb25Db250cm9sOiBMZWFmbGV0QXR0cmlidXRpb247XG4gIHByaXZhdGUgcmVhZG9ubHkgX2xlYWZsZXRWaXN1YWxpemVyOiBMZWFmbGV0VmlzdWFsaXplcjtcbiAgcHJpdmF0ZSByZWFkb25seSBfZXZlbnRIZWxwZXI6IEV2ZW50SGVscGVyO1xuICBwcml2YXRlIHJlYWRvbmx5IF9zZWxlY3Rpb25JbmRpY2F0b3I6IExlYWZsZXRTZWxlY3Rpb25JbmRpY2F0b3I7XG4gIHByaXZhdGUgX3N0b3BSZXF1ZXN0QW5pbWF0aW9uRnJhbWU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBfY2VzaXVtUmVxQW5pbUZyYW1lSWQ6IG51bWJlciB8IHVuZGVmaW5lZDtcbiAgcHJpdmF0ZSBfcGlja2VkRmVhdHVyZXM6IFBpY2tlZEZlYXR1cmVzIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkO1xuICBwcml2YXRlIF9wYXVzZU1hcEludGVyYWN0aW9uQ291bnQgPSAwO1xuXG4gIC8qIERpc3Bvc2VycyAqL1xuICBwcml2YXRlIHJlYWRvbmx5IF9kaXNwb3NlV29ya2JlbmNoTWFwSXRlbXNTdWJzY3JpcHRpb246ICgpID0+IHZvaWQ7XG4gIHByaXZhdGUgcmVhZG9ubHkgX2Rpc3Bvc2VEaXNhYmxlSW50ZXJhY3Rpb25TdWJzY3JpcHRpb246ICgpID0+IHZvaWQ7XG4gIHByaXZhdGUgX2Rpc3Bvc2VTZWxlY3RlZEZlYXR1cmVTdWJzY3JpcHRpb24/OiAoKSA9PiB2b2lkO1xuICBwcml2YXRlIF9kaXNwb3NlU3BsaXR0ZXJSZWFjdGlvbjogKCkgPT4gdm9pZDtcblxuICAvLyBUaGVzZSBhcmUgdXNlZCB0byBzcGxpdCBDZXNpdW1UaWxlTGF5ZXIgYW5kIE1hcGJveENhbnZhc1ZlY3RvclRpbGVMYXllclxuICBAb2JzZXJ2YWJsZSBzaXplOiBMLlBvaW50IHwgdW5kZWZpbmVkO1xuICBAb2JzZXJ2YWJsZSBudzogTC5Qb2ludCB8IHVuZGVmaW5lZDtcbiAgQG9ic2VydmFibGUgc2U6IEwuUG9pbnQgfCB1bmRlZmluZWQ7XG5cbiAgLyoqXG4gICAqIEluaXRpYWwgdmlldyBzZXQgd2hlbiB0aGUgdmlld2VyIGlzIGNyZWF0ZWRcbiAgICovXG4gIHByaXZhdGUgX2luaXRpYWxWaWV3OiBDYW1lcmFWaWV3IHwgdW5kZWZpbmVkO1xuXG4gIEBhY3Rpb25cbiAgcHJpdmF0ZSB1cGRhdGVNYXBPYnNlcnZhYmxlcygpIHtcbiAgICB0aGlzLnNpemUgPSB0aGlzLm1hcC5nZXRTaXplKCk7XG4gICAgdGhpcy5udyA9IHRoaXMubWFwLmNvbnRhaW5lclBvaW50VG9MYXllclBvaW50KFswLCAwXSk7XG4gICAgdGhpcy5zZSA9IHRoaXMubWFwLmNvbnRhaW5lclBvaW50VG9MYXllclBvaW50KHRoaXMuc2l6ZSk7XG4gIH1cblxuICBwcml2YXRlIF9jcmVhdGVJbWFnZXJ5TGF5ZXI6IChcbiAgICBpcDogSW1hZ2VyeVByb3ZpZGVyLFxuICAgIGNsaXBwaW5nUmVjdGFuZ2xlOiBSZWN0YW5nbGUgfCB1bmRlZmluZWRcbiAgKSA9PiBHcmlkTGF5ZXIgPSBjb21wdXRlZEZuKChpcCwgY2xpcHBpbmdSZWN0YW5nbGUpID0+IHtcbiAgICBjb25zdCBsYXllck9wdGlvbnMgPSB7XG4gICAgICBtYXhab29tOiB0aGlzLnRlcnJpYS5jb25maWdQYXJhbWV0ZXJzLmxlYWZsZXRNYXhab29tLFxuICAgICAgYm91bmRzOiBjbGlwcGluZ1JlY3RhbmdsZSAmJiByZWN0YW5nbGVUb0xhdExuZ0JvdW5kcyhjbGlwcGluZ1JlY3RhbmdsZSlcbiAgICB9O1xuICAgIC8vIFdlIGhhdmUgdHdvIGRpZmZlcmVudCBraW5kcyBvZiBJbWFnZXJ5UHJvdmlkZXJMZWFmbGV0IGxheWVyc1xuICAgIC8vIC0gR3JpZCBsYXllciB3aWxsIHVzZSB0aGUgSW1hZ2VyeVByb3ZpZGVyIGluIHRoZSBtb3JlIHRyYWRpdGlvbmFsIHdheSAtIGNhbGxpbmcgYHJlcXVlc3RJbWFnZWAgdG8gZHJhdyB0aGUgaW1hZ2Ugb24gdG8gYSBjYW52YXNcbiAgICAvLyAtIFRpbGUgbGF5ZXIgd2lsbCBwYXNzIHRpbGUgVVJMcyB0byBsZWFmbGV0IG9iamVjdHMgLSB3aGljaCBpcyBhIGJpdCBtb3JlIFwiTGVhZmxldHlcIiB0aGFuIEdyaWQgbGF5ZXJcbiAgICAvLyBUaWxlIGxheWVyIGlzIHByZWZlcnJlZC4gR3JpZCBsYXllciBtYWlubHkgZXhpc3RzIGZvciBjdXN0b20gSW1hZ2VyeSBQcm92aWRlcnMgd2hpY2ggYXJlbid0IGp1c3QgYSB0aWxlIG9mIGltYWdlIFVSTHNcbiAgICBpZiAoc3VwcG9ydHNJbWFnZXJ5UHJvdmlkZXJHcmlkTGF5ZXIoaXApKSB7XG4gICAgICByZXR1cm4gbmV3IEltYWdlcnlQcm92aWRlckxlYWZsZXRHcmlkTGF5ZXIodGhpcywgaXAsIGxheWVyT3B0aW9ucyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBuZXcgSW1hZ2VyeVByb3ZpZGVyTGVhZmxldFRpbGVMYXllcih0aGlzLCBpcCwgbGF5ZXJPcHRpb25zKTtcbiAgICB9XG4gIH0pO1xuXG4gIHByaXZhdGUgX21ha2VJbWFnZXJ5TGF5ZXJGcm9tUGFydHMoXG4gICAgcGFydHM6IEltYWdlcnlQYXJ0cyxcbiAgICBpdGVtOiBNYXBwYWJsZU1peGluLkluc3RhbmNlXG4gICkge1xuICAgIGlmIChwYXJ0cy5pbWFnZXJ5UHJvdmlkZXIgPT09IHVuZGVmaW5lZCkgcmV0dXJuIHVuZGVmaW5lZDtcblxuICAgIGlmIChUaWxlRXJyb3JIYW5kbGVyTWl4aW4uaXNNaXhlZEludG8oaXRlbSkpIHtcbiAgICAgIC8vIGJlY2F1c2UgdGhpcyBjb2RlIHBhdGggY2FuIHJ1biBtdWx0aXBsZSB0aW1lcywgbWFrZSBzdXJlIHdlIHJlbW92ZSB0aGVcbiAgICAgIC8vIGhhbmRsZXIgaWYgaXQgaXMgYWxyZWFkeSByZWdpc3RlcmVkXG4gICAgICBwYXJ0cy5pbWFnZXJ5UHJvdmlkZXIuZXJyb3JFdmVudC5yZW1vdmVFdmVudExpc3RlbmVyKFxuICAgICAgICBpdGVtLm9uVGlsZUxvYWRFcnJvcixcbiAgICAgICAgaXRlbVxuICAgICAgKTtcbiAgICAgIHBhcnRzLmltYWdlcnlQcm92aWRlci5lcnJvckV2ZW50LmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICAgIGl0ZW0ub25UaWxlTG9hZEVycm9yLFxuICAgICAgICBpdGVtXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fY3JlYXRlSW1hZ2VyeUxheWVyKFxuICAgICAgcGFydHMuaW1hZ2VyeVByb3ZpZGVyLFxuICAgICAgcGFydHMuY2xpcHBpbmdSZWN0YW5nbGVcbiAgICApO1xuICB9XG5cbiAgY29uc3RydWN0b3IodGVycmlhVmlld2VyOiBUZXJyaWFWaWV3ZXIsIGNvbnRhaW5lcjogc3RyaW5nIHwgSFRNTEVsZW1lbnQpIHtcbiAgICBzdXBlcigpO1xuICAgIG1ha2VPYnNlcnZhYmxlKHRoaXMpO1xuICAgIHRoaXMudGVycmlhID0gdGVycmlhVmlld2VyLnRlcnJpYTtcbiAgICB0aGlzLnRlcnJpYVZpZXdlciA9IHRlcnJpYVZpZXdlcjtcbiAgICB0aGlzLm1hcCA9IEwubWFwKGNvbnRhaW5lciwge1xuICAgICAgem9vbUNvbnRyb2w6IGZhbHNlLFxuICAgICAgYXR0cmlidXRpb25Db250cm9sOiBmYWxzZSxcbiAgICAgIHpvb21TbmFwOiAxLCAvLyBDaGFuZ2UgdG8gIDAuMiBmb3IgaW5jcmVtZW50YWwgem9vbSB3aGVuIENocm9tZSBmaXhlcyBjYW52YXMgc2NhbGluZyBnYXBzXG4gICAgICBwcmVmZXJDYW52YXM6IHRydWUsXG4gICAgICB3b3JsZENvcHlKdW1wOiBmYWxzZVxuICAgIH0pLnNldFZpZXcoWy0yOC41LCAxMzVdLCA1KTtcblxuICAgIHRoaXMubWFwLm9uKFwibW92ZVwiLCAoKSA9PiB0aGlzLnVwZGF0ZU1hcE9ic2VydmFibGVzKCkpO1xuICAgIHRoaXMubWFwLm9uKFwiem9vbVwiLCAoKSA9PiB0aGlzLnVwZGF0ZU1hcE9ic2VydmFibGVzKCkpO1xuXG4gICAgdGhpcy5zY2VuZSA9IG5ldyBMZWFmbGV0U2NlbmUodGhpcy5tYXApO1xuXG4gICAgdGhpcy5fYXR0cmlidXRpb25Db250cm9sID0gbmV3IExlYWZsZXRBdHRyaWJ1dGlvbih0aGlzLnRlcnJpYSk7XG4gICAgdGhpcy5tYXAuYWRkQ29udHJvbCh0aGlzLl9hdHRyaWJ1dGlvbkNvbnRyb2wpO1xuXG4gICAgdGhpcy5fbGVhZmxldFZpc3VhbGl6ZXIgPSBuZXcgTGVhZmxldFZpc3VhbGl6ZXIoKTtcbiAgICB0aGlzLl9zZWxlY3Rpb25JbmRpY2F0b3IgPSBuZXcgTGVhZmxldFNlbGVjdGlvbkluZGljYXRvcih0aGlzKTtcblxuICAgIHRoaXMuZGF0YVNvdXJjZURpc3BsYXkgPSBuZXcgTGVhZmxldERhdGFTb3VyY2VEaXNwbGF5KHtcbiAgICAgIHNjZW5lOiB0aGlzLnNjZW5lLFxuICAgICAgZGF0YVNvdXJjZUNvbGxlY3Rpb246IHRoaXMuZGF0YVNvdXJjZXMsXG4gICAgICB2aXN1YWxpemVyc0NhbGxiYWNrOiB0aGlzLl9sZWFmbGV0VmlzdWFsaXplci52aXN1YWxpemVyc0NhbGxiYWNrXG4gICAgfSk7XG5cbiAgICB0aGlzLl9ldmVudEhlbHBlciA9IG5ldyBFdmVudEhlbHBlcigpO1xuXG4gICAgdGhpcy5fZXZlbnRIZWxwZXIuYWRkKHRoaXMudGVycmlhLnRpbWVsaW5lQ2xvY2sub25UaWNrLCAoKGNsb2NrOiBDbG9jaykgPT4ge1xuICAgICAgdGhpcy5kYXRhU291cmNlRGlzcGxheS51cGRhdGUoY2xvY2suY3VycmVudFRpbWUpO1xuICAgIH0pIGFzIGFueSk7XG5cbiAgICBjb25zdCB0aWNrZXIgPSAoKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuX3N0b3BSZXF1ZXN0QW5pbWF0aW9uRnJhbWUpIHtcbiAgICAgICAgdGhpcy50ZXJyaWEudGltZWxpbmVDbG9jay50aWNrKCk7XG4gICAgICAgIHRoaXMuX2Nlc2l1bVJlcUFuaW1GcmFtZUlkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRpY2tlcik7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8vIFN0YXJ0IHRpY2tlciBhc3luY2hyb25vdXNseSB0byBhdm9pZCBjYWxsaW5nIGFuIGFjdGlvbiBpbiB0aGUgY29uc2N0cnVjdG9yXG4gICAgcnVuTGF0ZXIodGlja2VyKTtcblxuICAgIHRoaXMuX2Rpc3Bvc2VXb3JrYmVuY2hNYXBJdGVtc1N1YnNjcmlwdGlvbiA9IHRoaXMub2JzZXJ2ZU1vZGVsTGF5ZXIoKTtcbiAgICB0aGlzLl9kaXNwb3NlU3BsaXR0ZXJSZWFjdGlvbiA9IHRoaXMuX3JlYWN0VG9TcGxpdHRlckNoYW5nZXMoKTtcblxuICAgIHRoaXMuX2Rpc3Bvc2VEaXNhYmxlSW50ZXJhY3Rpb25TdWJzY3JpcHRpb24gPSBhdXRvcnVuKCgpID0+IHtcbiAgICAgIGNvbnN0IG1hcCA9IHRoaXMubWFwO1xuICAgICAgY29uc3QgaW50ZXJhY3Rpb25zID0gZmlsdGVyT3V0VW5kZWZpbmVkKFtcbiAgICAgICAgbWFwLnRvdWNoWm9vbSxcbiAgICAgICAgbWFwLmRvdWJsZUNsaWNrWm9vbSxcbiAgICAgICAgbWFwLnNjcm9sbFdoZWVsWm9vbSxcbiAgICAgICAgbWFwLmJveFpvb20sXG4gICAgICAgIG1hcC5rZXlib2FyZCxcbiAgICAgICAgbWFwLmRyYWdnaW5nLFxuICAgICAgICBtYXAudGFwSG9sZFxuICAgICAgXSk7XG4gICAgICBjb25zdCBwaWNrTG9jYXRpb24gPSB0aGlzLnBpY2tMb2NhdGlvbi5iaW5kKHRoaXMpO1xuICAgICAgY29uc3QgcGlja0ZlYXR1cmUgPSAoZW50aXR5OiBFbnRpdHksIGV2ZW50OiBMLkxlYWZsZXRNb3VzZUV2ZW50KSA9PiB7XG4gICAgICAgIHRoaXMuX2ZlYXR1cmVQaWNrZWQoZW50aXR5LCBldmVudCk7XG4gICAgICB9O1xuXG4gICAgICAvLyBVcGRhdGUgbW91c2UgY29vcmRzIG9uIG1vdXNlIG1vdmVcbiAgICAgIHRoaXMubWFwLm9uKFwibW91c2Vtb3ZlXCIsIChlOiBMLkxlYWZsZXRFdmVudCkgPT4ge1xuICAgICAgICBjb25zdCBtb3VzZUV2ZW50ID0gZSBhcyBMLkxlYWZsZXRNb3VzZUV2ZW50O1xuICAgICAgICB0aGlzLm1vdXNlQ29vcmRzLnVwZGF0ZUNvb3JkaW5hdGVzRnJvbUxlYWZsZXQoXG4gICAgICAgICAgdGhpcy50ZXJyaWEsXG4gICAgICAgICAgbW91c2VFdmVudC5vcmlnaW5hbEV2ZW50XG4gICAgICAgICk7XG4gICAgICB9KTtcblxuICAgICAgaWYgKHRoaXMudGVycmlhVmlld2VyLmRpc2FibGVJbnRlcmFjdGlvbikge1xuICAgICAgICBpbnRlcmFjdGlvbnMuZm9yRWFjaCgoaGFuZGxlcikgPT4gaGFuZGxlci5kaXNhYmxlKCkpO1xuICAgICAgICB0aGlzLm1hcC5vZmYoXCJjbGlja1wiLCBwaWNrTG9jYXRpb24pO1xuICAgICAgICB0aGlzLnNjZW5lLmZlYXR1cmVDbGlja2VkLnJlbW92ZUV2ZW50TGlzdGVuZXIocGlja0ZlYXR1cmUpO1xuICAgICAgICBpZiAodGhpcy5fZGlzcG9zZVNlbGVjdGVkRmVhdHVyZVN1YnNjcmlwdGlvbikge1xuICAgICAgICAgIHRoaXMuX2Rpc3Bvc2VTZWxlY3RlZEZlYXR1cmVTdWJzY3JpcHRpb24oKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaW50ZXJhY3Rpb25zLmZvckVhY2goKGhhbmRsZXIpID0+IGhhbmRsZXIuZW5hYmxlKCkpO1xuICAgICAgICB0aGlzLm1hcC5vbihcImNsaWNrXCIsIHBpY2tMb2NhdGlvbik7XG4gICAgICAgIHRoaXMuc2NlbmUuZmVhdHVyZUNsaWNrZWQuYWRkRXZlbnRMaXN0ZW5lcihwaWNrRmVhdHVyZSk7XG4gICAgICAgIHRoaXMuX2Rpc3Bvc2VTZWxlY3RlZEZlYXR1cmVTdWJzY3JpcHRpb24gPSBhdXRvcnVuKCgpID0+IHtcbiAgICAgICAgICBjb25zdCBmZWF0dXJlID0gdGhpcy50ZXJyaWEuc2VsZWN0ZWRGZWF0dXJlO1xuICAgICAgICAgIHRoaXMuX3NlbGVjdEZlYXR1cmUoZmVhdHVyZSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5faW5pdFByb2dyZXNzRXZlbnQoKTtcbiAgfVxuXG4gIGdldCBhdHRyaWJ1dGlvblByZWZpeCgpIHtcbiAgICByZXR1cm4gdGhpcy5fYXR0cmlidXRpb25Db250cm9sLnByZWZpeDtcbiAgfVxuXG4gIEBjb21wdXRlZFxuICBnZXQgYXR0cmlidXRpb25zKCkge1xuICAgIHJldHVybiB0aGlzLl9hdHRyaWJ1dGlvbkNvbnRyb2wuZGF0YUF0dHJpYnV0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBzZXRzIHVwIGxvYWRpbmcgbGlzdGVuZXJzXG4gICAqL1xuICBwcml2YXRlIF9pbml0UHJvZ3Jlc3NFdmVudCgpIHtcbiAgICBjb25zdCBvblRpbGVMb2FkQ2hhbmdlID0gKCkgPT4ge1xuICAgICAgbGV0IHRpbGVzTG9hZGluZ0NvdW50ID0gMDtcblxuICAgICAgdGhpcy5tYXAuZWFjaExheWVyKGZ1bmN0aW9uIChsYXllck9yR3JpZGxheWVyKSB7XG4gICAgICAgIC8vIF90aWxlcyBpcyBwcm90ZWN0ZWQgYnV0IG91ciBrbm9ja291dC1sb2FkaW5nLWxvZ2ljIGFjY2Vzc2VzIGl0IGhlcmUgYW55d2F5XG4gICAgICAgIGNvbnN0IGxheWVyID0gbGF5ZXJPckdyaWRsYXllciBhcyBhbnk7XG4gICAgICAgIGlmIChsYXllcj8uX3RpbGVzKSB7XG4gICAgICAgICAgLy8gQ291bnQgYWxsIHRpbGVzIG5vdCBtYXJrZWQgYXMgbG9hZGVkXG4gICAgICAgICAgdGlsZXNMb2FkaW5nQ291bnQgKz0gT2JqZWN0LmtleXMobGF5ZXIuX3RpbGVzKS5maWx0ZXIoXG4gICAgICAgICAgICAoa2V5KSA9PiAhbGF5ZXIuX3RpbGVzW2tleV0ubG9hZGVkXG4gICAgICAgICAgKS5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLl91cGRhdGVUaWxlc0xvYWRpbmdDb3VudCh0aWxlc0xvYWRpbmdDb3VudCk7XG4gICAgfTtcblxuICAgIHRoaXMubWFwLm9uKFxuICAgICAgXCJsYXllcmFkZFwiLFxuICAgICAgZnVuY3Rpb24gKGV2dDogYW55KSB7XG4gICAgICAgIC8vIFRoaXMgY2hlY2sgbWFrZXMgc3VyZSB3ZSBvbmx5IHdhdGNoIHRpbGUgbGF5ZXJzLCBhbmQgYWxzbyBwcm90ZWN0cyB1cyBpZiB0aGlzIHByaXZhdGUgdmFyaWFibGUgZ2V0cyBjaGFuZ2VkLlxuICAgICAgICBpZiAodHlwZW9mIGV2dC5sYXllci5fdGlsZXMgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICBldnQubGF5ZXIub24oXCJ0aWxlbG9hZHN0YXJ0IHRpbGVsb2FkIGxvYWRcIiwgb25UaWxlTG9hZENoYW5nZSk7XG4gICAgICAgIH1cbiAgICAgIH0uYmluZCh0aGlzKVxuICAgICk7XG5cbiAgICB0aGlzLm1hcC5vbihcbiAgICAgIFwibGF5ZXJyZW1vdmVcIixcbiAgICAgIGZ1bmN0aW9uIChldnQ6IGFueSkge1xuICAgICAgICBldnQubGF5ZXIub2ZmKFwidGlsZWxvYWRzdGFydCB0aWxlbG9hZCBsb2FkXCIsIG9uVGlsZUxvYWRDaGFuZ2UpO1xuICAgICAgfS5iaW5kKHRoaXMpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQaWNrIGZlYXR1cmUgZnJvbSBtb3VzZSBjbGljayBldmVudC5cbiAgICovXG4gIHByaXZhdGUgcGlja0xvY2F0aW9uKGU6IEwuTGVhZmxldEV2ZW50KSB7XG4gICAgY29uc3QgbW91c2VFdmVudCA9IGUgYXMgTC5MZWFmbGV0TW91c2VFdmVudDtcblxuICAgIC8vIEhhbmRsZSBjbGljayBldmVudHMgdGhhdCBjcm9zcyB0aGUgYW50aS1tZXJpZGlhblxuICAgIGlmIChtb3VzZUV2ZW50LmxhdGxuZy5sbmcgPiAxODAgfHwgbW91c2VFdmVudC5sYXRsbmcubG5nIDwgLTE4MCkge1xuICAgICAgbW91c2VFdmVudC5sYXRsbmcgPSBtb3VzZUV2ZW50LmxhdGxuZy53cmFwKCk7XG4gICAgfVxuXG4gICAgLy8gaWYgKCF0aGlzLl9kcmFnYm94Y29tcGxldGVkICYmIHRoYXQubWFwLmRyYWdnaW5nLmVuYWJsZWQoKSkge1xuICAgIHRoaXMuX3BpY2tGZWF0dXJlcyhtb3VzZUV2ZW50LmxhdGxuZyk7XG4gICAgLy8gfVxuICAgIC8vIHRoaXMuX2RyYWdib3hjb21wbGV0ZWQgPSBmYWxzZTtcbiAgfVxuXG4gIGdldENvbnRhaW5lcigpOiBIVE1MRWxlbWVudCB7XG4gICAgcmV0dXJuIHRoaXMubWFwLmdldENvbnRhaW5lcigpO1xuICB9XG5cbiAgcGF1c2VNYXBJbnRlcmFjdGlvbigpOiB2b2lkIHtcbiAgICArK3RoaXMuX3BhdXNlTWFwSW50ZXJhY3Rpb25Db3VudDtcbiAgICBpZiAodGhpcy5fcGF1c2VNYXBJbnRlcmFjdGlvbkNvdW50ID09PSAxKSB7XG4gICAgICB0aGlzLm1hcC5kcmFnZ2luZy5kaXNhYmxlKCk7XG4gICAgfVxuICB9XG5cbiAgcmVzdW1lTWFwSW50ZXJhY3Rpb24oKTogdm9pZCB7XG4gICAgLS10aGlzLl9wYXVzZU1hcEludGVyYWN0aW9uQ291bnQ7XG4gICAgaWYgKHRoaXMuX3BhdXNlTWFwSW50ZXJhY3Rpb25Db3VudCA9PT0gMCkge1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLl9wYXVzZU1hcEludGVyYWN0aW9uQ291bnQgPT09IDApIHtcbiAgICAgICAgICB0aGlzLm1hcC5kcmFnZ2luZy5lbmFibGUoKTtcbiAgICAgICAgfVxuICAgICAgfSwgMCk7XG4gICAgfVxuICB9XG5cbiAgZGVzdHJveSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5fZGlzcG9zZVNlbGVjdGVkRmVhdHVyZVN1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy5fZGlzcG9zZVNlbGVjdGVkRmVhdHVyZVN1YnNjcmlwdGlvbigpO1xuICAgIH1cbiAgICB0aGlzLl9kaXNwb3NlU3BsaXR0ZXJSZWFjdGlvbigpO1xuICAgIHRoaXMuX2Rpc3Bvc2VXb3JrYmVuY2hNYXBJdGVtc1N1YnNjcmlwdGlvbigpO1xuICAgIHRoaXMuX2V2ZW50SGVscGVyLnJlbW92ZUFsbCgpO1xuICAgIHRoaXMuX2Rpc3Bvc2VEaXNhYmxlSW50ZXJhY3Rpb25TdWJzY3JpcHRpb24oKTtcbiAgICAvLyBUaGlzIHZhcmlhYmxlIHByZXZlbnRzIGEgcmFjZSBjb25kaXRpb24gaWYgZGVzdHJveSgpIGlzIGNhbGxlZFxuICAgIC8vIHN5bmNocm9ub3VzbHkgYXMgYSByZXN1bHQgb2YgdGltZWxpbmVDbG9jayB0aWNraW5nIGR1ZSB0byB0aWNrZXIoKVxuICAgIHRoaXMuX3N0b3BSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSB0cnVlO1xuICAgIGlmIChpc0RlZmluZWQodGhpcy5fY2VzaXVtUmVxQW5pbUZyYW1lSWQpKSB7XG4gICAgICBjYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLl9jZXNpdW1SZXFBbmltRnJhbWVJZCk7XG4gICAgfVxuICAgIHRoaXMuZGF0YVNvdXJjZURpc3BsYXkuZGVzdHJveSgpO1xuICAgIHRoaXMubWFwLm9mZihcIm1vdmVcIik7XG4gICAgdGhpcy5tYXAub2ZmKFwiem9vbVwiKTtcbiAgICB0aGlzLm1hcC5vZmYoXCJ6b29tbGV2ZWxzY2hhbmdlXCIpO1xuICAgIHRoaXMubWFwLnJlbW92ZSgpO1xuICB9XG5cbiAgQGNvbXB1dGVkXG4gIGdldCBhdmFpbGFibGVDYXRhbG9nSXRlbXMoKSB7XG4gICAgY29uc3QgY2F0YWxvZ0l0ZW1zID0gW1xuICAgICAgLi4udGhpcy50ZXJyaWFWaWV3ZXIuaXRlbXMuZ2V0KCksXG4gICAgICB0aGlzLnRlcnJpYVZpZXdlci5iYXNlTWFwXG4gICAgXTtcbiAgICByZXR1cm4gY2F0YWxvZ0l0ZW1zO1xuICB9XG5cbiAgQGNvbXB1dGVkXG4gIGdldCBhdmFpbGFibGVEYXRhU291cmNlcygpIHtcbiAgICBjb25zdCBjYXRhbG9nSXRlbXMgPSB0aGlzLmF2YWlsYWJsZUNhdGFsb2dJdGVtcztcbiAgICAvKiBIYW5kbGUgZGF0YXNvdXJjZXMgKi9cbiAgICBjb25zdCBhbGxNYXBJdGVtcyA9IChbXSBhcyBNYXBJdGVtW10pLmNvbmNhdChcbiAgICAgIC4uLmNhdGFsb2dJdGVtcy5maWx0ZXIoaXNEZWZpbmVkKS5tYXAoKGl0ZW0pID0+IGl0ZW0ubWFwSXRlbXMpXG4gICAgKTtcbiAgICBjb25zdCBkYXRhU291cmNlcyA9IGFsbE1hcEl0ZW1zLmZpbHRlcihpc0RhdGFTb3VyY2UpO1xuICAgIHJldHVybiBkYXRhU291cmNlcztcbiAgfVxuXG4gIHByaXZhdGUgb2JzZXJ2ZU1vZGVsTGF5ZXIoKSB7XG4gICAgLy8gU2V0dXAgcmVhY3Rpb24gdG8gc3luYyBkYXRTb3VyY2VzIGNvbGxlY3Rpb24gd2l0aCBhdmFpbGFibGVEYXRhU291cmNlc1xuICAgIC8vXG4gICAgLy8gVG8gYXZvaWQgYnVnZ3kgY29uY3VycmVudCBzeW5jcywgd2UgaGF2ZSB0byBlbnN1cmUgdGhhdCBldmVuIHdoZW5cbiAgICAvLyBtdWx0aXBsZSBzeW5jIHJlYWN0aW9ucyBhcmUgdHJpZ2dlcmVkLCB3ZSBydW4gdGhlbSBvbmUgYWZ0ZXIgdGhlXG4gICAgLy8gb3RoZXIuIFRvIGRvIHRoaXMsIHdlIG1ha2UgZWFjaCBydW4gb2YgdGhlIHJlYWN0aW9uIHdhaXQgZm9yIHRoZVxuICAgIC8vIHByZXZpb3VzIGBzeW5jRGF0YVNvdXJjZXNQcm9taXNlYCB0byBmaW5pc2ggYmVmb3JlIHN0YXJ0aW5nIGl0c2VsZi5cbiAgICBsZXQgc3luY0RhdGFTb3VyY2VzUHJvbWlzZTogUHJvbWlzZTx2b2lkPiA9IFByb21pc2UucmVzb2x2ZSgpO1xuICAgIGNvbnN0IGRhdGFTb3VyY2VzUmVhY3Rpb25EaXNwb3NlciA9IHJlYWN0aW9uKFxuICAgICAgKCkgPT4gdGhpcy5hdmFpbGFibGVEYXRhU291cmNlcyxcbiAgICAgICgpID0+IHtcbiAgICAgICAgc3luY0RhdGFTb3VyY2VzUHJvbWlzZSA9IHN5bmNEYXRhU291cmNlc1Byb21pc2VcbiAgICAgICAgICAudGhlbihhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnN5bmNEYXRhU291cmNlQ29sbGVjdGlvbihcbiAgICAgICAgICAgICAgdGhpcy5hdmFpbGFibGVEYXRhU291cmNlcyxcbiAgICAgICAgICAgICAgdGhpcy5kYXRhU291cmNlc1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHRoaXMubm90aWZ5UmVwYWludFJlcXVpcmVkKCk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7XG4gICAgICB9LFxuICAgICAgeyBmaXJlSW1tZWRpYXRlbHk6IHRydWUgfVxuICAgICk7XG5cbiAgICAvLyBSZWFjdGlvbiB0byBzeW5jIGltYWdlcnkgZnJvbSBtb2RlbCBsYXllciB3aXRoIGNlc2l1bSBtYXBcbiAgICBjb25zdCBpbWFnZXJ5UmVhY3Rpb25EaXNwb3NlciA9IGF1dG9ydW4oKCkgPT4ge1xuICAgICAgY29uc3QgY2F0YWxvZ0l0ZW1zID0gdGhpcy5hdmFpbGFibGVDYXRhbG9nSXRlbXM7XG4gICAgICAvLyBGbGF0bWFwXG4gICAgICBjb25zdCBhbGxJbWFnZXJ5TWFwSXRlbXMgPSAoXG4gICAgICAgIFtdIGFzIHtcbiAgICAgICAgICBpdGVtOiBNYXBwYWJsZU1peGluLkluc3RhbmNlO1xuICAgICAgICAgIHBhcnRzOiBJbWFnZXJ5UGFydHM7XG4gICAgICAgIH1bXVxuICAgICAgKS5jb25jYXQoXG4gICAgICAgIC4uLmNhdGFsb2dJdGVtc1xuICAgICAgICAgIC5maWx0ZXIoaXNEZWZpbmVkKVxuICAgICAgICAgIC5tYXAoKGl0ZW0pID0+XG4gICAgICAgICAgICBpdGVtLm1hcEl0ZW1zXG4gICAgICAgICAgICAgIC5maWx0ZXIoSW1hZ2VyeVBhcnRzLmlzKVxuICAgICAgICAgICAgICAubWFwKChwYXJ0czogSW1hZ2VyeVBhcnRzKSA9PiAoeyBpdGVtLCBwYXJ0cyB9KSlcbiAgICAgICAgICApXG4gICAgICApO1xuXG4gICAgICBjb25zdCBhbGxJbWFnZXJ5ID0gYWxsSW1hZ2VyeU1hcEl0ZW1zLm1hcCgoeyBpdGVtLCBwYXJ0cyB9KSA9PiB7XG4gICAgICAgIGlmIChoYXNUcmFpdHMoaXRlbSwgSW1hZ2VyeVByb3ZpZGVyVHJhaXRzLCBcImxlYWZsZXRVcGRhdGVJbnRlcnZhbFwiKSkge1xuICAgICAgICAgIChwYXJ0cy5pbWFnZXJ5UHJvdmlkZXIgYXMgYW55KS5fbGVhZmxldFVwZGF0ZUludGVydmFsID1cbiAgICAgICAgICAgIGl0ZW0ubGVhZmxldFVwZGF0ZUludGVydmFsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgcGFydHM6IHBhcnRzLFxuICAgICAgICAgIGxheWVyOiB0aGlzLl9tYWtlSW1hZ2VyeUxheWVyRnJvbVBhcnRzKHBhcnRzLCBpdGVtKVxuICAgICAgICB9O1xuICAgICAgfSk7XG5cbiAgICAgIC8vIERlbGV0ZSBpbWFnZXJ5IGxheWVycyBubyBsb25nZXIgaW4gdGhlIG1vZGVsXG4gICAgICB0aGlzLm1hcC5lYWNoTGF5ZXIoKG1hcExheWVyKSA9PiB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBpc0ltYWdlcnlMYXllcihtYXBMYXllcikgfHxcbiAgICAgICAgICBtYXBMYXllciBpbnN0YW5jZW9mIEltYWdlcnlQcm92aWRlckxlYWZsZXRHcmlkTGF5ZXJcbiAgICAgICAgKSB7XG4gICAgICAgICAgY29uc3QgaW5kZXggPSBhbGxJbWFnZXJ5LmZpbmRJbmRleCgoaW0pID0+IGltLmxheWVyID09PSBtYXBMYXllcik7XG4gICAgICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgdGhpcy5tYXAucmVtb3ZlTGF5ZXIobWFwTGF5ZXIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vIEFkZCBsYXllciBhbmQgdXBkYXRlIGl0cyB6SW5kZXhcbiAgICAgIGxldCB6SW5kZXggPSAxMDA7IC8vIFN0YXJ0IGF0IGFuIGFyYml0cmFyeSB2YWx1ZVxuICAgICAgYWxsSW1hZ2VyeS5yZXZlcnNlKCkuZm9yRWFjaCgoeyBwYXJ0cywgbGF5ZXIgfSkgPT4ge1xuICAgICAgICBpZiAobGF5ZXIgJiYgcGFydHMuc2hvdykge1xuICAgICAgICAgIGxheWVyLnNldE9wYWNpdHkocGFydHMuYWxwaGEpO1xuICAgICAgICAgIGxheWVyLnNldFpJbmRleCh6SW5kZXgpO1xuICAgICAgICAgIHpJbmRleCsrO1xuXG4gICAgICAgICAgaWYgKCF0aGlzLm1hcC5oYXNMYXllcihsYXllcikpIHtcbiAgICAgICAgICAgIHRoaXMubWFwLmFkZExheWVyKGxheWVyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAobGF5ZXIpIHtcbiAgICAgICAgICB0aGlzLm1hcC5yZW1vdmVMYXllcihsYXllcik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGRhdGFTb3VyY2VzUmVhY3Rpb25EaXNwb3NlcigpO1xuICAgICAgaW1hZ2VyeVJlYWN0aW9uRGlzcG9zZXIoKTtcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFN5bmNzIHRoZSBgZGF0YVNvdXJjZXNgIGNvbGxlY3Rpb24gYWdhaW5zdCB0aGUgbGF0ZXN0IGBhdmFpbGFibGVEYXRhU291cmNlc2AuXG4gICAqXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHN5bmNEYXRhU291cmNlQ29sbGVjdGlvbihcbiAgICBhdmFpbGFibGVEYXRhU291cmNlczogRGF0YVNvdXJjZVtdLFxuICAgIGRhdGFTb3VyY2VzOiBEYXRhU291cmNlQ29sbGVjdGlvblxuICApIHtcbiAgICAvLyAxLiBSZW1vdmUgZGVsZXRlZCBkYXRhIHNvdXJjZXNcbiAgICAvL1xuICAgIC8vIEl0ZXJhdGUgYmFja3dhcmRzIGJlY2F1c2Ugd2UncmUgcmVtb3ZpbmcgaXRlbXMuXG4gICAgZm9yIChsZXQgaSA9IGRhdGFTb3VyY2VzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICBjb25zdCBkcyA9IGRhdGFTb3VyY2VzLmdldChpKTtcbiAgICAgIGlmIChhdmFpbGFibGVEYXRhU291cmNlcy5pbmRleE9mKGRzKSA9PT0gLTEgfHwgIWRzLnNob3cpIHtcbiAgICAgICAgZGF0YVNvdXJjZXMucmVtb3ZlKGRzKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyAyLiBBZGQgbmV3IGRhdGEgc291cmNlc1xuICAgIGZvciAoY29uc3QgZHMgb2YgYXZhaWxhYmxlRGF0YVNvdXJjZXMpIHtcbiAgICAgIGlmICghZGF0YVNvdXJjZXMuY29udGFpbnMoZHMpICYmIGRzLnNob3cpIHtcbiAgICAgICAgYXdhaXQgZGF0YVNvdXJjZXMuYWRkKGRzKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyAzLiBFbnN1cmUgc3RhY2tpbmcgb3JkZXIgbWF0Y2hlcyBvcmRlciBpbiBgYXZhaWxhYmxlRGF0YVNvdXJjZXNgIC0gZmlyc3QgaXRlbSBhcHBlYXJzIG9uIHRvcC5cbiAgICBydW5JbkFjdGlvbigoKSA9PlxuICAgICAgYXZhaWxhYmxlRGF0YVNvdXJjZXMuZm9yRWFjaCgoZHMpID0+IHtcbiAgICAgICAgLy8gVGhlcmUgaXMgYSBidWdneS91bi1pbnRlbmRlZCBzaWRlLWVmZmVjdCB3aGVuIGNhbGxpbmcgcmFpc2VUb1RvcCgpIHdpdGhcbiAgICAgICAgLy8gYSBzb3VyY2UgdGhhdCBkb2Vzbid0IGV4aXN0IGluIHRoZSBjb2xsZWN0aW9uLiBEb2luZyB0aGlzIHdpbGwgcmVwbGFjZVxuICAgICAgICAvLyB0aGUgbGFzdCBlbnRyeSBpbiB0aGUgY29sbGVjdGlvbiB3aXRoIHRoZSBuZXcgb25lLiBTbyB3ZSBzaG91bGQgYmVcbiAgICAgICAgLy8gY2FyZWZ1bCB0byByYWlzZVRvVG9wKCkgb25seSBpZiB0aGUgRFMgYWxyZWFkeSBleGlzdHMgaW4gdGhlIGNvbGxlY3Rpb24uXG4gICAgICAgIC8vIFJlbGV2YW50IGNvZGU6XG4gICAgICAgIC8vICAgaHR0cHM6Ly9naXRodWIuY29tL0Nlc2l1bUdTL2Nlc2l1bS9ibG9iL2RiZDQ1MjMyOGE0OGJmYzRlMTkyMTQ2ODYyYTlmOGZhMTU3ODlkYzgvcGFja2FnZXMvZW5naW5lL1NvdXJjZS9EYXRhU291cmNlcy9EYXRhU291cmNlQ29sbGVjdGlvbi5qcyNMMjk4LUwyOTlcbiAgICAgICAgaWYgKGRhdGFTb3VyY2VzLmNvbnRhaW5zKGRzKSkge1xuICAgICAgICAgIGRhdGFTb3VyY2VzLnJhaXNlVG9Ub3AoZHMpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBkb1pvb21UbyhcbiAgICB0YXJnZXQ6IENhbWVyYVZpZXcgfCBSZWN0YW5nbGUgfCBEYXRhU291cmNlIHwgTWFwcGFibGVNaXhpbi5JbnN0YW5jZSB8IGFueSxcbiAgICBmbGlnaHREdXJhdGlvblNlY29uZHM6IG51bWJlciA9IDMuMFxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIWlzRGVmaW5lZCh0YXJnZXQpKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIGxldCBib3VuZHM7XG4gICAgaWYgKGlzRGVmaW5lZCh0YXJnZXQuZW50aXRpZXMpKSB7XG4gICAgICBpZiAoaXNEZWZpbmVkKHRoaXMuZGF0YVNvdXJjZURpc3BsYXkpKSB7XG4gICAgICAgIGJvdW5kcyA9IHRoaXMuZGF0YVNvdXJjZURpc3BsYXkuZ2V0TGF0TG5nQm91bmRzKHRhcmdldCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBleHRlbnQ7XG5cbiAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBSZWN0YW5nbGUpIHtcbiAgICAgICAgZXh0ZW50ID0gdGFyZ2V0O1xuICAgICAgfSBlbHNlIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBDYW1lcmFWaWV3KSB7XG4gICAgICAgIGV4dGVudCA9IHRhcmdldC5yZWN0YW5nbGU7XG4gICAgICB9IGVsc2UgaWYgKE1hcHBhYmxlTWl4aW4uaXNNaXhlZEludG8odGFyZ2V0KSkge1xuICAgICAgICBpZiAoaXNEZWZpbmVkKHRhcmdldC5jZXNpdW1SZWN0YW5nbGUpKSB7XG4gICAgICAgICAgZXh0ZW50ID0gdGFyZ2V0LmNlc2l1bVJlY3RhbmdsZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWlzRGVmaW5lZChleHRlbnQpKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZG9ab29tVG8odGFyZ2V0Lm1hcEl0ZW1zWzBdLCBmbGlnaHREdXJhdGlvblNlY29uZHMpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBleHRlbnQgPSB0YXJnZXQucmVjdGFuZ2xlO1xuICAgICAgfVxuXG4gICAgICAvLyBFbnN1cmUgZXh0ZW50IGlzIGRlZmluZWQgYmVmb3JlIGFjY2Vzc2luZyBpdHMgcHJvcGVydGllc1xuICAgICAgaWYgKGlzRGVmaW5lZChleHRlbnQpKSB7XG4gICAgICAgIC8vIEFjY291bnQgZm9yIGEgYm91bmRpbmcgYm94IGNyb3NzaW5nIHRoZSBkYXRlIGxpbmUuXG4gICAgICAgIGlmIChleHRlbnQuZWFzdCA8IGV4dGVudC53ZXN0KSB7XG4gICAgICAgICAgZXh0ZW50ID0gUmVjdGFuZ2xlLmNsb25lKGV4dGVudCk7XG4gICAgICAgICAgZXh0ZW50LmVhc3QgKz0gQ2VzaXVtTWF0aC5UV09fUEk7XG4gICAgICAgIH1cbiAgICAgICAgYm91bmRzID0gcmVjdGFuZ2xlVG9MYXRMbmdCb3VuZHMoZXh0ZW50KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEhhbmRsZSB0aGUgY2FzZSB3aGVyZSBleHRlbnQgaXMgdW5kZWZpbmVkXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVbmFibGUgdG8gZGV0ZXJtaW5lIGJvdW5kcyBmb3Igem9vbWluZy5cIik7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoaXNEZWZpbmVkKGJvdW5kcykpIHtcbiAgICAgIHRoaXMubWFwLmZseVRvQm91bmRzKGJvdW5kcywge1xuICAgICAgICBhbmltYXRlOiBmbGlnaHREdXJhdGlvblNlY29uZHMgPiAwLjAsXG4gICAgICAgIGR1cmF0aW9uOiBmbGlnaHREdXJhdGlvblNlY29uZHNcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgfVxuXG4gIHNldEluaXRpYWxWaWV3KHZpZXc6IENhbWVyYVZpZXcpIHtcbiAgICB0aGlzLmRvWm9vbVRvKHZpZXcsIDApO1xuICAgIHRoaXMuX2luaXRpYWxWaWV3ID0gdmlldztcbiAgICB0aGlzLm1hcC5hZGRPbmVUaW1lRXZlbnRMaXN0ZW5lcihcIm1vdmVcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5faW5pdGlhbFZpZXcgPSB1bmRlZmluZWQ7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIHRoZSBpbml0aWFsIHZpZXcgaWYgaXQgaGFzbid0IGNoYW5nZWQuIE90aGVyd2lzZSByZXR1cm4gdW5kZWZpbmVkLlxuICAgKi9cbiAgZ2V0SW5pdGlhbFZpZXcoKTogQ2FtZXJhVmlldyB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMuX2luaXRpYWxWaWV3O1xuICB9XG5cbiAgZ2V0Q3VycmVudENhbWVyYVZpZXcoKTogQ2FtZXJhVmlldyB7XG4gICAgLy8gUmV0dXJuIHRoZSBpbml0aWFsIHZpZXcgaWYgdGhlIGNhbWVyYSBoYXNuJ3QgY2hhbmdlZCBzaW5jZSBzZXR0aW5nIGl0LlxuICAgIC8vIFRoaXMgZW5zdXJlcyB0aGF0IHRoZSB2aWV3IHJlbWFpbnMgY29uc3RhbnQgd2hlbiBzd2l0Y2hpbmcgYmV0d2VlblxuICAgIC8vIHZpZXdlciBtb2Rlcy5cbiAgICBjb25zdCBpbml0aWFsVmlldyA9IHRoaXMuZ2V0SW5pdGlhbFZpZXcoKTtcbiAgICBpZiAoaW5pdGlhbFZpZXcpIHtcbiAgICAgIHJldHVybiBpbml0aWFsVmlldztcbiAgICB9XG5cbiAgICBjb25zdCBib3VuZHMgPSB0aGlzLm1hcC5nZXRCb3VuZHMoKTtcbiAgICByZXR1cm4gbmV3IENhbWVyYVZpZXcoXG4gICAgICBSZWN0YW5nbGUuZnJvbURlZ3JlZXMoXG4gICAgICAgIGJvdW5kcy5nZXRXZXN0KCksXG4gICAgICAgIGJvdW5kcy5nZXRTb3V0aCgpLFxuICAgICAgICBib3VuZHMuZ2V0RWFzdCgpLFxuICAgICAgICBib3VuZHMuZ2V0Tm9ydGgoKVxuICAgICAgKVxuICAgICk7XG4gIH1cblxuICBub3RpZnlSZXBhaW50UmVxdWlyZWQoKTogdm9pZCB7XG4gICAgLy8gTm8gYWN0aW9uIG5lY2Vzc2FyeS5cbiAgfVxuXG4gIHBpY2tGcm9tTG9jYXRpb24oXG4gICAgbGF0TG5nSGVpZ2h0OiBMYXRMb25IZWlnaHQsXG4gICAgcHJvdmlkZXJDb29yZHM6IFByb3ZpZGVyQ29vcmRzTWFwLFxuICAgIGV4aXN0aW5nRmVhdHVyZXM6IFRlcnJpYUZlYXR1cmVbXVxuICApOiB2b2lkIHtcbiAgICB0aGlzLl9waWNrRmVhdHVyZXMoXG4gICAgICBMLmxhdExuZyh7XG4gICAgICAgIGxhdDogbGF0TG5nSGVpZ2h0LmxhdGl0dWRlLFxuICAgICAgICBsbmc6IGxhdExuZ0hlaWdodC5sb25naXR1ZGUsXG4gICAgICAgIGFsdDogbGF0TG5nSGVpZ2h0LmhlaWdodFxuICAgICAgfSksXG4gICAgICBwcm92aWRlckNvb3JkcyxcbiAgICAgIGV4aXN0aW5nRmVhdHVyZXNcbiAgICApO1xuICB9XG5cbiAgLypcbiAgICogVGhlcmUgYXJlIHR3byBcImxpc3RlbmVyc1wiIGZvciBjbGlja3Mgd2hpY2ggYXJlIHNldCB1cCBpbiBvdXIgY29uc3RydWN0b3IuXG4gICAqIC0gT25lIGZpcmVzIGZvciBhbnkgY2xpY2s6IGBtYXAub24oJ2NsaWNrJywgLi4uYC4gIEl0IGNhbGxzIGBwaWNrRmVhdHVyZXNgLlxuICAgKiAtIE9uZSBmaXJlcyBvbmx5IGZvciB2ZWN0b3IgZmVhdHVyZXM6IGB0aGlzLnNjZW5lLmZlYXR1cmVDbGlja2VkLmFkZEV2ZW50TGlzdGVuZXJgLlxuICAgKiAgICBJdCBjYWxscyBgZmVhdHVyZVBpY2tlZGAsIHdoaWNoIGNhbGxzIGBwaWNrRmVhdHVyZXNgIGFuZCB0aGVuIGFkZHMgdGhlIGZlYXR1cmUgaXQgZm91bmQsIGlmIGFueS5cbiAgICogVGhlc2UgZXZlbnRzIGNhbiBmaXJlIGluIGVpdGhlciBvcmRlci5cbiAgICogQmlsbGJvYXJkcyBkbyBub3QgZmlyZSB0aGUgZmlyc3QgZXZlbnQuXG4gICAqXG4gICAqIE5vdGUgdGhhdCBgcGlja0ZlYXR1cmVzYCBkb2VzIG5vdGhpbmcgaWYgYGxlYWZsZXQuX3BpY2tlZEZlYXR1cmVzYCBpcyBhbHJlYWR5IHNldC5cbiAgICogT3RoZXJ3aXNlLCBpdCBzZXRzIGl0LCBydW5zIGBydW5MYXRlcmAgdG8gY2xlYXIgaXQsIGFuZCBzdGFydHMgdGhlIGFzeW5jaHJvbm91cyByYXN0ZXIgZmVhdHVyZSBwaWNraW5nLlxuICAgKlxuICAgKiBTbzpcbiAgICogSWYgb25seSB0aGUgZmlyc3QgZXZlbnQgaXMgcmVjZWl2ZWQsIGl0IHRyaWdnZXJzIHRoZSByYXN0ZXItZmVhdHVyZSBwaWNraW5nIGFzIGRlc2lyZWQuXG4gICAqIElmIGJvdGggYXJlIHJlY2VpdmVkIGluIHRoZSBvcmRlciBhYm92ZSwgdGhlIHNlY29uZCBhZGRzIHRoZSB2ZWN0b3IgZmVhdHVyZXMgdG8gdGhlIGxpc3Qgb2YgcmFzdGVyIGZlYXR1cmVzIGFzIGRlc2lyZWQuXG4gICAqIElmIGJvdGggYXJlIHJlY2VpdmVkIGluIHRoZSByZXZlcnNlIG9yZGVyLCB0aGUgdmVjdG9yLWZlYXR1cmUgY2xpY2sga2lja3Mgb2ZmIHRoZSBzYW1lIGJlaGF2aW9yIGFzIHRoZSBvdGhlciBjbGljayB3b3VsZCBoYXZlO1xuICAgKiBhbmQgd2hlbiB0aGUgbmV4dCBjbGljayBpcyByZWNlaXZlZCwgaXQgaXMgaWdub3JlZCAtIGFnYWluLCBhcyBkZXNpcmVkLlxuICAgKi9cblxuICBAYWN0aW9uXG4gIHByaXZhdGUgYXN5bmMgX2ZlYXR1cmVQaWNrZWQoZW50aXR5OiBFbnRpdHksIGV2ZW50OiBMLkxlYWZsZXRNb3VzZUV2ZW50KSB7XG4gICAgdGhpcy5fcGlja0ZlYXR1cmVzKGV2ZW50LmxhdGxuZyk7XG5cbiAgICAvLyBJZ25vcmUgY2xpY2tzIG9uIHRoZSBmZWF0dXJlIGhpZ2hsaWdodC5cbiAgICBpZiAoZW50aXR5LmVudGl0eUNvbGxlY3Rpb24gJiYgZW50aXR5LmVudGl0eUNvbGxlY3Rpb24ub3duZXIpIHtcbiAgICAgIGNvbnN0IG93bmVyID0gZW50aXR5LmVudGl0eUNvbGxlY3Rpb24ub3duZXI7XG4gICAgICBpZiAoXG4gICAgICAgIG93bmVyIGluc3RhbmNlb2YgRGF0YVNvdXJjZSAmJlxuICAgICAgICBvd25lci5uYW1lID09PSBHbG9iZU9yTWFwLl9mZWF0dXJlSGlnaGxpZ2h0TmFtZVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBmZWF0dXJlID0gVGVycmlhRmVhdHVyZS5mcm9tRW50aXR5Q29sbGVjdGlvbk9yRW50aXR5KGVudGl0eSk7XG5cbiAgICBjb25zdCBjYXRhbG9nSXRlbSA9IGZlYXR1cmUuX2NhdGFsb2dJdGVtO1xuXG4gICAgaWYgKFxuICAgICAgRmVhdHVyZUluZm9VcmxUZW1wbGF0ZU1peGluLmlzTWl4ZWRJbnRvKGNhdGFsb2dJdGVtKSAmJlxuICAgICAgdHlwZW9mIGNhdGFsb2dJdGVtLmdldEZlYXR1cmVzRnJvbVBpY2tSZXN1bHQgPT09IFwiZnVuY3Rpb25cIiAmJlxuICAgICAgdGhpcy50ZXJyaWEuYWxsb3dGZWF0dXJlSW5mb1JlcXVlc3RzXG4gICAgKSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjYXRhbG9nSXRlbS5nZXRGZWF0dXJlc0Zyb21QaWNrUmVzdWx0LmJpbmQoXG4gICAgICAgIGNhdGFsb2dJdGVtXG4gICAgICApKFxuICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgIGVudGl0eSxcbiAgICAgICAgKHRoaXMuX3BpY2tlZEZlYXR1cmVzPy5mZWF0dXJlcy5sZW5ndGggfHwgMCkgPCBjYXRhbG9nSXRlbS5tYXhSZXF1ZXN0c1xuICAgICAgKTtcbiAgICAgIGlmIChyZXN1bHQgJiYgaXNEZWZpbmVkKHRoaXMuX3BpY2tlZEZlYXR1cmVzKSkge1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXN1bHQpKSB7XG4gICAgICAgICAgdGhpcy5fcGlja2VkRmVhdHVyZXMuZmVhdHVyZXMucHVzaCguLi5yZXN1bHQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuX3BpY2tlZEZlYXR1cmVzLmZlYXR1cmVzLnB1c2gocmVzdWx0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoaXNEZWZpbmVkKHRoaXMuX3BpY2tlZEZlYXR1cmVzKSkge1xuICAgICAgdGhpcy5fcGlja2VkRmVhdHVyZXMuZmVhdHVyZXMucHVzaChmZWF0dXJlKTtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgaXNEZWZpbmVkKHRoaXMuX3BpY2tlZEZlYXR1cmVzKSAmJlxuICAgICAgaXNEZWZpbmVkKGZlYXR1cmUpICYmXG4gICAgICBmZWF0dXJlLnBvc2l0aW9uXG4gICAgKSB7XG4gICAgICB0aGlzLl9waWNrZWRGZWF0dXJlcy5waWNrUG9zaXRpb24gPSAoZmVhdHVyZS5wb3NpdGlvbiBhcyBhbnkpLl92YWx1ZTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF9waWNrRmVhdHVyZXMoXG4gICAgbGF0bG5nOiBMLkxhdExuZyxcbiAgICB0aWxlQ29vcmRpbmF0ZXM/OiBSZWNvcmQ8c3RyaW5nLCBQcm92aWRlckNvb3Jkcz4sXG4gICAgZXhpc3RpbmdGZWF0dXJlcz86IFRlcnJpYUZlYXR1cmVbXSxcbiAgICBpZ25vcmVTcGxpdHRlcjogYm9vbGVhbiA9IGZhbHNlXG4gICkge1xuICAgIGlmIChpc0RlZmluZWQodGhpcy5fcGlja2VkRmVhdHVyZXMpKSB7XG4gICAgICAvLyBQaWNraW5nIGlzIGFscmVhZHkgaW4gcHJvZ3Jlc3MuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5fcGlja2VkRmVhdHVyZXMgPSBuZXcgUGlja2VkRmVhdHVyZXMoKTtcblxuICAgIGlmIChpc0RlZmluZWQoZXhpc3RpbmdGZWF0dXJlcykpIHtcbiAgICAgIHRoaXMuX3BpY2tlZEZlYXR1cmVzLmZlYXR1cmVzID0gZXhpc3RpbmdGZWF0dXJlcztcbiAgICB9XG5cbiAgICAvLyBXZSBydW4gdGhpcyBsYXRlciBiZWNhdXNlIHZlY3RvciBjbGljayBldmVudHMgYW5kIHRoZSBtYXAgY2xpY2sgZXZlbnQgY2FuIGNvbWUgdGhyb3VnaCBpbiBhbnkgb3JkZXIsIGJ1dCB3ZSBjYW5cbiAgICAvLyBiZSByZWFzb25hYmx5IHN1cmUgdGhhdCBhbGwgb2YgdGhlbSB3aWxsIGJlIHByb2Nlc3NlZCBieSB0aGUgdGltZSBvdXIgcnVuTGF0ZXIgZnVuYyBpcyBpbnZva2VkLlxuICAgIGNvbnN0IGNsZWFudXAgPSBydW5MYXRlcigoKSA9PiB7XG4gICAgICAvLyBTZXQgdGhpcyBhZ2FpbiBqdXN0IGluIGNhc2UgYSB2ZWN0b3IgcGljayBjYW1lIHRocm91Z2ggYW5kIHJlc2V0IGl0IHRvIHRoZSB2ZWN0b3IncyBwb3NpdGlvbi5cbiAgICAgIGNvbnN0IG5ld1BpY2tMb2NhdGlvbiA9XG4gICAgICAgIEVsbGlwc29pZC5XR1M4NC5jYXJ0b2dyYXBoaWNUb0NhcnRlc2lhbihwaWNrZWRMb2NhdGlvbik7XG4gICAgICBydW5JbkFjdGlvbigoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1hcEludGVyYWN0aW9uTW9kZVN0YWNrID0gdGhpcy50ZXJyaWEubWFwSW50ZXJhY3Rpb25Nb2RlU3RhY2s7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBpc0RlZmluZWQobWFwSW50ZXJhY3Rpb25Nb2RlU3RhY2spICYmXG4gICAgICAgICAgbWFwSW50ZXJhY3Rpb25Nb2RlU3RhY2subGVuZ3RoID4gMFxuICAgICAgICApIHtcbiAgICAgICAgICBjb25zdCBwaWNrZWRGZWF0dXJlcyA9XG4gICAgICAgICAgICBtYXBJbnRlcmFjdGlvbk1vZGVTdGFja1ttYXBJbnRlcmFjdGlvbk1vZGVTdGFjay5sZW5ndGggLSAxXVxuICAgICAgICAgICAgICAucGlja2VkRmVhdHVyZXM7XG4gICAgICAgICAgaWYgKGlzRGVmaW5lZChwaWNrZWRGZWF0dXJlcykpIHtcbiAgICAgICAgICAgIHBpY2tlZEZlYXR1cmVzLnBpY2tQb3NpdGlvbiA9IG5ld1BpY2tMb2NhdGlvbjtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoaXNEZWZpbmVkKHRoaXMudGVycmlhLnBpY2tlZEZlYXR1cmVzKSkge1xuICAgICAgICAgIHRoaXMudGVycmlhLnBpY2tlZEZlYXR1cmVzLnBpY2tQb3NpdGlvbiA9IG5ld1BpY2tMb2NhdGlvbjtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vIFVuc2V0IHRoaXMgc28gdGhhdCB0aGUgbmV4dCBjbGljayB3aWxsIHN0YXJ0IGJ1aWxkaW5nIGZlYXR1cmVzIGZyb20gc2NyYXRjaC5cbiAgICAgIHRoaXMuX3BpY2tlZEZlYXR1cmVzID0gdW5kZWZpbmVkO1xuICAgIH0pO1xuXG4gICAgY29uc3QgaW1hZ2VyeUxheWVyczogSW1hZ2VyeVByb3ZpZGVyTGVhZmxldFRpbGVMYXllcltdID0gW107XG4gICAgaWYgKHRoaXMudGVycmlhLmFsbG93RmVhdHVyZUluZm9SZXF1ZXN0cykge1xuICAgICAgdGhpcy5tYXAuZWFjaExheWVyKChsYXllcikgPT4ge1xuICAgICAgICBpZiAoaXNJbWFnZXJ5TGF5ZXIobGF5ZXIpKSB7XG4gICAgICAgICAgaW1hZ2VyeUxheWVycy5wdXNoKGxheWVyKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gd2UgbmVlZCBpdGVtcyBzb3J0ZWQgaW4gcmV2ZXJzZSBvcmRlciBieSB0aGVpciB6SW5kZXggdG8gZ2V0IGNvcnJlY3Qgb3JkZXJpbmcgb2YgZmVhdHVyZSBpbmZvXG4gICAgaW1hZ2VyeUxheWVycy5zb3J0KFxuICAgICAgKFxuICAgICAgICBhOiBJbWFnZXJ5UHJvdmlkZXJMZWFmbGV0VGlsZUxheWVyLFxuICAgICAgICBiOiBJbWFnZXJ5UHJvdmlkZXJMZWFmbGV0VGlsZUxheWVyXG4gICAgICApID0+IHtcbiAgICAgICAgaWYgKCFpc0RlZmluZWQoYS5vcHRpb25zLnpJbmRleCkgfHwgIWlzRGVmaW5lZChiLm9wdGlvbnMuekluZGV4KSkge1xuICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhLm9wdGlvbnMuekluZGV4IDwgYi5vcHRpb25zLnpJbmRleCkge1xuICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhLm9wdGlvbnMuekluZGV4ID4gYi5vcHRpb25zLnpJbmRleCkge1xuICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cbiAgICApO1xuXG4gICAgdGlsZUNvb3JkaW5hdGVzID0gdGlsZUNvb3JkaW5hdGVzID8/IHt9O1xuXG4gICAgY29uc3QgcGlja2VkTG9jYXRpb24gPSBDYXJ0b2dyYXBoaWMuZnJvbURlZ3JlZXMobGF0bG5nLmxuZywgbGF0bG5nLmxhdCk7XG4gICAgdGhpcy5fcGlja2VkRmVhdHVyZXMucGlja1Bvc2l0aW9uID1cbiAgICAgIEVsbGlwc29pZC5XR1M4NC5jYXJ0b2dyYXBoaWNUb0NhcnRlc2lhbihwaWNrZWRMb2NhdGlvbik7XG5cbiAgICBjb25zdCBpbWFnZXJ5RmVhdHVyZVByb21pc2VzID0gaW1hZ2VyeUxheWVycy5tYXAoYXN5bmMgKGltYWdlcnlMYXllcikgPT4ge1xuICAgICAgY29uc3QgaW1hZ2VyeUxheWVyVXJsID0gKGltYWdlcnlMYXllci5pbWFnZXJ5UHJvdmlkZXIgYXMgYW55KS51cmw7XG4gICAgICBjb25zdCBsb25nUmFkaWFucyA9IENlc2l1bU1hdGgudG9SYWRpYW5zKGxhdGxuZy5sbmcpO1xuICAgICAgY29uc3QgbGF0UmFkaWFucyA9IENlc2l1bU1hdGgudG9SYWRpYW5zKGxhdGxuZy5sYXQpO1xuXG4gICAgICBjb25zdCBjb29yZHMgPVxuICAgICAgICB0aWxlQ29vcmRpbmF0ZXM/LltpbWFnZXJ5TGF5ZXJVcmxdID8/XG4gICAgICAgIChhd2FpdCBpbWFnZXJ5TGF5ZXIuZ2V0RmVhdHVyZVBpY2tpbmdDb29yZHMoXG4gICAgICAgICAgdGhpcy5tYXAsXG4gICAgICAgICAgbG9uZ1JhZGlhbnMsXG4gICAgICAgICAgbGF0UmFkaWFuc1xuICAgICAgICApKTtcblxuICAgICAgY29uc3QgZmVhdHVyZXMgPSBhd2FpdCBpbWFnZXJ5TGF5ZXIucGlja0ZlYXR1cmVzKFxuICAgICAgICBjb29yZHMueCxcbiAgICAgICAgY29vcmRzLnksXG4gICAgICAgIGNvb3Jkcy5sZXZlbCxcbiAgICAgICAgbG9uZ1JhZGlhbnMsXG4gICAgICAgIGxhdFJhZGlhbnNcbiAgICAgICk7XG5cbiAgICAgIC8vIE1ha2Ugc3VyZSBJbWFnZXJ5TGF5ZXJGZWF0dXJlSW5mbyBoYXMgaW1hZ2VyeSBsYXllciBwcm9wZXJ0eVxuICAgICAgZmVhdHVyZXM/LmZvckVhY2goKGZlYXR1cmUpID0+IChmZWF0dXJlLmltYWdlcnlMYXllciA9IGltYWdlcnlMYXllcikpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBmZWF0dXJlczogZmVhdHVyZXMsXG4gICAgICAgIGltYWdlcnlMYXllcjogaW1hZ2VyeUxheWVyLFxuICAgICAgICBjb29yZHM6IGNvb3Jkc1xuICAgICAgfTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHBpY2tlZEZlYXR1cmVzID0gdGhpcy5fcGlja2VkRmVhdHVyZXM7XG5cbiAgICAvLyBXZSB3YW50IHRoZSBhbGwgYXZhaWxhYmxlIHByb21pc2UgdG8gcmV0dXJuIGFmdGVyIHRoZSBjbGVhbnVwIG9uZSB0b1xuICAgIC8vIG1ha2Ugc3VyZSBhbGwgdmVjdG9yIGNsaWNrIGV2ZW50cyBoYXZlIHJlc29sdmVkLlxuICAgIHBpY2tlZEZlYXR1cmVzLmFsbEZlYXR1cmVzQXZhaWxhYmxlUHJvbWlzZSA9IFByb21pc2UuYWxsKFtcbiAgICAgIGNsZWFudXAsXG4gICAgICBQcm9taXNlLmFsbChpbWFnZXJ5RmVhdHVyZVByb21pc2VzKVxuICAgICAgICAudGhlbigocmVzdWx0cykgPT4ge1xuICAgICAgICAgIHJ1bkluQWN0aW9uKCgpID0+IHtcbiAgICAgICAgICAgIHBpY2tlZEZlYXR1cmVzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgcGlja2VkRmVhdHVyZXMucHJvdmlkZXJDb29yZHMgPSB7fTtcbiAgICAgICAgICBjb25zdCBmaWx0ZXJlZFJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihcbiAgICAgICAgICAgIChyZXN1bHQpID0+IGlzRGVmaW5lZChyZXN1bHQuZmVhdHVyZXMpICYmIHJlc3VsdC5mZWF0dXJlcy5sZW5ndGggPiAwXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIHBpY2tlZEZlYXR1cmVzLnByb3ZpZGVyQ29vcmRzID0gZmlsdGVyZWRSZXN1bHRzLnJlZHVjZShmdW5jdGlvbiAoXG4gICAgICAgICAgICBjb29yZHNTb0ZhcjogUHJvdmlkZXJDb29yZHNNYXAsXG4gICAgICAgICAgICByZXN1bHRcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIGNvbnN0IGltYWdlcnlQcm92aWRlciA9IHJlc3VsdC5pbWFnZXJ5TGF5ZXI/LmltYWdlcnlQcm92aWRlcjtcbiAgICAgICAgICAgIGlmIChpbWFnZXJ5UHJvdmlkZXIpXG4gICAgICAgICAgICAgIGNvb3Jkc1NvRmFyWyhpbWFnZXJ5UHJvdmlkZXIgYXMgYW55KS51cmxdID0gcmVzdWx0LmNvb3JkcztcbiAgICAgICAgICAgIHJldHVybiBjb29yZHNTb0ZhcjtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHt9KTtcblxuICAgICAgICAgIGNvbnN0IGZlYXR1cmVzID0gZmlsdGVyZWRSZXN1bHRzLnJlZHVjZSgoYWxsRmVhdHVyZXMsIHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICB0aGlzLnRlcnJpYS5zaG93U3BsaXR0ZXIgJiZcbiAgICAgICAgICAgICAgaWdub3JlU3BsaXR0ZXIgPT09IGZhbHNlICYmXG4gICAgICAgICAgICAgIGlzRGVmaW5lZChwaWNrZWRGZWF0dXJlcy5waWNrUG9zaXRpb24pXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgLy8gU2tpcCB0aGlzIGZlYXR1cmUsIHVubGVzcyB0aGUgaW1hZ2VyeSBsYXllciBpcyBvbiB0aGUgcGlja2VkIHNpZGUgb3JcbiAgICAgICAgICAgICAgLy8gYmVsb25ncyB0byBib3RoIHNpZGVzIG9mIHRoZSBzcGxpdHRlclxuICAgICAgICAgICAgICBjb25zdCBzY3JlZW5Qb3NpdGlvbiA9IHRoaXMuX2NvbXB1dGVQb3NpdGlvbk9uU2NyZWVuKFxuICAgICAgICAgICAgICAgIHBpY2tlZEZlYXR1cmVzLnBpY2tQb3NpdGlvblxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICBjb25zdCBwaWNrZWRTaWRlID1cbiAgICAgICAgICAgICAgICB0aGlzLl9nZXRTcGxpdHRlclNpZGVGb3JTY3JlZW5Qb3NpdGlvbihzY3JlZW5Qb3NpdGlvbik7XG4gICAgICAgICAgICAgIGNvbnN0IGxheWVyRGlyZWN0aW9uID0gcmVzdWx0LmltYWdlcnlMYXllci5zcGxpdERpcmVjdGlvbjtcblxuICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgIShcbiAgICAgICAgICAgICAgICAgIGxheWVyRGlyZWN0aW9uID09PSBwaWNrZWRTaWRlIHx8XG4gICAgICAgICAgICAgICAgICBsYXllckRpcmVjdGlvbiA9PT0gU3BsaXREaXJlY3Rpb24uTk9ORVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFsbEZlYXR1cmVzO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBhbGxGZWF0dXJlcy5jb25jYXQoXG4gICAgICAgICAgICAgIHJlc3VsdC5mZWF0dXJlcyEubWFwKChmZWF0dXJlKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gRm9yIGZlYXR1cmVzIHdpdGhvdXQgYSBwb3NpdGlvbiwgdXNlIHRoZSBwaWNrZWQgbG9jYXRpb24uXG4gICAgICAgICAgICAgICAgaWYgKCFpc0RlZmluZWQoZmVhdHVyZS5wb3NpdGlvbikpIHtcbiAgICAgICAgICAgICAgICAgIGZlYXR1cmUucG9zaXRpb24gPSBwaWNrZWRMb2NhdGlvbjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY3JlYXRlRmVhdHVyZUZyb21JbWFnZXJ5TGF5ZXJGZWF0dXJlKGZlYXR1cmUpO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LCBwaWNrZWRGZWF0dXJlcy5mZWF0dXJlcyk7XG4gICAgICAgICAgcnVuSW5BY3Rpb24oKCkgPT4ge1xuICAgICAgICAgICAgcGlja2VkRmVhdHVyZXMuZmVhdHVyZXMgPSBmZWF0dXJlcztcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlKSA9PiB7XG4gICAgICAgICAgcnVuSW5BY3Rpb24oKCkgPT4ge1xuICAgICAgICAgICAgcGlja2VkRmVhdHVyZXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICBwaWNrZWRGZWF0dXJlcy5lcnJvciA9XG4gICAgICAgICAgICAgIFwiQW4gdW5rbm93biBlcnJvciBvY2N1cnJlZCB3aGlsZSBwaWNraW5nIGZlYXR1cmVzLlwiO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHRocm93IGU7XG4gICAgICAgIH0pXG4gICAgXSkudGhlbigoKSA9PiB1bmRlZmluZWQpO1xuXG4gICAgcnVuSW5BY3Rpb24oKCkgPT4ge1xuICAgICAgY29uc3QgbWFwSW50ZXJhY3Rpb25Nb2RlU3RhY2sgPSB0aGlzLnRlcnJpYS5tYXBJbnRlcmFjdGlvbk1vZGVTdGFjaztcbiAgICAgIGlmIChcbiAgICAgICAgaXNEZWZpbmVkKG1hcEludGVyYWN0aW9uTW9kZVN0YWNrKSAmJlxuICAgICAgICBtYXBJbnRlcmFjdGlvbk1vZGVTdGFjay5sZW5ndGggPiAwXG4gICAgICApIHtcbiAgICAgICAgbWFwSW50ZXJhY3Rpb25Nb2RlU3RhY2tbXG4gICAgICAgICAgbWFwSW50ZXJhY3Rpb25Nb2RlU3RhY2subGVuZ3RoIC0gMVxuICAgICAgICBdLnBpY2tlZEZlYXR1cmVzID0gdGhpcy5fcGlja2VkRmVhdHVyZXM7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnRlcnJpYS5waWNrZWRGZWF0dXJlcyA9IHRoaXMuX3BpY2tlZEZlYXR1cmVzO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgX3JlYWN0VG9TcGxpdHRlckNoYW5nZXMoKTogSVJlYWN0aW9uRGlzcG9zZXIge1xuICAgIHJldHVybiBhdXRvcnVuKCgpID0+IHtcbiAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy50ZXJyaWEubWFpblZpZXdlci5pdGVtcy5nZXQoKTtcbiAgICAgIGNvbnN0IHNob3dTcGxpdHRlciA9IHRoaXMudGVycmlhLnNob3dTcGxpdHRlcjtcbiAgICAgIGNvbnN0IHNwbGl0UG9zaXRpb24gPSB0aGlzLnRlcnJpYS5zcGxpdFBvc2l0aW9uO1xuICAgICAgaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgTWFwcGFibGVNaXhpbi5pc01peGVkSW50byhpdGVtKSAmJlxuICAgICAgICAgIGhhc1RyYWl0cyhpdGVtLCBTcGxpdHRlclRyYWl0cywgXCJzcGxpdERpcmVjdGlvblwiKVxuICAgICAgICApIHtcbiAgICAgICAgICBjb25zdCBsYXllcnMgPSB0aGlzLmdldEltYWdlcnlMYXllcnNGb3JJdGVtKGl0ZW0pO1xuICAgICAgICAgIGNvbnN0IHNwbGl0RGlyZWN0aW9uID0gaXRlbS5zcGxpdERpcmVjdGlvbjtcblxuICAgICAgICAgIGxheWVycy5mb3JFYWNoKFxuICAgICAgICAgICAgYWN0aW9uKChsYXllcikgPT4ge1xuICAgICAgICAgICAgICBpZiAoc2hvd1NwbGl0dGVyKSB7XG4gICAgICAgICAgICAgICAgbGF5ZXIuc3BsaXREaXJlY3Rpb24gPSBzcGxpdERpcmVjdGlvbjtcbiAgICAgICAgICAgICAgICBsYXllci5zcGxpdFBvc2l0aW9uID0gc3BsaXRQb3NpdGlvbjtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBsYXllci5zcGxpdERpcmVjdGlvbiA9IFNwbGl0RGlyZWN0aW9uLk5PTkU7XG4gICAgICAgICAgICAgICAgbGF5ZXIuc3BsaXRQb3NpdGlvbiA9IHNwbGl0UG9zaXRpb247XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB0aGlzLm5vdGlmeVJlcGFpbnRSZXF1aXJlZCgpO1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0SW1hZ2VyeUxheWVyc0Zvckl0ZW0oXG4gICAgaXRlbTogTWFwcGFibGVNaXhpbi5JbnN0YW5jZVxuICApOiAoSW1hZ2VyeVByb3ZpZGVyTGVhZmxldFRpbGVMYXllciB8IEltYWdlcnlQcm92aWRlckxlYWZsZXRHcmlkTGF5ZXIpW10ge1xuICAgIHJldHVybiBmaWx0ZXJPdXRVbmRlZmluZWQoXG4gICAgICBpdGVtLm1hcEl0ZW1zLm1hcCgobSkgPT4ge1xuICAgICAgICBpZiAoSW1hZ2VyeVBhcnRzLmlzKG0pKSB7XG4gICAgICAgICAgY29uc3QgbGF5ZXIgPSB0aGlzLl9tYWtlSW1hZ2VyeUxheWVyRnJvbVBhcnRzKG0sIGl0ZW0pO1xuICAgICAgICAgIHJldHVybiBsYXllciBpbnN0YW5jZW9mIEltYWdlcnlQcm92aWRlckxlYWZsZXRUaWxlTGF5ZXIgfHxcbiAgICAgICAgICAgIGxheWVyIGluc3RhbmNlb2YgSW1hZ2VyeVByb3ZpZGVyTGVhZmxldEdyaWRMYXllclxuICAgICAgICAgICAgPyBsYXllclxuICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb21wdXRlcyB0aGUgc2NyZWVuIHBvc2l0aW9uIG9mIGEgZ2l2ZW4gd29ybGQgcG9zaXRpb24uXG4gICAqIEBwYXJhbSBwb3NpdGlvbiBUaGUgd29ybGQgcG9zaXRpb24gaW4gRWFydGgtY2VudGVyZWQgRml4ZWQgY29vcmRpbmF0ZXMuXG4gICAqIEBwYXJhbSBbcmVzdWx0XSBUaGUgaW5zdGFuY2UgdG8gd2hpY2ggdG8gY29weSB0aGUgcmVzdWx0LlxuICAgKiBAcmV0dXJuIFRoZSBzY3JlZW4gcG9zaXRpb24sIG9yIHVuZGVmaW5lZCBpZiB0aGUgcG9zaXRpb24gaXMgbm90IG9uIHRoZSBzY3JlZW4uXG4gICAqL1xuICBwcml2YXRlIF9jb21wdXRlUG9zaXRpb25PblNjcmVlbihcbiAgICBwb3NpdGlvbjogQ2FydGVzaWFuMyxcbiAgICByZXN1bHQ/OiBDYXJ0ZXNpYW4yXG4gICk6IENhcnRlc2lhbjIge1xuICAgIGNvbnN0IGNhcnRvZ3JhcGhpY1NjcmF0Y2ggPSBuZXcgQ2FydG9ncmFwaGljKCk7XG4gICAgY29uc3QgY2FydG9ncmFwaGljID0gRWxsaXBzb2lkLldHUzg0LmNhcnRlc2lhblRvQ2FydG9ncmFwaGljKFxuICAgICAgcG9zaXRpb24sXG4gICAgICBjYXJ0b2dyYXBoaWNTY3JhdGNoXG4gICAgKTtcbiAgICBjb25zdCBwb2ludCA9IHRoaXMubWFwLmxhdExuZ1RvQ29udGFpbmVyUG9pbnQoXG4gICAgICBMLmxhdExuZyhcbiAgICAgICAgQ2VzaXVtTWF0aC50b0RlZ3JlZXMoY2FydG9ncmFwaGljLmxhdGl0dWRlKSxcbiAgICAgICAgQ2VzaXVtTWF0aC50b0RlZ3JlZXMoY2FydG9ncmFwaGljLmxvbmdpdHVkZSlcbiAgICAgIClcbiAgICApO1xuXG4gICAgaWYgKGlzRGVmaW5lZChyZXN1bHQpKSB7XG4gICAgICByZXN1bHQueCA9IHBvaW50Lng7XG4gICAgICByZXN1bHQueSA9IHBvaW50Lnk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc3VsdCA9IG5ldyBDYXJ0ZXNpYW4yKHBvaW50LngsIHBvaW50LnkpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgcHJpdmF0ZSBfc2VsZWN0RmVhdHVyZShmZWF0dXJlOiBUZXJyaWFGZWF0dXJlIHwgdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5faGlnaGxpZ2h0RmVhdHVyZShmZWF0dXJlKTtcblxuICAgIGlmIChpc0RlZmluZWQoZmVhdHVyZSkgJiYgaXNEZWZpbmVkKGZlYXR1cmUucG9zaXRpb24pKSB7XG4gICAgICBjb25zdCBjYXJ0b2dyYXBoaWNTY3JhdGNoID0gbmV3IENhcnRvZ3JhcGhpYygpO1xuICAgICAgY29uc3QgY2FydGVzaWFuUG9zaXRpb24gPSBmZWF0dXJlLnBvc2l0aW9uLmdldFZhbHVlKFxuICAgICAgICB0aGlzLnRlcnJpYS50aW1lbGluZUNsb2NrLmN1cnJlbnRUaW1lXG4gICAgICApO1xuICAgICAgaWYgKGNhcnRlc2lhblBvc2l0aW9uID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9yLmFuaW1hdGVTZWxlY3Rpb25JbmRpY2F0b3JEZXBhcnQoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgY2FydG9ncmFwaGljID0gRWxsaXBzb2lkLldHUzg0LmNhcnRlc2lhblRvQ2FydG9ncmFwaGljKFxuICAgICAgICBjYXJ0ZXNpYW5Qb3NpdGlvbixcbiAgICAgICAgY2FydG9ncmFwaGljU2NyYXRjaFxuICAgICAgKTtcbiAgICAgIHRoaXMuX3NlbGVjdGlvbkluZGljYXRvci5zZXRMYXRMbmcoXG4gICAgICAgIEwubGF0TG5nKFtcbiAgICAgICAgICBDZXNpdW1NYXRoLnRvRGVncmVlcyhjYXJ0b2dyYXBoaWMubGF0aXR1ZGUpLFxuICAgICAgICAgIENlc2l1bU1hdGgudG9EZWdyZWVzKGNhcnRvZ3JhcGhpYy5sb25naXR1ZGUpXG4gICAgICAgIF0pXG4gICAgICApO1xuICAgICAgdGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9yLmFuaW1hdGVTZWxlY3Rpb25JbmRpY2F0b3JBcHBlYXIoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9yLmFuaW1hdGVTZWxlY3Rpb25JbmRpY2F0b3JEZXBhcnQoKTtcbiAgICB9XG4gIH1cblxuICBnZXRDbGlwc0ZvclNwbGl0dGVyKCk6IGFueSB7XG4gICAgbGV0IGNsaXBMZWZ0OiBzdHJpbmcgPSBcIlwiO1xuICAgIGxldCBjbGlwUmlnaHQ6IHN0cmluZyA9IFwiXCI7XG4gICAgbGV0IGNsaXBQb3NpdGlvbldpdGhpbk1hcDogbnVtYmVyID0gMDtcbiAgICBsZXQgY2xpcFg6IG51bWJlciA9IDA7XG4gICAgaWYgKHRoaXMudGVycmlhLnNob3dTcGxpdHRlcikge1xuICAgICAgY29uc3QgbWFwID0gdGhpcy5tYXA7XG4gICAgICBjb25zdCBzaXplID0gbWFwLmdldFNpemUoKTtcbiAgICAgIGNvbnN0IG53ID0gbWFwLmNvbnRhaW5lclBvaW50VG9MYXllclBvaW50KFswLCAwXSk7XG4gICAgICBjb25zdCBzZSA9IG1hcC5jb250YWluZXJQb2ludFRvTGF5ZXJQb2ludChzaXplKTtcbiAgICAgIGNsaXBQb3NpdGlvbldpdGhpbk1hcCA9IHNpemUueCAqIHRoaXMudGVycmlhLnNwbGl0UG9zaXRpb247XG4gICAgICBjbGlwWCA9IE1hdGgucm91bmQobncueCArIGNsaXBQb3NpdGlvbldpdGhpbk1hcCk7XG4gICAgICBjbGlwTGVmdCA9IFwicmVjdChcIiArIFtudy55LCBjbGlwWCwgc2UueSwgbncueF0uam9pbihcInB4LFwiKSArIFwicHgpXCI7XG4gICAgICBjbGlwUmlnaHQgPSBcInJlY3QoXCIgKyBbbncueSwgc2UueCwgc2UueSwgY2xpcFhdLmpvaW4oXCJweCxcIikgKyBcInB4KVwiO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBsZWZ0OiBjbGlwTGVmdCxcbiAgICAgIHJpZ2h0OiBjbGlwUmlnaHQsXG4gICAgICBjbGlwUG9zaXRpb25XaXRoaW5NYXA6IGNsaXBQb3NpdGlvbldpdGhpbk1hcCxcbiAgICAgIGNsaXBYOiBjbGlwWFxuICAgIH07XG4gIH1cblxuICBpc1NwbGl0dGVyRHJhZ1RodW1iKGVsZW1lbnQ6IEhUTUxFbGVtZW50KTogYm9vbGVhbiB8IFwiXCIge1xuICAgIHJldHVybiAoXG4gICAgICBlbGVtZW50LmNsYXNzTmFtZSAmJlxuICAgICAgZWxlbWVudC5jbGFzc05hbWUuaW5kZXhPZiAmJlxuICAgICAgZWxlbWVudC5jbGFzc05hbWUuaW5kZXhPZihcInRqcy1zcGxpdHRlcl9fdGh1bWJcIikgPj0gMFxuICAgICk7XG4gIH1cblxuICBjYXB0dXJlU2NyZWVuc2hvdCgpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIC8vIFRlbXBvcmFyaWx5IGhpZGUgdGhlIG1hcCBjcmVkaXRzLlxuICAgIHRoaXMuX2F0dHJpYnV0aW9uQ29udHJvbC5yZW1vdmUoKTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBodG1sMmNhbnZhcyBjYW4ndCBoYW5kbGUgdGhlIGNsaXAgc3R5bGUgd2hpY2ggaXMgdXNlZCBmb3IgdGhlIHNwbGl0dGVyLiBTbyBpZiB0aGUgc3BsaXR0ZXIgaXMgYWN0aXZlLCB3ZSByZW5kZXJcbiAgICAgIC8vIGEgbGVmdCBpbWFnZSBhbmQgYSByaWdodCBpbWFnZSBhbmQgY29tcG9zZSB0aGVtLiBBbHNvIHJlbW92ZSB0aGUgc3BsaXR0ZXIgZHJhZyB0aHVtYi5cbiAgICAgIGxldCBwcm9taXNlOiBhbnk7XG4gICAgICBpZiAodGhpcy50ZXJyaWEuc2hvd1NwbGl0dGVyKSB7XG4gICAgICAgIGNvbnN0IGNsaXBzID0gdGhpcy5nZXRDbGlwc0ZvclNwbGl0dGVyKCk7XG4gICAgICAgIGNvbnN0IGNsaXBMZWZ0ID0gY2xpcHMubGVmdC5yZXBsYWNlKC8gL2csIFwiXCIpO1xuICAgICAgICBjb25zdCBjbGlwUmlnaHQgPSBjbGlwcy5yaWdodC5yZXBsYWNlKC8gL2csIFwiXCIpO1xuICAgICAgICBwcm9taXNlID0gaHRtbDJjYW52YXModGhpcy5tYXAuZ2V0Q29udGFpbmVyKCksIHtcbiAgICAgICAgICB1c2VDT1JTOiB0cnVlLFxuICAgICAgICAgIGlnbm9yZUVsZW1lbnRzOiAoZWxlbWVudDogSFRNTEVsZW1lbnQpID0+XG4gICAgICAgICAgICAoZWxlbWVudC5zdHlsZS5jbGlwICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5jbGlwICE9PSBudWxsICYmXG4gICAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUuY2xpcC5yZXBsYWNlKC8gL2csIFwiXCIpID09PSBjbGlwUmlnaHQpIHx8XG4gICAgICAgICAgICB0aGlzLmlzU3BsaXR0ZXJEcmFnVGh1bWIoZWxlbWVudClcbiAgICAgICAgfSkudGhlbigobGVmdENhbnZhczogSFRNTENhbnZhc0VsZW1lbnQpID0+IHtcbiAgICAgICAgICByZXR1cm4gaHRtbDJjYW52YXModGhpcy5tYXAuZ2V0Q29udGFpbmVyKCksIHtcbiAgICAgICAgICAgIHVzZUNPUlM6IHRydWUsXG4gICAgICAgICAgICBpZ25vcmVFbGVtZW50czogKGVsZW1lbnQ6IEhUTUxFbGVtZW50KSA9PlxuICAgICAgICAgICAgICAoZWxlbWVudC5zdHlsZS5jbGlwICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLmNsaXAgIT09IG51bGwgJiZcbiAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLmNsaXAucmVwbGFjZSgvIC9nLCBcIlwiKSA9PT0gY2xpcExlZnQpIHx8XG4gICAgICAgICAgICAgIHRoaXMuaXNTcGxpdHRlckRyYWdUaHVtYihlbGVtZW50KVxuICAgICAgICAgIH0pLnRoZW4oKHJpZ2h0Q2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29tYmluZWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAgICAgICAgICAgY29tYmluZWQud2lkdGggPSBsZWZ0Q2FudmFzLndpZHRoO1xuICAgICAgICAgICAgY29tYmluZWQuaGVpZ2h0ID0gbGVmdENhbnZhcy5oZWlnaHQ7XG4gICAgICAgICAgICBjb25zdCBjb250ZXh0OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgfCBudWxsID1cbiAgICAgICAgICAgICAgY29tYmluZWQuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgICAgICAgaWYgKGNvbnRleHQgPT09IHVuZGVmaW5lZCB8fCBjb250ZXh0ID09PSBudWxsKSB7XG4gICAgICAgICAgICAgIC8vIEVycm9yXG4gICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBzcGxpdCA9IGNsaXBzLmNsaXBQb3NpdGlvbldpdGhpbk1hcCAqIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvO1xuICAgICAgICAgICAgY29udGV4dC5kcmF3SW1hZ2UoXG4gICAgICAgICAgICAgIGxlZnRDYW52YXMsXG4gICAgICAgICAgICAgIDAsXG4gICAgICAgICAgICAgIDAsXG4gICAgICAgICAgICAgIHNwbGl0LFxuICAgICAgICAgICAgICBjb21iaW5lZC5oZWlnaHQsXG4gICAgICAgICAgICAgIDAsXG4gICAgICAgICAgICAgIDAsXG4gICAgICAgICAgICAgIHNwbGl0LFxuICAgICAgICAgICAgICBjb21iaW5lZC5oZWlnaHRcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjb250ZXh0LmRyYXdJbWFnZShcbiAgICAgICAgICAgICAgcmlnaHRDYW52YXMsXG4gICAgICAgICAgICAgIHNwbGl0LFxuICAgICAgICAgICAgICAwLFxuICAgICAgICAgICAgICBjb21iaW5lZC53aWR0aCAtIHNwbGl0LFxuICAgICAgICAgICAgICBjb21iaW5lZC5oZWlnaHQsXG4gICAgICAgICAgICAgIHNwbGl0LFxuICAgICAgICAgICAgICAwLFxuICAgICAgICAgICAgICBjb21iaW5lZC53aWR0aCAtIHNwbGl0LFxuICAgICAgICAgICAgICBjb21iaW5lZC5oZWlnaHRcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZXR1cm4gY29tYmluZWQ7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcHJvbWlzZSA9IGh0bWwyY2FudmFzKHRoaXMubWFwLmdldENvbnRhaW5lcigpLCB7XG4gICAgICAgICAgdXNlQ09SUzogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHByb21pc2VcbiAgICAgICAgLnRoZW4oKGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQpID0+IHtcbiAgICAgICAgICByZXR1cm4gY2FudmFzLnRvRGF0YVVSTChcImltYWdlL3BuZ1wiKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICAgIHRoaXMuX2F0dHJpYnV0aW9uQ29udHJvbC5hZGRUbyh0aGlzLm1hcCk7XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHRoaXMuX2F0dHJpYnV0aW9uQ29udHJvbC5hZGRUbyh0aGlzLm1hcCk7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZSk7XG4gICAgfVxuICB9XG5cbiAgX2FkZFZlY3RvclRpbGVIaWdobGlnaHQoXG4gICAgaW1hZ2VyeVByb3ZpZGVyOiBQcm90b21hcHNJbWFnZXJ5UHJvdmlkZXIsXG4gICAgcmVjdGFuZ2xlOiBSZWN0YW5nbGVcbiAgKTogKCkgPT4gdm9pZCB7XG4gICAgY29uc3QgbWFwID0gdGhpcy5tYXA7XG4gICAgY29uc3Qgb3B0aW9uczogYW55ID0ge1xuICAgICAgb3BhY2l0eTogMSxcbiAgICAgIGJvdW5kczogcmVjdGFuZ2xlVG9MYXRMbmdCb3VuZHMocmVjdGFuZ2xlKVxuICAgIH07XG5cbiAgICBpZiAoaXNEZWZpbmVkKG1hcC5vcHRpb25zLm1heFpvb20pKSB7XG4gICAgICBvcHRpb25zLm1heFpvb20gPSBtYXAub3B0aW9ucy5tYXhab29tO1xuICAgIH1cblxuICAgIGNvbnN0IGxheWVyID0gbmV3IEltYWdlcnlQcm92aWRlckxlYWZsZXRHcmlkTGF5ZXIoXG4gICAgICB0aGlzLFxuICAgICAgaW1hZ2VyeVByb3ZpZGVyLFxuICAgICAgb3B0aW9uc1xuICAgICk7XG4gICAgbGF5ZXIuYWRkVG8obWFwKTtcbiAgICBsYXllci5icmluZ1RvRnJvbnQoKTtcblxuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICBtYXAucmVtb3ZlTGF5ZXIobGF5ZXIpO1xuICAgIH07XG4gIH1cbn1cblxuZnVuY3Rpb24gaXNJbWFnZXJ5TGF5ZXIoXG4gIHNvbWVMYXllcjogTC5MYXllclxuKTogc29tZUxheWVyIGlzIEltYWdlcnlQcm92aWRlckxlYWZsZXRUaWxlTGF5ZXIge1xuICByZXR1cm4gXCJpbWFnZXJ5UHJvdmlkZXJcIiBpbiBzb21lTGF5ZXI7XG59XG5cbmZ1bmN0aW9uIGlzRGF0YVNvdXJjZShvYmplY3Q6IE1hcEl0ZW0pOiBvYmplY3QgaXMgRGF0YVNvdXJjZSB7XG4gIHJldHVybiBcImVudGl0aWVzXCIgaW4gb2JqZWN0O1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Models/Leaflet.ts\n\n}");

/***/ }),

/***/ "./packages/terriajs/lib/Models/LeafletAttribution.ts":
/*!************************************************************!*\
  !*** ./packages/terriajs/lib/Models/LeafletAttribution.ts ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LeafletAttribution: () => (/* binding */ LeafletAttribution)\n/* harmony export */ });\n/* harmony import */ var core_js_modules_es_array_reverse_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! core-js/modules/es.array.reverse.js */ \"./node_modules/core-js/modules/es.array.reverse.js\");\n/* harmony import */ var core_js_modules_es_array_reverse_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(core_js_modules_es_array_reverse_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var mobx__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! mobx */ \"./node_modules/mobx/dist/mobx.esm.js\");\n/* harmony import */ var leaflet__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\");\n/* harmony import */ var leaflet__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(leaflet__WEBPACK_IMPORTED_MODULE_2__);\n\nvar _class, _descriptor;\nfunction _initializerDefineProperty(e, i, r, l) { r && Object.defineProperty(e, i, { enumerable: r.enumerable, configurable: r.configurable, writable: r.writable, value: r.initializer ? r.initializer.call(l) : void 0 }); }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction _applyDecoratedDescriptor(i, e, r, n, l) { var a = {}; return Object.keys(n).forEach(function (i) { a[i] = n[i]; }), a.enumerable = !!a.enumerable, a.configurable = !!a.configurable, (\"value\" in a || a.initializer) && (a.writable = !0), a = r.slice().reverse().reduce(function (r, n) { return n(i, e, r) || r; }, a), l && void 0 !== a.initializer && (a.value = a.initializer ? a.initializer.call(l) : void 0, a.initializer = void 0), void 0 === a.initializer ? (Object.defineProperty(i, e, a), null) : a; }\nfunction _initializerWarningHelper(r, e) { throw Error(\"Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.\"); }\n\n\nlet LeafletAttribution = (_class = class LeafletAttribution extends (leaflet__WEBPACK_IMPORTED_MODULE_2___default().Control).Attribution {\n  constructor(terria) {\n    const options = {\n      position: \"bottomleft\"\n    };\n    if (terria.configParameters.leafletAttributionPrefix) {\n      options.prefix = terria.configParameters.leafletAttributionPrefix;\n    }\n    super(options);\n    _defineProperty(this, \"_attributions\", void 0);\n    _defineProperty(this, \"map\", void 0);\n    _defineProperty(this, \"_container\", void 0);\n    _initializerDefineProperty(this, \"dataAttributions\", _descriptor, this);\n    (0,mobx__WEBPACK_IMPORTED_MODULE_1__.makeObservable)(this);\n    this._attributions = {};\n    this.dataAttributions = (0,mobx__WEBPACK_IMPORTED_MODULE_1__.observable)([]);\n  }\n  onAdd(map) {\n    map.attributionControl = this;\n    this.map = map;\n    this._container = leaflet__WEBPACK_IMPORTED_MODULE_2___default().DomUtil.create(\"div\", \"leaflet-control-attribution\");\n    leaflet__WEBPACK_IMPORTED_MODULE_2___default().DomEvent.disableClickPropagation(this._container);\n    map.eachLayer(layer => {\n      if (layer.getAttribution) {\n        const att = layer.getAttribution();\n        if (att) this.addAttribution(att);\n      }\n    });\n    return this._container;\n  }\n  onRemove() {\n    this.map = undefined;\n  }\n  _update() {\n    if (!this.map) {\n      return;\n    }\n    const attribs = [];\n    const attributions = this._attributions;\n    for (const i in attributions) {\n      if (attributions[i]) {\n        attribs.push(i);\n      }\n    }\n  }\n  addAttribution(text) {\n    super.addAttribution(text);\n    if (this.map) {\n      (0,mobx__WEBPACK_IMPORTED_MODULE_1__.runInAction)(() => {\n        this.dataAttributions.push(text);\n      });\n    }\n    return this;\n  }\n  removeAttribution(text) {\n    super.removeAttribution(text);\n    if (this.map) {\n      (0,mobx__WEBPACK_IMPORTED_MODULE_1__.runInAction)(() => {\n        this.dataAttributions.remove(text);\n      });\n    }\n    return this;\n  }\n  get attributions() {\n    const attributionsList = [];\n    const attributions = this._attributions;\n    for (const i in attributions) {\n      if (attributions[i]) {\n        attributionsList.push(i);\n      }\n    }\n    return attributionsList;\n  }\n  get prefix() {\n    if (!this.options.prefix) return undefined;\n    return \"\".concat(this.options.prefix);\n  }\n}, _descriptor = _applyDecoratedDescriptor(_class.prototype, \"dataAttributions\", [mobx__WEBPACK_IMPORTED_MODULE_1__.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _class);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTW9kZWxzL0xlYWZsZXRBdHRyaWJ1dGlvbi50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBTUE7QUFHQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF4RkE7QUFBQTtBQUFBO0FBQUE7QUFBQSIsInNvdXJjZXMiOlsid2VicGFjazovL3RlcnJpYWpzLW1hcC8uL3BhY2thZ2VzL3RlcnJpYWpzL2xpYi9Nb2RlbHMvTGVhZmxldEF0dHJpYnV0aW9uLnRzPzdmMDEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgSU9ic2VydmFibGVBcnJheSxcbiAgcnVuSW5BY3Rpb24sXG4gIG9ic2VydmFibGUsXG4gIG1ha2VPYnNlcnZhYmxlXG59IGZyb20gXCJtb2J4XCI7XG5pbXBvcnQgTCBmcm9tIFwibGVhZmxldFwiO1xuaW1wb3J0IFRlcnJpYSBmcm9tIFwiLi9UZXJyaWFcIjtcblxuZXhwb3J0IGNsYXNzIExlYWZsZXRBdHRyaWJ1dGlvbiBleHRlbmRzIEwuQ29udHJvbC5BdHRyaWJ1dGlvbiB7XG4gIHByaXZhdGUgcmVhZG9ubHkgX2F0dHJpYnV0aW9uczogUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcbiAgcHJpdmF0ZSBtYXA/OiBMLk1hcDtcbiAgcHJpdmF0ZSBfY29udGFpbmVyITogSFRNTEVsZW1lbnQ7XG4gIEBvYnNlcnZhYmxlXG4gIGRhdGFBdHRyaWJ1dGlvbnM6IElPYnNlcnZhYmxlQXJyYXk8c3RyaW5nPjtcblxuICBjb25zdHJ1Y3Rvcih0ZXJyaWE6IFRlcnJpYSkge1xuICAgIGNvbnN0IG9wdGlvbnM6IEwuQ29udHJvbC5BdHRyaWJ1dGlvbk9wdGlvbnMgPSB7XG4gICAgICBwb3NpdGlvbjogXCJib3R0b21sZWZ0XCJcbiAgICB9O1xuICAgIGlmICh0ZXJyaWEuY29uZmlnUGFyYW1ldGVycy5sZWFmbGV0QXR0cmlidXRpb25QcmVmaXgpIHtcbiAgICAgIG9wdGlvbnMucHJlZml4ID0gdGVycmlhLmNvbmZpZ1BhcmFtZXRlcnMubGVhZmxldEF0dHJpYnV0aW9uUHJlZml4O1xuICAgIH1cbiAgICBzdXBlcihvcHRpb25zKTtcbiAgICBtYWtlT2JzZXJ2YWJsZSh0aGlzKTtcblxuICAgIHRoaXMuX2F0dHJpYnV0aW9ucyA9IHt9O1xuICAgIHRoaXMuZGF0YUF0dHJpYnV0aW9ucyA9IG9ic2VydmFibGUoW10pO1xuICB9XG5cbiAgb25BZGQobWFwOiBMLk1hcCk6IEhUTUxFbGVtZW50IHtcbiAgICBtYXAuYXR0cmlidXRpb25Db250cm9sID0gdGhpcztcbiAgICB0aGlzLm1hcCA9IG1hcDtcblxuICAgIHRoaXMuX2NvbnRhaW5lciA9IEwuRG9tVXRpbC5jcmVhdGUoXCJkaXZcIiwgXCJsZWFmbGV0LWNvbnRyb2wtYXR0cmlidXRpb25cIik7XG4gICAgTC5Eb21FdmVudC5kaXNhYmxlQ2xpY2tQcm9wYWdhdGlvbih0aGlzLl9jb250YWluZXIpO1xuXG4gICAgbWFwLmVhY2hMYXllcigobGF5ZXIpID0+IHtcbiAgICAgIGlmIChsYXllci5nZXRBdHRyaWJ1dGlvbikge1xuICAgICAgICBjb25zdCBhdHQgPSBsYXllci5nZXRBdHRyaWJ1dGlvbigpO1xuICAgICAgICBpZiAoYXR0KSB0aGlzLmFkZEF0dHJpYnV0aW9uKGF0dCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcy5fY29udGFpbmVyO1xuICB9XG5cbiAgb25SZW1vdmUoKTogdm9pZCB7XG4gICAgdGhpcy5tYXAgPSB1bmRlZmluZWQ7XG4gIH1cblxuICBfdXBkYXRlKCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5tYXApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBhdHRyaWJzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IGF0dHJpYnV0aW9ucyA9IHRoaXMuX2F0dHJpYnV0aW9ucztcbiAgICBmb3IgKGNvbnN0IGkgaW4gYXR0cmlidXRpb25zKSB7XG4gICAgICBpZiAoYXR0cmlidXRpb25zW2ldKSB7XG4gICAgICAgIGF0dHJpYnMucHVzaChpKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBhZGRBdHRyaWJ1dGlvbih0ZXh0OiBzdHJpbmcpOiB0aGlzIHtcbiAgICBzdXBlci5hZGRBdHRyaWJ1dGlvbih0ZXh0KTtcbiAgICBpZiAodGhpcy5tYXApIHtcbiAgICAgIHJ1bkluQWN0aW9uKCgpID0+IHtcbiAgICAgICAgdGhpcy5kYXRhQXR0cmlidXRpb25zLnB1c2godGV4dCk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICByZW1vdmVBdHRyaWJ1dGlvbih0ZXh0OiBzdHJpbmcpOiB0aGlzIHtcbiAgICBzdXBlci5yZW1vdmVBdHRyaWJ1dGlvbih0ZXh0KTtcbiAgICBpZiAodGhpcy5tYXApIHtcbiAgICAgIHJ1bkluQWN0aW9uKCgpID0+IHtcbiAgICAgICAgdGhpcy5kYXRhQXR0cmlidXRpb25zLnJlbW92ZSh0ZXh0KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGdldCBhdHRyaWJ1dGlvbnMoKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGF0dHJpYnV0aW9uc0xpc3Q6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgYXR0cmlidXRpb25zID0gdGhpcy5fYXR0cmlidXRpb25zO1xuICAgIGZvciAoY29uc3QgaSBpbiBhdHRyaWJ1dGlvbnMpIHtcbiAgICAgIGlmIChhdHRyaWJ1dGlvbnNbaV0pIHtcbiAgICAgICAgYXR0cmlidXRpb25zTGlzdC5wdXNoKGkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBhdHRyaWJ1dGlvbnNMaXN0O1xuICB9XG5cbiAgZ2V0IHByZWZpeCgpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIGlmICghdGhpcy5vcHRpb25zLnByZWZpeCkgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICByZXR1cm4gYCR7dGhpcy5vcHRpb25zLnByZWZpeH1gO1xuICB9XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Models/LeafletAttribution.ts\n\n}");

/***/ })

}]);