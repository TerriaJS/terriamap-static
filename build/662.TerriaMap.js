((self||window).webpackChunkterriajs_map=(self||window).webpackChunkterriajs_map||[]).push([[662],{26675:e=>{function t(e,t){const r=new RegExp(t,"g"),i=e.match(r);return i?i.length:0}e.exports=t,e.exports.default=t},27379:e=>{function t(e,t,r){const i=r&&r.debug||!1;i&&console.log("[xml-utils] getting "+t+" in "+e);const s="object"==typeof e?e.outer:e,n=s.slice(0,s.indexOf(">")+1),o=['"',"'"];for(let e=0;e<o.length;e++){const r=o[e],s=t+"\\="+r+"([^"+r+"]*)"+r;i&&console.log("[xml-utils] pattern:",s);const a=new RegExp(s).exec(n);if(i&&console.log("[xml-utils] match:",a),a)return a[1]}}e.exports=t,e.exports.default=t},41281:(e,t,r)=>{"use strict";r.r(t),r.d(t,{TIFFImageryProvider:()=>Kt,colorscales:()=>bt,default:()=>Kt,renderColorScaleToCanvas:()=>Tt});var i=r(79764),s=r(65572),n=r(90430),o=r(93657),a=r(90172),l=r(57634),h=r(93246),c=r(15639),f=r(56870),u=r(88163),g=r(78588),d=r(99651),p=r(90293);const m=new Map;function w(e,t){Array.isArray(e)||(e=[e]),e.forEach(e=>m.set(e,t))}async function C(e){const t=m.get(e.Compression);if(!t)throw new Error(`Unknown compression method identifier: ${e.Compression}`);return new(await t())(e)}w([void 0,1],()=>r.e(121).then(r.bind(r,35121)).then(e=>e.default)),w(5,()=>r.e(764).then(r.bind(r,12764)).then(e=>e.default)),w(6,()=>{throw new Error("old style JPEG compression is not supported.")}),w(7,()=>r.e(457).then(r.bind(r,76457)).then(e=>e.default)),w([8,32946],()=>Promise.all([r.e(148),r.e(424)]).then(r.bind(r,50424)).then(e=>e.default)),w(32773,()=>r.e(30).then(r.bind(r,1030)).then(e=>e.default)),w(34887,()=>Promise.all([r.e(148),r.e(414)]).then(r.bind(r,51414)).then(async e=>(await e.zstd.init(),e)).then(e=>e.default)),w(50001,()=>r.e(568).then(r.bind(r,6568)).then(e=>e.default));const A="undefined"!=typeof navigator&&navigator.hardwareConcurrency||2,y=class{constructor(e=A,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise(e=>{r.e(651).then(r.bind(r,67651)).then(t=>{e(t.create)})}),this._awaitingDecoder.then(t=>{this._awaitingDecoder=null,this.workers=[];for(let r=0;r<e;r++)this.workers.push({worker:t(),idle:!0})}))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,0===this.size?C(e).then(r=>r.decode(e,t)):new Promise(r=>{const i=this.workers.find(e=>e.idle)||this.workers[Math.floor(Math.random()*this.size)];i.idle=!1;const s=this.messageId++,n=e=>{e.data.id===s&&(i.idle=!0,r(e.data.decoded),i.worker.removeEventListener("message",n))};i.worker.addEventListener("message",n),i.worker.postMessage({fileDirectory:e,buffer:t,id:s},[t])})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}};function I(e){return(t,...r)=>D(e,t,r)}function b(e,t){return I(_(e,t).get)}const{apply:D,construct:S,defineProperty:v,get:E,getOwnPropertyDescriptor:_,getPrototypeOf:x,has:T,ownKeys:B,set:R,setPrototypeOf:G}=Reflect,{EPSILON:F,MAX_SAFE_INTEGER:M,isFinite:P,isNaN:k}=Number,{iterator:O,species:U,toStringTag:N,for:V}=Symbol,L=Object,{create:Z,defineProperty:W,freeze:X,is:H}=L,j=L.prototype,Y=(j.__lookupGetter__&&I(j.__lookupGetter__),L.hasOwn||I(j.hasOwnProperty),Array),K=(Y.isArray,Y.prototype),z=(I(K.join),I(K.push),I(K.toLocaleString),K[O]),$=I(z),{abs:q,trunc:J}=Math,Q=ArrayBuffer,ee=(Q.isView,Q.prototype),te=(I(ee.slice),b(ee,"byteLength"),"undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:null),re=(te&&b(te.prototype,"byteLength"),x(Uint8Array)),ie=(re.from,re.prototype),se=(ie[O],I(ie.keys),I(ie.values),I(ie.entries),I(ie.set),I(ie.reverse),I(ie.fill),I(ie.copyWithin),I(ie.sort),I(ie.slice),I(ie.subarray),b(ie,"buffer"),b(ie,"byteOffset"),b(ie,"length"),b(ie,N),Uint8Array),ne=Uint16Array,oe=Uint32Array,ae=Float32Array,le=x([][O]()),he=I(le.next),ce=I(function*(){}().next),fe=x(le),ue=DataView.prototype,ge=I(ue.getUint16),de=(I(ue.setUint16),TypeError,WeakSet.prototype),pe=(I(de.add),I(de.has),WeakMap),me=pe.prototype,we=I(me.get),Ce=(I(me.has),I(me.set)),Ae=new pe,ye=Z(null,{next:{value:function(){const e=we(Ae,this);return he(e)}},[O]:{value:function(){return this}}}),Ie=new pe,be=Z(fe,{next:{value:function(){const e=we(Ie,this);return ce(e)},writable:!0,configurable:!0}});for(const e of B(le))"next"!==e&&W(be,e,_(le,e));const De=new Q(4),Se=new ae(De),ve=new oe(De),Ee=new ne(512),_e=new se(512);for(let e=0;e<256;++e){const t=e-127;t<-24?(Ee[e]=0,Ee[256|e]=32768,_e[e]=24,_e[256|e]=24):t<-14?(Ee[e]=1024>>-t-14,Ee[256|e]=1024>>-t-14|32768,_e[e]=-t-1,_e[256|e]=-t-1):t<=15?(Ee[e]=t+15<<10,Ee[256|e]=t+15<<10|32768,_e[e]=13,_e[256|e]=13):t<128?(Ee[e]=31744,Ee[256|e]=64512,_e[e]=24,_e[256|e]=24):(Ee[e]=31744,Ee[256|e]=64512,_e[e]=13,_e[256|e]=13)}const xe=new oe(2048);for(let e=1;e<1024;++e){let t=e<<13,r=0;for(;!(8388608&t);)t<<=1,r-=8388608;t&=-8388609,r+=947912704,xe[e]=t|r}for(let e=1024;e<2048;++e)xe[e]=939524096+(e-1024<<13);const Te=new oe(64);for(let e=1;e<31;++e)Te[e]=e<<23;Te[31]=1199570944,Te[32]=2147483648;for(let e=33;e<63;++e)Te[e]=2147483648+(e-32<<23);Te[63]=3347054592;const Be=new ne(64);for(let e=1;e<64;++e)32!==e&&(Be[e]=1024);function Re(e,t,...r){return function(e){const t=e>>10;return ve[0]=xe[Be[t]+(1023&e)]+Te[t],Se[0]}(ge(e,t,...function(e){if(e[O]===z&&le.next===he)return e;const t=Z(ye);return Ce(Ae,t,$(e)),t}(r)))}var Ge=r(27379),Fe=r(60563),Me=r(98622);function Pe(e,t,r,i=1){return new(Object.getPrototypeOf(e).constructor)(t*r*i)}function ke(e,t,r){return(1-r)*e+r*t}function Oe(e,t,r){let i=0;for(let s=t;s<r;++s)i+=e[s];return i}function Ue(e,t,r){switch(e){case 1:if(t<=8)return new Uint8Array(r);if(t<=16)return new Uint16Array(r);if(t<=32)return new Uint32Array(r);break;case 2:if(8===t)return new Int8Array(r);if(16===t)return new Int16Array(r);if(32===t)return new Int32Array(r);break;case 3:switch(t){case 16:case 32:return new Float32Array(r);case 64:return new Float64Array(r)}}throw Error("Unsupported data format/bitsPerSample")}const Ne=class{constructor(e,t,r,i,s,n){this.fileDirectory=e,this.geoKeys=t,this.dataView=r,this.littleEndian=i,this.tiles=s?{}:null,this.isTiled=!e.StripOffsets;const o=e.PlanarConfiguration;if(this.planarConfiguration=void 0===o?1:o,1!==this.planarConfiguration&&2!==this.planarConfiguration)throw new Error("Invalid planar configuration.");this.source=n}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return void 0!==this.fileDirectory.SamplesPerPixel?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:void 0!==this.fileDirectory.RowsPerStrip?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,r=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(r<=8)return DataView.prototype.getUint8;if(r<=16)return DataView.prototype.getUint16;if(r<=32)return DataView.prototype.getUint32;break;case 2:if(r<=8)return DataView.prototype.getInt8;if(r<=16)return DataView.prototype.getInt16;if(r<=32)return DataView.prototype.getInt32;break;case 3:switch(r){case 16:return function(e,t){return Re(this,e,t)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){return Ue(this.getSampleFormat(e),this.getBitsPerSample(e),t)}async getTileOrStrip(e,t,r,i,s){const n=Math.ceil(this.getWidth()/this.getTileWidth()),o=Math.ceil(this.getHeight()/this.getTileHeight());let a;const{tiles:l}=this;let h,c;1===this.planarConfiguration?a=t*n+e:2===this.planarConfiguration&&(a=r*n*o+t*n+e),this.isTiled?(h=this.fileDirectory.TileOffsets[a],c=this.fileDirectory.TileByteCounts[a]):(h=this.fileDirectory.StripOffsets[a],c=this.fileDirectory.StripByteCounts[a]);const f=(await this.source.fetch([{offset:h,length:c}],s))[0];let u;return null!==l&&l[a]?u=l[a]:(u=(async()=>{let e=await i.decode(this.fileDirectory,f);const r=this.getSampleFormat(),s=this.getBitsPerSample();return function(e,t){return(1!==e&&2!==e||!(t<=32)||t%8!=0)&&(3!==e||16!==t&&32!==t&&64!==t)}(r,s)&&(e=function(e,t,r,i,s,n,o){const a=new DataView(e),l=2===r?1:i,h=Ue(t,s,2===r?o*n:o*n*i),c=parseInt("1".repeat(s),2);if(1===t){let e;e=1===r?i*s:s;let t=n*e;7&t&&(t=t+7&-8);for(let e=0;e<o;++e){const r=e*t;for(let t=0;t<n;++t){const i=r+t*l*s;for(let r=0;r<l;++r){const o=i+r*s,f=(e*n+t)*l+r,u=Math.floor(o/8),g=o%8;if(g+s<=8)h[f]=a.getUint8(u)>>8-s-g&c;else if(g+s<=16)h[f]=a.getUint16(u)>>16-s-g&c;else if(g+s<=24){const e=a.getUint16(u)<<8|a.getUint8(u+2);h[f]=e>>24-s-g&c}else h[f]=a.getUint32(u)>>32-s-g&c}}}}return h.buffer}(e,r,this.planarConfiguration,this.getSamplesPerPixel(),s,this.getTileWidth(),this.getBlockHeight(t))),e})(),null!==l&&(l[a]=u)),{x:e,y:t,sample:r,data:await u}}async _readRaster(e,t,r,i,s,n,o,a,l){const h=this.getTileWidth(),c=this.getTileHeight(),f=this.getWidth(),u=this.getHeight(),g=Math.max(Math.floor(e[0]/h),0),d=Math.min(Math.ceil(e[2]/h),Math.ceil(f/h)),p=Math.max(Math.floor(e[1]/c),0),m=Math.min(Math.ceil(e[3]/c),Math.ceil(u/c)),w=e[2]-e[0];let C=this.getBytesPerPixel();const A=[],y=[];for(let e=0;e<t.length;++e)1===this.planarConfiguration?A.push(Oe(this.fileDirectory.BitsPerSample,0,t[e])/8):A.push(0),y.push(this.getReaderForSample(t[e]));const I=[],{littleEndian:b}=this;for(let n=p;n<m;++n)for(let o=g;o<d;++o){let a;1===this.planarConfiguration&&(a=this.getTileOrStrip(o,n,0,s,l));for(let g=0;g<t.length;++g){const d=g,p=t[g];2===this.planarConfiguration&&(C=this.getSampleByteSize(p),a=this.getTileOrStrip(o,n,p,s,l));const m=a.then(s=>{const n=s.data,o=new DataView(n),a=this.getBlockHeight(s.y),l=s.y*c,g=s.x*h,p=l+a,m=(s.x+1)*h,I=y[d],D=Math.min(a,a-(p-e[3]),u-l),S=Math.min(h,h-(m-e[2]),f-g);for(let s=Math.max(0,e[1]-l);s<D;++s)for(let n=Math.max(0,e[0]-g);n<S;++n){const a=(s*h+n)*C,c=I.call(o,a+A[d],b);let f;i?(f=(s+l-e[1])*w*t.length+(n+g-e[0])*t.length+d,r[f]=c):(f=(s+l-e[1])*w+n+g-e[0],r[d][f]=c)}});I.push(m)}}if(await Promise.all(I),n&&e[2]-e[0]!==n||o&&e[3]-e[1]!==o){let s;return s=i?function(e,t,r,i,s,n,o="nearest"){switch(o.toLowerCase()){case"nearest":return function(e,t,r,i,s,n){const o=t/i,a=r/s,l=Pe(e,i,s,n);for(let h=0;h<s;++h){const s=Math.min(Math.round(a*h),r-1);for(let r=0;r<i;++r){const a=Math.min(Math.round(o*r),t-1);for(let o=0;o<n;++o){const c=e[s*t*n+a*n+o];l[h*i*n+r*n+o]=c}}}return l}(e,t,r,i,s,n);case"bilinear":case"linear":return function(e,t,r,i,s,n){const o=t/i,a=r/s,l=Pe(e,i,s,n);for(let h=0;h<s;++h){const s=a*h,c=Math.floor(s),f=Math.min(Math.ceil(s),r-1);for(let r=0;r<i;++r){const a=o*r,u=a%1,g=Math.floor(a),d=Math.min(Math.ceil(a),t-1);for(let o=0;o<n;++o){const a=e[c*t*n+g*n+o],p=e[c*t*n+d*n+o],m=e[f*t*n+g*n+o],w=e[f*t*n+d*n+o],C=ke(ke(a,p,u),ke(m,w,u),s%1);l[h*i*n+r*n+o]=C}}}return l}(e,t,r,i,s,n);default:throw new Error(`Unsupported resampling method: '${o}'`)}}(r,e[2]-e[0],e[3]-e[1],n,o,t.length,a):function(e,t,r,i,s,n="nearest"){switch(n.toLowerCase()){case"nearest":return function(e,t,r,i,s){const n=t/i,o=r/s;return e.map(e=>{const a=Pe(e,i,s);for(let l=0;l<s;++l){const s=Math.min(Math.round(o*l),r-1);for(let r=0;r<i;++r){const o=Math.min(Math.round(n*r),t-1),h=e[s*t+o];a[l*i+r]=h}}return a})}(e,t,r,i,s);case"bilinear":case"linear":return function(e,t,r,i,s){const n=t/i,o=r/s;return e.map(e=>{const a=Pe(e,i,s);for(let l=0;l<s;++l){const s=o*l,h=Math.floor(s),c=Math.min(Math.ceil(s),r-1);for(let r=0;r<i;++r){const o=n*r,f=o%1,u=Math.floor(o),g=Math.min(Math.ceil(o),t-1),d=e[h*t+u],p=e[h*t+g],m=e[c*t+u],w=e[c*t+g],C=ke(ke(d,p,f),ke(m,w,f),s%1);a[l*i+r]=C}}return a})}(e,t,r,i,s);default:throw new Error(`Unsupported resampling method: '${n}'`)}}(r,e[2]-e[0],e[3]-e[1],n,o,a),s.width=n,s.height=o,s}return r.width=n||e[2]-e[0],r.height=o||e[3]-e[1],r}async readRasters({window:e,samples:t=[],interleave:r,pool:i=null,width:s,height:n,resampleMethod:o,fillValue:a,signal:l}={}){const h=e||[0,0,this.getWidth(),this.getHeight()];if(h[0]>h[2]||h[1]>h[3])throw new Error("Invalid subsets");const c=(h[2]-h[0])*(h[3]-h[1]),f=this.getSamplesPerPixel();if(t&&t.length){for(let e=0;e<t.length;++e)if(t[e]>=f)return Promise.reject(new RangeError(`Invalid sample index '${t[e]}'.`))}else for(let e=0;e<f;++e)t.push(e);let u;if(r)u=Ue(this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,Math.max.apply(null,this.fileDirectory.BitsPerSample),c*t.length),a&&u.fill(a);else{u=[];for(let e=0;e<t.length;++e){const r=this.getArrayForSample(t[e],c);Array.isArray(a)&&e<a.length?r.fill(a[e]):a&&!Array.isArray(a)&&r.fill(a),u.push(r)}}const g=i||await C(this.fileDirectory);return await this._readRaster(h,t,u,r,g,s,n,o,l)}async readRGB({window:e,interleave:t=!0,pool:r=null,width:i,height:s,resampleMethod:n,enableAlpha:o=!1,signal:a}={}){const l=e||[0,0,this.getWidth(),this.getHeight()];if(l[0]>l[2]||l[1]>l[3])throw new Error("Invalid subsets");const h=this.fileDirectory.PhotometricInterpretation;if(h===Me.ub.RGB){let l=[0,1,2];if(this.fileDirectory.ExtraSamples!==Me.AC.Unspecified&&o){l=[];for(let e=0;e<this.fileDirectory.BitsPerSample.length;e+=1)l.push(e)}return this.readRasters({window:e,interleave:t,samples:l,pool:r,width:i,height:s,resampleMethod:n,signal:a})}let c;switch(h){case Me.ub.WhiteIsZero:case Me.ub.BlackIsZero:case Me.ub.Palette:c=[0];break;case Me.ub.CMYK:c=[0,1,2,3];break;case Me.ub.YCbCr:case Me.ub.CIELab:c=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const f={window:l,interleave:!0,samples:c,pool:r,width:i,height:s,resampleMethod:n,signal:a},{fileDirectory:u}=this,g=await this.readRasters(f),d=2**this.fileDirectory.BitsPerSample[0];let p;switch(h){case Me.ub.WhiteIsZero:p=function(e,t){const{width:r,height:i}=e,s=new Uint8Array(r*i*3);let n;for(let r=0,i=0;r<e.length;++r,i+=3)n=256-e[r]/t*256,s[i]=n,s[i+1]=n,s[i+2]=n;return s}(g,d);break;case Me.ub.BlackIsZero:p=function(e,t){const{width:r,height:i}=e,s=new Uint8Array(r*i*3);let n;for(let r=0,i=0;r<e.length;++r,i+=3)n=e[r]/t*256,s[i]=n,s[i+1]=n,s[i+2]=n;return s}(g,d);break;case Me.ub.Palette:p=function(e,t){const{width:r,height:i}=e,s=new Uint8Array(r*i*3),n=t.length/3,o=t.length/3*2;for(let r=0,i=0;r<e.length;++r,i+=3){const a=e[r];s[i]=t[a]/65536*256,s[i+1]=t[a+n]/65536*256,s[i+2]=t[a+o]/65536*256}return s}(g,u.ColorMap);break;case Me.ub.CMYK:p=function(e){const{width:t,height:r}=e,i=new Uint8Array(t*r*3);for(let t=0,r=0;t<e.length;t+=4,r+=3){const s=e[t],n=e[t+1],o=e[t+2],a=e[t+3];i[r]=(255-s)/256*255*((255-a)/256),i[r+1]=(255-n)/256*255*((255-a)/256),i[r+2]=(255-o)/256*255*((255-a)/256)}return i}(g);break;case Me.ub.YCbCr:p=function(e){const{width:t,height:r}=e,i=new Uint8ClampedArray(t*r*3);for(let t=0,r=0;t<e.length;t+=3,r+=3){const s=e[t],n=e[t+1],o=e[t+2];i[r]=s+1.402*(o-128),i[r+1]=s-.34414*(n-128)-.71414*(o-128),i[r+2]=s+1.772*(n-128)}return i}(g);break;case Me.ub.CIELab:p=function(e){const{width:t,height:r}=e,i=new Uint8Array(t*r*3);for(let t=0,r=0;t<e.length;t+=3,r+=3){let s,n,o,a=(e[t+0]+16)/116,l=(e[t+1]<<24>>24)/500+a,h=a-(e[t+2]<<24>>24)/200;l=.95047*(l*l*l>.008856?l*l*l:(l-16/116)/7.787),a=1*(a*a*a>.008856?a*a*a:(a-16/116)/7.787),h=1.08883*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),s=3.2406*l+-1.5372*a+-.4986*h,n=-.9689*l+1.8758*a+.0415*h,o=.0557*l+-.204*a+1.057*h,s=s>.0031308?1.055*s**(1/2.4)-.055:12.92*s,n=n>.0031308?1.055*n**(1/2.4)-.055:12.92*n,o=o>.0031308?1.055*o**(1/2.4)-.055:12.92*o,i[r]=255*Math.max(0,Math.min(1,s)),i[r+1]=255*Math.max(0,Math.min(1,n)),i[r+2]=255*Math.max(0,Math.min(1,o))}return i}(g);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const e=new Uint8Array(p.length/3),t=new Uint8Array(p.length/3),r=new Uint8Array(p.length/3);for(let i=0,s=0;i<p.length;i+=3,++s)e[s]=p[i],t[s]=p[i+1],r[s]=p[i+2];p=[e,t,r]}return p.width=g.width,p.height=g.height,p}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const r=this.fileDirectory.GDAL_METADATA;let i=Fe(r,"Item");i=null===e?i.filter(e=>void 0===Ge(e,"sample")):i.filter(t=>Number(Ge(t,"sample"))===e);for(let e=0;e<i.length;++e){const r=i[e];t[Ge(r,"name")]=r.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&6===e.length)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,r=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(r)return 0===r[1]&&0===r[4]?[r[0],-r[5],r[10]]:[Math.sqrt(r[0]*r[0]+r[4]*r[4]),-Math.sqrt(r[1]*r[1]+r[5]*r[5]),r[10]];if(e){const[t,r,i]=e.getResolution();return[t*e.getWidth()/this.getWidth(),r*e.getHeight()/this.getHeight(),i*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return 1===this.geoKeys.GTRasterTypeGeoKey}getBoundingBox(e=!1){const t=this.getHeight(),r=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[e,i,s,n,o,a,l,h]=this.fileDirectory.ModelTransformation,c=[[0,0],[0,t],[r,0],[r,t]].map(([t,r])=>[n+e*t+i*r,h+o*t+a*r]),f=c.map(e=>e[0]),u=c.map(e=>e[1]);return[Math.min(...f),Math.min(...u),Math.max(...f),Math.max(...u)]}{const e=this.getOrigin(),i=this.getResolution(),s=e[0],n=e[1],o=s+i[0]*r,a=n+i[1]*t;return[Math.min(s,o),Math.min(n,a),Math.max(s,o),Math.max(n,a)]}}};class Ve{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const r=this.getUint32(e,t),i=this.getUint32(e+4,t);let s;if(t){if(s=r+2**32*i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*r+i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}getInt64(e,t){let r=0;const i=(128&this._dataView.getUint8(e+(t?7:0)))>0;let s=!0;for(let n=0;n<8;n++){let o=this._dataView.getUint8(e+(t?n:7-n));i&&(s?0!==o&&(o=255&~(o-1),s=!1):o=255&~o),r+=o*256**n}return i&&(r=-r),r}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return Re(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class Le{constructor(e,t,r,i){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=r,this._bigTiff=i}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),r=this.readUint32(e+4);let i;if(this._littleEndian){if(i=t+2**32*r,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}if(i=2**32*t+r,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}readInt64(e){let t=0;const r=(128&this._dataView.getUint8(e+(this._littleEndian?7:0)))>0;let i=!0;for(let s=0;s<8;s++){let n=this._dataView.getUint8(e+(this._littleEndian?s:7-s));r&&(i?0!==n&&(n=255&~(n-1),i=!1):n=255&~n),t+=n*256**s}return r&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}function Ze(e){if(void 0!==Object.fromEntries)return Object.fromEntries(e);const t={};for(const[r,i]of e)t[r.toLowerCase()]=i;return t}function We(e){return Ze(e.split("\r\n").map(e=>{const t=e.split(":").map(e=>e.trim());return t[0]=t[0].toLowerCase(),t}))}function Xe(e){let t,r,i;return e&&([,t,r,i]=e.match(/bytes (\d+)-(\d+)\/(\d+)/),t=parseInt(t,10),r=parseInt(r,10),i=parseInt(i,10)),{start:t,end:r,total:i}}class He{async fetch(e,t=void 0){return Promise.all(e.map(e=>this.fetchSlice(e,t)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class je extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if("number"==typeof e.maxAge&&0===e.maxAge)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if("function"==typeof this.onEviction)for(const[t,r]of e)this.onEviction(t,r.value)}_deleteIfExpired(e,t){return"number"==typeof t.expiry&&t.expiry<=Date.now()&&("function"==typeof this.onEviction&&this.onEviction(e,t.value),this.delete(e))}_getOrDeleteIfExpired(e,t){if(!1===this._deleteIfExpired(e,t))return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const r=t.get(e);return this._getItemValue(e,r)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,r]=e;this.cache.has(t)||!1===this._deleteIfExpired(t,r)&&(yield e)}for(const e of this.cache){const[t,r]=e;!1===this._deleteIfExpired(t,r)&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(!1===this._deleteIfExpired(e,t))return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:r=this.maxAge}={}){const i="number"==typeof r&&r!==Number.POSITIVE_INFINITY?Date.now()+r:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:i}):this._set(e,{value:t,expiry:i}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):!!this.oldCache.has(e)&&!this._deleteIfExpired(e,this.oldCache.get(e))}peek(e){return this.cache.has(e)?this._peek(e,this.cache):this.oldCache.has(e)?this._peek(e,this.oldCache):void 0}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],r=t.length-e;r<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(r>0&&this._emitEvictions(t.slice(0,r)),this.oldCache=new Map(t.slice(r)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,r]=e;!1===this._deleteIfExpired(t,r)&&(yield[t,r.value])}for(const e of this.oldCache){const[t,r]=e;this.cache.has(t)||!1===this._deleteIfExpired(t,r)&&(yield[t,r.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const r=e[t],[i,s]=r;!1===this._deleteIfExpired(i,s)&&(yield[i,s.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const r=e[t],[i,s]=r;this.cache.has(i)||!1===this._deleteIfExpired(i,s)&&(yield[i,s.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[r,i]of this.entriesAscending())e.call(t,i,r,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}class Ye extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,Ye),this.name="AbortError"}}class Ke extends Error{constructor(e,t){super(t),this.errors=e,this.message=t,this.name="AggregateError"}}const ze=Ke;class $e{constructor(e,t,r=null){this.offset=e,this.length=t,this.data=r}get top(){return this.offset+this.length}}class qe{constructor(e,t,r){this.offset=e,this.length=t,this.blockIds=r}}class Je extends He{constructor(e,{blockSize:t=65536,cacheSize:r=100}={}){super(),this.source=e,this.blockSize=t,this.blockCache=new je({maxSize:r,onEviction:(e,t)=>{this.evictedBlocks.set(e,t)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,t){const r=[],i=[],s=[];this.evictedBlocks.clear();for(const{offset:t,length:n}of e){let e=t+n;const{fileSize:o}=this;null!==o&&(e=Math.min(e,o));for(let n=Math.floor(t/this.blockSize)*this.blockSize;n<e;n+=this.blockSize){const e=Math.floor(n/this.blockSize);this.blockCache.has(e)||this.blockRequests.has(e)||(this.blockIdsToFetch.add(e),i.push(e)),this.blockRequests.has(e)&&r.push(this.blockRequests.get(e)),s.push(e)}}await async function(){return new Promise(e=>setTimeout(e,undefined))}(),this.fetchBlocks(t);const n=[];for(const e of i)this.blockRequests.has(e)&&n.push(this.blockRequests.get(e));await Promise.allSettled(r),await Promise.allSettled(n);const o=[],a=s.filter(e=>this.abortedBlockIds.has(e)||!this.blockCache.has(e));if(a.forEach(e=>this.blockIdsToFetch.add(e)),a.length>0&&t&&!t.aborted){this.fetchBlocks(null);for(const e of a){const t=this.blockRequests.get(e);if(!t)throw new Error(`Block ${e} is not in the block requests`);o.push(t)}await Promise.allSettled(o)}if(t&&t.aborted)throw new Ye("Request was aborted");const l=s.map(e=>this.blockCache.get(e)||this.evictedBlocks.get(e)),h=l.filter(e=>!e);if(h.length)throw new ze(h,"Request failed");const c=new Map(function(e,t){const r=Array.isArray(e)?e:Array.from(e),i=Array.isArray(t)?t:Array.from(t);return r.map((e,t)=>[e,i[t]])}(s,l));return this.readSliceData(e,c)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const t=this.groupBlocks(this.blockIdsToFetch),r=this.source.fetch(t,e);for(let i=0;i<t.length;++i){const s=t[i];for(const t of s.blockIds)this.blockRequests.set(t,(async()=>{try{const e=(await r)[i],s=t*this.blockSize,n=s-e.offset,o=Math.min(n+this.blockSize,e.data.byteLength),a=e.data.slice(n,o),l=new $e(s,a.byteLength,a,t);this.blockCache.set(t,l),this.abortedBlockIds.delete(t)}catch(r){if("AbortError"!==r.name)throw r;r.signal=e,this.blockCache.delete(t),this.abortedBlockIds.add(t)}finally{this.blockRequests.delete(t)}})())}this.blockIdsToFetch.clear()}}groupBlocks(e){const t=Array.from(e).sort((e,t)=>e-t);if(0===t.length)return[];let r=[],i=null;const s=[];for(const e of t)null===i||i+1===e?(r.push(e),i=e):(s.push(new qe(r[0]*this.blockSize,r.length*this.blockSize,r)),r=[e],i=e);return s.push(new qe(r[0]*this.blockSize,r.length*this.blockSize,r)),s}readSliceData(e,t){return e.map(e=>{let r=e.offset+e.length;null!==this.fileSize&&(r=Math.min(this.fileSize,r));const i=Math.floor(e.offset/this.blockSize),s=Math.floor(r/this.blockSize),n=new ArrayBuffer(e.length),o=new Uint8Array(n);for(let n=i;n<=s;++n){const i=t.get(n),s=i.offset-e.offset;let a,l=0,h=0;s<0?l=-s:s>0&&(h=s),a=i.top-r<0?i.length-l:r-i.offset-l;const c=new Uint8Array(i.data,l,a);o.set(c,h)}return n})}}class Qe{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class et{constructor(e){this.url=e}async request({headers:e,signal:t}={}){throw new Error("request is not implemented")}}class tt extends Qe{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class rt extends et{constructor(e,t){super(e),this.credentials=t}async request({headers:e,signal:t}={}){const r=await fetch(this.url,{headers:e,credentials:this.credentials,signal:t});return new tt(r)}}class it extends Qe{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class st extends et{constructRequest(e,t){return new Promise((r,i)=>{const s=new XMLHttpRequest;s.open("GET",this.url),s.responseType="arraybuffer";for(const[t,r]of Object.entries(e))s.setRequestHeader(t,r);s.onload=()=>{const e=s.response;r(new it(s,e))},s.onerror=i,s.onabort=()=>i(new Ye("Request aborted")),s.send(),t&&(t.aborted&&s.abort(),t.addEventListener("abort",()=>s.abort()))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}var nt=r(28625),ot=r(56504),at=r(6580),lt=r(48287).hp;class ht extends Qe{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class ct extends et{constructor(e){super(e),this.parsedUrl=at.parse(this.url),this.httpApi="http:"===this.parsedUrl.protocol?nt:ot}constructRequest(e,t){return new Promise((r,i)=>{const s=this.httpApi.get({...this.parsedUrl,headers:e},e=>{const t=new Promise(t=>{const r=[];e.on("data",e=>{r.push(e)}),e.on("end",()=>{const e=lt.concat(r).buffer;t(e)}),e.on("error",i)});r(new ht(e,t))});s.on("error",i),t&&(t.aborted&&s.destroy(new Ye("Request aborted")),t.addEventListener("abort",()=>s.destroy(new Ye("Request aborted"))))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class ft extends He{constructor(e,t,r,i){super(),this.client=e,this.headers=t,this.maxRanges=r,this.allowFullFile=i,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length,Promise.all(e.map(e=>this.fetchSlice(e,t))))}async fetchSlices(e,t){const r=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:e,length:t})=>`${e}-${e+t}`).join(",")}`},signal:t});if(r.ok){if(206===r.status){const{type:i,params:s}=function(e){const[t,...r]=e.split(";").map(e=>e.trim());return{type:t,params:Ze(r.map(e=>e.split("=")))}}(r.getHeader("content-type"));if("multipart/byteranges"===i){const e=function(e,t){let r=null;const i=new TextDecoder("ascii"),s=[],n=`--${t}`,o=`${n}--`;for(let t=0;t<10;++t)i.decode(new Uint8Array(e,t,n.length))===n&&(r=t);if(null===r)throw new Error("Could not find initial boundary");for(;r<e.byteLength;){const t=i.decode(new Uint8Array(e,r,Math.min(n.length+1024,e.byteLength-r)));if(0===t.length||t.startsWith(o))break;if(!t.startsWith(n))throw new Error("Part does not start with boundary");const a=t.substr(n.length+2);if(0===a.length)break;const l=a.indexOf("\r\n\r\n"),h=We(a.substr(0,l)),{start:c,end:f,total:u}=Xe(h["content-range"]),g=r+n.length+l+4,d=parseInt(f,10)+1-parseInt(c,10);s.push({headers:h,data:e.slice(g,g+d),offset:c,length:d,fileSize:u}),r=g+d+4}return s}(await r.getData(),s.boundary);return this._fileSize=e[0].fileSize||null,e}const n=await r.getData(),{start:o,end:a,total:l}=Xe(r.getHeader("content-range"));this._fileSize=l||null;const h=[{data:n,offset:o,length:a-o}];if(e.length>1){const r=await Promise.all(e.slice(1).map(e=>this.fetchSlice(e,t)));return h.concat(r)}return h}{if(!this.allowFullFile)throw new Error("Server responded with full file");const e=await r.getData();return this._fileSize=e.byteLength,[{data:e,offset:0,length:e.byteLength}]}}throw new Error("Error fetching data.")}async fetchSlice(e,t){const{offset:r,length:i}=e,s=await this.client.request({headers:{...this.headers,Range:`bytes=${r}-${r+i}`},signal:t});if(s.ok){if(206===s.status){const e=await s.getData(),{total:t}=Xe(s.getHeader("content-range"));return this._fileSize=t||null,{data:e,offset:r,length:i}}{if(!this.allowFullFile)throw new Error("Server responded with full file");const e=await s.getData();return this._fileSize=e.byteLength,{data:e,offset:0,length:e.byteLength}}}throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function ut(e,{blockSize:t,cacheSize:r}){return null===t?e:new Je(e,{blockSize:t,cacheSize:r})}class gt extends He{constructor(e){super(),this.file=e}async fetchSlice(e,t){return new Promise((r,i)=>{const s=this.file.slice(e.offset,e.offset+e.length),n=new FileReader;n.onload=e=>r(e.target.result),n.onerror=i,n.onabort=i,n.readAsArrayBuffer(s),t&&t.addEventListener("abort",()=>n.abort())})}}function dt(e){switch(e){case Me.s$.BYTE:case Me.s$.ASCII:case Me.s$.SBYTE:case Me.s$.UNDEFINED:return 1;case Me.s$.SHORT:case Me.s$.SSHORT:return 2;case Me.s$.LONG:case Me.s$.SLONG:case Me.s$.FLOAT:case Me.s$.IFD:return 4;case Me.s$.RATIONAL:case Me.s$.SRATIONAL:case Me.s$.DOUBLE:case Me.s$.LONG8:case Me.s$.SLONG8:case Me.s$.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${e}`)}}function pt(e,t,r,i){let s=null,n=null;const o=dt(t);switch(t){case Me.s$.BYTE:case Me.s$.ASCII:case Me.s$.UNDEFINED:s=new Uint8Array(r),n=e.readUint8;break;case Me.s$.SBYTE:s=new Int8Array(r),n=e.readInt8;break;case Me.s$.SHORT:s=new Uint16Array(r),n=e.readUint16;break;case Me.s$.SSHORT:s=new Int16Array(r),n=e.readInt16;break;case Me.s$.LONG:case Me.s$.IFD:s=new Uint32Array(r),n=e.readUint32;break;case Me.s$.SLONG:s=new Int32Array(r),n=e.readInt32;break;case Me.s$.LONG8:case Me.s$.IFD8:s=new Array(r),n=e.readUint64;break;case Me.s$.SLONG8:s=new Array(r),n=e.readInt64;break;case Me.s$.RATIONAL:s=new Uint32Array(2*r),n=e.readUint32;break;case Me.s$.SRATIONAL:s=new Int32Array(2*r),n=e.readInt32;break;case Me.s$.FLOAT:s=new Float32Array(r),n=e.readFloat32;break;case Me.s$.DOUBLE:s=new Float64Array(r),n=e.readFloat64;break;default:throw new RangeError(`Invalid field type: ${t}`)}if(t!==Me.s$.RATIONAL&&t!==Me.s$.SRATIONAL)for(let t=0;t<r;++t)s[t]=n.call(e,i+t*o);else for(let t=0;t<r;t+=2)s[t]=n.call(e,i+t*o),s[t+1]=n.call(e,i+(t*o+4));return t===Me.s$.ASCII?new TextDecoder("utf-8").decode(s):s}class mt{constructor(e,t,r){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=r}}class wt extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class Ct{async readRasters(e={}){const{window:t,width:r,height:i}=e;let{resX:s,resY:n,bbox:o}=e;const a=await this.getImage();let l=a;const h=await this.getImageCount(),c=a.getBoundingBox();if(t&&o)throw new Error('Both "bbox" and "window" passed.');if(r||i){if(t){const[e,r]=a.getOrigin(),[i,s]=a.getResolution();o=[e+t[0]*i,r+t[1]*s,e+t[2]*i,r+t[3]*s]}const e=o||c;if(r){if(s)throw new Error("Both width and resX passed");s=(e[2]-e[0])/r}if(i){if(n)throw new Error("Both width and resY passed");n=(e[3]-e[1])/i}}if(s||n){const e=[];for(let t=0;t<h;++t){const r=await this.getImage(t),{SubfileType:i,NewSubfileType:s}=r.fileDirectory;(0===t||2===i||1&s)&&e.push(r)}e.sort((e,t)=>e.getWidth()-t.getWidth());for(let t=0;t<e.length;++t){const r=e[t],i=(c[2]-c[0])/r.getWidth(),o=(c[3]-c[1])/r.getHeight();if(l=r,s&&s>i||n&&n>o)break}}let f=t;if(o){const[e,t]=a.getOrigin(),[r,i]=l.getResolution(a);f=[Math.round((o[0]-e)/r),Math.round((o[1]-t)/i),Math.round((o[2]-e)/r),Math.round((o[3]-t)/i)],f=[Math.min(f[0],f[2]),Math.min(f[1],f[3]),Math.max(f[0],f[2]),Math.max(f[1],f[3])]}return l.readRasters({...e,window:f})}}class At extends Ct{constructor(e,t,r,i,s={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=r,this.firstIFDOffset=i,this.cache=s.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const r=this.bigTiff?4048:1024;return new Le((await this.source.fetch([{offset:e,length:void 0!==t?t:r}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,r=this.bigTiff?8:2;let i=await this.getSlice(e);const s=this.bigTiff?i.readUint64(e):i.readUint16(e),n=s*t+(this.bigTiff?16:6);i.covers(e,n)||(i=await this.getSlice(e,n));const o={};let a=e+(this.bigTiff?8:2);for(let e=0;e<s;a+=t,++e){const e=i.readUint16(a),t=i.readUint16(a+2),r=this.bigTiff?i.readUint64(a+4):i.readUint32(a+4);let s,n;const l=dt(t),h=a+(this.bigTiff?12:8);if(l*r<=(this.bigTiff?8:4))s=pt(i,t,r,h);else{const e=i.readOffset(h),n=dt(t)*r;s=i.covers(e,n)?pt(i,t,r,e):pt(await this.getSlice(e,n),t,r,e)}n=1===r&&-1===Me.NZ.indexOf(e)&&t!==Me.s$.RATIONAL&&t!==Me.s$.SRATIONAL?s[0]:s,o[Me.$[e]]=n}const l=function(e){const t=e.GeoKeyDirectory;if(!t)return null;const r={};for(let i=4;i<=4*t[3];i+=4){const s=Me.Hm[t[i]],n=t[i+1]?Me.$[t[i+1]]:null,o=t[i+2],a=t[i+3];let l=null;if(n){if(l=e[n],null==l)throw new Error(`Could not get value of geoKey '${s}'.`);"string"==typeof l?l=l.substring(a,a+o-1):l.subarray&&(l=l.subarray(a,a+o),1===o&&(l=l[0]))}else l=a;r[s]=l}return r}(o),h=i.readOffset(e+r+t*s);return new mt(o,l,h)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(0===e)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){if(t instanceof wt)throw new wt(e);throw t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(0===t.nextIFDByteOffset)throw new wt(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new Ne(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(e){if(!(e instanceof wt))throw e;t=!1}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;let t=await this.getSlice(e,130);if("GDAL_STRUCTURAL_METADATA_SIZE="===pt(t,Me.s$.ASCII,30,e)){const r=pt(t,Me.s$.ASCII,130,e).split("\n")[0],i=Number(r.split("=")[1].split(" ")[0])+r.length;i>130&&(t=await this.getSlice(e,i));const s=pt(t,Me.s$.ASCII,i,e);this.ghostValues={},s.split("\n").filter(e=>e.length>0).map(e=>e.split("=")).forEach(([e,t])=>{this.ghostValues[e]=t})}return this.ghostValues}static async fromSource(e,t,r){const i=(await e.fetch([{offset:0,length:1024}],r))[0],s=new Ve(i),n=s.getUint16(0,0);let o;if(18761===n)o=!0;else{if(19789!==n)throw new TypeError("Invalid byte order value.");o=!1}const a=s.getUint16(2,o);let l;if(42===a)l=!1;else{if(43!==a)throw new TypeError("Invalid magic number.");if(l=!0,8!==s.getUint16(4,o))throw new Error("Unsupported offset byte-size.")}const h=l?s.getUint64(8,o):s.getUint32(4,o);return new At(e,o,l,h,t)}close(){return"function"==typeof this.source.close&&this.source.close()}}async function yt(e,t){return At.fromSource(new gt(e),t)}var It=r(48287).hp;const bt={viridis:new Uint8Array([68,1,84,255,68,2,86,255,69,4,87,255,69,5,89,255,70,7,90,255,70,8,92,255,70,10,93,255,70,11,94,255,71,13,96,255,71,14,97,255,71,16,99,255,71,17,100,255,71,19,101,255,72,20,103,255,72,22,104,255,72,23,105,255,72,24,106,255,72,26,108,255,72,27,109,255,72,28,110,255,72,29,111,255,72,31,112,255,72,32,113,255,72,33,115,255,72,35,116,255,72,36,117,255,72,37,118,255,72,38,119,255,72,40,120,255,72,41,121,255,71,42,122,255,71,44,122,255,71,45,123,255,71,46,124,255,71,47,125,255,70,48,126,255,70,50,126,255,70,51,127,255,70,52,128,255,69,53,129,255,69,55,129,255,69,56,130,255,68,57,131,255,68,58,131,255,68,59,132,255,67,61,132,255,67,62,133,255,66,63,133,255,66,64,134,255,66,65,134,255,65,66,135,255,65,68,135,255,64,69,136,255,64,70,136,255,63,71,136,255,63,72,137,255,62,73,137,255,62,74,137,255,62,76,138,255,61,77,138,255,61,78,138,255,60,79,138,255,60,80,139,255,59,81,139,255,59,82,139,255,58,83,139,255,58,84,140,255,57,85,140,255,57,86,140,255,56,88,140,255,56,89,140,255,55,90,140,255,55,91,141,255,54,92,141,255,54,93,141,255,53,94,141,255,53,95,141,255,52,96,141,255,52,97,141,255,51,98,141,255,51,99,141,255,50,100,142,255,50,101,142,255,49,102,142,255,49,103,142,255,49,104,142,255,48,105,142,255,48,106,142,255,47,107,142,255,47,108,142,255,46,109,142,255,46,110,142,255,46,111,142,255,45,112,142,255,45,113,142,255,44,113,142,255,44,114,142,255,44,115,142,255,43,116,142,255,43,117,142,255,42,118,142,255,42,119,142,255,42,120,142,255,41,121,142,255,41,122,142,255,41,123,142,255,40,124,142,255,40,125,142,255,39,126,142,255,39,127,142,255,39,128,142,255,38,129,142,255,38,130,142,255,38,130,142,255,37,131,142,255,37,132,142,255,37,133,142,255,36,134,142,255,36,135,142,255,35,136,142,255,35,137,142,255,35,138,141,255,34,139,141,255,34,140,141,255,34,141,141,255,33,142,141,255,33,143,141,255,33,144,141,255,33,145,140,255,32,146,140,255,32,146,140,255,32,147,140,255,31,148,140,255,31,149,139,255,31,150,139,255,31,151,139,255,31,152,139,255,31,153,138,255,31,154,138,255,30,155,138,255,30,156,137,255,30,157,137,255,31,158,137,255,31,159,136,255,31,160,136,255,31,161,136,255,31,161,135,255,31,162,135,255,32,163,134,255,32,164,134,255,33,165,133,255,33,166,133,255,34,167,133,255,34,168,132,255,35,169,131,255,36,170,131,255,37,171,130,255,37,172,130,255,38,173,129,255,39,173,129,255,40,174,128,255,41,175,127,255,42,176,127,255,44,177,126,255,45,178,125,255,46,179,124,255,47,180,124,255,49,181,123,255,50,182,122,255,52,182,121,255,53,183,121,255,55,184,120,255,56,185,119,255,58,186,118,255,59,187,117,255,61,188,116,255,63,188,115,255,64,189,114,255,66,190,113,255,68,191,112,255,70,192,111,255,72,193,110,255,74,193,109,255,76,194,108,255,78,195,107,255,80,196,106,255,82,197,105,255,84,197,104,255,86,198,103,255,88,199,101,255,90,200,100,255,92,200,99,255,94,201,98,255,96,202,96,255,99,203,95,255,101,203,94,255,103,204,92,255,105,205,91,255,108,205,90,255,110,206,88,255,112,207,87,255,115,208,86,255,117,208,84,255,119,209,83,255,122,209,81,255,124,210,80,255,127,211,78,255,129,211,77,255,132,212,75,255,134,213,73,255,137,213,72,255,139,214,70,255,142,214,69,255,144,215,67,255,147,215,65,255,149,216,64,255,152,216,62,255,155,217,60,255,157,217,59,255,160,218,57,255,162,218,55,255,165,219,54,255,168,219,52,255,170,220,50,255,173,220,48,255,176,221,47,255,178,221,45,255,181,222,43,255,184,222,41,255,186,222,40,255,189,223,38,255,192,223,37,255,194,223,35,255,197,224,33,255,200,224,32,255,202,225,31,255,205,225,29,255,208,225,28,255,210,226,27,255,213,226,26,255,216,226,25,255,218,227,25,255,221,227,24,255,223,227,24,255,226,228,24,255,229,228,25,255,231,228,25,255,234,229,26,255,236,229,27,255,239,229,28,255,241,229,29,255,244,230,30,255,246,230,32,255,248,230,33,255,251,231,35,255,253,231,37,255]),inferno:new Uint8Array([0,0,4,255,1,0,5,255,1,1,6,255,1,1,8,255,2,1,10,255,2,2,12,255,2,2,14,255,3,2,16,255,4,3,18,255,4,3,20,255,5,4,23,255,6,4,25,255,7,5,27,255,8,5,29,255,9,6,31,255,10,7,34,255,11,7,36,255,12,8,38,255,13,8,41,255,14,9,43,255,16,9,45,255,17,10,48,255,18,10,50,255,20,11,52,255,21,11,55,255,22,11,57,255,24,12,60,255,25,12,62,255,27,12,65,255,28,12,67,255,30,12,69,255,31,12,72,255,33,12,74,255,35,12,76,255,36,12,79,255,38,12,81,255,40,11,83,255,41,11,85,255,43,11,87,255,45,11,89,255,47,10,91,255,49,10,92,255,50,10,94,255,52,10,95,255,54,9,97,255,56,9,98,255,57,9,99,255,59,9,100,255,61,9,101,255,62,9,102,255,64,10,103,255,66,10,104,255,68,10,104,255,69,10,105,255,71,11,106,255,73,11,106,255,74,12,107,255,76,12,107,255,77,13,108,255,79,13,108,255,81,14,108,255,82,14,109,255,84,15,109,255,85,15,109,255,87,16,110,255,89,16,110,255,90,17,110,255,92,18,110,255,93,18,110,255,95,19,110,255,97,19,110,255,98,20,110,255,100,21,110,255,101,21,110,255,103,22,110,255,105,22,110,255,106,23,110,255,108,24,110,255,109,24,110,255,111,25,110,255,113,25,110,255,114,26,110,255,116,26,110,255,117,27,110,255,119,28,109,255,120,28,109,255,122,29,109,255,124,29,109,255,125,30,109,255,127,30,108,255,128,31,108,255,130,32,108,255,132,32,107,255,133,33,107,255,135,33,107,255,136,34,106,255,138,34,106,255,140,35,105,255,141,35,105,255,143,36,105,255,144,37,104,255,146,37,104,255,147,38,103,255,149,38,103,255,151,39,102,255,152,39,102,255,154,40,101,255,155,41,100,255,157,41,100,255,159,42,99,255,160,42,99,255,162,43,98,255,163,44,97,255,165,44,96,255,166,45,96,255,168,46,95,255,169,46,94,255,171,47,94,255,173,48,93,255,174,48,92,255,176,49,91,255,177,50,90,255,179,50,90,255,180,51,89,255,182,52,88,255,183,53,87,255,185,53,86,255,186,54,85,255,188,55,84,255,189,56,83,255,191,57,82,255,192,58,81,255,193,58,80,255,195,59,79,255,196,60,78,255,198,61,77,255,199,62,76,255,200,63,75,255,202,64,74,255,203,65,73,255,204,66,72,255,206,67,71,255,207,68,70,255,208,69,69,255,210,70,68,255,211,71,67,255,212,72,66,255,213,74,65,255,215,75,63,255,216,76,62,255,217,77,61,255,218,78,60,255,219,80,59,255,221,81,58,255,222,82,56,255,223,83,55,255,224,85,54,255,225,86,53,255,226,87,52,255,227,89,51,255,228,90,49,255,229,92,48,255,230,93,47,255,231,94,46,255,232,96,45,255,233,97,43,255,234,99,42,255,235,100,41,255,235,102,40,255,236,103,38,255,237,105,37,255,238,106,36,255,239,108,35,255,239,110,33,255,240,111,32,255,241,113,31,255,241,115,29,255,242,116,28,255,243,118,27,255,243,120,25,255,244,121,24,255,245,123,23,255,245,125,21,255,246,126,20,255,246,128,19,255,247,130,18,255,247,132,16,255,248,133,15,255,248,135,14,255,248,137,12,255,249,139,11,255,249,140,10,255,249,142,9,255,250,144,8,255,250,146,7,255,250,148,7,255,251,150,6,255,251,151,6,255,251,153,6,255,251,155,6,255,251,157,7,255,252,159,7,255,252,161,8,255,252,163,9,255,252,165,10,255,252,166,12,255,252,168,13,255,252,170,15,255,252,172,17,255,252,174,18,255,252,176,20,255,252,178,22,255,252,180,24,255,251,182,26,255,251,184,29,255,251,186,31,255,251,188,33,255,251,190,35,255,250,192,38,255,250,194,40,255,250,196,42,255,250,198,45,255,249,199,47,255,249,201,50,255,249,203,53,255,248,205,55,255,248,207,58,255,247,209,61,255,247,211,64,255,246,213,67,255,246,215,70,255,245,217,73,255,245,219,76,255,244,221,79,255,244,223,83,255,244,225,86,255,243,227,90,255,243,229,93,255,242,230,97,255,242,232,101,255,242,234,105,255,241,236,109,255,241,237,113,255,241,239,117,255,241,241,121,255,242,242,125,255,242,244,130,255,243,245,134,255,243,246,138,255,244,248,142,255,245,249,146,255,246,250,150,255,248,251,154,255,249,252,157,255,250,253,161,255,252,255,164,255]),turbo:new Uint8Array([48,18,59,255,50,21,67,255,51,24,74,255,52,27,81,255,53,30,88,255,54,33,95,255,55,36,102,255,56,39,109,255,57,42,115,255,58,45,121,255,59,47,128,255,60,50,134,255,61,53,139,255,62,56,145,255,63,59,151,255,63,62,156,255,64,64,162,255,65,67,167,255,65,70,172,255,66,73,177,255,66,75,181,255,67,78,186,255,68,81,191,255,68,84,195,255,68,86,199,255,69,89,203,255,69,92,207,255,69,94,211,255,70,97,214,255,70,100,218,255,70,102,221,255,70,105,224,255,70,107,227,255,71,110,230,255,71,113,233,255,71,115,235,255,71,118,238,255,71,120,240,255,71,123,242,255,70,125,244,255,70,128,246,255,70,130,248,255,70,133,250,255,70,135,251,255,69,138,252,255,69,140,253,255,68,143,254,255,67,145,254,255,66,148,255,255,65,150,255,255,64,153,255,255,62,155,254,255,61,158,254,255,59,160,253,255,58,163,252,255,56,165,251,255,55,168,250,255,53,171,248,255,51,173,247,255,49,175,245,255,47,178,244,255,46,180,242,255,44,183,240,255,42,185,238,255,40,188,235,255,39,190,233,255,37,192,231,255,35,195,228,255,34,197,226,255,32,199,223,255,31,201,221,255,30,203,218,255,28,205,216,255,27,208,213,255,26,210,210,255,26,212,208,255,25,213,205,255,24,215,202,255,24,217,200,255,24,219,197,255,24,221,194,255,24,222,192,255,24,224,189,255,25,226,187,255,25,227,185,255,26,228,182,255,28,230,180,255,29,231,178,255,31,233,175,255,32,234,172,255,34,235,170,255,37,236,167,255,39,238,164,255,42,239,161,255,44,240,158,255,47,241,155,255,50,242,152,255,53,243,148,255,56,244,145,255,60,245,142,255,63,246,138,255,67,247,135,255,70,248,132,255,74,248,128,255,78,249,125,255,82,250,122,255,85,250,118,255,89,251,115,255,93,252,111,255,97,252,108,255,101,253,105,255,105,253,102,255,109,254,98,255,113,254,95,255,117,254,92,255,121,254,89,255,125,255,86,255,128,255,83,255,132,255,81,255,136,255,78,255,139,255,75,255,143,255,73,255,146,255,71,255,150,254,68,255,153,254,66,255,156,254,64,255,159,253,63,255,161,253,61,255,164,252,60,255,167,252,58,255,169,251,57,255,172,251,56,255,175,250,55,255,177,249,54,255,180,248,54,255,183,247,53,255,185,246,53,255,188,245,52,255,190,244,52,255,193,243,52,255,195,241,52,255,198,240,52,255,200,239,52,255,203,237,52,255,205,236,52,255,208,234,52,255,210,233,53,255,212,231,53,255,215,229,53,255,217,228,54,255,219,226,54,255,221,224,55,255,223,223,55,255,225,221,55,255,227,219,56,255,229,217,56,255,231,215,57,255,233,213,57,255,235,211,57,255,236,209,58,255,238,207,58,255,239,205,58,255,241,203,58,255,242,201,58,255,244,199,58,255,245,197,58,255,246,195,58,255,247,193,58,255,248,190,57,255,249,188,57,255,250,186,57,255,251,184,56,255,251,182,55,255,252,179,54,255,252,177,54,255,253,174,53,255,253,172,52,255,254,169,51,255,254,167,50,255,254,164,49,255,254,161,48,255,254,158,47,255,254,155,45,255,254,153,44,255,254,150,43,255,254,147,42,255,254,144,41,255,253,141,39,255,253,138,38,255,252,135,37,255,252,132,35,255,251,129,34,255,251,126,33,255,250,123,31,255,249,120,30,255,249,117,29,255,248,114,28,255,247,111,26,255,246,108,25,255,245,105,24,255,244,102,23,255,243,99,21,255,242,96,20,255,241,93,19,255,240,91,18,255,239,88,17,255,237,85,16,255,236,83,15,255,235,80,14,255,234,78,13,255,232,75,12,255,231,73,12,255,229,71,11,255,228,69,10,255,226,67,10,255,225,65,9,255,223,63,8,255,221,61,8,255,220,59,7,255,218,57,7,255,216,55,6,255,214,53,6,255,212,51,5,255,210,49,5,255,208,47,5,255,206,45,4,255,204,43,4,255,202,42,4,255,200,40,3,255,197,38,3,255,195,37,3,255,193,35,2,255,190,33,2,255,188,32,2,255,185,30,2,255,183,29,2,255,180,27,1,255,178,26,1,255,175,24,1,255,172,23,1,255,169,22,1,255,167,20,1,255,164,19,1,255,161,18,1,255,158,16,1,255,155,15,1,255,152,14,1,255,149,13,1,255,146,11,1,255,142,10,1,255,139,9,2,255,136,8,2,255,133,7,2,255,129,6,2,255,126,5,2,255,122,4,3,255]),rainbow:{colors:["#96005A","#0000C8","#0019FF","#0098FF","#2CFF96","#97FF00","#FFEA00","#FF6F00","#FF0000"],positions:[0,.125,.25,.375,.5,.625,.75,.875,1]},jet:{colors:["#000083","#003CAA","#05FFFF","#FFFF00","#FA0000","#800000"],positions:[0,.125,.375,.625,.875,1]},hsv:{colors:["#ff0000","#fdff02","#f7ff02","#00fc04","#00fc0a","#01f9ff","#0200fd","#0800fd","#ff00fb","#ff00f5","#ff0006"],positions:[0,.169,.173,.337,.341,.506,.671,.675,.839,.843,1]},hot:{colors:["#000000","#e60000","#ffd200","#ffffff"],positions:[0,.3,.6,1]},cool:{colors:["#00ffff","#ff00ff"],positions:[0,1]},spring:{colors:["#ff00ff","#ffff00"],positions:[0,1]},summer:{colors:["#008066","#ffff66"],positions:[0,1]},autumn:{colors:["#ff0000","#ffff00"],positions:[0,1]},winter:{colors:["#0000ff","#00ff80"],positions:[0,1]},bone:{colors:["#000000","#545474","#a9c8c8","#ffffff"],positions:[0,.376,.753,1]},copper:{colors:["#000000","#ffa066","#ffc77f"],positions:[0,.804,1]},greys:{colors:["#000000","#ffffff"],positions:[0,1]},ylgnbu:{colors:["#081d58","#253494","#225ea8","#1d91c0","#41b6c4","#7fcdbb","#c7e9b4","#edf8d9","#ffffd9"],positions:[0,.125,.25,.375,.5,.625,.75,.875,1]},greens:{colors:["#00441b","#006d2c","#238b45","#41ab5d","#74c476","#a1d99b","#c7e9c0","#e5f5e0","#f7fcf5"],positions:[0,.125,.25,.375,.5,.625,.75,.875,1]},ylorrd:{colors:["#800026","#bd0026","#e31a1c","#fc4e2a","#fd8d3c","#feb24c","#fed976","#ffeda0","#ffffcc"],positions:[0,.125,.25,.375,.5,.625,.75,.875,1]},bluered:{colors:["#0000ff","#ff0000"],positions:[0,1]},rdbu:{colors:["#050aac","#6a89f7","#bebebe","#dcaa84","#e6915a","#b20a1c"],positions:[0,.35,.5,.6,.7,1]},picnic:{colors:["#0000ff","#3399ff","#66ccff","#99ccff","#ccccff","#ffffff","#ffccff","#ff99ff","#ff66cc","#ff6666","#ff0000"],positions:[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1]},portland:{colors:["#0c3383","#0a88ba","#f2d338","#f28f38","#d91e1e"],positions:[0,.25,.5,.75,1]},blackbody:{colors:["#000000","#e60000","#e6d200","#ffffff","#a0c8ff"],positions:[0,.2,.4,.7,1]},earth:{colors:["#000082","#00b4b4","#28d228","#e6e632","#784614","#ffffff"],positions:[0,.1,.2,.4,.6,1]},electric:{colors:["#000000","#1e0064","#780064","#a05a00","#e6c800","#fffadc"],positions:[0,.15,.4,.6,.8,1]},magma:new Uint8Array([0,0,4,255,1,0,5,255,1,1,6,255,1,1,8,255,2,1,9,255,2,2,11,255,2,2,13,255,3,3,15,255,3,3,18,255,4,4,20,255,5,4,22,255,6,5,24,255,6,5,26,255,7,6,28,255,8,7,30,255,9,7,32,255,10,8,34,255,11,9,36,255,12,9,38,255,13,10,41,255,14,11,43,255,16,11,45,255,17,12,47,255,18,13,49,255,19,13,52,255,20,14,54,255,21,14,56,255,22,15,59,255,24,15,61,255,25,16,63,255,26,16,66,255,28,16,68,255,29,17,71,255,30,17,73,255,32,17,75,255,33,17,78,255,34,17,80,255,36,18,83,255,37,18,85,255,39,18,88,255,41,17,90,255,42,17,92,255,44,17,95,255,45,17,97,255,47,17,99,255,49,17,101,255,51,16,103,255,52,16,105,255,54,16,107,255,56,16,108,255,57,15,110,255,59,15,112,255,61,15,113,255,63,15,114,255,64,15,116,255,66,15,117,255,68,15,118,255,69,16,119,255,71,16,120,255,73,16,120,255,74,16,121,255,76,17,122,255,78,17,123,255,79,18,123,255,81,18,124,255,82,19,124,255,84,19,125,255,86,20,125,255,87,21,126,255,89,21,126,255,90,22,126,255,92,22,127,255,93,23,127,255,95,24,127,255,96,24,128,255,98,25,128,255,100,26,128,255,101,26,128,255,103,27,128,255,104,28,129,255,106,28,129,255,107,29,129,255,109,29,129,255,110,30,129,255,112,31,129,255,114,31,129,255,115,32,129,255,117,33,129,255,118,33,129,255,120,34,129,255,121,34,130,255,123,35,130,255,124,35,130,255,126,36,130,255,128,37,130,255,129,37,129,255,131,38,129,255,132,38,129,255,134,39,129,255,136,39,129,255,137,40,129,255,139,41,129,255,140,41,129,255,142,42,129,255,144,42,129,255,145,43,129,255,147,43,128,255,148,44,128,255,150,44,128,255,152,45,128,255,153,45,128,255,155,46,127,255,156,46,127,255,158,47,127,255,160,47,127,255,161,48,126,255,163,48,126,255,165,49,126,255,166,49,125,255,168,50,125,255,170,51,125,255,171,51,124,255,173,52,124,255,174,52,123,255,176,53,123,255,178,53,123,255,179,54,122,255,181,54,122,255,183,55,121,255,184,55,121,255,186,56,120,255,188,57,120,255,189,57,119,255,191,58,119,255,192,58,118,255,194,59,117,255,196,60,117,255,197,60,116,255,199,61,115,255,200,62,115,255,202,62,114,255,204,63,113,255,205,64,113,255,207,64,112,255,208,65,111,255,210,66,111,255,211,67,110,255,213,68,109,255,214,69,108,255,216,69,108,255,217,70,107,255,219,71,106,255,220,72,105,255,222,73,104,255,223,74,104,255,224,76,103,255,226,77,102,255,227,78,101,255,228,79,100,255,229,80,100,255,231,82,99,255,232,83,98,255,233,84,98,255,234,86,97,255,235,87,96,255,236,88,96,255,237,90,95,255,238,91,94,255,239,93,94,255,240,95,94,255,241,96,93,255,242,98,93,255,242,100,92,255,243,101,92,255,244,103,92,255,244,105,92,255,245,107,92,255,246,108,92,255,246,110,92,255,247,112,92,255,247,114,92,255,248,116,92,255,248,118,92,255,249,120,93,255,249,121,93,255,249,123,93,255,250,125,94,255,250,127,94,255,250,129,95,255,251,131,95,255,251,133,96,255,251,135,97,255,252,137,97,255,252,138,98,255,252,140,99,255,252,142,100,255,252,144,101,255,253,146,102,255,253,148,103,255,253,150,104,255,253,152,105,255,253,154,106,255,253,155,107,255,254,157,108,255,254,159,109,255,254,161,110,255,254,163,111,255,254,165,113,255,254,167,114,255,254,169,115,255,254,170,116,255,254,172,118,255,254,174,119,255,254,176,120,255,254,178,122,255,254,180,123,255,254,182,124,255,254,183,126,255,254,185,127,255,254,187,129,255,254,189,130,255,254,191,132,255,254,193,133,255,254,194,135,255,254,196,136,255,254,198,138,255,254,200,140,255,254,202,141,255,254,204,143,255,254,205,144,255,254,207,146,255,254,209,148,255,254,211,149,255,254,213,151,255,254,215,153,255,254,216,154,255,253,218,156,255,253,220,158,255,253,222,160,255,253,224,161,255,253,226,163,255,253,227,165,255,253,229,167,255,253,231,169,255,253,233,170,255,253,235,172,255,252,236,174,255,252,238,176,255,252,240,178,255,252,242,180,255,252,244,182,255,252,246,184,255,252,247,185,255,252,249,187,255,252,251,189,255,252,253,191,255]),plasma:new Uint8Array([13,8,135,255,16,7,136,255,19,7,137,255,22,7,138,255,25,6,140,255,27,6,141,255,29,6,142,255,32,6,143,255,34,6,144,255,36,6,145,255,38,5,145,255,40,5,146,255,42,5,147,255,44,5,148,255,46,5,149,255,47,5,150,255,49,5,151,255,51,5,151,255,53,4,152,255,55,4,153,255,56,4,154,255,58,4,154,255,60,4,155,255,62,4,156,255,63,4,156,255,65,4,157,255,67,3,158,255,68,3,158,255,70,3,159,255,72,3,159,255,73,3,160,255,75,3,161,255,76,2,161,255,78,2,162,255,80,2,162,255,81,2,163,255,83,2,163,255,85,2,164,255,86,1,164,255,88,1,164,255,89,1,165,255,91,1,165,255,92,1,166,255,94,1,166,255,96,1,166,255,97,0,167,255,99,0,167,255,100,0,167,255,102,0,167,255,103,0,168,255,105,0,168,255,106,0,168,255,108,0,168,255,110,0,168,255,111,0,168,255,113,0,168,255,114,1,168,255,116,1,168,255,117,1,168,255,119,1,168,255,120,1,168,255,122,2,168,255,123,2,168,255,125,3,168,255,126,3,168,255,128,4,168,255,129,4,167,255,131,5,167,255,132,5,167,255,134,6,166,255,135,7,166,255,136,8,166,255,138,9,165,255,139,10,165,255,141,11,165,255,142,12,164,255,143,13,164,255,145,14,163,255,146,15,163,255,148,16,162,255,149,17,161,255,150,19,161,255,152,20,160,255,153,21,159,255,154,22,159,255,156,23,158,255,157,24,157,255,158,25,157,255,160,26,156,255,161,27,155,255,162,29,154,255,163,30,154,255,165,31,153,255,166,32,152,255,167,33,151,255,168,34,150,255,170,35,149,255,171,36,148,255,172,38,148,255,173,39,147,255,174,40,146,255,176,41,145,255,177,42,144,255,178,43,143,255,179,44,142,255,180,46,141,255,181,47,140,255,182,48,139,255,183,49,138,255,184,50,137,255,186,51,136,255,187,52,136,255,188,53,135,255,189,55,134,255,190,56,133,255,191,57,132,255,192,58,131,255,193,59,130,255,194,60,129,255,195,61,128,255,196,62,127,255,197,64,126,255,198,65,125,255,199,66,124,255,200,67,123,255,201,68,122,255,202,69,122,255,203,70,121,255,204,71,120,255,204,73,119,255,205,74,118,255,206,75,117,255,207,76,116,255,208,77,115,255,209,78,114,255,210,79,113,255,211,81,113,255,212,82,112,255,213,83,111,255,213,84,110,255,214,85,109,255,215,86,108,255,216,87,107,255,217,88,106,255,218,90,106,255,218,91,105,255,219,92,104,255,220,93,103,255,221,94,102,255,222,95,101,255,222,97,100,255,223,98,99,255,224,99,99,255,225,100,98,255,226,101,97,255,226,102,96,255,227,104,95,255,228,105,94,255,229,106,93,255,229,107,93,255,230,108,92,255,231,110,91,255,231,111,90,255,232,112,89,255,233,113,88,255,233,114,87,255,234,116,87,255,235,117,86,255,235,118,85,255,236,119,84,255,237,121,83,255,237,122,82,255,238,123,81,255,239,124,81,255,239,126,80,255,240,127,79,255,240,128,78,255,241,129,77,255,241,131,76,255,242,132,75,255,243,133,75,255,243,135,74,255,244,136,73,255,244,137,72,255,245,139,71,255,245,140,70,255,246,141,69,255,246,143,68,255,247,144,68,255,247,145,67,255,247,147,66,255,248,148,65,255,248,149,64,255,249,151,63,255,249,152,62,255,249,154,62,255,250,155,61,255,250,156,60,255,250,158,59,255,251,159,58,255,251,161,57,255,251,162,56,255,252,163,56,255,252,165,55,255,252,166,54,255,252,168,53,255,252,169,52,255,253,171,51,255,253,172,51,255,253,174,50,255,253,175,49,255,253,177,48,255,253,178,47,255,253,180,47,255,253,181,46,255,254,183,45,255,254,184,44,255,254,186,44,255,254,187,43,255,254,189,42,255,254,190,42,255,254,192,41,255,253,194,41,255,253,195,40,255,253,197,39,255,253,198,39,255,253,200,39,255,253,202,38,255,253,203,38,255,252,205,37,255,252,206,37,255,252,208,37,255,252,210,37,255,251,211,36,255,251,213,36,255,251,215,36,255,250,216,36,255,250,218,36,255,249,220,36,255,249,221,37,255,248,223,37,255,248,225,37,255,247,226,37,255,247,228,37,255,246,230,38,255,246,232,38,255,245,233,38,255,245,235,39,255,244,237,39,255,243,238,39,255,243,240,39,255,242,242,39,255,241,244,38,255,241,245,37,255,240,247,36,255,240,249,33,255]),redblue:{colors:["#ff0000","#0000ff"],positions:[0,1]},coolwarm:{colors:["#0000ff","#ffffff","#ff0000"],positions:[0,.5,1]},diverging_1:{colors:["#400040","#3b004d","#36005b","#320068","#2d0076","#290084","#240091","#20009f","#1b00ad","#1600ba","#1200c8","#0d00d6","#0900e3","#0400f1","#0000ff","#0217ff","#042eff","#0645ff","#095cff","#0b73ff","#0d8bff","#10a2ff","#12b9ff","#14d0ff","#17e7ff","#19ffff","#3fffff","#66ffff","#8cffff","#b2ffff","#d8ffff","#ffffff","#ffffd4","#ffffaa","#ffff7f","#ffff54","#ffff2a","#ffff00","#ffed00","#ffdd00","#ffcc00","#ffba00","#ffaa00","#ff9900","#ff8700","#ff7700","#ff6600","#ff5400","#ff4400","#ff3300","#ff2100","#ff1100","#ff0000","#ff0017","#ff002e","#ff0045","#ff005c","#ff0073","#ff008b","#ff00a2","#ff00b9","#ff00d0","#ff00e7","#ff00ff"],positions:[0,.01587301587,.03174603174,.04761904761,.06349206348,.07936507935,.09523809522,.11111111109,.12698412696,.14285714283,.1587301587,.17460317457,.19047619044,.20634920631,.22222222218,.23809523805,.25396825392,.26984126979,.28571428566,.30158730153,.3174603174,.33333333327,.34920634914,.36507936501,.38095238088,.39682539675,.41269841262,.42857142849,.44444444436,.46031746023,.4761904761,.49206349197,.50793650784,.52380952371,.53968253958,.55555555545,.57142857132,.58730158719,.60317460306,.61904761893,.6349206348,.65079365067,.66666666654,.68253968241,.69841269828,.71428571415,.73015873002,.74603174589,.76190476176,.77777777763,.7936507935,.80952380937,.82539682524,.84126984111,.85714285698,.87301587285,.88888888872,.90476190459,.92063492046,.93650793633,.9523809522,.96825396807,.98412698394,1]},diverging_2:{colors:["#000000","#030aff","#204aff","#3c8aff","#77c4ff","#f0ffff","#f0ffff","#f2ff7f","#ffff00","#ff831e","#ff083d","#ff00ff"],positions:[0,1e-10,.1,.2,.3333,.4666,.5333,.6666,.8,.9,.999999999999,1]},blackwhite:{colors:["#000000","#ffffff"],positions:[0,1]},twilight:{colors:["#E2D9E2","#E0D9E2","#DDD9E0","#DAD8DF","#D6D7DD","#D2D5DB","#CDD3D8","#C8D0D6","#C2CED4","#BCCBD1","#B6C8CF","#B0C5CD","#AAC2CC","#A4BECA","#9EBBC9","#99B8C8","#93B4C6","#8EB1C5","#89ADC5","#85A9C4","#80A5C3","#7CA2C2","#789EC2","#759AC1","#7196C1","#6E92C0","#6C8EBF","#698ABF","#6786BE","#6682BD","#647DBC","#6379BB","#6275BA","#6170B9","#606CB8","#6067B6","#5F62B4","#5F5EB3","#5F59B1","#5E54AE","#5E4FAC","#5E4BA9","#5E46A6","#5D41A3","#5D3CA0","#5C379C","#5B3298","#5A2E93","#59298E","#572588","#562182","#531E7C","#511A75","#4E186F","#4B1668","#471461","#44135A","#411254","#3D114E","#3A1149","#371144","#351140","#33113C","#311339","#301437","#331237","#351138","#381139","#3B113B","#3F123D","#43123E","#481341","#4D1443","#521545","#571647","#5C1749","#61184B","#67194C","#6C1B4E","#711D4F","#761F4F","#7B2150","#802350","#852650","#8A2950","#8E2C50","#922F50","#963350","#9A3750","#9E3B50","#A13F50","#A54350","#A84750","#AB4B50","#AE5051","#B15452","#B35953","#B65D54","#B86255","#BA6657","#BC6B59","#BE705B","#C0755E","#C27A61","#C37F64","#C58468","#C6896C","#C78E71","#C89275","#C9977B","#CA9C80","#CCA186","#CDA68C","#CEAB92","#CFAF99","#D1B4A0","#D2B8A7","#D4BDAD","#D6C1B4","#D8C5BB","#D9C9C2","#DBCCC8","#DDD0CE","#DED3D3","#DFD5D8","#E0D7DB","#E1D8DF","#E2D9E1"],positions:[0,.0078740157,.0157480315,.0236220472,.031496063,.0393700787,.0472440945,.0551181102,.062992126,.0708661417,.0787401575,.0866141732,.094488189,.1023622047,.1102362205,.1181102362,.125984252,.1338582677,.1417322835,.1496062992,.157480315,.1653543307,.1732283465,.1811023622,.188976378,.1968503937,.2047244094,.2125984252,.2204724409,.2283464567,.2362204724,.2440944882,.2519685039,.2598425197,.2677165354,.2755905512,.2834645669,.2913385827,.2992125984,.3070866142,.3149606299,.3228346457,.3307086614,.3385826772,.3464566929,.3543307087,.3622047244,.3700787402,.3779527559,.3858267717,.3937007874,.4015748031,.4094488189,.4173228346,.4251968504,.4330708661,.4409448819,.4488188976,.4566929134,.4645669291,.4724409449,.4803149606,.4881889764,.4960629921,.5039370079,.5118110236,.5196850394,.5275590551,.5354330709,.5433070866,.5511811024,.5590551181,.5669291339,.5748031496,.5826771654,.5905511811,.5984251969,.6062992126,.6141732283,.6220472441,.6299212598,.6377952756,.6456692913,.6535433071,.6614173228,.6692913386,.6771653543,.6850393701,.6929133858,.7007874016,.7086614173,.7165354331,.7244094488,.7322834646,.7401574803,.7480314961,.7559055118,.7637795276,.7716535433,.7795275591,.7874015748,.7952755906,.8031496063,.811023622,.8188976378,.8267716535,.8346456693,.842519685,.8503937008,.8582677165,.8661417323,.874015748,.8818897638,.8897637795,.8976377953,.905511811,.9133858268,.9212598425,.9291338583,.937007874,.9448818898,.9527559055,.9606299213,.968503937,.9763779528,.9842519685,.9921259843,1]},twilight_shifted:{colors:["#301437","#32123A","#34113E","#361142","#391146","#3C114B","#3F1251","#421257","#46145E","#491564","#4C176B","#4F1972","#521C79","#551F7F","#572385","#58278B","#5A2B90","#5B3095","#5C359A","#5D3A9E","#5D3EA1","#5E43A5","#5E48A8","#5E4DAB","#5E52AD","#5F57B0","#5F5BB2","#5F60B4","#5F65B5","#6069B7","#606EB8","#6172BA","#6277BB","#637BBC","#657FBD","#6684BD","#6888BE","#6B8CBF","#6D90C0","#7094C0","#7398C1","#769CC1","#7AA0C2","#7EA4C3","#82A7C3","#87ABC4","#8CAFC5","#91B2C6","#96B6C7","#9CB9C8","#A1BDC9","#A7C0CB","#ADC3CD","#B3C6CE","#B9C9D0","#BFCCD3","#C5CFD5","#CBD2D7","#D0D4D9","#D4D6DC","#D8D8DE","#DCD9DF","#DED9E1","#E1D9E2","#E2D9E1","#E1D8DF","#E0D7DB","#DFD5D8","#DED3D3","#DDD0CE","#DBCCC8","#D9C9C2","#D8C5BB","#D6C1B4","#D4BDAD","#D2B8A7","#D1B4A0","#CFAF99","#CEAB92","#CDA68C","#CCA186","#CA9C80","#C9977B","#C89275","#C78E71","#C6896C","#C58468","#C37F64","#C27A61","#C0755E","#BE705B","#BC6B59","#BA6657","#B86255","#B65D54","#B35953","#B15452","#AE5051","#AB4B50","#A84750","#A54350","#A13F50","#9E3B50","#9A3750","#963350","#922F50","#8E2C50","#8A2950","#852650","#802350","#7B2150","#761F4F","#711D4F","#6C1B4E","#67194C","#61184B","#5C1749","#571647","#521545","#4D1443","#481341","#43123E","#3F123D","#3B113B","#381139","#351138","#331237","#301437"],positions:[0,.0078740157,.0157480315,.0236220472,.031496063,.0393700787,.0472440945,.0551181102,.062992126,.0708661417,.0787401575,.0866141732,.094488189,.1023622047,.1102362205,.1181102362,.125984252,.1338582677,.1417322835,.1496062992,.157480315,.1653543307,.1732283465,.1811023622,.188976378,.1968503937,.2047244094,.2125984252,.2204724409,.2283464567,.2362204724,.2440944882,.2519685039,.2598425197,.2677165354,.2755905512,.2834645669,.2913385827,.2992125984,.3070866142,.3149606299,.3228346457,.3307086614,.3385826772,.3464566929,.3543307087,.3622047244,.3700787402,.3779527559,.3858267717,.3937007874,.4015748031,.4094488189,.4173228346,.4251968504,.4330708661,.4409448819,.4488188976,.4566929134,.4645669291,.4724409449,.4803149606,.4881889764,.4960629921,.5039370079,.5118110236,.5196850394,.5275590551,.5354330709,.5433070866,.5511811024,.5590551181,.5669291339,.5748031496,.5826771654,.5905511811,.5984251969,.6062992126,.6141732283,.6220472441,.6299212598,.6377952756,.6456692913,.6535433071,.6614173228,.6692913386,.6771653543,.6850393701,.6929133858,.7007874016,.7086614173,.7165354331,.7244094488,.7322834646,.7401574803,.7480314961,.7559055118,.7637795276,.7716535433,.7795275591,.7874015748,.7952755906,.8031496063,.811023622,.8188976378,.8267716535,.8346456693,.842519685,.8503937008,.8582677165,.8661417323,.874015748,.8818897638,.8897637795,.8976377953,.905511811,.9133858268,.9212598425,.9291338583,.937007874,.9448818898,.9527559055,.9606299213,.968503937,.9763779528,.9842519685,.9921259843,1]}};function Dt(e,t,r,i){this.message=e,this.expected=t,this.found=r,this.location=i,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,Dt)}function St(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function vt(e,t){return void 0!==e?e:t}function Et(e,t,r){const i=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(i,t),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(i));const s=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(s,r),e.compileShader(s),!e.getShaderParameter(s,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(s));const n=e.createProgram();return e.attachShader(n,i),e.attachShader(n,s),e.linkProgram(n),n}function _t(e,t,r,i,s){let n;return e&&(e.viewport(0,0,i,s),n=e.createTexture(),e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,i,s,0,e.LUMINANCE,e.FLOAT,new Float32Array(r))),{textureData:n,width:i,height:s,data:r,id:t}}function xt(e,t){e&&e.deleteTexture(t.textureData)}function Tt(e,t,r="continuous"){const i=bt[e];t.height=1;const s=t.getContext("2d"),n=8192;if(!s)throw new Error("Unable to get canvas context.");if("[object Object]"===Object.prototype.toString.call(i))if(t.width=n,"continuous"===r){const e=s.createLinearGradient(0,0,n,1);for(let t=0;t<i.colors.length;++t)e.addColorStop(i.positions[t],i.colors[t]);s.fillStyle=e,s.fillRect(0,0,n,1)}else{if("discrete"!==r)throw new Error("Invalid color scale type.");for(let e=0;e<i.colors.length;++e){const t=i.positions[e],r=i.positions[e+1],o=8182*t,a=r?8182*r:n;s.fillStyle=i.colors[e],s.fillRect(o,0,a-o,1)}}else{if("[object Uint8Array]"!==Object.prototype.toString.call(i))throw new Error("Color scale not defined.");{t.width=n;const e=s.createImageData(n,1);e.data.set(i),s.putImageData(e,0,0)}}}!function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(Dt,Error),Dt.buildMessage=function(e,t){var r,i={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){var t=e.parts.map(function(e){return Array.isArray(e)?o(e[0])+"-"+o(e[1]):o(e)});return"["+(e.inverted?"^":"")+t+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description},not:function(e){return"not "+a(e.expected)}};function s(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+s(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+s(e)})}function o(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+s(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+s(e)})}function a(e){return i[e.type](e)}return"Expected "+function(e){var t,r,i=e.map(a);if(i.sort(),i.length>0){for(t=1,r=1;t<i.length;t++)i[t-1]!==i[t]&&(i[r]=i[t],r++);i.length=r}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+((r=t)?'"'+n(r)+'"':"end of input")+" found."};const Bt="\nprecision mediump float;\n// our texture\nuniform sampler2D u_textureData;\nuniform sampler2D u_textureScale;\nuniform vec2 u_textureSize;\nuniform vec2 u_domain;\nuniform vec2 u_display_range;\nuniform bool u_apply_display_range;\nuniform float u_noDataValue;\nuniform bool u_clampLow;\nuniform bool u_clampHigh;\n// the texCoords passed in from the vertex shader.\nvarying vec2 v_texCoord;\n\nbool isnan( float val ) {\n  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;\n}\n\nvoid main() {\n  vec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n  float value = texture2D(u_textureData, v_texCoord)[0];\n  if(value < -3.402823466e+38) // Check for possible NaN value\n    gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  else if (value == u_noDataValue || isnan(value))\n    gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  else if (u_apply_display_range && (value < u_display_range[0] || value >= u_display_range[1]))\n        gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))\n    gl_FragColor = vec4(0, 0, 0, 0);\n  else {\n    float normalisedValue = (value - u_domain[0]) / (u_domain[1] - u_domain[0]);\n    gl_FragColor = texture2D(u_textureScale, vec2(normalisedValue, 0));\n  }\n}";class Rt{canvas;currentDataset;datasetCollection;gl;program;texCoordBuffer;ctx;displayRange;applyDisplayRange;matrix;colorScaleImage;domain;colorScaleCanvas;name;clampLow;clampHigh;textureScale;noDataValue;expressionAst;colorType="continuous";positionBuffer;programCache={};constructor(e){if(this.datasetCollection={},this.currentDataset=null,this.setCanvas(e.canvas),this.setColorType(e.type),vt(e.useWebGL,!0)){const e=function(e,t){const r=["webgl","experimental-webgl"];let i=null;for(let s=0;s<r.length;++s){try{i=e.getContext(r[s],t)}catch(e){}if(i)break}return i&&i.getExtension("OES_texture_float")?i:null}(this.canvas,{premultipliedAlpha:!1});if(null!==e){this.gl=e,this.program=Et(e,"\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nuniform mat3 u_matrix;\nuniform vec2 u_resolution;\nvarying vec2 v_texCoord;\nvoid main() {\n  // apply transformation matrix\n  vec2 position = (u_matrix * vec3(a_position, 1)).xy;\n  // convert the rectangle from pixels to 0.0 to 1.0\n  vec2 zeroToOne = position / u_resolution;\n  // convert from 0->1 to 0->2\n  vec2 zeroToTwo = zeroToOne * 2.0;\n  // convert from 0->2 to -1->+1 (clipspace)\n  vec2 clipSpace = zeroToTwo - 1.0;\n  gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n  // pass the texCoord to the fragment shader\n  // The GPU will interpolate this value between points.\n  v_texCoord = a_texCoord;\n}",Bt),e.useProgram(this.program);const t=e.getAttribLocation(this.program,"a_texCoord");this.texCoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texCoordBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,2,e.FLOAT,!1,0,0),this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW);const r=e.getAttribLocation(this.program,"a_position");e.enableVertexAttribArray(r),e.vertexAttribPointer(r,2,e.FLOAT,!1,0,0)}else this.ctx=this.canvas.getContext("2d")}else this.ctx=this.canvas.getContext("2d");if(e.colorScaleImage?this.setColorScaleImage(e.colorScaleImage):this.setColorScale(vt(e.colorScale,"viridis")),this.setDomain(vt(e.domain,[0,1])),this.displayRange=vt(e.displayRange,[0,1]),this.applyDisplayRange=vt(e.applyDisplayRange,!1),this.setClamp(vt(e.clampLow,!0),e.clampHigh),this.setNoDataValue(e.noDataValue),e.data){const t=e.data.length;this.setData(e.data,vt(e.width,e.data[t-2]),vt(e.height,e.data[t-2]))}if(e.datasets)for(let t=0;t<e.datasets.length;++t){const r=e.datasets[t];this.addDataset(r.id,r.data,r.width,r.height)}e.matrix?this.matrix=e.matrix:this.matrix=[1,0,0,0,1,0,0,0,1]}getData(){const e=this.currentDataset;if(!e)throw new Error("No dataset available.");return e.data}atPoint(e,t){const r=this.currentDataset;if(!r)throw new Error("No dataset available.");if(e>=r.width||t>=r.height)throw new Error("Coordinates are outside of image bounds.");return r.data[t*r.width+e]}setData(e,t,r){this.currentDataset&&null===this.currentDataset.id&&xt(this.gl,this.currentDataset),this.currentDataset=_t(this.gl,null,e,t,r)}addDataset(e,t,r,i){if(this.datasetAvailable(e))throw new Error(`There is already a dataset registered with id '${e}'`);this.datasetCollection[e]=_t(this.gl,e,t,r,i),this.currentDataset||(this.currentDataset=this.datasetCollection[e])}setCurrentDataset(e){if(!this.datasetAvailable(e))throw new Error(`No such dataset registered: '${e}'`);this.currentDataset&&null===this.currentDataset.id&&xt(this.gl,this.currentDataset),this.currentDataset=this.datasetCollection[e]}removeDataset(e){const t=this.datasetCollection[e];if(!t)throw new Error(`No such dataset registered: '${e}'`);xt(this.gl,t),this.currentDataset===t&&(this.currentDataset=null),delete this.datasetCollection[e]}removeAllDataset(){Object.keys(this.datasetCollection).forEach(e=>this.removeDataset(e))}datasetAvailable(e){return St(this.datasetCollection,e)}getColorScaleImage(){return this.colorScaleImage}setCanvas(e){this.canvas=e||document.createElement("canvas")}setColorType(e){this.colorType=e??"continuous"}setDomain(e){if(!e||2!==e.length)throw new Error("Invalid domain specified.");this.domain=e}setDisplayRange(e){if(!e||2!==e.length)throw new Error("Invalid view range specified.");this.displayRange=e,this.applyDisplayRange=!0}getCanvas(){return this.canvas}setColorScale(e){if(!St(bt,e))throw new Error(`No such color scale '${e}'`);this.colorScaleCanvas||(this.colorScaleCanvas=document.createElement("canvas"),this.colorScaleCanvas.width=256,this.colorScaleCanvas.height=1),Tt(e,this.colorScaleCanvas,this.colorType),this.name=e,this.setColorScaleImage(this.colorScaleCanvas)}setClamp(e,t){this.clampLow=e,this.clampHigh=void 0!==t?t:e}setColorScaleImage(e){this.colorScaleImage=e;const t=this.gl;t&&(this.textureScale&&t.deleteTexture(this.textureScale),this.textureScale=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.textureScale),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e))}setNoDataValue(e){this.noDataValue=e}render(){const e=this.canvas,t=this.currentDataset;e.width=t.width,e.height=t.height;let r=this.getExpressionIds();this.gl?this.renderWebGL(t,r):this.ctx&&this.render2D(t)}getExpressionIds(){if(!this.expressionAst)return null;const e=new Set,t=r=>{"string"==typeof r&&e.add(r.replace(/[+-]/g,"")),"string"==typeof r.lhs?e.add(r.lhs.replace(/[+-]/g,"")):"object"==typeof r.lhs&&t(r.lhs),"string"==typeof r.rhs?e.add(r.rhs.replace(/[+-]/g,"")):"object"==typeof r.rhs&&t(r.rhs)};return t(this.expressionAst),Array.from(e)}renderWebGL(e,t){const r=this.gl;r.viewport(0,0,e.width,e.height);const i=this.getOrCreateProgram(t);r.useProgram(i),this.setupTextures(i,t,e),this.setupUniforms(i),this.setupAttributes(i),r.drawArrays(r.TRIANGLES,0,6)}getOrCreateProgram(e){if(!this.expressionAst)return this.program;const t=JSON.stringify(this.expressionAst);if(this.programCache[t])return this.programCache[t];const r=this.createVertexShader(),i=this.createFragmentShader(e),s=Et(this.gl,r,i);return this.programCache[t]=s,s}createVertexShader(){return"\n      attribute vec2 a_position;\n      attribute vec2 a_texCoord;\n      uniform mat3 u_matrix;\n      uniform vec2 u_resolution;\n      varying vec2 v_texCoord;\n      void main() {\n        vec2 position = (u_matrix * vec3(a_position, 1)).xy;\n        vec2 zeroToOne = position / u_resolution;\n        vec2 zeroToTwo = zeroToOne * 2.0;\n        vec2 clipSpace = zeroToTwo - 1.0;\n        gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n        v_texCoord = a_texCoord;\n      }\n    "}createFragmentShader(e){if(!e)return Bt;const t=e=>"object"==typeof e?"**"===e.op?`pow(${t(e.lhs)}, ${t(e.rhs)})`:e.fn?`(${e.fn}(${t(e.lhs)}))`:`(${t(e.lhs)} ${e.op} ${t(e.rhs)})`:"string"==typeof e?`${e}_value`:`float(${e})`,r=t(this.expressionAst);return`\n      precision mediump float;\n      uniform sampler2D u_textureScale;\n      ${e.map(e=>`uniform sampler2D u_texture_${e};`).join("\n")}\n      uniform vec2 u_textureSize;\n      uniform vec2 u_domain;\n      uniform vec2 u_display_range;\n      uniform bool u_apply_display_range;\n      uniform float u_noDataValue;\n      uniform bool u_clampLow;\n      uniform bool u_clampHigh;\n      varying vec2 v_texCoord;\n      void main() {\n        ${e.map(e=>`float ${e}_value = texture2D(u_texture_${e}, v_texCoord)[0];`).join("\n")}\n        float value = ${r};\n\n        if (value == u_noDataValue)\n          gl_FragColor = vec4(0.0, 0, 0, 0.0);\n        else if (u_apply_display_range && (value < u_display_range[0] || value >= u_display_range[1]))\n          gl_FragColor = vec4(0.0, 0, 0, 0.0);\n        else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))\n          gl_FragColor = vec4(0, 0, 0, 0);\n        else {\n          float normalisedValue = (value - u_domain[0]) / (u_domain[1] - u_domain[0]);\n          gl_FragColor = texture2D(u_textureScale, vec2(normalisedValue, 0));\n        }\n      }\n    `}setupTextures(e,t,r){const i=this.gl;t?(i.uniform1i(i.getUniformLocation(e,"u_textureScale"),0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.textureScale),t.forEach((t,r)=>{const s=r+1,n=this.datasetCollection[t];if(!n)throw new Error(`No such dataset registered: '${t}'`);i.uniform1i(i.getUniformLocation(e,`u_texture_${t}`),s),i.activeTexture(i[`TEXTURE${s}`]),i.bindTexture(i.TEXTURE_2D,n.textureData)})):(i.uniform1i(i.getUniformLocation(e,"u_textureData"),0),i.uniform1i(i.getUniformLocation(e,"u_textureScale"),1),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,r.textureData),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,this.textureScale))}setupUniforms(e){const t=this.gl,r=this.canvas;t.uniform2f(t.getUniformLocation(e,"u_resolution"),r.width,r.height),t.uniform2fv(t.getUniformLocation(e,"u_domain"),this.domain),t.uniform2fv(t.getUniformLocation(e,"u_display_range"),this.displayRange),t.uniform1i(t.getUniformLocation(e,"u_apply_display_range"),+this.applyDisplayRange),t.uniform1i(t.getUniformLocation(e,"u_clampLow"),+this.clampLow),t.uniform1i(t.getUniformLocation(e,"u_clampHigh"),+this.clampHigh),t.uniform1f(t.getUniformLocation(e,"u_noDataValue"),this.noDataValue),t.uniformMatrix3fv(t.getUniformLocation(e,"u_matrix"),!1,this.matrix)}setupAttributes(e){const t=this.gl,r=this.canvas,i=t.getAttribLocation(e,"a_position"),s=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,s),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0),function(e,t,r,i,s){const n=0+i,o=0+s;e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,n,0,0,o,0,o,n,0,n,o]),e.STATIC_DRAW)}(t,0,0,r.width,r.height)}render2D(e){const t=this.ctx,r=this.canvas.width,i=this.canvas.height,s=t.createImageData(r,i),n=this.domain[1]-this.domain[0],o=this.colorScaleCanvas.width,a=this.colorScaleCanvas.getContext("2d").getImageData(0,0,o,1).data;let l;const h=e.data;for(let e=0;e<i;e++)for(let t=0;t<r;t++){const i=e*r+t;let c=Math.floor((h[i]-this.domain[0])/n*(o-1));l=255,c<0?(c=0,this.clampLow||(l=0)):c>255&&(c=255,this.clampHigh||(l=0)),(h[i]===this.noDataValue||h[i]!=h[i]||this.applyDisplayRange&&(h[i]<this.displayRange[0]||h[i]>=this.displayRange[1]))&&(l=0);const f=4*(e*r+t);s.data[f+0]=a[4*c],s.data[f+1]=a[4*c+1],s.data[f+2]=a[4*c+2],s.data[f+3]=Math.min(l,a[4*c+3])}t.putImageData(s,0,0)}renderDataset(e){return this.setCurrentDataset(e),this.render()}getColor(e){const t=this.colorScaleCanvas.width,r=this.colorScaleCanvas.getContext("2d").getImageData(0,0,t,1).data,i=this.domain[1]-this.domain[0];let s=Math.round((e-this.domain[0])/i*t),n=255;return s<0&&(s=0,this.clampLow||(n=0)),s>255&&(s=255,this.clampHigh||(n=0)),[r[4*s],r[4*s+1],r[4*s+2],n]}setExpression(e){e&&e.length?this.expressionAst=function(e,t){t=void 0!==t?t:{};var r,i={},s={Expression:$},n=$,o="+",a="-",l="*",h="/",c="**",f="(",u=")",g=/^[\-+]/,d=/^[0-9]/,p=/^[a-zA-Z_$]/,m=/^[a-zA-Z_$0-9]/,w=/^[ \t\n\r]/,C=Z("+",!1),A=Z("-",!1),y=Z("*",!1),I=Z("/",!1),b=Z("**",!1),D=Z("(",!1),S=Z(")",!1),v=W("float"),E=W("integer"),_=W("identifier"),x=W("whitespace"),T=function(e,t){var r,i,s=e;for(r=0;r<t.length;r++)i=t[r][1],s=re(s,t[r][3],i);return s},B=function(e,t){var r,i,s=e;for(r=0;r<t.length;r++)i=t[r][1],s=re(s,t[r][3],i);return s},R=function(e){return e},G=function(e,t){return{fn:e,lhs:t}},F=function(){return parseFloat(L(),10)},M=function(){return parseInt(L(),10)},P=function(){return L()},k=0,O=0,U=[{line:1,column:1}],N=[],V=0;if("startRule"in t){if(!(t.startRule in s))throw new Error("Can't start parsing from rule \""+t.startRule+'".');n=s[t.startRule]}function L(){return e.substring(O,k)}function Z(e,t){return{type:"literal",text:e,ignoreCase:t}}function W(e){return{type:"other",description:e}}function X(t){var r,i=U[t];if(i)return i;for(r=t-1;!U[r];)r--;for(i={line:(i=U[r]).line,column:i.column};r<t;)10===e.charCodeAt(r)?(i.line++,i.column=1):i.column++,r++;return U[t]=i,i}var H,j,Y="string"==typeof t.filename&&t.filename.length>0;function K(e,r){var i={};Y&&(i.filename=t.filename);var s=X(e);i.start={offset:e,line:s.line,column:s.column};var n=X(r);return i.end={offset:r,line:n.line,column:n.column},i}function z(e){var t=N[N.length-1];k<t.pos||(k>t.pos&&(t.pos=k,t.variants=[]),t.variants.push(e))}function $(){var t,r,s,n,l,h,c,f,u=function(e){0===V&&z(e)};if(t=k,(r=q())!==i){for(s=[],n=k,l=te(),u(C),43===e.charCodeAt(k)?(h=o,k++):h=i,h===i&&(u(A),45===e.charCodeAt(k)?(h=a,k++):h=i),h!==i?(c=te(),(f=q())!==i?n=l=[l,h,c,f]:(k=n,n=i)):(k=n,n=i);n!==i;)s.push(n),n=k,l=te(),u(C),43===e.charCodeAt(k)?(h=o,k++):h=i,h===i&&(u(A),45===e.charCodeAt(k)?(h=a,k++):h=i),h!==i?(c=te(),(f=q())!==i?n=l=[l,h,c,f]:(k=n,n=i)):(k=n,n=i);O=t,t=T(r,s)}else k=t,t=i;return t}function q(){var t,r,s,n,o,a,c,f,u=function(e){0===V&&z(e)};if(t=k,(r=J())!==i){for(s=[],n=k,o=te(),u(y),42===e.charCodeAt(k)?(a=l,k++):a=i,a===i&&(u(I),47===e.charCodeAt(k)?(a=h,k++):a=i),a!==i?(c=te(),(f=J())!==i?n=o=[o,a,c,f]:(k=n,n=i)):(k=n,n=i);n!==i;)s.push(n),n=k,o=te(),u(y),42===e.charCodeAt(k)?(a=l,k++):a=i,a===i&&(u(I),47===e.charCodeAt(k)?(a=h,k++):a=i),a!==i?(c=te(),(f=J())!==i?n=o=[o,a,c,f]:(k=n,n=i)):(k=n,n=i);O=t,t=B(r,s)}else k=t,t=i;return t}function J(){var t,r,s,n,o,a,l,h,f=function(e){0===V&&z(e)};if(t=k,(r=Q())!==i){for(s=[],n=k,o=te(),f(b),e.substr(k,2)===c?(a=c,k+=2):a=i,a!==i?(l=te(),(h=Q())!==i?n=o=[o,a,l,h]:(k=n,n=i)):(k=n,n=i);n!==i;)s.push(n),n=k,o=te(),f(b),e.substr(k,2)===c?(a=c,k+=2):a=i,a!==i?(l=te(),(h=Q())!==i?n=o=[o,a,l,h]:(k=n,n=i)):(k=n,n=i);O=t,t=B(r,s)}else k=t,t=i;return t}function Q(){var t,r,s,n,o,a,l=function(e){0===V&&z(e)};return t=k,l(D),40===e.charCodeAt(k)?(r=f,k++):r=i,r!==i?(s=te(),(n=$())!==i?(o=te(),l(S),41===e.charCodeAt(k)?(a=u,k++):a=i,a!==i?(O=t,t=R(n)):(k=t,t=i)):(k=t,t=i)):(k=t,t=i),t===i&&(t=function(){var t,r,s,n,o,a;for(function(e){0===V&&z(e)}(v),V++,t=k,r=[],g.test(e.charAt(k))?(s=e.charAt(k),k++):s=i;s!==i;)r.push(s),g.test(e.charAt(k))?(s=e.charAt(k),k++):s=i;if(s=[],d.test(e.charAt(k))?(n=e.charAt(k),k++):n=i,n!==i)for(;n!==i;)s.push(n),d.test(e.charAt(k))?(n=e.charAt(k),k++):n=i;else s=i;if(s!==i)if(e.length>k?(n=e.charAt(k),k++):n=i,n!==i){if(o=[],d.test(e.charAt(k))?(a=e.charAt(k),k++):a=i,a!==i)for(;a!==i;)o.push(a),d.test(e.charAt(k))?(a=e.charAt(k),k++):a=i;else o=i;o!==i?(O=t,t=F()):(k=t,t=i)}else k=t,t=i;else k=t,t=i;return V--,t}(),t===i&&(t=function(){var t,r,s,n;for(function(e){0===V&&z(e)}(E),V++,t=k,r=[],g.test(e.charAt(k))?(s=e.charAt(k),k++):s=i;s!==i;)r.push(s),g.test(e.charAt(k))?(s=e.charAt(k),k++):s=i;if(s=[],d.test(e.charAt(k))?(n=e.charAt(k),k++):n=i,n!==i)for(;n!==i;)s.push(n),d.test(e.charAt(k))?(n=e.charAt(k),k++):n=i;else s=i;return s!==i?(O=t,t=M()):(k=t,t=i),V--,t}(),t===i&&(t=k,(r=ee())!==i?(l(D),40===e.charCodeAt(k)?(s=f,k++):s=i,s!==i&&(n=$())!==i?(l(S),41===e.charCodeAt(k)?(o=u,k++):o=i,o!==i?(O=t,t=G(r,n)):(k=t,t=i)):(k=t,t=i)):(k=t,t=i),t===i&&(t=ee())))),t}function ee(){var t,r,s,n,o;for(0===V&&z(_),V++,t=k,r=[],g.test(e.charAt(k))?(s=e.charAt(k),k++):s=i;s!==i;)r.push(s),g.test(e.charAt(k))?(s=e.charAt(k),k++):s=i;if(p.test(e.charAt(k))?(s=e.charAt(k),k++):s=i,s!==i){for(n=[],m.test(e.charAt(k))?(o=e.charAt(k),k++):o=i;o!==i;)n.push(o),m.test(e.charAt(k))?(o=e.charAt(k),k++):o=i;O=t,t=P()}else k=t,t=i;return V--,t}function te(){var t,r;for(0===V&&z(x),V++,t=[],w.test(e.charAt(k))?(r=e.charAt(k),k++):r=i;r!==i;)t.push(r),w.test(e.charAt(k))?(r=e.charAt(k),k++):r=i;return V--,t}function re(e,t,r){if("number"==typeof e&&"number"==typeof t)switch(r){case"+":return e+t;case"-":return e-t;case"*":return e*t;case"/":return e/t;case"**":return Math.pow(e,t)}return{lhs:e,rhs:t,op:r}}if(N.push({pos:k,variants:[]}),(r=n())!==i&&k===e.length)return r;throw r!==i&&k<e.length&&z({type:"end"}),j=(H=N[0]).pos,function(e,t,r){return new Dt(Dt.buildMessage(e,t),e,t,r)}(H.variants,j<e.length?e.charAt(j):null,j<e.length?K(j,j+1):K(j,j))}(e):this.expressionAst=null}destroy(){var e;null==(e=this.gl)||e.deleteProgram(this.program),this.removeAllDataset()}}function Gt(e){return Math.round(255*e)}function Ft(e){const t=i.A.fromCssColorString(e),{red:r,green:s,blue:n,alpha:o}=t;return[r,s,n,o].map(e=>Math.round(255*e))}class Mt extends s.A{nativeRectangle;constructor(e){super(e);const{project:t,unproject:r}=e;this.nativeRectangle=new n.A(e.rectangleSouthwestInMeters.x,e.rectangleSouthwestInMeters.y,e.rectangleNortheastInMeters.x,e.rectangleNortheastInMeters.y),this._projection={ellipsoid:this.ellipsoid,project(e,r){const[i,s]=t([e.longitude,e.latitude].map(o.A.toDegrees)),n=e.height;return a.A.fromElements(i,s,n,r)},unproject(e,t){const[i,s]=r([e.x,e.y]),n=e.z;return l.A.fromDegrees(i,s,n,t)}};const i=new a.A;e.rectangleSouthwestInMeters.clone(i);const s=new a.A;e.rectangleNortheastInMeters.clone(s);const h=new a.A(s.x,i.y),c=new a.A(i.x,s.y),f=this.projection.unproject(i),u=this.projection.unproject(h),g=this.projection.unproject(c),d=this.projection.unproject(s);this._rectangle=n.A.fromCartographicArray([f,u,g,d])}tileXYToNativeRectangle2(e,t,r){const i=this.tileXYToRectangle(e,t,r),s=this.projection,o=[s.project(new l.A(i.west,i.south)),s.project(new l.A(i.west,i.north)),s.project(new l.A(i.east,i.north)),s.project(new l.A(i.east,i.south))],a=o.map(e=>e.x),h=o.map(e=>e.y);return new n.A(Math.min(...a),Math.min(...h),Math.max(...a),Math.max(...h))}tileXYToRectangle(e,t,r){const i=this.tileXYToNativeRectangle(e,t,r),s=this.projection,l=s.unproject(new a.A(i.west,i.south)),h=s.unproject(new a.A(i.west,i.north)),c=s.unproject(new a.A(i.east,i.north)),f=s.unproject(new a.A(i.east,i.south)),u=n.A.fromCartographicArray([l,h,c,f]);return u.east<u.west&&(u.east+=o.A.TWO_PI),u}}function Pt(e,t,r,i=1){return new(Object.getPrototypeOf(e).constructor)(t*r*i)}function kt(e,t,r){return(1-r)*e+r*t}function Ot(e,t){return!(e<t[0]&&e<t[1]||e>t[0]&&e>t[1])}function Ut(e){const{data:t,sourceBBox:r,targetBBox:i,project:s,sourceWidth:n,sourceHeight:o,nodata:a}=e,{targetWidth:l=n,targetHeight:h=o}=e,[c,f,u,g]=r,[d,p,m,w]=i,C=Math.abs(u-c)/n,A=Math.abs(g-f)/o,y=Math.abs(m-d)/l,I=Math.abs(w-p)/h,b=Pt(t,l,h).fill(a);for(let e=0;e<h;e++)for(let r=0;r<l;r++){const i=d+y*(r+.5),o=w-I*(e+.5),[a,h]=s([i,o]);if(!Ot(a,[c,u])||!Ot(h,[c,g]))break;const f=t[~~((g-h)/A)*n+~~((a-c)/C)];b[e*l+r]=f}return b}function Nt(e,t){if("OffscreenCanvas"in window)return new OffscreenCanvas(e,t);{const r=document.createElement("canvas");return r.width=e,r.height=t,r}}var Vt=null;try{var Lt="undefined"!=typeof module&&"function"==typeof module.require&&module.require("worker_threads")||"function"==typeof require&&require("worker_threads")||"function"==typeof require&&require("worker_threads");Vt=Lt.Worker}catch(e){}var Zt,Wt,Xt=(Zt="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgZnVuY3Rpb24gcmVzYW1wbGVOZWFyZXN0KGRhdGEsIG9wdGlvbnMpIHsKICAgIGNvbnN0IHsgc291cmNlV2lkdGgsIHNvdXJjZUhlaWdodCwgdGFyZ2V0V2lkdGgsIHRhcmdldEhlaWdodCwgd2luZG93LCBidWZmZXIgPSAwIH0gPSBvcHRpb25zOwogICAgY29uc3QgW3gwLCB5MCwgeDEsIHkxXSA9IHdpbmRvdzsKICAgIGNvbnN0IGVmZmVjdGl2ZVNvdXJjZVdpZHRoID0gc291cmNlV2lkdGggLSAyICogYnVmZmVyOwogICAgY29uc3QgZWZmZWN0aXZlU291cmNlSGVpZ2h0ID0gc291cmNlSGVpZ2h0IC0gMiAqIGJ1ZmZlcjsKICAgIGNvbnN0IHJlc2FtcGxlZERhdGEgPSBjb3B5TmV3U2l6ZShkYXRhLCB0YXJnZXRXaWR0aCwgdGFyZ2V0SGVpZ2h0KTsKICAgIGZvciAobGV0IHkgPSAwOyB5IDwgdGFyZ2V0SGVpZ2h0OyB5KyspIHsKICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB0YXJnZXRXaWR0aDsgeCsrKSB7CiAgICAgICAgY29uc3QgY29sID0gYnVmZmVyICsgKGVmZmVjdGl2ZVNvdXJjZVdpZHRoICogKHgwICsgeCAvIHRhcmdldFdpZHRoICogKHgxIC0geDApKSA+Pj4gMCk7CiAgICAgICAgY29uc3Qgcm93ID0gYnVmZmVyICsgKGVmZmVjdGl2ZVNvdXJjZUhlaWdodCAqICh5MCArIHkgLyB0YXJnZXRIZWlnaHQgKiAoeTEgLSB5MCkpID4+PiAwKTsKICAgICAgICByZXNhbXBsZWREYXRhW3kgKiB0YXJnZXRXaWR0aCArIHhdID0gZGF0YVtyb3cgKiBzb3VyY2VXaWR0aCArIGNvbF07CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXNhbXBsZWREYXRhOwogIH0KICBmdW5jdGlvbiByZXNhbXBsZURhdGEoZGF0YSwgb3B0aW9ucykgewogICAgY29uc3QgeyBtZXRob2QgPSAibmVhcmVzdCIgfSA9IG9wdGlvbnM7CiAgICBzd2l0Y2ggKG1ldGhvZCkgewogICAgICBjYXNlICJuZWFyZXN0IjoKICAgICAgICByZXR1cm4gcmVzYW1wbGVOZWFyZXN0KGRhdGEsIG9wdGlvbnMpOwogICAgICBjYXNlICJiaWxpbmVhciI6CiAgICAgICAgcmV0dXJuIHJlc2FtcGxlQmlsaW5lYXIoZGF0YSwgb3B0aW9ucyk7CiAgICB9CiAgfQogIGZ1bmN0aW9uIGNvcHlOZXdTaXplKGFycmF5LCB3aWR0aCwgaGVpZ2h0LCBzYW1wbGVzUGVyUGl4ZWwgPSAxKSB7CiAgICByZXR1cm4gbmV3IChPYmplY3QuZ2V0UHJvdG90eXBlT2YoYXJyYXkpKS5jb25zdHJ1Y3Rvcih3aWR0aCAqIGhlaWdodCAqIHNhbXBsZXNQZXJQaXhlbCk7CiAgfQogIGZ1bmN0aW9uIGxlcnAodjAsIHYxLCB0KSB7CiAgICByZXR1cm4gKDEgLSB0KSAqIHYwICsgdCAqIHYxOwogIH0KICBmdW5jdGlvbiByZXNhbXBsZUJpbGluZWFyKGRhdGEsIG9wdGlvbnMpIHsKICAgIGNvbnN0IHsgc291cmNlV2lkdGgsIHNvdXJjZUhlaWdodCwgdGFyZ2V0V2lkdGgsIHRhcmdldEhlaWdodCwgd2luZG93LCBidWZmZXIgPSAwLCBub2RhdGEgfSA9IG9wdGlvbnM7CiAgICBjb25zdCBbeDAsIHkwLCB4MSwgeTFdID0gd2luZG93OwogICAgY29uc3Qgd2luZG93V2lkdGggPSB4MSAtIHgwOwogICAgY29uc3Qgd2luZG93SGVpZ2h0ID0geTEgLSB5MDsKICAgIGNvbnN0IG5ld0FycmF5ID0gY29weU5ld1NpemUoZGF0YSwgdGFyZ2V0V2lkdGgsIHRhcmdldEhlaWdodCk7CiAgICBjb25zdCBlZmZlY3RpdmVTb3VyY2VXaWR0aCA9IHNvdXJjZVdpZHRoIC0gMiAqIGJ1ZmZlcjsKICAgIGNvbnN0IGVmZmVjdGl2ZVNvdXJjZUhlaWdodCA9IHNvdXJjZUhlaWdodCAtIDIgKiBidWZmZXI7CiAgICBjb25zdCBpbnZUYXJnZXRXaWR0aCA9IDEgLyB0YXJnZXRXaWR0aDsKICAgIGNvbnN0IGludlRhcmdldEhlaWdodCA9IDEgLyB0YXJnZXRIZWlnaHQ7CiAgICBjb25zdCBpc05vZGF0YSA9ICh2YWx1ZSkgPT4gewogICAgICBpZiAobm9kYXRhID09PSB2b2lkIDApCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICBpZiAobm9kYXRhID09PSAwKQogICAgICAgIHJldHVybiB2YWx1ZSA9PT0gMDsKICAgICAgcmV0dXJuIE1hdGguYWJzKCh2YWx1ZSAtIG5vZGF0YSkgLyBub2RhdGEpIDwgMWUtNjsKICAgIH07CiAgICBmb3IgKGxldCB5ID0gMDsgeSA8IHRhcmdldEhlaWdodDsgeSsrKSB7CiAgICAgIGNvbnN0IHlSYXRpbyA9IHkgKiBpbnZUYXJnZXRIZWlnaHQ7CiAgICAgIGNvbnN0IHlNYXBwZWQgPSB5MCArIHlSYXRpbyAqIHdpbmRvd0hlaWdodDsKICAgICAgY29uc3QgcmF3WSA9IGVmZmVjdGl2ZVNvdXJjZUhlaWdodCAqIHlNYXBwZWQgKyBidWZmZXI7CiAgICAgIGNvbnN0IHlsID0gTWF0aC5mbG9vcihyYXdZKTsKICAgICAgY29uc3QgeWggPSBNYXRoLm1pbihNYXRoLmNlaWwocmF3WSksIHNvdXJjZUhlaWdodCAtIGJ1ZmZlciAtIDEpOwogICAgICBjb25zdCB0eSA9IHJhd1kgLSB5bDsKICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB0YXJnZXRXaWR0aDsgeCsrKSB7CiAgICAgICAgY29uc3QgeFJhdGlvID0geCAqIGludlRhcmdldFdpZHRoOwogICAgICAgIGNvbnN0IHhNYXBwZWQgPSB4MCArIHhSYXRpbyAqIHdpbmRvd1dpZHRoOwogICAgICAgIGNvbnN0IHJhd1ggPSBlZmZlY3RpdmVTb3VyY2VXaWR0aCAqIHhNYXBwZWQgKyBidWZmZXI7CiAgICAgICAgY29uc3QgeGwgPSBNYXRoLmZsb29yKHJhd1gpOwogICAgICAgIGNvbnN0IHhoID0gTWF0aC5taW4oTWF0aC5jZWlsKHJhd1gpLCBzb3VyY2VXaWR0aCAtIGJ1ZmZlciAtIDEpOwogICAgICAgIGNvbnN0IHR4RnJhY3Rpb24gPSByYXdYIC0geGw7CiAgICAgICAgY29uc3QgY2VudGVyID0gZGF0YVt5bCAqIHNvdXJjZVdpZHRoICsgeGxdOwogICAgICAgIGNvbnN0IG5laWdoYm9ycyA9IFsKICAgICAgICAgIGRhdGFbeWwgKiBzb3VyY2VXaWR0aCArIHhsXSwKICAgICAgICAgIGRhdGFbeWwgKiBzb3VyY2VXaWR0aCArIHhoXSwKICAgICAgICAgIGRhdGFbeWggKiBzb3VyY2VXaWR0aCArIHhsXSwKICAgICAgICAgIGRhdGFbeWggKiBzb3VyY2VXaWR0aCArIHhoXQogICAgICAgIF07CiAgICAgICAgbmVpZ2hib3JzLmZvckVhY2goKG5laWdoYm9yLCBpbmRleCkgPT4gewogICAgICAgICAgaWYgKGlzTm9kYXRhKG5laWdoYm9yKSkgewogICAgICAgICAgICBuZWlnaGJvcnNbaW5kZXhdID0gY2VudGVyOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGlmIChpc05vZGF0YShjZW50ZXIpKSB7CiAgICAgICAgICBuZXdBcnJheVt5ICogdGFyZ2V0V2lkdGggKyB4XSA9IG5vZGF0YTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBbbGwsIGhsLCBsaCwgaGhdID0gbmVpZ2hib3JzOwogICAgICAgIGNvbnN0IHYwID0gbGVycChsbCwgaGwsIHR4RnJhY3Rpb24pOwogICAgICAgIGNvbnN0IHYxID0gbGVycChsaCwgaGgsIHR4RnJhY3Rpb24pOwogICAgICAgIGNvbnN0IHZhbHVlID0gbGVycCh2MCwgdjEsIHR5KTsKICAgICAgICBuZXdBcnJheVt5ICogdGFyZ2V0V2lkdGggKyB4XSA9IHZhbHVlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbmV3QXJyYXk7CiAgfQoKICBvbm1lc3NhZ2UgPSBmdW5jdGlvbihlKSB7CiAgICBjb25zdCB7IGRhdGEsIG9wdGlvbnMsIGlkIH0gPSBlLmRhdGE7CiAgICBjb25zdCByZXN1bHQgPSByZXNhbXBsZURhdGEoZGF0YSwgb3B0aW9ucyk7CiAgICBwb3N0TWVzc2FnZSh7IGRhdGE6IHJlc3VsdCwgaWQgfSk7CiAgfTsKCn0pKCk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPXdvcmtlci5qcy5tYXAKCg==",Wt=!1,"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)?function(e,t,r){var i=void 0===t?null:t,s=function(e,t){return It.from(e,"base64").toString(t?"utf16":"utf8")}(e,void 0!==r&&r),n=s.indexOf("\n",10)+1,o=s.substring(n)+(i?"//# sourceMappingURL="+i:"");return function(e){return new Vt(o,Object.assign({},e,{eval:!0}))}}(Zt,null,Wt):function(e){var t;return function(r){return t=t||function(e,t,r){var i=void 0===t?null:t,s=function(e,t){var r=atob(e);if(t){for(var i=new Uint8Array(r.length),s=0,n=r.length;s<n;++s)i[s]=r.charCodeAt(s);return String.fromCharCode.apply(null,new Uint16Array(i.buffer))}return r}(e,void 0!==r&&r),n=s.indexOf("\n",10)+1,o=s.substring(n)+(i?"//# sourceMappingURL="+i:""),a=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(a)}(e,null,false),new Worker(t,r)}}(Zt));const Ht="undefined"!=typeof navigator&&navigator.hardwareConcurrency||2;class jt{workers;size;messageId;constructor(e=Ht){if(this.workers=null,this.size=e??0,this.messageId=0,e){this.workers=[];for(let t=0;t<e;t++)this.workers.push({worker:Xt(),idle:!0})}}async resample(e,t){return 0===this.size?function(e,t){const{method:r="nearest"}=t;switch(r){case"nearest":return function(e,t){const{sourceWidth:r,sourceHeight:i,targetWidth:s,targetHeight:n,window:o,buffer:a=0}=t,[l,h,c,f]=o,u=r-2*a,g=i-2*a,d=Pt(e,s,n);for(let t=0;t<n;t++)for(let i=0;i<s;i++){const o=a+(u*(l+i/s*(c-l))>>>0),p=a+(g*(h+t/n*(f-h))>>>0);d[t*s+i]=e[p*r+o]}return d}(e,t);case"bilinear":return function(e,t){const{sourceWidth:r,sourceHeight:i,targetWidth:s,targetHeight:n,window:o,buffer:a=0,nodata:l}=t,[h,c,f,u]=o,g=f-h,d=u-c,p=Pt(e,s,n),m=r-2*a,w=i-2*a,C=1/s,A=1/n,y=e=>void 0!==l&&(0===l?0===e:Math.abs((e-l)/l)<1e-6);for(let t=0;t<n;t++){const n=w*(c+t*A*d)+a,o=Math.floor(n),f=Math.min(Math.ceil(n),i-a-1),u=n-o;for(let i=0;i<s;i++){const n=m*(h+i*C*g)+a,c=Math.floor(n),d=Math.min(Math.ceil(n),r-a-1),w=n-c,A=e[o*r+c],I=[e[o*r+c],e[o*r+d],e[f*r+c],e[f*r+d]];if(I.forEach((e,t)=>{y(e)&&(I[t]=A)}),y(A)){p[t*s+i]=l;continue}const[b,D,S,v]=I,E=kt(b,D,w),_=kt(S,v,w),x=kt(E,_,u);p[t*s+i]=x}}return p}(e,t)}}(e,t):new Promise(r=>{const i=this.workers.find(e=>e.idle)||this.workers[Math.floor(Math.random()*this.size)];i.idle=!1;const s=this.messageId++,n=e=>{e.data.id===s&&(i.idle=!0,r(e.data.data),i.worker.removeEventListener("message",n))};i.worker.addEventListener("message",n),i.worker.postMessage({data:e,options:t,id:s})})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}}const Yt=Nt(256,256);class Kt{constructor(e){this.options=e,this.hasAlphaChannel=e.hasAlphaChannel??!0,this.maximumLevel=e.maximumLevel??18,this.minimumLevel=e.minimumLevel??0,this.credit=new h.A(e.credit||"",!1),this.errorEvent=new c.A,this._cacheSize=e.cacheSize??100,this.workerPool=new jt(e.workerPoolSize),this.geotiffWorkerPool=new y(e.workerPoolSize),this.ready=!1,(0,f.A)(e.url)&&(this.readyPromise=this._build(e.url,e).then(()=>!0))}ready;tilingScheme;rectangle;tileSize;tileWidth;tileHeight;maximumLevel;minimumLevel;credit;errorEvent;readyPromise;bands;noData;hasAlphaChannel;plot;renderOptions;readSamples;requestLevels;bbox;_destroyed=!1;_source;_imageCount;_images=[];_imagesCache=new Map;_cacheSize;_isTiled;_proj;origin;reverseY=!1;samples;workerPool;geotiffWorkerPool;get isDestroyed(){return this._destroyed}async _build(e,t={}){var r,i;const{tileSize:a,renderOptions:l,projFunc:h,requestOptions:c}=t;let f=await(e instanceof File||e instanceof Blob?yt(e):async function(e,t={},r){return At.fromSource(function(e,{forceXHR:t=!1,...r}={}){return"function"!=typeof fetch||t?"undefined"!=typeof XMLHttpRequest?function(e,{headers:t={},maxRanges:r=0,allowFullFile:i=!1,...s}={}){const n=new st(e);return ut(new ft(n,t,r,i),s)}(e,r):function(e,{headers:t={},maxRanges:r=0,allowFullFile:i=!1,...s}={}){const n=new ct(e);return ut(new ft(n,t,r,i),s)}(e,r):function(e,{headers:t={},credentials:r,maxRanges:i=0,allowFullFile:s=!1,...n}={}){const o=new rt(e,r);return ut(new ft(o,t,i,s),n)}(e,r)}(e,t),r)}(e,c)),p=await f.getImage();this._isTiled=p.isTiled,this._isTiled||"string"!=typeof e||(f=await yt(await(await fetch(e)).blob()),p=await f.getImage()),this._source=f,this.origin=this._getOrigin(p),this.bbox=p.getBoundingBox(),this.reverseY=this._checkIfReversed(p);const[m,w,C,A]=this.bbox,y=+(p.geoKeys.ProjectedCSTypeGeoKey??p.geoKeys.GeographicTypeGeoKey);if(this._proj=null==h?void 0:h(y),3857===y||900913===y)this.tilingScheme=new s.A({rectangleNortheastInMeters:new u.A(C,A),rectangleSouthwestInMeters:new u.A(m,w)});else if(4326===y)this.tilingScheme=new g.A({rectangle:n.A.fromDegrees(...this.bbox),numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1});else{if("function"!=typeof(null==(r=this._proj)?void 0:r.project)||"function"!=typeof(null==(i=this._proj)?void 0:i.unproject))throw new d.A(`Unspported projection type: EPSG:${y}, please add projFunc parameter to handle projection`);console.warn(`[Experimental] Reprojection EPSG:${y}`),this.tilingScheme=new Mt({rectangleNortheastInMeters:new u.A(C,A),rectangleSouthwestInMeters:new u.A(m,w),...this._proj})}this.rectangle=this.tilingScheme.rectangle,this.rectangle.east<this.rectangle.west&&(this.rectangle.east+=o.A.TWO_PI),this._imageCount=await f.getImageCount(),this.tileSize=this.tileWidth=a||(this._isTiled?p.getTileWidth():p.getWidth())||256,this.tileHeight=a||(this._isTiled?p.getTileHeight():p.getHeight())||256,console.log(this.tileWidth,this.tileHeight),this.requestLevels=this._isTiled?await this._getCogLevels():[0],this._images=new Array(this._imageCount).fill(null);const I=p.getSamplesPerPixel();this.samples=I,this.renderOptions=l??{};const b=p.getGDALNoData();if(this.noData=this.renderOptions.nodata??b,I<3&&this.renderOptions.convertToRGB)throw new d.A("Can not render the image as RGB, please check the convertToRGB parameter");this.renderOptions.single||this.renderOptions.multi||this.renderOptions.convertToRGB||(this.renderOptions=I>2?{convertToRGB:!0,...this.renderOptions}:{single:{band:1},...this.renderOptions}),this.renderOptions.single&&(this.renderOptions.single.band=this.renderOptions.single.band??1);const{single:D,multi:S,convertToRGB:v}=this.renderOptions;this.readSamples=S?[S.r.band-1,S.g.band-1,S.b.band-1]:v?[0,1,2]:[D.band-1],(null==D?void 0:D.expression)&&(this.readSamples=function(e){const t=/b(\d+)/g,r=new Set;let i;for(;null!==(i=t.exec(e));)r.add(parseInt(i[1])-1);return Array.from(r).sort((e,t)=>e-t)}(D.expression));const E={};await Promise.all(this.readSamples.map(async e=>{const t=p.getGDALMetadata(e),r=e+1;if((null==t?void 0:t.STATISTICS_MINIMUM)&&(null==t?void 0:t.STATISTICS_MAXIMUM))E[r]={min:+t.STATISTICS_MINIMUM,max:+t.STATISTICS_MAXIMUM};else{if(v&&(E[r]={min:0,max:255}),S){const e=S[Object.keys(S).find(e=>{var t;return(null==(t=S[e])?void 0:t.band)===r})];if(void 0!==(null==e?void 0:e.min)&&void 0!==(null==e?void 0:e.max)){const{min:t,max:i}=e;E[r]={min:t,max:i}}}if(D&&!D.expression&&D.band===r&&D.domain&&(E[r]={min:D.domain[0],max:D.domain[1]}),!(null==D?void 0:D.expression)&&!E[r]){console.warn(`Can not get band${r} min/max, try to calculate min/max values, or setting ${D?"domain":"min / max"}`);const t=await f.getImage(this.requestLevels[0]),i=(await t.readRasters({samples:[e],pool:this.geotiffWorkerPool}))[0].filter(e=>!isNaN(e));E[r]=function(e,t){let r,i;for(let s=0;s<e.length;s+=1){const n=e[s];n!==t&&(void 0!==r||void 0!==i?n<r?r=n:n>i&&(i=n):r=i=n)}return{min:r,max:i}}(i,b)}}})),this.bands=E;try{if(this.renderOptions.single){const e=this.bands[D.band];if(!D.expression&&!e)throw new d.A(`Invalid band${D.band}`);const t=D.domain??[e.min,e.max];this.plot=new Rt({canvas:Yt,...D,domain:t}),this.plot.setNoDataValue(this.noData);const{expression:r,colors:i,colorScaleImage:s}=D;if(this.plot.setExpression(r),i){const e=function(e,t){let r;if("string"==typeof e[0])r=e.map((t,r)=>[r/e.length,t]);else{const[i,s]=t;r=e.map(e=>[(e[0]-i)/(s-i),e[1]])}r.sort((e,t)=>e[0]-t[0]);let i=r.length-1;for(;i>1&&r[i][0]>=1&&r[i-1][0]>=1;)r.pop(),i--;return r[0][0]>0&&(r=[[0,r[0][1]],...r]),{colors:r.map(e=>e[1]),positions:r.map(e=>{let t=e[0];return t<0?0:t>1?1:t})}}(i,(null==D?void 0:D.useRealValue)?t:[0,1]);!function(e,t,r){if(t.length!==r.length)throw new Error("Invalid color scale.");bt.temp={colors:t,positions:r}}(0,e.colors,e.positions),this.plot.setColorScale("temp")}else s||this.plot.setColorScale((null==D?void 0:D.colorScale)??"blackwhite")}}catch(e){console.error(e),this.errorEvent.raiseEvent(e)}this.readyPromise=Promise.resolve(!0),this.ready=!0}static async fromUrl(e,t={}){const r=new Kt(t);return await r._build(e,{...t,url:void 0}),r}_getOrigin(e){try{return e.getOrigin().slice(0,2)}catch(t){return[0,e.fileDirectory.ImageLength]}}_checkIfReversed(e){const t=e.getFileDirectory().ModelPixelScale;if(t&&t[1]<0)return!0;const r=e.getFileDirectory().ModelTransformation;if(r){const e=r[3];if(r[7]>e)return!0}return!1}async _getCogLevels(){const e=[];let t=this._imageCount-1;for(let r=this._imageCount-1;r>=0;r--){const i=this._images[r]=await this._source.getImage(r),s=i.getWidth(),n=i.getHeight(),o=Math.max(s,n);if(r===this._imageCount-1){const t=Math.ceil((o-this.tileSize)/this.tileSize);e.push(...new Array(t).fill(r))}if(o>.5*this.tileSize){t=r;break}}let r=t;for(;r>=0;)e.push(r--);return e}async _loadTile(e,t,r){var i;let s=e,n=t,a=r,l=e,h=t;const c=this.requestLevels.length-1;a>c&&(a=c,s>>=r-c,n>>=r-c,l=s<<r-a,h=n<<r-a);const f=this.requestLevels[a];let u=this._images[f];u||(u=this._images[f]=await this._source.getImage(f));const g=u.getWidth(),d=u.getHeight(),p=g/this.tilingScheme.getNumberOfXTilesAtLevel(a),m=d/this.tilingScheme.getNumberOfYTilesAtLevel(a);let w=[Math.round(s*p),Math.round(n*m),Math.round((s+1)*p),Math.round((n+1)*m)];if(this._proj&&this.tilingScheme instanceof Mt){const e=this.tilingScheme.tileXYToNativeRectangle2(s,n,a),t=this.tilingScheme.nativeRectangle;e.west-=t.width/g,e.east+=t.width/g,e.south-=t.height/d,e.north+=t.height/d,w=[~~((e.west-t.west)/t.width*g),~~((t.north-e.north)/t.height*d),~~((e.east-t.west)/t.width*g),~~((t.north-e.south)/t.height*d)]}this.reverseY&&(w=[w[0],d-w[3],w[2],d-w[1]]),w=[w[0]-1,w[1]-1,w[2]+1,w[3]+1];const C=w[2]-w[0],A=w[3]-w[1],y={window:w,pool:this.geotiffWorkerPool,samples:this.readSamples,fillValue:this.noData,interleave:!1};let I;try{if(this.renderOptions.convertToRGB?I=await u.readRGB(y):(I=await u.readRasters(y),this.reverseY&&(I=await Promise.all(I.map(e=>function(e){const{array:t,width:r,height:i}=e,s=[];for(let e=i-1;e>=0;e--){const i=e*r,n=i+r,o=t.slice(i,n);s.push(...o)}return s}({array:e,width:I.width,height:I.height}))))),(null==(i=this._proj)?void 0:i.project)&&this.tilingScheme instanceof Mt){const e=this.tilingScheme.tileXYToNativeRectangle2(s,n,a),t=this.tilingScheme.tileXYToRectangle(s,n,a),r=[e.west,e.south,e.east,e.north],i=[t.west,t.south,t.east,t.north].map(o.A.toDegrees),l=[];for(let e=0;e<I.length;e++){const t=Ut({data:I[e],sourceWidth:C,sourceHeight:A,nodata:this.noData,project:this._proj.project,sourceBBox:r,targetBBox:i});l.push(t)}I=l}const c=1<<r-a,f=(e-l)/c,g=(t-h)/c,d=1/(1<<r-a),p=f+d,m=g+d;return I=await Promise.all(I.map(async e=>this.workerPool.resample(e,{sourceWidth:C,sourceHeight:A,targetWidth:this.tileWidth,targetHeight:this.tileHeight,window:[f,g,p,m],method:this.renderOptions.resampleMethod,buffer:1,nodata:this.noData}))),{data:I,width:this.tileWidth,height:this.tileHeight}}catch(e){throw this.errorEvent.raiseEvent(e),e}}async requestImage(e,t,r){if(!this.ready)throw new d.A("requestImage must not be called before the imagery provider is ready.");if(r<this.minimumLevel||r>this.maximumLevel)return;const i=`${e}_${t}_${r}`;if(this._imagesCache.has(i))return this._imagesCache.get(i);const{single:s,multi:n,convertToRGB:o}=this.renderOptions;try{const{width:a,height:l,data:h}=await this._loadTile(e,t,r);if(this._destroyed||!a||!l)return;let c;if(n||o){const e={data:h,width:a,height:l,renderOptions:n??["r","g","b"].reduce((e,t,r)=>({...e,[t]:{band:r+1,min:0,max:255}}),{}),bands:this.bands,noData:this.noData,colorMapping:Object.entries(this.renderOptions.colorMapping??{black:"transparent"}).map(e=>e.map(Ft))};c=await async function(e){const{data:t,width:r,height:i,renderOptions:s,bands:n,noData:o,colorMapping:a}=e,l=new Uint8ClampedArray(r*i*4);function h(...e){return!!e.some(e=>isNaN(e)||e===o)}const{r:c,g:f,b:u}=s??{},g=[c,f,u].map(e=>function(e,t){const r=e[t.band];if(!r)throw new Error(`Invalid band${t.band}`);const i=(null==t?void 0:t.min)??+r.min,s=(null==t?void 0:t.max)??+r.max;return{min:i,max:s,range:s-i}}(n,e)),d=t[0],p=t[1],m=t[2];for(let e=0;e<t[0].length;e++){let t=Gt((d[e]-g[0].min)/g[0].range),r=Gt((p[e]-g[1].min)/g[1].range),i=Gt((m[e]-g[2].min)/g[2].range),s=h(d[e],p[e],m[e])?0:255;a.map(([e,n])=>{t===e[0]&&r===e[1]&&i===e[2]&&(t=n[0],r=n[1],i=n[2],s=n[3])}),l[4*e]=t,l[4*e+1]=r,l[4*e+2]=i,l[4*e+3]=s}return new ImageData(l,r,i)}(e)}else if(s&&this.plot){const{band:e=1}=s;this.plot.removeAllDataset(),this.readSamples.forEach((e,t)=>{this.plot.addDataset(`b${e+1}`,h[t],a,l)}),s.expression?this.plot.render():this.plot.renderDataset(`b${e}`);const t=Nt(this.tileWidth,this.tileHeight);t.getContext("2d").drawImage(this.plot.canvas,0,0),c=t}if(c){if(this._imagesCache.size>=this._cacheSize){const e=this._imagesCache.keys().next().value;this._imagesCache.delete(e)}this._imagesCache.set(i,c)}return c}catch(e){throw console.error(e),this.errorEvent.raiseEvent(e),e}}async pickFeatures(e,t,r,i,s){if(!this.options.enablePickFeatures)return;const n=r>this.maximumLevel?this.maximumLevel:r,a=this.requestLevels[n];let l=this._images[a];l||(l=this._images[a]=await this._source.getImage(a));const h=l.getWidth(),c=l.getHeight();let f,u,g;const{west:d,south:m,north:w,width:C}=this.rectangle;let A=i-d;i<d&&(A+=o.A.TWO_PI),f=~~(Math.abs(A/C)*h),u=~~(Math.abs((w-s)/(w-m))*c),g=[f,u,f+1,u+1],this.reverseY&&(u=c-u,g=[f,u-1,f+1,u]);const y={window:g,height:1,width:1,pool:this.geotiffWorkerPool,interleave:!1};let I;I=this.renderOptions.convertToRGB?await l.readRGB(y):await l.readRasters(y);const b=new p.A;b.name=`lon:${(i/Math.PI*180).toFixed(6)}, lat:${(s/Math.PI*180).toFixed(6)}`;const D={};return null==I||I.forEach((e,t)=>{D[t]=null==e?void 0:e[0]}),b.data=D,I&&b.configureDescriptionFromProperties(D),[b]}destroy(){var e;if(this._imagesCache){for(const e in this._imagesCache)delete this._imagesCache[e];this._imagesCache.clear()}if(this.workerPool&&this.workerPool.destroy(),this.plot&&this.plot.gl){for(const e in this.plot.programCache)this.plot.gl.deleteProgram(this.plot.programCache[e]);this.plot.gl.deleteBuffer(this.plot.positionBuffer)}null==(e=this.plot)||e.destroy(),this._images=[],this._source=void 0,this._destroyed=!0}}},43614:e=>{function t(e,t,r){const i=new RegExp(t).exec(e.slice(r));return i?r+i.index:-1}e.exports=t,e.exports.default=t},48694:e=>{function t(e,t,r){const i=new RegExp(t).exec(e.slice(r));return i?r+i.index+i[0].length-1:-1}e.exports=t,e.exports.default=t},58556:(e,t,r)=>{const i=r(43614),s=r(48694),n=r(26675);function o(e,t,r){const o=r&&r.debug||!1,a=!(r&&!1===typeof r.nested),l=r&&r.startIndex||0;o&&console.log("[xml-utils] starting findTagByName with",t," and ",r);const h=i(e,`<${t}[ \n>/]`,l);if(o&&console.log("[xml-utils] start:",h),-1===h)return;const c=e.slice(h+t.length);let f=s(c,"^[^<]*[ /]>",0);const u=-1!==f&&"/"===c[f-1];if(o&&console.log("[xml-utils] selfClosing:",u),!1===u)if(a){let e=0,r=1,i=0;for(;-1!==(f=s(c,"[ /]"+t+">",e));){const s=c.substring(e,f+1);if(r+=n(s,"<"+t+"[ \n\t>]"),i+=n(s,"</"+t+">"),i>=r)break;e=f}}else f=s(c,"[ /]"+t+">",0);const g=h+t.length+f+1;if(o&&console.log("[xml-utils] end:",g),-1===g)return;const d=e.slice(h,g);let p;return p=u?null:d.slice(d.indexOf(">")+1,d.lastIndexOf("<")),{inner:p,outer:d,start:h,end:g}}e.exports=o,e.exports.default=o},60563:(e,t,r)=>{const i=r(58556);function s(e,t,r){const s=[],n=r&&r.debug||!1,o=!r||"boolean"!=typeof r.nested||r.nested;let a,l=r&&r.startIndex||0;for(;a=i(e,t,{debug:n,startIndex:l});)l=o?a.start+1+t.length:a.end,s.push(a);return n&&console.log("findTagsByName found",s.length,"tags"),s}e.exports=s,e.exports.default=s},98622:(e,t,r)=>{"use strict";r.d(t,{$:()=>i,AC:()=>h,Hm:()=>u,NZ:()=>n,S3:()=>f,TZ:()=>c,s$:()=>a,ub:()=>l});const i={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},s={};for(const e in i)i.hasOwnProperty(e)&&(s[i[e]]=parseInt(e,10));const n=[s.BitsPerSample,s.ExtraSamples,s.SampleFormat,s.StripByteCounts,s.StripOffsets,s.StripRowCounts,s.TileByteCounts,s.TileOffsets,s.SubIFDs],o={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},a={};for(const e in o)o.hasOwnProperty(e)&&(a[o[e]]=parseInt(e,10));const l={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},h={Unspecified:0,Assocalpha:1,Unassalpha:2},c={Version:0,AddCompression:1},f={None:0,Deflate:1,Zstandard:2},u={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},g={};for(const e in u)u.hasOwnProperty(e)&&(g[u[e]]=parseInt(e,10))}}]);